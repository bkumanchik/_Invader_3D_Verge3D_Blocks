function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).v3d={})}(this,function(e){"use strict";const De="4.0.0 pre3",$={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};const X=0,j=1,K=2;const q=0,Z=1,J=2,ee=3,te=4,ne=5,re=6,Ne=0,Fe=1,Oe=2;const ie=0,ae=1,oe=2,se=3,le=4,ce=5,ue=100,de=101,he=102,pe=103,fe=104,me=200,ge=201,ve=202,Ae=203,_e=204,xe=205,ye=206,be=207,Me=208,Ce=209,Se=210,we=0,Ee=1,Te=2,Ie=3,Re=4,Le=5,Be=6,Pe=7,Ue=0,o=300,T=301,I=302,l=303,c=304,D=306,N=307,k=1e3,ze=1001,Q=1002,Ve=1003,W=1004;const H=1005;const Ge=1006,Y=1007;const ke=1008;const Qe=1009,a=1010,s=1011,We=1012,u=1013,He=1014,Ye=1015,Xe=1016,d=1017,h=1018,je=1020,p=1021,f=1022,Ke=1023,m=1024,g=1025,qe=1026,Ze=1027,Je=1028,v=1029,A=1030,_=1031,x=1033,y=33776,b=33777,M=33778,C=33779,S=35840,w=35841,E=35842,R=35843,L=36196,B=37492,P=37496,F=37808,O=37809,U=37810,z=37811,V=37812,G=37813,$e=37814,et=37815,tt=37816,nt=37817,rt=37818,it=37819,at=37820,ot=37821,st=36492,lt=2300,ct=2301,ut=2400,dt=2401,ht=2402,pt=3e3,ft=3001,i=3201,mt=3301,gt=3302,vt=0,At=1;const _t=34055,xt=34056;const r=35044,n=35048;const yt="300 es",bt=1035,Mt="BLENDER",Ct="__V3DL__0ae7dcee16";class t{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0!==this._listeners){const n=this._listeners[e];void 0===n||-1!==(t=n.indexOf(t))&&n.splice(t,1)}}dispatchEvent(n){if(void 0!==this._listeners){const e=this._listeners[n.type];if(void 0!==e){n.target=this;const r=e.slice(0);for(let e=0,t=r.length;e<t;e++)r[e].call(this,n);n.target=null}}}}const St=[];for(let e=0;e<256;e++)St[e]=(e<16?"0":"")+e.toString(16);let wt=1234567;const Et=Math.PI/180,Tt=180/Math.PI;function It(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;const i=St[255&e]+St[e>>8&255]+St[e>>16&255]+St[e>>24&255]+"-"+St[255&t]+St[t>>8&255]+"-"+St[t>>16&15|64]+St[t>>24&255]+"-"+St[63&n|128]+St[n>>8&255]+"-"+St[n>>16&255]+St[n>>24&255]+St[255&r]+St[r>>8&255]+St[r>>16&255]+St[r>>24&255];return i.toUpperCase()}function Rt(e,t,n){return Math.max(t,Math.min(n,e))}function Lt(e,t){return(e%t+t)%t}function Bt(e,t,n){return(1-n)*e+n*t}function Pt(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)}function Dt(e){return e*Et}function Nt(e){return e*Tt}function Ft(e){return 0==(e&e-1)&&0!==e}function Ot(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ut(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function zt(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function Vt(e,t,n,r){r=Math.exp(-n/r);return e*r+(1-r)*t}function Gt(e,t,n,r,i){let a=Vt(e,t,n,r);return Math.abs(e-t)<i&&(a=t),a}function kt(e){return Rt(e-2*Math.PI*Math.floor(e/(2*Math.PI)),0,2*Math.PI)}function Qt(e){e+=Math.PI;return e%=2*Math.PI,e+=2*Math.PI,e%=2*Math.PI,e-=Math.PI}function Wt(e,t,n){let r=kt(e-t);n=kt(n-t);return r>n&&(r=r<n/2+Math.PI?n:0),r+t}var Ht=Object.freeze({__proto__:null,DEG2RAD:Et,RAD2DEG:Tt,generateUUID:It,clamp:Rt,euclideanModulo:Lt,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Bt,damp:function(e,t,n,r){return Bt(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Lt(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:Pt,randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(wt=e%2147483647),wt=16807*wt%2147483647,(wt-1)/2147483646},degToRad:Dt,radToDeg:Nt,isPowerOfTwo:Ft,ceilPowerOfTwo:Ot,floorPowerOfTwo:Ut,setQuaternionFromProperEuler:function(e,t,n,r,i){const a=Math.cos,o=Math.sin;var s=a(n/2),l=o(n/2),c=a((t+r)/2),u=o((t+r)/2),d=a((t-r)/2),h=o((t-r)/2),p=a((r-t)/2),f=o((r-t)/2);switch(i){case"XYX":e.set(s*u,l*d,l*h,s*c);break;case"YZY":e.set(l*h,s*u,l*d,s*c);break;case"ZXZ":e.set(l*d,l*h,s*u,s*c);break;case"XZX":e.set(s*u,l*f,l*p,s*c);break;case"YXY":e.set(l*p,s*u,l*f,s*c);break;case"ZYZ":e.set(l*f,l*p,s*u,s*c);break;default:console.warn("v3d.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},hashString:zt,expAverage:Vt,expAverageClamp:Gt,angleToRange_0_2Pi:kt,angleToRange_mPi_Pi:Qt,clampAngle:Wt});class Yt{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("v3d.Vector2: .add() now only accepts one argument. Use .addVectors(a, b) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("v3d.Vector2: .sub() now only accepts one argument. Use .subVectors(a, b) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,n=this.y,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6],this.y=e[1]*t+e[4]*n+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("v3d.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,t=this.y-e.y;return this.x=i*n-t*r+e.x,this.y=i*r+t*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Yt.prototype.isVector2=!0;class Xt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("v3d.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var n=e.elements,r=t.elements;const i=this.elements;var a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],A=r[4],e=r[7],t=r[2],n=r[5],r=r[8];return i[0]=a*f+o*v+s*t,i[3]=a*m+o*A+s*n,i[6]=a*g+o*e+s*r,i[1]=l*f+c*v+u*t,i[4]=l*m+c*A+u*n,i[7]=l*g+c*e+u*r,i[2]=d*f+h*v+p*t,i[5]=d*m+h*A+p*n,i[8]=d*g+h*e+p*r,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],e=e[8];return t*a*e-t*o*l-n*i*e+n*o*s+r*i*l-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,d=o*s-c*i,h=l*i-a*s,p=t*u+n*d+r*h;if(0==p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(o*n-r*a)*f,e[3]=d*f,e[4]=(c*t-r*s)*f,e[5]=(r*i-o*t)*f,e[6]=h*f,e[7]=(n*s-l*t)*f,e[8]=(a*t-n*i)*f,this}transpose(){var e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){var s=Math.cos(i),i=Math.sin(i);return this.set(n*s,n*i,-n*(s*a+i*o)+a+e,-r*i,r*s,-r*(-i*a+s*o)+o+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){var t=Math.cos(e),n=Math.sin(e);const r=this.elements;var i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],e=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*e,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*e,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){var t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(t,n=0){for(let e=0;e<9;e++)this.elements[e]=t[e+n];return this}toArray(e=[],t=0){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function jt(n){if(0===n.length)return-1/0;let r=n[0];for(let e=1,t=n.length;e<t;++e)n[e]>r&&(r=n[e]);return r}function Kt(t){for(let e=t.length-1;0<=e;--e)if(65535<t[e])return 1}Xt.prototype.isMatrix3=!0;const qt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Zt(e,t){return new qt[e](t)}function Jt(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function $t(e){return void 0!==e}function en(t,n,r){for(let e=0;e<t.length;e++)t[e]=Rt(t[e],n,r);return t}function tn(){switch(Mt){case"BLENDER":return"for Blender";case"MAX":return"for 3ds Max";case"MAYA":return"for Maya";case"ALL":return"Ultimate";default:return"Unknown"}}function nn(e){return""+(e%1?e:e+".0")}function rn(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:global}const an={};function on(t=""){var n=document.getElementsByTagName("script");let r=t;for(let e=n.length-1;0<=e;--e){const a=n[e].src;var i=a.search(/\/v3d[\w.]+js/);-1<i&&(r=a.substr(0,i)+"/"+t)}return r}function sn(e,t=function(e){},n=function(e){}){an[e]=an[e]||{status:0,loadCallbacks:[],errorCallbacks:[]};const r=an[e];if(4!=r.status){if(r.loadCallbacks.push(t),r.errorCallbacks.push(n),!(0<r.status)){var i,n=on(e);const a=document.createElement("script");a.type="text/javascript",a.src=n,i=e,a.onload=function(){an[i].loadCallbacks.forEach(function(e){e(i)}),an[i].status=4},a.onerror=function(){an[i].errorCallbacks.forEach(function(e){e(i)}),an[i].status=0},document.getElementsByTagName("head")[0].appendChild(a),r.status=3}}else t(e)}function ln(e,a,o=0){let r=Promise.resolve(performance.now());return e.forEach(function(e,t,n){r=r.then(function(e,t,n,r){var i=performance.now();return a(e,t,n),o<i-r?(r=i,new Promise(function(e){setTimeout(function(){e(r)},1)})):r}.bind(null,e,t,n))}),r}const cn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},un={h:0,s:0,l:0},dn={h:0,s:0,l:0};function hn(e,t,n){return n<0&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function pn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function fn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class mn{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){return e=Lt(e,1),t=Rt(t,0,1),n=Rt(n,0,1),0===t?this.r=this.g=this.b=n:(this.r=hn(t=2*n-(n=n<=.5?n*(1+t):n+t-n*t),n,e+1/3),this.g=hn(t,n,e),this.b=hn(t,n,e-1/3)),this}setStyle(t){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("v3d.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let e;var i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(e[1])/360,s=parseInt(e[2],10)/100,l=parseInt(e[3],10)/100;return n(e[4]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const e=r[1];i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this}setColorName(e){var t=cn[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("v3d.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=pn(e.r),this.g=pn(e.g),this.b=pn(e.b),this}copyLinearToSRGB(e){return this.r=fn(e.r),this.g=fn(e.g),this.b=fn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),a=Math.min(t,n,r);let o,s;var l=(a+i)/2;if(a===i)o=0,s=0;else{var c=i-a;switch(s=l<=.5?c/(i+a):c/(2-i-a),i){case t:o=(n-r)/c+(n<r?6:0);break;case n:o=(r-t)/c+2;break;case r:o=(t-n)/c+4}o/=6}return e.h=o,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(un),un.h+=e,un.s+=t,un.l+=n,this.setHSL(un.h,un.s,un.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(un),e.getHSL(dn);var n=Bt(un.h,dn.h,t),e=Bt(un.s,dn.s,t),t=Bt(un.l,dn.l,t);return this.setHSL(n,e,t),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}mn.NAMES=cn,mn.prototype.isColor=!0,mn.prototype.r=1,mn.prototype.g=1,mn.prototype.b=1;let gn;class vn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===gn&&(gn=Jt("canvas")),gn.width=e.width,gn.height=e.height;const n=gn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=gn}return 2048<t.width||2048<t.height?(console.warn("v3d.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=Jt("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);var t=r.getImageData(0,0,e.width,e.height);const i=t.data;for(let e=0;e<i.length;e++)i[e]=255*pn(i[e]/255);return r.putImageData(t,0,0),n}if(e.data){const a=e.data.slice(0);for(let e=0;e<a.length;e++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[e]=Math.floor(255*pn(a[e]/255)):a[e]=pn(a[e]);return{data:a,width:e.width,height:e.height}}return console.warn("v3d.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let An=0;class _n extends t{constructor(e=_n.DEFAULT_IMAGE,t=_n.DEFAULT_MAPPING,n=ze,r=ze,i=Ge,a=ke,o=Ke,s=Qe,l=1,c=pt){super(),Object.defineProperty(this,"id",{value:An++}),this.uuid=It(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Yt(0,0),this.repeat=new Yt(1,1),this.center=new Yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=It()),!t&&void 0===e.images[r.uuid]){let n;if(Array.isArray(r)){n=[];for(let e=0,t=r.length;e<t;e++)r[e].isDataTexture?n.push(xn(r[e].image)):n.push(xn(r[e]))}else n=xn(r);e.images[r.uuid]={uuid:r.uuid,url:n}}n.image=r.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==o)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case k:e.x=e.x-Math.floor(e.x);break;case ze:e.x=e.x<0?0:1;break;case Q:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case k:e.y=e.y-Math.floor(e.y);break;case ze:e.y=e.y<0?0:1;break;case Q:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function xn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?vn.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("v3d.Texture: Unable to serialize Texture."),{})}_n.DEFAULT_IMAGE=void 0,_n.DEFAULT_MAPPING=o,_n.prototype.isTexture=!0;class yn{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("v3d.Vector4: .add() now only accepts one argument. Use .addVectors(a, b) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("v3d.Vector4: .sub() now only accepts one argument. Use .subVectors(a, b) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,n=this.y,r=this.z,i=this.w,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;var a=e.elements,o=a[0],s=a[4],l=a[8],c=a[1],u=a[5],d=a[9],h=a[2],p=a[6],f=a[10];if(Math.abs(s-c)<.01&&Math.abs(l-h)<.01&&Math.abs(d-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+h)<.1&&Math.abs(d+p)<.1&&Math.abs(o+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,g=(u+1)/2,v=(f+1)/2,A=(s+c)/4,e=(l+h)/4,a=(d+p)/4;return g<m&&v<m?i=m<.01?(n=0,r=.707106781):(n=Math.sqrt(m),r=A/n,e/n):v<g?i=g<.01?(n=.707106781,r=0,.707106781):(r=Math.sqrt(g),n=A/r,a/r):v<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=e/i,r=a/i),this.set(n,r,i,t),this}let _=Math.sqrt((p-d)*(p-d)+(l-h)*(l-h)+(c-s)*(c-s));return Math.abs(_)<.001&&(_=1),this.x=(p-d)/_,this.y=(l-h)/_,this.z=(c-s)/_,this.w=Math.acos((o+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("v3d.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}yn.prototype.isVector4=!0;class bn extends t{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new yn(0,0,e,t),this.scissorTest=!1,this.viewport=new yn(0,0,e,t),this.texture=new _n(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Ge,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),Array.isArray(this.texture.image)?this.texture.image=[...this.texture.image]:this.texture.image=_extends({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}bn.prototype.isWebGLRenderTarget=!0;class Mn extends bn{constructor(e,t,n){super(e,t);const r=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=r.clone()}setSize(n,r,i=1){if(this.width!==n||this.height!==r||this.depth!==i){this.width=n,this.height=r,this.depth=i;for(let e=0,t=this.texture.length;e<t;e++)this.texture[e].image.width=n,this.texture[e].image.height=r,this.texture[e].image.depth=i;this.dispose()}return this.viewport.set(0,0,n,r),this.scissor.set(0,0,n,r),this}copy(n){this.dispose(),this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture;for(let e=this.texture.length=0,t=n.texture.length;e<t;e++)this.texture[e]=n.texture[e].clone();return this}}Mn.prototype.isWebGLMultipleRenderTargets=!0;class Cn extends bn{constructor(e,t,n={}){super(e,t,n),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0!==n.ignoreDepth&&n.ignoreDepth,this.useRenderToTexture=void 0!==n.useRenderToTexture&&n.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}Cn.prototype.isWebGLMultisampleRenderTarget=!0;class Sn{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("v3d.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions(qa, qb, t) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];var d=i[a+0],h=i[a+1],p=i[a+2],n=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=n);if(u!==n||s!==d||l!==h||c!==p){let e=1-o;r=s*d+l*h+c*p+u*n,i=0<=r?1:-1,a=1-r*r;a>Number.EPSILON&&(a=Math.sqrt(a),r=Math.atan2(a,r*i),e=Math.sin(e*r)/a,o=Math.sin(o*r)/a);i=o*i;s=s*e+d*i,l=l*e+h*i,c=c*e+p*i,u=u*e+n*i,e===1-o&&(o=1/Math.sqrt(s*s+l*l+c*c+u*u),s*=o,l*=o,c*=o,u*=o)}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){var o=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[a],n=i[a+1],r=i[a+2],a=i[a+3];return e[t]=o*a+c*u+s*r-l*n,e[t+1]=s*a+c*n+l*u-o*r,e[t+2]=l*a+c*r+o*n-s*u,e[t+3]=c*a-o*u-s*n-l*r,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("v3d.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e._order;const o=Math.cos,s=Math.sin;var l=o(n/2),c=o(r/2),u=o(i/2),d=s(n/2),h=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:console.warn("v3d.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var n=t/2,t=Math.sin(n);return this._x=e.x*t,this._y=e.y*t,this._z=e.z*t,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){var t,n=e.elements,r=n[0],i=n[4],a=n[8],o=n[1],s=n[5],l=n[9],c=n[2],u=n[6],e=n[10],n=r+s+e;return 0<n?(n=.5/Math.sqrt(n+1),this._w=.25/n,this._x=(u-l)*n,this._y=(a-c)*n,this._z=(o-i)*n):s<r&&e<r?(t=2*Math.sqrt(1+r-s-e),this._w=(u-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+c)/t):e<s?(t=2*Math.sqrt(1+s-r-e),this._w=(a-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+u)/t):(s=2*Math.sqrt(1+e-r-s),this._w=(o-i)/s,this._x=(a+c)/s,this._y=(l+u)/s,this._z=.25*s),this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rt(this.dot(e),-1,1)))}rotateTowards(e,t){var n=this.angleTo(e);if(0===n)return this;n=Math.min(1,t/n);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("v3d.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions(a, b) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,e=t._z,t=t._w;return this._x=n*t+a*o+r*e-i*s,this._y=r*t+a*s+i*o-n*e,this._z=i*t+a*e+n*s-r*o,this._w=a*t-n*o-r*s-i*e,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w;let o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),1<=o)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}e=Math.sqrt(s),l=Math.atan2(e,o),s=Math.sin((1-t)*l)/e,e=Math.sin(t*l)/e;return this._w=a*s+this._w*e,this._x=n*s+this._x*e,this._y=r*s+this._y*e,this._z=i*s+this._z*e,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(e),n*Math.cos(e),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Sn.prototype.isQuaternion=!0;class wn{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("v3d.Vector3: .add() now only accepts one argument. Use .addVectors(a, b) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("v3d.Vector3: .sub() now only accepts one argument. Use .subVectors(a, b) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("v3d.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors(a, b) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("v3d.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Tn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Tn.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,n=this.y,r=this.z,i=e.elements,e=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*e,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*e,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*e,this}applyQuaternion(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,c=s*n+o*t-i*r,e=s*r+i*n-a*t,r=-i*t-a*n-o*r;return this.x=l*s+r*-i+c*-o-e*-a,this.y=c*s+r*-a+e*-i-l*-o,this.z=e*s+r*-o+l*-a-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("v3d.Vector3: .cross() now only accepts one argument. Use .crossVectors(a, b) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,e=t.y,t=t.z;return this.x=r*t-i*e,this.y=i*a-n*t,this.z=n*e-r*a,this}projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);t=e.dot(this)/t;return this.copy(e).multiplyScalar(t)}projectOnPlane(e){return En.copy(this).projectOnVector(e),this.sub(En)}reflect(e){return this.sub(En.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;t=this.dot(e)/t;return Math.acos(Rt(t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,n=this.y-e.y,e=this.z-e.z;return t*t+n*n+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("v3d.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}wn.prototype.isVector3=!0;const En=new wn,Tn=new Sn;class In{constructor(e=new wn(1/0,1/0,1/0),t=new wn(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(n){let r=1/0,i=1/0,a=1/0,o=-1/0,s=-1/0,l=-1/0;for(let e=0,t=n.length;e<t;e+=3){var c=n[e],u=n[e+1],d=n[e+2];c<r&&(r=c),u<i&&(i=u),d<a&&(a=d),c>o&&(o=c),u>s&&(s=u),d>l&&(l=d)}return this.min.set(r,i,a),this.max.set(o,s,l),this}setFromBufferAttribute(n){let r=1/0,i=1/0,a=1/0,o=-1/0,s=-1/0,l=-1/0;for(let e=0,t=n.count;e<t;e++){var c=n.getX(e),u=n.getY(e),d=n.getZ(e);c<r&&(r=c),u<i&&(i=u),d<a&&(a=d),c>o&&(o=c),u>s&&(s=u),d>l&&(l=d)}return this.min.set(r,i,a),this.max.set(o,s,l),this}setFromPoints(n){this.makeEmpty();for(let e=0,t=n.length;e<t;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(e,t){t=Ln.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(n,r=!1){n.updateWorldMatrix(!1,!1);const e=n.geometry;if(void 0!==e)if(r&&null!=e.attributes&&void 0!==e.attributes.position){var i=e.attributes.position;for(let e=0,t=i.count;e<t;e++)Ln.fromBufferAttribute(i,e).applyMatrix4(n.matrixWorld),this.expandByPoint(Ln)}else null===e.boundingBox&&e.computeBoundingBox(),Bn.copy(e.boundingBox),Bn.applyMatrix4(n.matrixWorld),this.union(Bn);var a=n.children;for(let e=0,t=a.length;e<t;e++)this.expandByObject(a[e],r);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ln),Ln.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return n=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter(zn),Vn.subVectors(this.max,zn),Pn.subVectors(e.a,zn),Dn.subVectors(e.b,zn),Nn.subVectors(e.c,zn),Fn.subVectors(Dn,Pn),On.subVectors(Nn,Dn),Un.subVectors(Pn,Nn),!!Qn([0,-Fn.z,Fn.y,0,-On.z,On.y,0,-Un.z,Un.y,Fn.z,0,-Fn.x,On.z,0,-On.x,Un.z,0,-Un.x,-Fn.y,Fn.x,0,-On.y,On.x,0,-Un.y,Un.x,0],Pn,Dn,Nn,Vn)&&(!!Qn([1,0,0,0,1,0,0,0,1],Pn,Dn,Nn,Vn)&&(Gn.crossVectors(Fn,On),Qn([Gn.x,Gn.y,Gn.z],Pn,Dn,Nn,Vn))))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=Ln.copy(e).clamp(this.min,this.max);return t.sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Ln).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Rn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Rn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Rn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Rn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Rn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Rn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Rn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Rn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Rn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}In.prototype.isBox3=!0;const Rn=[new wn,new wn,new wn,new wn,new wn,new wn,new wn,new wn],Ln=new wn,Bn=new In,Pn=new wn,Dn=new wn,Nn=new wn,Fn=new wn,On=new wn,Un=new wn,zn=new wn,Vn=new wn,Gn=new wn,kn=new wn;function Qn(n,r,i,a,o){for(let e=0,t=n.length-3;e<=t;e+=3){kn.fromArray(n,e);var s=o.x*Math.abs(kn.x)+o.y*Math.abs(kn.y)+o.z*Math.abs(kn.z),l=r.dot(kn),c=i.dot(kn),u=a.dot(kn);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}const Wn=new In,Hn=new wn,Yn=new wn,Xn=new wn;class jn{constructor(e=new wn,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(n,e){const r=this.center;void 0!==e?r.copy(e):Wn.setFromPoints(n).getCenter(r);let i=0;for(let e=0,t=n.length;e<t;e++)i=Math.max(i,r.distanceToSquared(n[e]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Xn.subVectors(e,this.center);var t=Xn.lengthSq();return t>this.radius*this.radius&&(t=.5*((e=Math.sqrt(t))-this.radius),this.center.add(Xn.multiplyScalar(t/e)),this.radius+=t),this}union(e){return(!0===this.center.equals(e.center)?Yn.set(0,0,1):Yn.subVectors(e.center,this.center).normalize()).multiplyScalar(e.radius),this.expandByPoint(Hn.copy(e.center).add(Yn)),this.expandByPoint(Hn.copy(e.center).sub(Yn)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Kn=new wn,qn=new wn,Zn=new wn,Jn=new wn,$n=new wn,er=new wn,tr=new wn;class nr{constructor(e=new wn,t=new wn(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Kn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=Kn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Kn.copy(this.direction).multiplyScalar(t).add(this.origin),Kn.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){qn.copy(e).add(t).multiplyScalar(.5),Zn.copy(t).sub(e).normalize(),Jn.copy(this.origin).sub(qn);var i=.5*e.distanceTo(t),a=-this.direction.dot(Zn),o=Jn.dot(this.direction),s=-Jn.dot(Zn),e=Jn.lengthSq(),t=Math.abs(1-a*a);let l,c,u,d;return u=0<t?(l=a*s-o,c=a*o-s,d=i*t,0<=l?c>=-d?c<=d?(t=1/t,l*=t,c*=t,l*(l+a*c+2*o)+c*(a*l+c+2*s)+e):(c=i,l=Math.max(0,-(a*c+o)),-l*l+c*(c+2*s)+e):(c=-i,l=Math.max(0,-(a*c+o)),-l*l+c*(c+2*s)+e):c<=-d?(l=Math.max(0,-(-a*i+o)),c=0<l?-i:Math.min(Math.max(-i,-s),i),-l*l+c*(c+2*s)+e):c<=d?(l=0,c=Math.min(Math.max(-i,-s),i),c*(c+2*s)+e):(l=Math.max(0,-(a*i+o)),c=0<l?i:Math.min(Math.max(-i,-s),i),-l*l+c*(c+2*s)+e)):(c=0<a?-i:i,l=Math.max(0,-(a*c+o)),-l*l+c*(c+2*s)+e),n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),r&&r.copy(Zn).multiplyScalar(c).add(qn),u}intersectSphere(e,t){Kn.subVectors(e.center,this.origin);var n=Kn.dot(this.direction),r=Kn.dot(Kn)-n*n,e=e.radius*e.radius;if(e<r)return null;e=Math.sqrt(e-r),r=n-e,e=n+e;return r<0&&e<0?null:r<0?this.at(e,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=t?t:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;var l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return r=0<=l?(n=(e.min.x-d.x)*l,(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,(e.min.x-d.x)*l),a=0<=c?(i=(e.min.y-d.y)*c,(e.max.y-d.y)*c):(i=(e.max.y-d.y)*c,(e.min.y-d.y)*c),n>a||i>r?null:((i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),s=0<=u?(o=(e.min.z-d.z)*u,(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,(e.min.z-d.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(0<=n?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Kn)}intersectTriangle(e,t,n,r,i){$n.subVectors(t,e),er.subVectors(n,e),tr.crossVectors($n,er);let a=this.direction.dot(tr),o;if(0<a){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Jn.subVectors(this.origin,e);r=o*this.direction.dot(er.crossVectors(Jn,er));if(r<0)return null;e=o*this.direction.dot($n.cross(Jn));if(e<0)return null;if(r+e>a)return null;e=-o*Jn.dot(tr);return e<0?null:this.at(e/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class rr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("v3d.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,a,o,s,l,c,u,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new rr).fromArray(this.elements)}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements;var n=e.elements,r=1/ir.setFromMatrixColumn(e,0).length(),i=1/ir.setFromMatrixColumn(e,1).length(),e=1/ir.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("v3d.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements;var n,r,i,a,o,s,l,c,u,d,h,p=e.x,f=e.y,m=e.z,g=Math.cos(p),v=Math.sin(p),A=Math.cos(f),_=Math.sin(f),p=Math.cos(m),f=Math.sin(m);return"XYZ"===e.order?(n=g*p,i=g*f,r=v*p,m=v*f,t[0]=A*p,t[4]=-A*f,t[8]=_,t[1]=i+r*_,t[5]=n-m*_,t[9]=-v*A,t[2]=m-n*_,t[6]=r+i*_,t[10]=g*A):"YXZ"===e.order?(a=A*p,n=A*f,r=_*p,i=_*f,t[0]=a+i*v,t[4]=r*v-n,t[8]=g*_,t[1]=g*f,t[5]=g*p,t[9]=-v,t[2]=n*v-r,t[6]=i+a*v,t[10]=g*A):"ZXY"===e.order?(l=A*p,a=A*f,o=_*p,s=_*f,t[0]=l-s*v,t[4]=-g*f,t[8]=o+a*v,t[1]=a+o*v,t[5]=g*p,t[9]=s-l*v,t[2]=-g*_,t[6]=v,t[10]=g*A):"ZYX"===e.order?(o=g*p,s=g*f,c=v*p,l=v*f,t[0]=A*p,t[4]=c*_-s,t[8]=o*_+l,t[1]=A*f,t[5]=l*_+o,t[9]=s*_-c,t[2]=-_,t[6]=v*A,t[10]=g*A):"YZX"===e.order?(d=g*A,c=g*_,u=v*A,h=v*_,t[0]=A*p,t[4]=h-d*f,t[8]=u*f+c,t[1]=f,t[5]=g*p,t[9]=-v*p,t[2]=-_*p,t[6]=c*f+u,t[10]=d-h*f):"XZY"===e.order&&(u=g*A,d=g*_,h=v*A,e=v*_,t[0]=A*p,t[4]=-f,t[8]=_*p,t[1]=u*f+e,t[5]=g*p,t[9]=d*f-h,t[2]=h*f-d,t[6]=v*p,t[10]=e*f+u),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(or,e,sr)}lookAt(e,t,n){const r=this.elements;return ur.subVectors(e,t),0===ur.lengthSq()&&(ur.z=1),ur.normalize(),lr.crossVectors(n,ur),0===lr.lengthSq()&&(1===Math.abs(n.z)?ur.x+=1e-4:ur.z+=1e-4,ur.normalize(),lr.crossVectors(n,ur)),lr.normalize(),cr.crossVectors(ur,lr),r[0]=lr.x,r[4]=cr.x,r[8]=ur.x,r[1]=lr.y,r[5]=cr.y,r[9]=ur.y,r[2]=lr.z,r[6]=cr.z,r[10]=ur.z,this}multiply(e,t){return void 0!==t?(console.warn("v3d.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices(a, b) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var n=e.elements,r=t.elements;const i=this.elements;var a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],A=n[7],_=n[11],x=n[15],y=r[0],b=r[4],M=r[8],C=r[12],S=r[1],w=r[5],E=r[9],T=r[13],I=r[2],R=r[6],L=r[10],B=r[14],e=r[3],t=r[7],n=r[11],r=r[15];return i[0]=a*y+o*S+s*I+l*e,i[4]=a*b+o*w+s*R+l*t,i[8]=a*M+o*E+s*L+l*n,i[12]=a*C+o*T+s*B+l*r,i[1]=c*y+u*S+d*I+h*e,i[5]=c*b+u*w+d*R+h*t,i[9]=c*M+u*E+d*L+h*n,i[13]=c*C+u*T+d*B+h*r,i[2]=p*y+f*S+m*I+g*e,i[6]=p*b+f*w+m*R+g*t,i[10]=p*M+f*E+m*L+g*n,i[14]=p*C+f*T+m*B+g*r,i[3]=v*y+A*S+_*I+x*e,i[7]=v*b+A*w+_*R+x*t,i[11]=v*M+A*E+_*L+x*n,i[15]=v*C+A*T+_*B+x*r,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+i*s*u-r*l*u-i*o*d+n*l*d+r*o*h-n*s*h)+e[7]*(+t*s*h-t*l*d+i*a*d-r*a*h+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*h-i*a*u+n*a*h+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*d+r*a*u-n*a*d+n*s*c)}transpose(){const e=this.elements;var t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*d*l+f*s*h-o*m*h-u*s*g+o*d*g,A=p*d*l-c*m*l-p*s*h+a*m*h+c*s*g-a*d*g,_=c*f*l-p*u*l+p*o*h-a*f*h-c*o*g+a*u*g,x=p*u*s-c*f*s-p*o*d+a*f*d+c*o*m-a*u*m;var y=t*v+n*A+r*_+i*x;if(0==y)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);y=1/y;return e[0]=v*y,e[1]=(f*d*i-u*m*i-f*r*h+n*m*h+u*r*g-n*d*g)*y,e[2]=(o*m*i-f*s*i+f*r*l-n*m*l-o*r*g+n*s*g)*y,e[3]=(u*s*i-o*d*i-u*r*l+n*d*l+o*r*h-n*s*h)*y,e[4]=A*y,e[5]=(c*m*i-p*d*i+p*r*h-t*m*h-c*r*g+t*d*g)*y,e[6]=(p*s*i-a*m*i-p*r*l+t*m*l+a*r*g-t*s*g)*y,e[7]=(a*d*i-c*s*i+c*r*l-t*d*l-a*r*h+t*s*h)*y,e[8]=_*y,e[9]=(p*u*i-c*f*i-p*n*h+t*f*h+c*n*g-t*u*g)*y,e[10]=(a*f*i-p*o*i+p*n*l-t*f*l-a*n*g+t*o*g)*y,e[11]=(c*o*i-a*u*i-c*n*l+t*u*l+a*n*h-t*o*h)*y,e[12]=x*y,e[13]=(c*f*r-p*u*r+p*n*d-t*f*d-c*n*m+t*u*m)*y,e[14]=(p*o*r-a*f*r-p*n*s+t*f*s+a*n*m-t*o*m)*y,e[15]=(a*u*r-c*o*r+c*n*s-t*u*s-a*n*d+t*o*d)*y,this}scale(e){const t=this.elements;var n=e.x,r=e.y,e=e.z;return t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,e))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,t=i*a,e=i*o;return this.set(t*a+n,t*o-r*s,t*s+r*o,0,t*o+r*s,e*o+n,e*s-r*a,0,t*s-r*o,e*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements;var i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,d=i*l,h=i*c,p=i*u,t=a*c,i=a*u,a=o*u,o=s*l,l=s*c,c=s*u,s=n.x,u=n.y,n=n.z;return r[0]=(1-(t+a))*s,r[1]=(h+c)*s,r[2]=(p-l)*s,r[3]=0,r[4]=(h-c)*u,r[5]=(1-(d+a))*u,r[6]=(i+o)*u,r[7]=0,r[8]=(p+l)*n,r[9]=(i-o)*n,r[10]=(1-(d+t))*n,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){var r=this.elements;let i=ir.set(r[0],r[1],r[2]).length();var a=ir.set(r[4],r[5],r[6]).length(),o=ir.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],ar.copy(this);var s=1/i,e=1/a,r=1/o;return ar.elements[0]*=s,ar.elements[1]*=s,ar.elements[2]*=s,ar.elements[4]*=e,ar.elements[5]*=e,ar.elements[6]*=e,ar.elements[8]*=r,ar.elements[9]*=r,ar.elements[10]*=r,t.setFromRotationMatrix(ar),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a){void 0===a&&console.warn("v3d.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements;var s=2*i/(n-r),l=(t+e)/(t-e),n=(n+r)/(n-r),r=-(a+i)/(a-i),a=-2*a*i/(a-i);return o[0]=2*i/(t-e),o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=s,o[9]=n,o[13]=0,o[2]=0,o[6]=0,o[10]=r,o[14]=a,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,a){const o=this.elements;var s=1/(t-e),l=1/(n-r),c=1/(a-i),e=(t+e)*s,r=(n+r)*l,i=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-e,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-r,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-i,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){var t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(t,n=0){for(let e=0;e<16;e++)this.elements[e]=t[e+n];return this}toArray(e=[],t=0){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}composeE(e,t,n){const r=this.elements;this.makeRotationFromEuler(t);var i=n.x,t=n.y,n=n.z;return r[0]*=i,r[1]*=i,r[2]*=i,r[3]=0,r[4]*=t,r[5]*=t,r[6]*=t,r[7]=0,r[8]*=n,r[9]*=n,r[10]*=n,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decomposeE(e,t,n,r=t.order){var i=this.elements;let a=ir.set(i[0],i[1],i[2]).length();var o=ir.set(i[4],i[5],i[6]).length(),s=ir.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),e.x=i[12],e.y=i[13],e.z=i[14],ar.copy(this);var l=1/a,e=1/o,i=1/s;return ar.elements[0]*=l,ar.elements[1]*=l,ar.elements[2]*=l,ar.elements[4]*=e,ar.elements[5]*=e,ar.elements[6]*=e,ar.elements[8]*=i,ar.elements[9]*=i,ar.elements[10]*=i,t.setFromRotationMatrix(ar,r),n.x=a,n.y=o,n.z=s,this}}rr.prototype.isMatrix4=!0;const ir=new wn,ar=new rr,or=new wn(0,0,0),sr=new wn(1,1,1),lr=new wn,cr=new wn,ur=new wn,dr=new rr,hr=new Sn;class pr{constructor(e=0,t=0,n=0,r=pr.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){var e=e.elements,r=e[0],i=e[4],a=e[8],o=e[1],s=e[5],l=e[9],c=e[2],u=e[6],d=e[10];switch(t){case"XYZ":this._y=Math.asin(Rt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-i,r)):(this._x=Math.atan2(u,s),this._z=0);break;case"YXZ":this._x=Math.asin(-Rt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,s)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(Rt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-i,s)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Rt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-i,s));break;case"YZX":this._z=Math.asin(Rt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,s),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Rt(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(u,s),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("v3d.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return dr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(dr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return hr.setFromEuler(this),this.setFromQuaternion(hr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new wn(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}makeAlternative(){var e="X"===this._order[1]?-1:1,t="Y"===this._order[1]?-1:1,n="Z"===this._order[1]?-1:1;return this._x=Qt(e*(this._x+Math.PI)),this._y=Qt(t*(this._y+Math.PI)),this._z=Qt(n*(this._z+Math.PI)),this}equalsEps(e,t){return Math.abs(this._x-e._x)<t&&Math.abs(this._y-e._y)<t&&Math.abs(this._z-e._z)<t&&this._order===e._order}}pr.prototype.isEuler=!0,pr.DefaultOrder="XYZ",pr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class fr{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let mr=0;const gr=new wn,vr=new Sn,Ar=new rr,_r=new wn,xr=new wn,yr=new wn,br=new Sn,Mr=new wn(1,0,0),Cr=new wn(0,1,0),Sr=new wn(0,0,1),wr={type:"added"},Er={type:"removed"};class Tr extends t{constructor(){super(),Object.defineProperty(this,"id",{value:mr++}),this.uuid=It(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tr.DefaultUp.clone();var e=new wn;const t=new pr,n=new Sn;var r=new wn(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new rr},normalMatrix:{value:new Xt}}),this.matrix=new rr,this.matrixWorld=new rr,this.matrixAutoUpdate=Tr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fr,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={},this.internVisible=!0,this.externVisible=!0,this.constraints=[],this.disableChildRendering=!1,this.hidpiCompositing=!1,this.groupNames=[],this.objectIndex=0,this.objectColor=new mn}set visible(e){this.externVisible=e}get visible(){return this.internVisible&&this.externVisible}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return vr.setFromAxisAngle(e,t),this.quaternion.multiply(vr),this}rotateOnWorldAxis(e,t){return vr.setFromAxisAngle(e,t),this.quaternion.premultiply(vr),this}rotateX(e){return this.rotateOnAxis(Mr,e)}rotateY(e){return this.rotateOnAxis(Cr,e)}rotateZ(e){return this.rotateOnAxis(Sr,e)}translateOnAxis(e,t){return gr.copy(e).applyQuaternion(this.quaternion),this.position.add(gr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Mr,e)}translateY(e){return this.translateOnAxis(Cr,e)}translateZ(e){return this.translateOnAxis(Sr,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ar.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?_r.copy(e):_r.set(e,t,n);n=this.parent;this.updateWorldMatrix(!0,!1),xr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ar.lookAt(xr,_r,this.up):Ar.lookAt(_r,xr,this.up),this.quaternion.setFromRotationMatrix(Ar),n&&(Ar.extractRotation(n.matrixWorld),vr.setFromRotationMatrix(Ar),this.quaternion.premultiply(vr.invert()))}add(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("v3d.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(wr)):console.error("v3d.Object3D.add: object not an instance of v3d.Object3D.",e),this}remove(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Er)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Er)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ar.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ar.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ar),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(n,r){if(this[n]===r)return this;for(let e=0,t=this.children.length;e<t;e++){const a=this.children[e];var i=a.getObjectByProperty(n,r);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xr,e,yr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xr,br,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[4],t[5],t[6]).normalize()}raycast(){}traverse(n){n(this);const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].traverse(n)}traverseVisible(n){if(!1!==this.visible){n(this);const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].traverseVisible(n)}}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.updateConstraints(),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n=!(this.matrixWorldNeedsUpdate=!1));const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(n)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].updateWorldMatrix(!1,!0)}}toJSON(n){var e,t,r,i,a,o=void 0===n||"string"==typeof n;const s={};o&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const l={};function c(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(n)),t.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),!1===this.disableChildRendering&&(l.disableChildRendering=!1),!0===this.hidpiCompositing&&(l.hidpiCompositing=!0),0!==this.objectIndex&&(l.objectIndex=this.objectIndex),this.objectColor&&this.objectColor.isColor&&(l.objectColor=this.objectColor.getHex()),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(l.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&(l.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=c(n.geometries,this.geometry);var u=this.geometry.parameters;if(void 0!==u&&void 0!==u.shapes){var d=u.shapes;if(Array.isArray(d))for(let e=0,t=d.length;e<t;e++){var h=d[e];c(n.shapes,h)}else c(n.shapes,d)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(c(n.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const m=[];for(let e=0,t=this.material.length;e<t;e++)m.push(c(n.materials,this.material[e]));l.material=m}else l.material=c(n.materials,this.material);if(0<this.children.length){l.children=[];for(let e=0;e<this.children.length;e++)l.children.push(this.children[e].toJSON(n).object)}if(0<this.animations.length){l.animations=[];for(let e=0;e<this.animations.length;e++){var p=this.animations[e];l.animations.push(c(n.animations,p))}}return o&&(e=f(n.geometries),t=f(n.materials),r=f(n.textures),i=f(n.images),a=f(n.shapes),u=f(n.skeletons),o=f(n.animations),0<e.length&&(s.geometries=e),0<t.length&&(s.materials=t),0<r.length&&(s.textures=r),0<i.length&&(s.images=i),0<a.length&&(s.shapes=a),0<u.length&&(s.skeletons=u),0<o.length&&(s.animations=o)),s.object=l,s;function f(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(t,e=!0){this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.disableChildRendering=t.disableChildRendering,this.hidpiCompositing=t.hidpiCompositing,this.objectIndex=t.objectIndex,this.objectColor.copy(t.objectColor),this.constraints=[];for(let e=0;e<t.constraints.length;e++)this.constraints.push(t.constraints[e].clone());if(this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}copyTransform(e){this.matrix.copy(e.matrixWorld),this.parent&&this.matrix.multiplyMatrices(Ar.copy(this.parent.matrixWorld).invert(),this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)}isVisible(){return this.visible}updateConstraints(){for(let e=0;e<this.constraints.length;e++)this.constraints[e].update(this)}getWorldPositionNU(e){return e.setFromMatrixPosition(this.matrixWorld)}getLocalDirection(e){var t=this.matrix.elements;return(this.isCamera||this.isLight?e.set(-t[8],-t[9],-t[10]):e.set(t[8],t[9],t[10])).normalize()}lookAtLocal(e,t,n){e.isVector3?_r.copy(e):_r.set(e,t,n),xr.setFromMatrixPosition(this.matrix),this.isCamera||this.isLight?Ar.lookAt(xr,_r,this.up):Ar.lookAt(_r,xr,this.up),this.quaternion.setFromRotationMatrix(Ar)}findRoot(){let t=this;return this.traverseAncestors(function(e){t=e}),t}resolveMultiMaterial(){const t=[];for(let e=0;e<this.children.length;e++){var n=this.children[e];n.isMesh&&n.isMaterialGeneratedMesh&&t.push(n)}return t.length||t.push(this),t}getAuxClippingMeshes(){const t=[];for(let e=0;e<this.children.length;e++){var n=this.children[e];n.isMesh&&n.isAuxClippingMesh&&t.push(n)}return t}getWorldEuler(e,t=e._order){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decomposeE(xr,e,yr,t),e}}Tr.DefaultUp=new wn(0,1,0),Tr.DefaultMatrixAutoUpdate=!0,Tr.prototype.isObject3D=!0;const Ir=new wn,Rr=new wn,Lr=new wn,Br=new wn,Pr=new wn,Dr=new wn,Nr=new wn,Fr=new wn,Or=new wn,Ur=new wn;class zr{constructor(e=new wn,t=new wn,n=new wn){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Ir.subVectors(e,t),r.cross(Ir);t=r.lengthSq();return 0<t?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Ir.subVectors(r,t),Rr.subVectors(n,t),Lr.subVectors(e,t);var a=Ir.dot(Ir),o=Ir.dot(Rr),r=Ir.dot(Lr),n=Rr.dot(Rr),e=Rr.dot(Lr),t=a*n-o*o;if(0==t)return i.set(-2,-1,-1);t=1/t,n=(n*r-o*e)*t,t*=a*e-o*r;return i.set(1-n-t,t,n)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Br),0<=Br.x&&0<=Br.y&&Br.x+Br.y<=1}static getUV(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,Br),s.set(0,0),s.addScaledVector(i,Br.x),s.addScaledVector(a,Br.y),s.addScaledVector(o,Br.z),s}static isFrontFacing(e,t,n,r){return Ir.subVectors(n,t),Rr.subVectors(e,t),Ir.cross(Rr).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ir.subVectors(this.c,this.b),Rr.subVectors(this.a,this.b),.5*Ir.cross(Rr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return zr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return zr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return zr.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return zr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return zr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){var n=this.a,r=this.b,i=this.c;let a,o;Pr.subVectors(r,n),Dr.subVectors(i,n),Fr.subVectors(e,n);var s=Pr.dot(Fr),l=Dr.dot(Fr);if(s<=0&&l<=0)return t.copy(n);Or.subVectors(e,r);var c=Pr.dot(Or),u=Dr.dot(Or);if(0<=c&&u<=c)return t.copy(r);var d=s*u-c*l;if(d<=0&&0<=s&&c<=0)return a=s/(s-c),t.copy(n).addScaledVector(Pr,a);Ur.subVectors(e,i);var h=Pr.dot(Ur),e=Dr.dot(Ur);if(0<=e&&h<=e)return t.copy(i);s=h*l-s*e;if(s<=0&&0<=l&&e<=0)return o=l/(l-e),t.copy(n).addScaledVector(Dr,o);l=c*e-h*u;if(l<=0&&0<=u-c&&0<=h-e)return Nr.subVectors(i,r),o=(u-c)/(u-c+(h-e)),t.copy(r).addScaledVector(Nr,o);l=1/(l+s+d);return a=s*l,o=d*l,t.copy(n).addScaledVector(Pr,a).addScaledVector(Dr,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Vr=0;class Gr extends t{constructor(){super(),Object.defineProperty(this,"id",{value:Vr++}),this.uuid=It(),this.name="",this.type="Material",this.fog=!0,this.blending=ae,this.side=Ne,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=_e,this.blendDst=xe,this.blendEquation=ue,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ie,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0,this.receiveShadow=!1,this.castShadow=!1,this.useHDR=!1,this.profile="",this.defines={},this.DefaultEnvMapAutoAssign=!0,this.envMapAutoAssign=this.DefaultEnvMapAutoAssign,this.gtaoVisible=!0}get alphaTest(){return this._alphaTest}set alphaTest(e){0<this._alphaTest!=0<e&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const n in e){var t=e[n];if(void 0!==t)if("shading"!==n){const r=this[n];void 0!==r?r&&r.isColor?r.set(t):r&&r.isVector3&&t&&t.isVector3?r.copy(t):this[n]=t:console.warn("v3d."+this.type+": '"+n+"' is not a property of this material.")}else console.warn("v3d."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t;else console.warn("v3d.Material: '"+n+"' parameter is undefined.")}}toJSON(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&!this.isMeshNodeMaterial&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ae&&(n.blending=this.blending),this.side!==Ne&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t&&(t=r(e.textures),e=r(e.images),0<t.length&&(n.textures=t),0<e.length&&(n.images=e)),n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){var r=t.length;n=new Array(r);for(let e=0;e!==r;++e)n[e]=t[e].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.defines=Object.assign({},e.defines),this.receiveShadow=e.receiveShadow,this.castShadow=e.castShadow,this.useHDR=e.useHDR,this.profile=e.profile,this.envMapAutoAssign=e.envMapAutoAssign,this.gtaoVisible=e.gtaoVisible,this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}get needsUpdate(){return 0!=this.version}}Gr.prototype.isMaterial=!0;class kr extends Gr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new mn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}kr.prototype.isMeshBasicMaterial=!0;const Qr=new wn,Wr=new Yt;class Hr{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("v3d.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=r,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(n,r,i){n*=this.itemSize,i*=r.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[n+e]=r.array[i+e];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("v3d.BufferAttribute.copyColorsArray(): color is undefined",t),e=new mn),r[i++]=e.r,r[i++]=e.g,r[i++]=e.b}return this}copyVector2sArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("v3d.BufferAttribute.copyVector2sArray(): vector is undefined",t),e=new Yt),r[i++]=e.x,r[i++]=e.y}return this}copyVector3sArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("v3d.BufferAttribute.copyVector3sArray(): vector is undefined",t),e=new wn),r[i++]=e.x,r[i++]=e.y,r[i++]=e.z}return this}copyVector4sArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("v3d.BufferAttribute.copyVector4sArray(): vector is undefined",t),e=new yn),r[i++]=e.x,r[i++]=e.y,r[i++]=e.z,r[i++]=e.w}return this}applyMatrix3(n){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)Wr.fromBufferAttribute(this,e),Wr.applyMatrix3(n),this.setXY(e,Wr.x,Wr.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)Qr.fromBufferAttribute(this,e),Qr.applyMatrix3(n),this.setXYZ(e,Qr.x,Qr.y,Qr.z);return this}applyMatrix4(n){for(let e=0,t=this.count;e<t;e++)Qr.x=this.getX(e),Qr.y=this.getY(e),Qr.z=this.getZ(e),Qr.applyMatrix4(n),this.setXYZ(e,Qr.x,Qr.y,Qr.z);return this}applyNormalMatrix(n){for(let e=0,t=this.count;e<t;e++)Qr.x=this.getX(e),Qr.y=this.getY(e),Qr.z=this.getZ(e),Qr.applyNormalMatrix(n),this.setXYZ(e,Qr.x,Qr.y,Qr.z);return this}transformDirection(n){for(let e=0,t=this.count;e<t;e++)Qr.x=this.getX(e),Qr.y=this.getY(e),Qr.z=this.getZ(e),Qr.transformDirection(n),this.setXYZ(e,Qr.x,Qr.y,Qr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==r&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Hr.prototype.isBufferAttribute=!0;class Yr extends Hr{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Xr extends Hr{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class jr extends Hr{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Kr extends Hr{constructor(e,t,n){super(new Int16Array(e),t,n)}}class qr extends Hr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Zr extends Hr{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Jr extends Hr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class $r extends Hr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}$r.prototype.isFloat16BufferAttribute=!0;class ei extends Hr{constructor(e,t,n){super(new Float32Array(e),t,n)}}class ti extends Hr{constructor(e,t,n){super(new Float64Array(e),t,n)}}let ni=0;const ri=new rr,ii=new Tr,ai=new wn,oi=new In,si=new In,li=new wn;class ci extends t{constructor(){super(),Object.defineProperty(this,"id",{value:ni++}),this.uuid=It(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Kt(e)?Jr:qr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;var r;void 0!==n&&(r=(new Xt).getNormalMatrix(e),n.applyNormalMatrix(r),n.needsUpdate=!0);const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ri.makeRotationFromQuaternion(e),this.applyMatrix4(ri),this}rotateX(e){return ri.makeRotationX(e),this.applyMatrix4(ri),this}rotateY(e){return ri.makeRotationY(e),this.applyMatrix4(ri),this}rotateZ(e){return ri.makeRotationZ(e),this.applyMatrix4(ri),this}translate(e,t,n){return ri.makeTranslation(e,t,n),this.applyMatrix4(ri),this}scale(e,t,n){return ri.makeScale(e,t,n),this.applyMatrix4(ri),this}lookAt(e){return ii.lookAt(e),ii.updateMatrix(),this.applyMatrix4(ii.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ai).negate(),this.translate(ai.x,ai.y,ai.z),this}setFromPoints(n){const r=[];for(let e=0,t=n.length;e<t;e++){var i=n[e];r.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ei(r,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new In);var e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('v3d.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new wn(-1/0,-1/0,-1/0),new wn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),n)for(let e=0,t=n.length;e<t;e++){var r=n[e];oi.setFromBufferAttribute(r),this.morphTargetsRelative?(li.addVectors(this.boundingBox.min,oi.min),this.boundingBox.expandByPoint(li),li.addVectors(this.boundingBox.max,oi.max),this.boundingBox.expandByPoint(li)):(this.boundingBox.expandByPoint(oi.min),this.boundingBox.expandByPoint(oi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('v3d.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new jn);var r=this.attributes.position,i=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('v3d.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new wn,1/0);if(r){const l=this.boundingSphere.center;if(oi.setFromBufferAttribute(r),i)for(let e=0,t=i.length;e<t;e++){var a=i[e];si.setFromBufferAttribute(a),this.morphTargetsRelative?(li.addVectors(oi.min,si.min),oi.expandByPoint(li),li.addVectors(oi.max,si.max),oi.expandByPoint(li)):(oi.expandByPoint(si.min),oi.expandByPoint(si.max))}oi.getCenter(l);let n=0;for(let e=0,t=r.count;e<t;e++)li.fromBufferAttribute(r,e),n=Math.max(n,l.distanceToSquared(li));if(i)for(let e=0,t=i.length;e<t;e++){var o=i[e],s=this.morphTargetsRelative;for(let e=0,t=o.count;e<t;e++)li.fromBufferAttribute(o,e),s&&(ai.fromBufferAttribute(r,e),li.add(ai)),n=Math.max(n,l.distanceToSquared(li))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('v3d.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var r=e.array;const u=t.position.array,d=t.normal.array,h=t.uv.array;var i=u.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Hr(new Float32Array(4*i),4));const p=t.tangent.array,f=[],m=[];for(let e=0;e<i;e++)f[e]=new wn,m[e]=new wn;const g=new wn,v=new wn,A=new wn,_=new Yt,x=new Yt,y=new Yt,b=new wn,M=new wn;let n=this.groups;0===n.length&&(n=[{start:0,count:r.length}]);for(let e=0,t=n.length;e<t;++e){var a=n[e],o=a.start;for(let e=o,t=o+a.count;e<t;e+=3)!function(e,t,n){g.fromArray(u,3*e),v.fromArray(u,3*t),A.fromArray(u,3*n),_.fromArray(h,2*e),x.fromArray(h,2*t),y.fromArray(h,2*n),v.sub(g),A.sub(g),x.sub(_),y.sub(_);var r=1/(x.x*y.y-y.x*x.y);isFinite(r)&&(b.copy(v).multiplyScalar(y.y).addScaledVector(A,-x.y).multiplyScalar(r),M.copy(A).multiplyScalar(x.x).addScaledVector(v,-y.x).multiplyScalar(r),f[e].add(b),f[t].add(b),f[n].add(b),m[e].add(M),m[t].add(M),m[n].add(M))}(r[e+0],r[e+1],r[e+2])}const C=new wn,S=new wn,w=new wn,E=new wn;for(let e=0,t=n.length;e<t;++e){var s=n[e],l=s.start;for(let e=l,t=l+s.count;e<t;e+=3)c(r[e+0]),c(r[e+1]),c(r[e+2])}function c(e){w.fromArray(d,3*e),E.copy(w);var t=f[e];C.copy(t),C.sub(w.multiplyScalar(w.dot(t))).normalize(),S.crossVectors(E,t);t=S.dot(m[e])<0?-1:1;p[4*e]=C.x,p[4*e+1]=C.y,p[4*e+2]=C.z,p[4*e+3]=t}}else console.error("v3d.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)")}computeVertexNormals(){const r=this.index;var i=this.getAttribute("position");if(void 0!==i){let n=this.getAttribute("normal");if(void 0===n)n=new Hr(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const l=new wn,c=new wn,u=new wn,d=new wn,h=new wn,p=new wn,f=new wn,m=new wn;if(r)for(let e=0,t=r.count;e<t;e+=3){var a=r.getX(e+0),o=r.getX(e+1),s=r.getX(e+2);l.fromBufferAttribute(i,a),c.fromBufferAttribute(i,o),u.fromBufferAttribute(i,s),f.subVectors(u,c),m.subVectors(l,c),f.cross(m),d.fromBufferAttribute(n,a),h.fromBufferAttribute(n,o),p.fromBufferAttribute(n,s),d.add(f),h.add(f),p.add(f),n.setXYZ(a,d.x,d.y,d.z),n.setXYZ(o,h.x,h.y,h.z),n.setXYZ(s,p.x,p.y,p.z)}else for(let e=0,t=i.count;e<t;e+=3)l.fromBufferAttribute(i,e+0),c.fromBufferAttribute(i,e+1),u.fromBufferAttribute(i,e+2),f.subVectors(u,c),m.subVectors(l,c),f.cross(m),n.setXYZ(e+0,f.x,f.y,f.z),n.setXYZ(e+1,f.x,f.y,f.z),n.setXYZ(e+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("v3d.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(const o in n)if(void 0!==e.attributes[o]){const s=n[o].array;var r=e.attributes[o],i=r.array,r=r.itemSize*t,a=Math.min(i.length,s.length-r);for(let e=0,t=r;e<a;e++,t++)s[t]=i[e]}return this}console.error("v3d.BufferGeometry.merge(): geometry not an instance of v3d.BufferGeometry.",e)}normalizeNormals(){const n=this.attributes.normal;for(let e=0,t=n.count;e<t;e++)li.fromBufferAttribute(n,e),li.normalize(),n.setXYZ(e,li.x,li.y,li.z)}toNonIndexed(){function n(n,r){const i=n.array;var a=n.itemSize,e=n.normalized;const o=new i.constructor(r.length*a);let s=0,l=0;for(let e=0,t=r.length;e<t;e++){s=n.isInterleavedBufferAttribute?r[e]*n.data.stride+n.offset:r[e]*a;for(let e=0;e<a;e++)o[l++]=i[s++]}return new Hr(o,a,e)}if(null===this.index)return console.warn("v3d.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const r=new ci;var i=this.index.array,e=this.attributes;for(const u in e){var t=n(e[u],i);r.setAttribute(u,t)}var a=this.morphAttributes;for(const d in a){const h=[];var o=a[d];for(let e=0,t=o.length;e<t;e++){var s=n(o[e],i);h.push(s)}r.morphAttributes[d]=h}r.morphTargetsRelative=this.morphTargetsRelative;var l=this.groups;for(let e=0,t=l.length;e<t;e++){var c=l[e];r.addGroup(c.start,c.count,c.materialIndex)}return r}toJSON(){const n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),0<Object.keys(this.userData).length&&(n.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(const l in e)void 0!==e[l]&&(n[l]=e[l]);return n}n.data={attributes:{}};var t=this.index;null!==t&&(n.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});var r=this.attributes;for(const c in r){const u=r[c];n.data.attributes[c]=u.toJSON(n.data)}const i={};let a=!1;for(const d in this.morphAttributes){var o=this.morphAttributes[d];const h=[];for(let e=0,t=o.length;e<t;e++){const p=o[e];h.push(p.toJSON(n.data))}0<h.length&&(i[d]=h,a=!0)}a&&(n.data.morphAttributes=i,n.data.morphTargetsRelative=this.morphTargetsRelative);t=this.groups;0<t.length&&(n.data.groups=JSON.parse(JSON.stringify(t)));const s=this.boundingSphere;return null!==s&&(n.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),n}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var n={};this.name=e.name;const t=e.index;null!==t&&this.setIndex(t.clone(n));var r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(n))}var i=e.morphAttributes;for(const d in i){const h=[],p=i[d];for(let e=0,t=p.length;e<t;e++)h.push(p[e].clone(n));this.morphAttributes[d]=h}this.morphTargetsRelative=e.morphTargetsRelative;var a=e.groups;for(let e=0,t=a.length;e<t;e++){var o=a[e];this.addGroup(o.start,o.count,o.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}ci.prototype.isBufferGeometry=!0;const ui=new rr,di=new nr,hi=new jn,pi=new wn,fi=new wn,mi=new wn,gi=new wn,vi=new wn,Ai=new wn,_i=new wn,xi=new wn,yi=new wn,bi=new Yt,Mi=new Yt,Ci=new Yt,Si=new wn,wi=new wn;class Ei extends Tr{constructor(e=new ci,t=new kr){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets(),this.isMaterialGeneratedMesh=!1,this.isAuxClippingMesh=!1}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this.isMaterialGeneratedMesh=e.isMaterialGeneratedMesh,this}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(0<n.length){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("v3d.Mesh.updateMorphTargets() no longer supports v3d.Geometry. Use v3d.BufferGeometry instead.")}}raycast(r,i){if(!this.isAuxClippingMesh){const t=this.geometry;var a=this.material,e=this.matrixWorld;if(void 0!==a&&(null===t.boundingSphere&&t.computeBoundingSphere(),hi.copy(t.boundingSphere),hi.applyMatrix4(e),!1!==r.ray.intersectsSphere(hi)&&(ui.copy(e).invert(),di.copy(r.ray).applyMatrix4(ui),null===t.boundingBox||!1!==di.intersectsBox(t.boundingBox)))){let n;if(t.isBufferGeometry){const I=t.index;var o=t.attributes.position,s=t.morphAttributes.position,l=t.morphTargetsRelative,c=t.attributes.uv,u=t.attributes.uv2,d=t.groups,h=t.drawRange;if(null!==I)if(Array.isArray(a))for(let e=0,t=d.length;e<t;e++){var p=d[e],f=a[p.materialIndex];for(let e=Math.max(p.start,h.start),t=Math.min(I.count,Math.min(p.start+p.count,h.start+h.count));e<t;e+=3){var m=I.getX(e),g=I.getX(e+1),v=I.getX(e+2);n=Ti(this,f,r,di,o,s,l,c,u,m,g,v),n&&(n.faceIndex=Math.floor(e/3),n.face.materialIndex=p.materialIndex,i.push(n))}}else for(let e=Math.max(0,h.start),t=Math.min(I.count,h.start+h.count);e<t;e+=3){var A=I.getX(e),_=I.getX(e+1),x=I.getX(e+2);n=Ti(this,a,r,di,o,s,l,c,u,A,_,x),n&&(n.faceIndex=Math.floor(e/3),i.push(n))}else if(void 0!==o)if(Array.isArray(a))for(let e=0,t=d.length;e<t;e++){var y=d[e],b=a[y.materialIndex];for(let e=Math.max(y.start,h.start),t=Math.min(o.count,Math.min(y.start+y.count,h.start+h.count));e<t;e+=3){var M=e,C=e+1,S=e+2;n=Ti(this,b,r,di,o,s,l,c,u,M,C,S),n&&(n.faceIndex=Math.floor(e/3),n.face.materialIndex=y.materialIndex,i.push(n))}}else for(let e=Math.max(0,h.start),t=Math.min(o.count,h.start+h.count);e<t;e+=3){var w=e,E=e+1,T=e+2;n=Ti(this,a,r,di,o,s,l,c,u,w,E,T),n&&(n.faceIndex=Math.floor(e/3),i.push(n))}}else t.isGeometry&&console.error("v3d.Mesh.raycast() no longer supports v3d.Geometry. Use v3d.BufferGeometry instead.")}}}clone(){return new this.constructor(this.geometry,this.material).copy(this)}getWorldDirection(e){this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}isVisible(){return this.isMaterialGeneratedMesh&&this.parent?this.visible&&this.parent.visible:this.visible}}function Ti(e,t,n,r,i,a,o,s,l,c,u,d){pi.fromBufferAttribute(i,c),fi.fromBufferAttribute(i,u),mi.fromBufferAttribute(i,d);var h=e.morphTargetInfluences;if(a&&h){_i.set(0,0,0),xi.set(0,0,0),yi.set(0,0,0);for(let e=0,t=a.length;e<t;e++){var p=h[e],f=a[e];0!==p&&(gi.fromBufferAttribute(f,c),vi.fromBufferAttribute(f,u),Ai.fromBufferAttribute(f,d),o?(_i.addScaledVector(gi,p),xi.addScaledVector(vi,p),yi.addScaledVector(Ai,p)):(_i.addScaledVector(gi.sub(pi),p),xi.addScaledVector(vi.sub(fi),p),yi.addScaledVector(Ai.sub(mi),p)))}pi.add(_i),fi.add(xi),mi.add(yi)}e.isSkinnedMesh&&(e.boneTransform(c,pi),e.boneTransform(u,fi),e.boneTransform(d,mi));const m=function(e,t,n,r,i,a,o,s){let l;return l=t.side===Fe?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==Oe,s),null===l?null:(wi.copy(s),wi.applyMatrix4(e.matrixWorld),(s=n.ray.origin.distanceTo(wi))<n.near||s>n.far?null:{distance:s,point:wi.clone(),object:e})}(e,t,n,r,pi,fi,mi,Si);return m&&(s&&(bi.fromBufferAttribute(s,c),Mi.fromBufferAttribute(s,u),Ci.fromBufferAttribute(s,d),m.uv=zr.getUV(Si,pi,fi,mi,bi,Mi,Ci,new Yt)),l&&(bi.fromBufferAttribute(l,c),Mi.fromBufferAttribute(l,u),Ci.fromBufferAttribute(l,d),m.uv2=zr.getUV(Si,pi,fi,mi,bi,Mi,Ci,new Yt)),l={a:c,b:u,c:d,normal:new wn,materialIndex:0},zr.getNormal(pi,fi,mi,l.normal),m.face=l),m}Ei.prototype.isMesh=!0;class Ii extends ci{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const E=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const T=[],I=[],R=[],L=[];let B=0,P=0;function o(n,r,i,a,o,e,t,s,l,c,u){var d=e/l,h=t/c,p=e/2,f=t/2,m=s/2,g=l+1,v=c+1;let A=0,_=0;const x=new wn;for(let t=0;t<v;t++){var y=t*h-f;for(let e=0;e<g;e++){var b=e*d-p;x[n]=b*a,x[r]=y*o,x[i]=m,I.push(x.x,x.y,x.z),x[n]=0,x[r]=0,x[i]=0<s?1:-1,R.push(x.x,x.y,x.z),L.push(e/l),L.push(1-t/c),A+=1}}for(let t=0;t<c;t++)for(let e=0;e<l;e++){var M=B+e+g*t,C=B+e+g*(t+1),S=B+(e+1)+g*(t+1),w=B+(e+1)+g*t;T.push(M,C,w),T.push(C,S,w),_+=6}E.addGroup(P,_,u),P+=_,B+=A}o("z","y","x",-1,-1,n,t,e,a,i,0),o("z","y","x",1,-1,n,t,-e,a,i,1),o("x","z","y",1,1,e,n,t,r,a,2),o("x","z","y",1,-1,e,n,-t,r,a,3),o("x","y","z",1,-1,e,t,n,r,i,4),o("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(T),this.setAttribute("position",new ei(I,3)),this.setAttribute("normal",new ei(R,3)),this.setAttribute("uv",new ei(L,2))}static fromJSON(e){return new Ii(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ri(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Li(t){const n={};for(let e=0;e<t.length;e++){var r=Ri(t[e]);for(const i in r)n[i]=r[i]}return n}const Bi={clone:Ri,merge:Li};class Pi extends Gr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.customPrepTokens={},this.vertexShader="void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",this.fragmentShader="void main() {\ngl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("v3d.ShaderMaterial: attributes should now be defined in v3d.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ri(e.uniforms),this.defines=Object.assign({},e.defines),this.customPrepTokens=Object.assign({},e.customPrepTokens),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const a in this.extensions)!0===this.extensions[a]&&(n[a]=!0);return 0<Object.keys(n).length&&(t.extensions=n),t}}Pi.prototype.isShaderMaterial=!0;class Di extends Tr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new rr,this.projectionMatrix=new rr,this.projectionMatrixInverse=new rr,this.controls=null,this.viewportFit={type:0,initialAspect:1},this.ignoreShadowLayers=!1}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),e.controls&&(this.controls=e.controls.clone()),this.viewportFit.type=e.viewportFit.type,this.viewportFit.initialAspect=e.viewportFit.initialAspect,this.ignoreShadowLayers=e.ignoreShadowLayers,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(e){return(new this.constructor).copy(this,e)}}Di.prototype.isCamera=!0;class Ni extends Di{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){e=.5*this.getFilmHeight()/e;this.fov=2*Tt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var e=Math.tan(.5*Et*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Tt*Math.atan(Math.tan(.5*Et*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=this.near;let t=e*Math.tan(.5*Et*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;var a,o=this.view;null!==this.view&&this.view.enabled&&(a=o.fullWidth,s=o.fullHeight,i+=o.offsetX*r/a,t-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s);var s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ni.prototype.isPerspectiveCamera=!0;class Fi extends Tr{constructor(e,t,n){if(super(),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;const r=new Ni(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new wn(1,0,0)),this.add(r);const i=new Ni(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new wn(-1,0,0)),this.add(i);const a=new Ni(90,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new wn(0,1,0)),this.add(a);const o=new Ni(90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new wn(0,-1,0)),this.add(o);const s=new Ni(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new wn(0,0,1)),this.add(s);const l=new Ni(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new wn(0,0,-1)),this.add(l)}else console.error("v3d.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget;var[r,i,a,o,s,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;var d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c,n.texture.needsPMREMUpdate=!0}}class Oi extends _n{constructor(e,t,n,r,i,a,o,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:T,n,r,i,a,o,s,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}copy(e){return super.copy(e),this.image=e.image.slice(),this}}Oi.prototype.isCubeTexture=!0;class Ui extends bn{constructor(e,t,n){Number.isInteger(t)&&(console.warn("v3d.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget(size, options)"),t=n),super(e,e,t),t=t||{},this.texture=new Oi(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Ge,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ke,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={uniforms:{tEquirect:{value:null}},vertexShader:`

                varying vec3 vWorldDirection;

                vec3 transformDirection(in vec3 dir, in mat4 matrix) {

                    return normalize((matrix * vec4(dir, 0.0)).xyz);

                }

                void main() {

                    vWorldDirection = transformDirection(position, modelMatrix);

                    #include <begin_vertex>
                    #include <project_vertex>

                }
            `,fragmentShader:`

                uniform sampler2D tEquirect;

                varying vec3 vWorldDirection;

                #include <common>

                void main() {

                    vec3 direction = normalize(vWorldDirection);

                    vec2 sampleUV = equirectUv(direction);

                    gl_FragColor = texture2D(tEquirect, sampleUV);

                }
            `},r=new Ii(5,5,5);const i=new Pi({name:"CubemapFromEquirect",uniforms:Ri(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Fe,blending:ie});i.uniforms.tEquirect.value=t;const a=new Ei(r,i);r=t.minFilter;t.minFilter===ke&&(t.minFilter=Ge);const o=new Fi(1,10,this);return o.update(e,a),t.minFilter=r,a.geometry.dispose(),a.material.dispose(),this}clear(t,n,r,i){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(n,r,i);t.setRenderTarget(e)}}Ui.prototype.isWebGLCubeRenderTarget=!0;const zi=new wn,Vi=new wn,Gi=new Xt;class ki{constructor(e=new wn(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){t=zi.subVectors(n,t).cross(Vi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(t,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){var n=e.delta(zi),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;r=-(e.start.dot(this.normal)+this.constant)/r;return r<0||1<r?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||Gi.getNormalMatrix(e);const n=this.coplanarPoint(zi).applyMatrix4(e);t=this.normal.applyMatrix3(t).normalize();return this.constant=-n.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}ki.prototype.isPlane=!0;const Qi=new jn,Wi=new wn;class Hi{constructor(e=new ki,t=new ki,n=new ki,r=new ki,i=new ki,a=new ki){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(t){const n=this.planes;for(let e=0;e<6;e++)n[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e){const t=this.planes;var n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],d=n[8],h=n[9],p=n[10],f=n[11],m=n[12],g=n[13],e=n[14],n=n[15];return t[0].setComponents(o-r,u-s,f-d,n-m).normalize(),t[1].setComponents(o+r,u+s,f+d,n+m).normalize(),t[2].setComponents(o+i,u+l,f+h,n+g).normalize(),t[3].setComponents(o-i,u-l,f-h,n-g).normalize(),t[4].setComponents(o-a,u-c,f-p,n-e).normalize(),t[5].setComponents(o+a,u+c,f+p,n+e).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Qi.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Qi)}intersectsSprite(e){return Qi.center.set(0,0,0),Qi.radius=.7071067811865476,Qi.applyMatrix4(e.matrixWorld),this.intersectsSphere(Qi)}intersectsSphere(e){const t=this.planes;var n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){var n=this.planes;for(let e=0;e<6;e++){const r=n[e];if(Wi.x=(0<r.normal.x?t.max:t.min).x,Wi.y=(0<r.normal.y?t.max:t.min).y,Wi.z=(0<r.normal.z?t.max:t.min).z,r.distanceToPoint(Wi)<0)return!1}return!0}containsPoint(t){const n=this.planes;for(let e=0;e<6;e++)if(n[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Yi(){let n=null,e=!1,r=null,i=null;function a(e,t){r(e,t),i=n.requestAnimationFrame(a)}return{start:function(){!0!==e&&null!==r&&(i=n.requestAnimationFrame(a),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(e){r=e},setContext:function(e){n=e}}}function Xi(o,e){const s=e.isWebGL2;let i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=i.get(e);t&&(o.deleteBuffer(t.buffer),i.delete(e))},update:function(e,t){if(e.isGLBufferAttribute){var n=i.get(e);(!n||n.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);const r=i.get(e);void 0===r?i.set(e,function(e,t){var n=e.array,r=e.usage,i=o.createBuffer();o.bindBuffer(t,i),o.bufferData(t,n,r),e.onUploadCallback();let a=5126;return n instanceof Float32Array?a=5126:n instanceof Float64Array?console.warn("v3d.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?e.isFloat16BufferAttribute?s?a=5131:console.warn("v3d.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:n instanceof Int16Array?a=5122:n instanceof Uint32Array?a=5125:n instanceof Int32Array?a=5124:n instanceof Int8Array?a=5120:(n instanceof Uint8Array||n instanceof Uint8ClampedArray)&&(a=5121),{buffer:i,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(e,t)):r.version<e.version&&(function(e,t,n){const r=t.array,i=t.updateRange;o.bindBuffer(n,e),-1===i.count?o.bufferSubData(n,0,r):(s?o.bufferSubData(n,i.offset*r.BYTES_PER_ELEMENT,r,i.offset,i.count):o.bufferSubData(n,i.offset*r.BYTES_PER_ELEMENT,r.subarray(i.offset,i.offset+i.count)),i.count=-1)}(r.buffer,e,t),r.version=e.version)}},dispose:function(){i=new WeakMap}}}class ji extends ci{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),l=o+1,c=s+1,u=e/o,d=t/s;const h=[],p=[],f=[],m=[];for(let t=0;t<c;t++){var g=t*d-a;for(let e=0;e<l;e++){var v=e*u-i;p.push(v,-g,0),f.push(0,0,1),m.push(e/o),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<o;e++){var A=e+l*t,_=e+l*(t+1),x=e+1+l*(t+1),y=e+1+l*t;h.push(A,_,y),h.push(_,x,y)}this.setIndex(h),this.setAttribute("position",new ei(p,3)),this.setAttribute("normal",new ei(f,3)),this.setAttribute("uv",new ei(m,2))}static fromJSON(e){return new ji(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ki={alphamap_fragment:"#ifdef USE_ALPHAMAP\ndiffuseColor.a *= texture2D(alphaMap, vUv).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\nif (diffuseColor.a < alphaTest)\ndiscard;\nelse\ndiffuseColor.a = 1.0;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\nuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\nfloat ambientOcclusion = (texture2D(aoMap, vUv2).r - 1.0) * aoMapIntensity + 1.0;\nreflectedLight.indirectDiffuse *= ambientOcclusion;\n#if defined(USE_ENVMAP) && defined(STANDARD)\nfloat dotNV = saturate(dot(geometry.normal, geometry.viewDir));\nreflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, material.roughness);\n#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\nuniform sampler2D aoMap;\nuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3(position);",beginnormal_vertex:"vec3 objectNormal = vec3(normal);\n#ifdef USE_TANGENT\nvec3 objectTangent = vec3(tangent.xyz);\n#endif",bsdfs:"\nvec2 integrateSpecularBRDF(const in float dotNV, const in float roughness) {\nconst vec4 c0 = vec4(- 1, - 0.0275, - 0.572, 0.022);\nconst vec4 c1 = vec4(1, 0.0425, 1.04, - 0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(- 9.28 * dotNV)) * r.x + r.y;\nreturn vec2(-1.04, 1.04) * a004 + r.zw;\n}\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\nreturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {\nfloat fresnel = exp2((- 5.55473 * dotVH - 6.98316) * dotVH);\nreturn f0 * (1.0 - fresnel) + (f90 * fresnel);\n}\nvec3 F_Schlick_RoughnessDependent(const in vec3 F0, const in float dotNV, const in float roughness) {\nfloat fresnel = exp2((-5.55473 * dotNV - 6.98316) * dotNV);\nvec3 Fr = max(vec3(1.0 - roughness), F0) - F0;\nreturn Fr * fresnel + F0;\n}\nfloat V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {\nfloat a2 = pow2(alpha);\nfloat gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\nfloat gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\nreturn 0.5 / max(gv + gl, EPSILON);\n}\nfloat D_GGX(const in float alpha, const in float dotNH) {\nfloat a2 = pow2(alpha);\nfloat denom = pow2(dotNH) * (a2 - 1.0) + 1.0;\nreturn RECIPROCAL_PI * a2 / pow2(denom);\n}\nvec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {\nfloat alpha = pow2(clamp(roughness, 0.04, 1.0));\nvec3 halfDir = normalize(lightDir + viewDir);\nfloat dotNL = saturate(dot(normal, lightDir));\nfloat dotNV = saturate(dot(normal, viewDir));\nfloat dotNH = saturate(dot(normal, halfDir));\nfloat dotVH = saturate(dot(viewDir, halfDir));\nvec3 F = F_Schlick(f0, f90, dotVH);\nfloat V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);\nfloat D = D_GGX(alpha, dotNH);\nreturn F * (V * D);\n}\nvec2 LTC_Uv(const in vec3 N, const in vec3 V, const in float roughness) {\nconst float LUT_SIZE = 64.0;\nconst float LUT_SCALE = (LUT_SIZE - 1.0) / LUT_SIZE;\nconst float LUT_BIAS = 0.5 / LUT_SIZE;\nfloat dotNV = saturate(dot(N, V));\nvec2 uv = vec2(roughness, sqrt(1.0 - dotNV));\nuv = uv * LUT_SCALE + LUT_BIAS;\nreturn uv;\n}\nfloat LTC_ClippedSphereFormFactor(const in vec3 f) {\nfloat l = length(f);\nreturn max((l * l + f.z) / (l + 1.0), 0.0);\n}\nvec3 LTC_EdgeVectorFormFactor(const in vec3 v1, const in vec3 v2) {\nfloat x = dot(v1, v2);\nfloat y = abs(x);\nfloat a = 0.8543985 + (0.4965155 + 0.0145206 * y) * y;\nfloat b = 3.4175940 + (4.1616724 + y) * y;\nfloat v = a / b;\nfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt(max(1.0 - x * x, 1e-7)) - v;\nreturn cross(v1, v2) * theta_sintheta;\n}\nvec3 LTC_Evaluate(const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[4]) {\nvec3 v1 = rectCoords[1] - rectCoords[0];\nvec3 v2 = rectCoords[3] - rectCoords[0];\nvec3 lightNormal = cross(v1, v2);\nif(dot(lightNormal, P - rectCoords[0]) < 0.0) return vec3(0.0);\nvec3 T1, T2;\nT1 = normalize(V - N * dot(V, N));\nT2 = -cross(N, T1);\nmat3 mat = mInv * transposeMat3(mat3(T1, T2, N));\nvec3 coords[4];\ncoords[0] = mat * (rectCoords[0] - P);\ncoords[1] = mat * (rectCoords[1] - P);\ncoords[2] = mat * (rectCoords[2] - P);\ncoords[3] = mat * (rectCoords[3] - P);\ncoords[0] = normalize(coords[0]);\ncoords[1] = normalize(coords[1]);\ncoords[2] = normalize(coords[2]);\ncoords[3] = normalize(coords[3]);\nvec3 vectorFormFactor = vec3(0.0);\nvectorFormFactor += LTC_EdgeVectorFormFactor(coords[0], coords[1]);\nvectorFormFactor += LTC_EdgeVectorFormFactor(coords[1], coords[2]);\nvectorFormFactor += LTC_EdgeVectorFormFactor(coords[2], coords[3]);\nvectorFormFactor += LTC_EdgeVectorFormFactor(coords[3], coords[0]);\nfloat result = LTC_ClippedSphereFormFactor(vectorFormFactor);\nreturn vec3(result);\n}\nvec2 get_BRDF_SpecCoeffsBlender(float x, float y) {\nvec3 xyFactors0 = vec3(x * x, y * y, x * y);\nvec3 xyFactors1 = vec3(x, y, 1);\nvec3 a0a1a2 = vec3(0.33749372, 0.15167605, 1.09684597);\nvec3 a3a4a5 = vec3(-1.26123466, -0.927699, 0.9199188);\nvec3 b0b1b2 = vec3(0.41699717, 0.44675109, 0.79947684);\nvec3 b3b4b5 = vec3(-1.19307849, -0.89813958, 0.89305222);\nvec3 c0c1c2 = vec3(0.29920727, 0.09505591, -0.9136233);\nvec3 c3c4c5 = vec3(0.77055201, 0.13006674, -0.23085581);\nvec3 d0d1d2 = vec3(15.05004149, 7.98517355, 13.30473726);\nvec3 d3d4d5 = vec3(-32.00353547, -12.97743434, 17.83646751);\nfloat coeff0 = (dot(xyFactors0, a0a1a2) + dot(xyFactors1, a3a4a5))\n/ (dot(xyFactors0, b0b1b2) + dot(xyFactors1, b3b4b5));\nfloat coeff1 = (dot(xyFactors0, c0c1c2) + dot(xyFactors1, c3c4c5))\n/ (dot(xyFactors0, d0d1d2) + dot(xyFactors1, d3d4d5));\ncoeff1 = clamp(coeff1, 0.0, 1.0);\nreturn vec2(coeff0, coeff1);\n}\nvec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness) {\nfloat dotNV = saturate(dot(normal, viewDir));\nvec2 brdf = integrateSpecularBRDF(dotNV, roughness);\nreturn specularColor * brdf.x + brdf.y;\n}\nvec3 BRDF_Specular_GGX_Environment_Blender_Approx(const in GeometricContext geometry,\nconst in vec3 fresnelRefl0, const in vec3 fresnelRefl90,\nconst in float roughness, const int useCoat) {\nvec3 normal = geometry.normal;\n#ifdef USE_CLEARCOAT\nif (useCoat == 1) {\nnormal = geometry.clearcoatNormal;\n}\n#endif\nfloat dotNV = saturate(dot(normal, geometry.viewDir));\nfloat angle = acos(abs(dotNV)) / PI_HALF;\nvec2 specCoeffs = get_BRDF_SpecCoeffsBlender(angle, roughness);\nvec3 specular = specCoeffs.x * fresnelRefl0\n+ specCoeffs.y * fresnelRefl90\n* vec3(saturate(50.0 * linearToRelativeLuminance(fresnelRefl0)));\n#if defined (COMPAT_SATURATE_SPEC_ENV_BLENDER_APPROX)\nspecular = saturate(specular);\n#endif\nreturn specular;\n}\nvoid BRDF_Specular_Multiscattering_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\nfloat dotNV = saturate(dot(geometry.normal, geometry.viewDir));\nvec3 F = F_Schlick_RoughnessDependent(specularColor, dotNV, roughness);\nvec2 brdf = integrateSpecularBRDF(dotNV, roughness);\nvec3 FssEss = F * brdf.x + brdf.y;\nfloat Ess = brdf.x + brdf.y;\nfloat Ems = 1.0 - Ess;\nvec3 Favg = specularColor + (1.0 - specularColor) * 0.047619;\nvec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\nsingleScatter += FssEss;\nmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit() {\nreturn 0.25;\n}\nfloat D_BlinnPhong(const in float shininess, const in float dotNH) {\nreturn RECIPROCAL_PI * (shininess * 0.5 + 1.0) * pow(dotNH, shininess);\n}\nvec3 BRDF_BlinnPhong(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess) {\nvec3 halfDir = normalize(lightDir + viewDir);\nfloat dotNH = saturate(dot(normal, halfDir));\nfloat dotVH = saturate(dot(viewDir, halfDir));\nvec3 F = F_Schlick(specularColor, 1.0, dotVH);\nfloat G = G_BlinnPhong_Implicit();\nfloat D = D_BlinnPhong(shininess, dotNH);\nreturn F * (G * D);\n}\nfloat GGXRoughnessToBlinnExponent(const in float ggxRoughness) {\nreturn (2.0 / pow2(ggxRoughness + 0.0001) - 2.0);\n}\nfloat BlinnExponentToGGXRoughness(const in float blinnExponent) {\nreturn sqrt(2.0 / (blinnExponent + 2.0));\n}\n#if defined(USE_SHEEN)\nfloat D_Charlie(float roughness, float dotNH) {\nfloat alpha = pow2(roughness);\nfloat invAlpha = 1.0 / alpha;\nfloat cos2h = dotNH * dotNH;\nfloat sin2h = max(1.0 - cos2h, 0.0078125);\nreturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float dotNV, float dotNL) {\nreturn saturate(1.0 / (4.0 * (dotNL + dotNV - dotNL * dotNV)));\n}\nvec3 BRDF_Sheen(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness) {\nvec3 halfDir = normalize(lightDir + viewDir);\nfloat dotNL = saturate(dot(normal, lightDir));\nfloat dotNV = saturate(dot(normal, viewDir));\nfloat dotNH = saturate(dot(normal, halfDir));\nfloat D = D_Charlie(sheenRoughness, dotNH);\nfloat V = V_Neubelt(dotNV, dotNL);\nreturn sheenColor * (D * V);\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx(vUv);\nvec2 dSTdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpMap, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpMap, vUv + dSTdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpMap, vUv + dSTdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormalArb(vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection) {\nvec3 vSigmaX = vec3(dFdx(surf_pos.x), dFdx(surf_pos.y), dFdx(surf_pos.z));\nvec3 vSigmaY = vec3(dFdy(surf_pos.x), dFdy(surf_pos.y), dFdy(surf_pos.z));\nvec3 vN = surf_norm;\nvec3 R1 = cross(vSigmaY, vN);\nvec3 R2 = cross(vN, vSigmaX);\nfloat fDet = dot(vSigmaX, R1) * faceDirection;\nvec3 vGrad = sign(fDet) * (dHdxy.x * R1 + dHdxy.y * R2);\nreturn normalize(abs(fDet) * surf_norm - vGrad);\n}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\nvec4 plane;\n#pragma unroll_loop_start\nfor (int i = 0; i < UNION_CLIPPING_PLANES; i++) {\nplane = clippingPlanes[i];\nif (dot(vClipPosition, plane.xyz) > plane.w) discard;\n}\n#pragma unroll_loop_end\n#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\nbool clipped = true;\n#pragma unroll_loop_start\nfor (int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i++) {\nplane = clippingPlanes[i];\nclipped = (dot(vClipPosition, plane.xyz) > plane.w) && clipped;\n}\n#pragma unroll_loop_end\nif (clipped) discard;\n#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\nvarying vec3 vClipPosition;\nuniform vec4 clippingPlanes[NUM_CLIPPING_PLANES];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\nvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\nvClipPosition = -mvPosition.xyz;\n#endif",color_fragment:"#if defined(USE_COLOR_ALPHA)\ndiffuseColor *= vColor;\n#elif defined(USE_COLOR)\ndiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined(USE_COLOR_ALPHA)\nvarying vec4 vColor;\n#elif defined(USE_COLOR)\nvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined(USE_COLOR_ALPHA)\nvarying vec4 vColor;\n#elif defined(USE_COLOR) || defined(USE_INSTANCING_COLOR)\nvarying vec3 vColor;\n#endif",color_vertex:"#if defined(USE_COLOR_ALPHA)\nvColor = vec4(1.0);\n#elif defined(USE_COLOR) || defined(USE_INSTANCING_COLOR)\nvColor = vec3(1.0);\n#endif\n#ifdef USE_COLOR\nvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\nvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp(a, 0.0, 1.0)\n#endif\n#define whiteComplement(a) (1.0 - saturate(a))\n#define RECIPROCAL_3 0.333333333333\nfloat pow2(const in float x) { return x*x; }\nfloat pow3(const in float x) { return x*x*x; }\nfloat pow4(const in float x) { float x2 = x*x; return x2*x2; }\nfloat max3(const in vec3 v) { return max(max(v.x, v.y), v.z); }\nfloat average(const in vec3 color) { return dot(color, vec3(0.3333)); }\nhighp float rand(const in vec2 uv) {\nconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\nhighp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, PI);\nreturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\nfloat precisionSafeLength(vec3 v) { return length(v); }\n#else\nfloat precisionSafeLength(vec3 v) {\nfloat maxComponent = max3(abs(v));\nreturn length(v / maxComponent) * maxComponent;\n}\n#endif\nstruct IncidentLight {\nvec3 color;\nvec3 direction;\nbool visible;\n};\nstruct ReflectedLight {\nvec3 directDiffuse;\nvec3 directSpecular;\nvec3 indirectDiffuse;\nvec3 indirectSpecular;\n};\nstruct GeometricContext {\nvec3 position;\nvec3 normal;\nvec3 viewDir;\nvec3 probeNormal;\n#ifdef USE_CLEARCOAT\nvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection(in vec3 dir, in mat4 matrix) {\nreturn normalize((matrix * vec4(dir, 0.0)).xyz);\n}\nvec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\nreturn normalize((vec4(dir, 0.0) * matrix).xyz);\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\nfloat distance = dot(planeNormal, point - pointOnPlane);\nreturn - distance * planeNormal + point;\n}\nfloat sideOfPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\nreturn sign(dot(point - pointOnPlane, planeNormal));\n}\nvec3 linePlaneIntersect(in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal) {\nreturn lineDirection * (dot(planeNormal, pointOnPlane - pointOnLine) / dot(planeNormal, lineDirection)) + pointOnLine;\n}\nmat3 transposeMat3(const in mat3 m) {\nmat3 tmp;\ntmp[0] = vec3(m[0].x, m[1].x, m[2].x);\ntmp[1] = vec3(m[0].y, m[1].y, m[2].y);\ntmp[2] = vec3(m[0].z, m[1].z, m[2].z);\nreturn tmp;\n}\nfloat linearToRelativeLuminance(const in vec3 color) {\nvec3 weights = vec3(0.2126, 0.7152, 0.0722);\nreturn dot(weights, color.rgb);\n}\nbool isPerspectiveMatrix(mat4 m) {\nreturn m[2][3] == - 1.0;\n}\nvec2 equirectUv(in vec3 dir) {\nfloat u = atan(dir.z, dir.x) * RECIPROCAL_PI2 + 0.5;\nfloat v = asin(clamp(dir.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;\nreturn vec2(u, v);\n}\nfloat smootherstep(float edge0, float edge1, float x) {\nfloat t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\nreturn t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\nhighp vec3 rand3(const in vec3 v) {\nconst highp float c = 43758.5453;\nconst highp mat3 coeffs = mat3(\n165.15, 253.34, 323.22,\n241.49, 329.07, 147.79,\n376.31, 143.45, 281.63\n);\nhighp vec3 sn = mod(coeffs * v, PI);\nreturn fract(sin(sn) * c);\n}\nfloat powCompat(const in float val, const in float power) {\nif (power == 0.0)\nreturn 1.0;\nelse if (val < 0.0) {\nif (mod(-power, 2.0) == 0.0)\nreturn pow(abs(val), power);\nelse\nreturn -pow(abs(val), power);\n} else if (val == 0.0)\nreturn 0.0;\nreturn pow(abs(val), power);\n}\nfloat maxFromRGB(vec3 rgb) {\nreturn max(max(rgb.r, rgb.g), rgb.b);\n}\nbool isOrtho(const in mat4 m) {\nif (m[3][3] != 0.0)\nreturn true;\nelse\nreturn false;\n}\nvec3 swizzleUpZ(const vec3 vec) {\nreturn vec3(vec[0], -vec[2], vec[1]);\n}\nvec3 swizzleUpY(const vec3 vec) {\nreturn vec3(vec[0], vec[2], -vec[1]);\n}\nvec3 xyz_to_sRGB(vec3 xyz) {\nmat3 convMat = mat3(\n3.2406, -0.9689, 0.0557,\n-1.5372, 1.8758, -0.2040,\n-0.4986, 0.0415, 1.0570\n);\nreturn convMat * xyz;\n}\nvec3 xyY_to_XYZ(float x, float y, float Y) {\nfloat X = 0.0;\nfloat Z = 0.0;\nif (y != 0.0) {\nX = (Y / y) * x;\nZ = (Y / y) * (1.0 - x - y);\n}\nreturn vec3(X, Y, Z);\n}\nvec3 octUVToCubeVec(vec2 octUV, vec2 texelSize) {\noctUV = (1.0 + 2.0 * texelSize) * octUV - texelSize;\noctUV = octUV * 2.0 - 1.0;\nfloat x = octUV.x;\nfloat z = -octUV.y;\nfloat absX = abs(x);\nfloat absZ = abs(z);\nvec3 cubeVec = vec3(x, 1.0 - absX - absZ, z);\nif (absX + absZ > 1.0) {\ncubeVec.xz = -(vec2(absZ, absX) - 1.0) * sign(vec2(x, z));\n}\nreturn cubeVec;\n}\nvec2 cubeVecToOctUV(vec3 cubeVec, vec2 texelSize) {\ncubeVec /= dot(vec3(1.0), abs(cubeVec));\nvec2 octUV = vec2(cubeVec.x, -cubeVec.z);\nif (cubeVec.y < 0.0) {\noctUV = sign(octUV) * (1.0 - abs(octUV.ts));\n}\noctUV = (octUV + 1.0) / 2.0;\noctUV = (1.0 - 2.0 * texelSize) * octUV + texelSize;\nreturn octUV;\n}\n#if __VERSION__ == 100\nfloat cosh(float x) {\nreturn (exp(x) + exp(-x)) / 2.0;\n}\nvec2 cosh(vec2 x) {\nreturn (exp(x) + exp(-x)) / 2.0;\n}\nvec3 cosh(vec3 x) {\nreturn (exp(x) + exp(-x)) / 2.0;\n}\nvec4 cosh(vec4 x) {\nreturn (exp(x) + exp(-x)) / 2.0;\n}\nfloat sinh(float x) {\nreturn (exp(x) - exp(-x)) / 2.0;\n}\nvec2 sinh(vec2 x) {\nreturn (exp(x) - exp(-x)) / 2.0;\n}\nvec3 sinh(vec3 x) {\nreturn (exp(x) - exp(-x)) / 2.0;\n}\nvec4 sinh(vec4 x) {\nreturn (exp(x) - exp(-x)) / 2.0;\n}\nfloat tanh(float x) {\nfloat exp2x = exp(2.0 * x);\nreturn (exp2x - 1.0) / (exp2x + 1.0);\n}\nvec2 tanh(vec2 x) {\nvec2 exp2x = exp(2.0 * x);\nreturn (exp2x - 1.0) / (exp2x + 1.0);\n}\nvec3 tanh(vec3 x) {\nvec3 exp2x = exp(2.0 * x);\nreturn (exp2x - 1.0) / (exp2x + 1.0);\n}\nvec4 tanh(vec4 x) {\nvec4 exp2x = exp(2.0 * x);\nreturn (exp2x - 1.0) / (exp2x + 1.0);\n}\nfloat trunc(float x) {\nreturn floor(abs(x)) * sign(x);\n}\nvec2 trunc(vec2 x) {\nreturn floor(abs(x)) * sign(x);\n}\nvec3 trunc(vec3 x) {\nreturn floor(abs(x)) * sign(x);\n}\nvec4 trunc(vec4 x) {\nreturn floor(abs(x)) * sign(x);\n}\n#endif\nfloat getSmoothFactor(float a, float b, float smoothness) {\nreturn max(smoothness - abs(a - b), 0.0) / smoothness;\n}\nfloat smoothMin(float a, float b, float smoothness) {\nfloat smoothFac = getSmoothFactor(a, b, smoothness);\nreturn min(a, b) - smoothFac * smoothFac * smoothFac * smoothness * (1.0 / 6.0);\n}\nfloat smoothMax(float a, float b, float smoothness) {\nfloat smoothFac = getSmoothFactor(a, b, smoothness);\nreturn max(a, b) + smoothFac * smoothFac * smoothFac * smoothness * (1.0 / 6.0);\n}\nvec3 vec3RotateAxisAngle(vec3 vector, vec3 axis, float angle) {\nvec3 axisNorm = normalize(axis);\nfloat x = axisNorm.x, y = axisNorm.y, z = axisNorm.z;\nfloat s = sin(angle), c = cos(angle);\nreturn mat3(\nx * x * (1.0 - c) + c, x * y * (1.0 - c) + z * s, x * z * (1.0 - c) - y * s,\nx * y * (1.0 - c) - z * s, y * y * (1.0 - c) + c, y * z * (1.0 - c) + x * s,\nx * z * (1.0 - c) + y * s, y * z * (1.0 - c) - x * s, z * z * (1.0 - c) + c\n) * vector;\n}\nmat3 mat3RotateX(float angle) {\nfloat s = sin(angle), c = cos(angle);\nreturn mat3(1.0, 0.0, 0.0,\n0.0, c, s,\n0.0, -s, c);\n}\nmat3 mat3RotateY(float angle) {\nfloat s = sin(angle), c = cos(angle);\nreturn mat3(c, 0.0, -s,\n0.0, 1.0, 0.0,\ns, 0.0, c);\n}\nmat3 mat3RotateZ(float angle) {\nfloat s = sin(angle), c = cos(angle);\nreturn mat3(c, s, 0.0,\n-s, c, 0.0,\n0.0, 0.0, 1.0);\n}\nvec3 vec3RotateXAngle(vec3 vector, float angle) {\nreturn mat3RotateX(angle) * vector;\n}\nvec3 vec3RotateYAngle(vec3 vector, float angle) {\nreturn mat3RotateY(angle) * vector;\n}\nvec3 vec3RotateZAngle(vec3 vector, float angle) {\nreturn mat3RotateZ(angle) * vector;\n}\nvec4 eulerToAxisAngle(vec3 euler) {\nfloat c1 = cos(euler.x / 2.0), c2 = cos(euler.y / 2.0), c3 = cos(euler.z / 2.0);\nfloat s1 = sin(euler.x / 2.0), s2 = sin(euler.y / 2.0), s3 = sin(euler.z / 2.0);\nvec4 axisAngle = vec4(\ns1 * c2 * c3 - c1 * s2 * s3,\nc1 * s2 * c3 + s1 * c2 * s3,\nc1 * c2 * s3 - s1 * s2 * c3,\n2.0 * acos(c1 * c2 * c3 + s1 * s2 * s3)\n);\naxisAngle.xyz = length(axisAngle.xyz) > 0.0 ? normalize(axisAngle.xyz) : vec3(1.0, 0.0, 0.0);\nreturn axisAngle;\n}\nfloat mat3GetDeterminant(mat3 mat) {\nreturn mat[0][0] * mat[1][1] * mat[2][2]\n+ mat[0][2] * mat[1][0] * mat[2][1]\n+ mat[0][1] * mat[1][2] * mat[2][0]\n- mat[0][2] * mat[1][1] * mat[2][0]\n- mat[0][0] * mat[1][2] * mat[2][1]\n- mat[0][1] * mat[1][0] * mat[2][2];\n}\nmat3 mat3GetInverseTransposed(mat3 mat) {\nfloat det = mat3GetDeterminant(mat);\nfloat a00 = (mat[1][1] * mat[2][2] - mat[1][2] * mat[2][1]) / det;\nfloat a01 = - (mat[1][0] * mat[2][2] - mat[1][2] * mat[2][0]) / det;\nfloat a02 = (mat[1][0] * mat[2][1] - mat[1][1] * mat[2][0]) / det;\nfloat a10 = - (mat[0][1] * mat[2][2] - mat[0][2] * mat[2][1]) / det;\nfloat a11 = (mat[0][0] * mat[2][2] - mat[0][2] * mat[2][0]) / det;\nfloat a12 = - (mat[0][0] * mat[2][1] - mat[0][1] * mat[2][0]) / det;\nfloat a20 = (mat[0][1] * mat[1][2] - mat[0][2] * mat[1][1]) / det;\nfloat a21 = - (mat[0][0] * mat[1][2] - mat[0][2] * mat[1][0]) / det;\nfloat a22 = (mat[0][0] * mat[1][1] - mat[0][1] * mat[1][0]) / det;\nreturn mat3(\na00, a01, a02,\na10, a11, a12,\na20, a21, a22\n);\n}\nmat3 toMat3(mat4 mat) {\nreturn mat3(mat[0][0], mat[0][1], mat[0][2],\nmat[1][0], mat[1][1], mat[1][2],\nmat[2][0], mat[2][1], mat[2][2]);\n}\nmat4 toMat4(mat3 mat) {\nreturn mat4(mat[0][0], mat[0][1], mat[0][2], 0.0,\nmat[1][0], mat[1][1], mat[1][2], 0.0,\nmat[2][0], mat[2][1], mat[2][2], 0.0,\n0.0, 0.0, 0.0, 1.0);\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\nfloat getFace(vec3 direction) {\nvec3 absDirection = abs(direction);\nfloat face = -1.0;\nif (absDirection.x > absDirection.z) {\nif (absDirection.x > absDirection.y) {\nface = direction.x > 0.0 ? 0.0 : 3.0;\n} else {\nface = direction.y > 0.0 ? 1.0 : 4.0;\n}\n} else {\nif (absDirection.z > absDirection.y) {\nface = direction.z > 0.0 ? 2.0 : 5.0;\n} else {\nface = direction.y > 0.0 ? 1.0 : 4.0;\n}\n}\nreturn face;\n}\nvec2 getUV(vec3 direction, float face) {\nvec2 uv;\nif (face == 0.0) {\nuv = vec2(-direction.z, direction.y) / abs(direction.x);\n} else if (face == 1.0) {\nuv = vec2(direction.x, -direction.z) / abs(direction.y);\n} else if (face == 2.0) {\nuv = direction.xy / abs(direction.z);\n} else if (face == 3.0) {\nuv = vec2(direction.z, direction.y) / abs(direction.x);\n} else if (face == 4.0) {\nuv = direction.xz / abs(direction.y);\n} else {\nuv = vec2(-direction.x, direction.y) / abs(direction.z);\n}\nreturn 0.5 * (uv + 1.0);\n}\n#ifndef cubeUV_maxTileSize\n#define cubeUV_maxTileSize 256.0\n#endif\n#define cubeUV_lodIdxMin 0.0\n#define cubeUV_lodIdxLastDownscaled 4.0\n#define cubeUV_lodIdxMax 10.0\n#define cubeUV_minTileSize (cubeUV_maxTileSize / exp2(cubeUV_lodIdxLastDownscaled))\nfloat getLodTileSize(float lodIdx) {\nreturn cubeUV_maxTileSize / exp2(min(lodIdx, cubeUV_lodIdxLastDownscaled));\n}\nfloat getLodFilterLevel(float lodIdx) {\nreturn max(lodIdx - cubeUV_lodIdxLastDownscaled, 0.0);\n}\nvec2 fixCubeUVSeams(vec2 uv, float faceSize) {\nfloat BORDER_WIDTH_PX = max(cubeUV_maxTileSize / 256.0 - 1.0, 0.0);\nfloat scale = (faceSize - BORDER_WIDTH_PX) / faceSize;\nfloat offset = 0.5 * BORDER_WIDTH_PX / faceSize;\nreturn uv * scale + offset;\n}\nvec2 getUVPixels(vec3 direction, float lodIdx) {\nfloat face = getFace(direction);\nfloat faceSize = getLodTileSize(lodIdx);\nfloat filterLevel = getLodFilterLevel(lodIdx);\nvec2 uv = getUV(direction, face);\nuv = fixCubeUVSeams(uv, faceSize);\nuv *= (faceSize - 1.0);\nif (face > 2.0) {\nuv.y += faceSize;\nface -= 3.0;\n}\nuv.x += face * faceSize;\nif (lodIdx > 0.0) {\nuv.y += 2.0 * cubeUV_maxTileSize;\n}\nuv.y += filterLevel * 2.0 * cubeUV_minTileSize;\nuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\nreturn uv;\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float lodIdx) {\nfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\nvec2 uv = getUVPixels(direction, lodIdx);\nvec2 f = fract(uv);\nuv += 0.5 - f;\nuv *= texelSize;\nvec3 tl = texture2D(envMap, uv).rgb;\nuv.x += texelSize;\nvec3 tr = texture2D(envMap, uv).rgb;\nuv.y += texelSize;\nvec3 br = texture2D(envMap, uv).rgb;\nuv.x -= texelSize;\nvec3 bl = texture2D(envMap, uv).rgb;\nvec3 tm = mix(tl, tr, f.x);\nvec3 bm = mix(bl, br, f.x);\nreturn mix(tm, bm, f.y);\n}\nvec3 sampleCubeUV(sampler2D envMap, vec3 direction, float lodIdx) {\nfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\nvec2 uv = getUVPixels(direction, lodIdx);\nuv += 0.5;\nuv *= texelSize;\nreturn texture2D(envMap, uv).rgb;\n}\n#define cubeUV_r0 1.0\n#define cubeUV_v0 0.339\n#define cubeUV_m0 -2.0\n#define cubeUV_r1 0.8\n#define cubeUV_v1 0.276\n#define cubeUV_m1 -1.0\n#define cubeUV_r4 0.4\n#define cubeUV_v4 0.046\n#define cubeUV_m4 2.0\n#define cubeUV_r5 0.305\n#define cubeUV_v5 0.016\n#define cubeUV_m5 3.0\n#define cubeUV_r6 0.21\n#define cubeUV_v6 0.0038\n#define cubeUV_m6 4.0\nfloat roughnessToMip(float roughness) {\nfloat r = roughness;\nfloat r2 = r * r;\nfloat r3 = r2 * r;\nroughness = -1.20278049 * r3 + 1.86860137 * r2 + 0.32478081 * r + 0.0098139;\nreturn roughness * (cubeUV_lodIdxMax - cubeUV_lodIdxMin);\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\nfloat lodIdx = clamp(roughnessToMip(roughness), cubeUV_lodIdxMin,\ncubeUV_lodIdxMax);\nfloat lodIdxF = fract(lodIdx);\nfloat lodIdxI = floor(lodIdx);\nvec3 color0 = sampleCubeUV(envMap, sampleDir, lodIdxI);\nif (lodIdxF == 0.0) {\nreturn vec4(color0, 1.0);\n} else {\nvec3 color1 = sampleCubeUV(envMap, sampleDir, lodIdxI + 1.0);\nreturn vec4(mix(color0, color1, lodIdxF), 1.0);\n}\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\nmat3 m = mat3(instanceMatrix);\ntransformedNormal /= vec3(dot(m[0], m[0]), dot(m[1], m[1]), dot(m[2], m[2]));\ntransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\ntransformedNormal = -transformedNormal;\n#endif\n#ifdef USE_TANGENT\nvec3 transformedTangent = (modelViewMatrix * vec4(objectTangent, 0.0)).xyz;\n#ifdef FLIP_SIDED\ntransformedTangent = -transformedTangent;\n#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\nuniform sampler2D displacementMap;\nuniform float displacementScale;\nuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\ntransformed += normalize(objectNormal) * (texture2D(displacementMap, vUv).x * displacementScale + displacementBias);\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\nvec4 emissiveColor = texture2D(emissiveMap, vUv);\ntotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\nuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel(gl_FragColor);",encodings_pars_fragment:"vec4 LinearToLinear(in vec4 value) {\nreturn value;\n}\nvec4 LinearTosRGB(in vec4 value) {\nreturn vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.a);\n}",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef ENV_WORLDPOS\nvec3 cameraToFrag;\nif (isOrthographic) {\ncameraToFrag = normalize(vec3(-viewMatrix[0][2], - viewMatrix[1][2], - viewMatrix[2][2]));\n} else {\ncameraToFrag = normalize(vWorldPosition - cameraPosition);\n}\nvec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\n#ifdef ENVMAP_MODE_REFLECTION\nvec3 reflectVec = reflect(cameraToFrag, worldNormal);\n#else\nvec3 reflectVec = refract(cameraToFrag, worldNormal, refractionRatio);\n#endif\n#else\nvec3 reflectVec = vReflect;\n#endif\n#ifdef ENVMAP_TYPE_CUBE\nvec4 envColor = textureCube(envMap, vec3(flipEnvMap * reflectVec.x, reflectVec.yz));\n#elif defined(ENVMAP_TYPE_CUBE_UV)\nvec4 envColor = textureCubeUV(envMap, reflectVec, 0.0);\n#else\nvec4 envColor = vec4(0.0);\n#endif\n#ifdef ENVMAP_BLENDING_MULTIPLY\noutgoingLight = mix(outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity);\n#elif defined(ENVMAP_BLENDING_MIX)\noutgoingLight = mix(outgoingLight, envColor.xyz, specularStrength * reflectivity);\n#elif defined(ENVMAP_BLENDING_ADD)\noutgoingLight += envColor.xyz * specularStrength * reflectivity;\n#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\nuniform float envMapIntensity;\nuniform float flipEnvMap;\nuniform int maxMipLevel;\n#ifdef ENVMAP_TYPE_CUBE\nuniform samplerCube envMap;\n#else\nuniform sampler2D envMap;\n#endif\n#if defined(ENVMAP_TYPE_CUBE) && defined(NODE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat calcGeometryRoughness(vec3 geometryNormal) {\nvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\nreturn max(max(dxy.x, dxy.y), dxy.z);\n}\nfloat calcCubeUVAdjustedRoughness(float origRoughness, float geomRoughness) {\nreturn min(max(origRoughness, 0.0525) + geomRoughness, 1.0);\n}\n#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\n#if defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(PHONG)\n#define ENV_WORLDPOS\n#endif\n#ifdef ENV_WORLDPOS\nvarying vec3 vWorldPosition;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n#if defined(USE_BUMPMAP) || defined(USE_NORMALMAP) ||defined(PHONG)\n#define ENV_WORLDPOS\n#endif\n#ifdef ENV_WORLDPOS\n\nvarying vec3 vWorldPosition;\n#else\nvarying vec3 vReflect;\nuniform float refractionRatio;\n#endif\n#endif",envmap_physical_pars_fragment:"#if defined(USE_ENVMAP)\n#define ENVMAP_PARALLAX_INFINITE 0\n#define ENVMAP_PARALLAX_SPHERE 1\n#define ENVMAP_PARALLAX_BOX 2\n#ifdef ENVMAP_MODE_REFRACTION\nuniform float refractionRatio;\n#endif\nuniform int envMapParallaxType;\nuniform mat4 envMapParallaxMatrix;\nuniform mat4 envMapParallaxMatrixInv;\nvec3 correctParallax(vec3 directionVecWorld, vec3 posWorld, int parallaxType) {\nvec3 posProbe = (envMapParallaxMatrix * vec4(posWorld, 1.0)).xyz;\nvec3 reflectVecProbe = transformDirection(directionVecWorld, envMapParallaxMatrix);\nif (parallaxType == ENVMAP_PARALLAX_SPHERE) {\nfloat b = 2.0 * dot(reflectVecProbe, posProbe);\nfloat c = dot(posProbe, posProbe) - 1.0;\nfloat D = b * b - 4.0 * c;\nif (D >= 0.0) {\nfloat x = (sqrt(D) - b) / 2.0;\nreflectVecProbe = posProbe + x * reflectVecProbe;\n}\n} else if (parallaxType == ENVMAP_PARALLAX_BOX) {\nvec3 scalePos = (vec3(1.0) - posProbe) / reflectVecProbe;\nvec3 scaleNeg = (vec3(-1.0) - posProbe) / reflectVecProbe;\nvec3 scalePosNeg = mix(scaleNeg, scalePos, step(vec3(0.0), reflectVecProbe));\nfloat x = min(scalePosNeg.x, min(scalePosNeg.y, scalePosNeg.z));\nreflectVecProbe = posProbe + x * reflectVecProbe;\n}\nvec3 directionVecWorldCorrected = transformDirection(reflectVecProbe,\nenvMapParallaxMatrixInv);\nreturn directionVecWorldCorrected;\n}\nvec3 getIBLIrradiance(const in GeometricContext geometry, const in int maxMIPLevel) {\nvec3 worldNormal = inverseTransformDirection(geometry.probeNormal, viewMatrix);\n#ifdef ENVMAP_TYPE_CUBE\nvec3 queryVec = vec3(flipEnvMap * worldNormal.x, worldNormal.yz);\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor = textureCubeLodEXT(envMap, queryVec, float(maxMIPLevel));\n#else\nvec4 envMapColor = textureCube(envMap, queryVec, float(maxMIPLevel));\n#endif\n#elif defined(ENVMAP_TYPE_CUBE_UV)\nvec3 queryVec = vec3(flipEnvMap * worldNormal.x, worldNormal.yz);\nvec4 envMapColor = textureCubeUV(envMap, queryVec, 1.0);\n#else\nvec4 envMapColor = vec4(0.0);\n#endif\nreturn PI * envMapColor.rgb * envMapIntensity;\n}\nfloat getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {\nfloat maxMIPLevelScalar = float(maxMIPLevel);\nfloat clapmedBlinnShininessExponent = min(blinnShininessExponent, 30000.0);\nfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248\n- 0.5 * log2(pow2(clapmedBlinnShininessExponent) + 1.0);\nreturn clamp(desiredMIPLevel, 0.0, maxMIPLevelScalar);\n}\nvec3 _getIBL(const float blinnShininessExponent, const int maxMIPLevel, vec3 directionVec) {\nfloat specularMIPLevel = getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);\n#ifdef ENVMAP_TYPE_CUBE\nvec3 queryVec = vec3(flipEnvMap * directionVec.x, directionVec.yz);\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor = textureCubeLodEXT(envMap, queryVec, specularMIPLevel);\n#else\nvec4 envMapColor = textureCube(envMap, queryVec, specularMIPLevel);\n#endif\n#elif defined(ENVMAP_TYPE_CUBE_UV)\nvec3 queryVec = vec3(flipEnvMap * directionVec.x, directionVec.yz);\nvec4 envMapColor = textureCubeUV(envMap, queryVec,\nBlinnExponentToGGXRoughness(blinnShininessExponent));\n#else\nvec4 envMapColor = return vec3(0.0);\n#endif\nreturn envMapColor.rgb * envMapIntensity;\n}\nvec3 getIBLRadiance(const GeometricContext geometry, const float blinnShininessExponent,\nconst int maxMIPLevel, const int useCoat) {\nvec3 normal = geometry.normal;\n#ifdef USE_CLEARCOAT\nif (useCoat == 1) {\nnormal = geometry.clearcoatNormal;\n}\n#endif\n#ifdef ENVMAP_MODE_REFLECTION\nvec3 directionVec = reflect(-geometry.viewDir, normal);\n#else\nvec3 directionVec = refract(-geometry.viewDir, normal, refractionRatio);\n#endif\ndirectionVec = inverseTransformDirection(directionVec, viewMatrix);\nvec3 posWorld = (invViewMatrix * vec4(geometry.position, 1.0)).xyz;\nif (envMapParallaxType != ENVMAP_PARALLAX_INFINITE) {\ndirectionVec = correctParallax(directionVec, posWorld, envMapParallaxType);\n}\nreturn _getIBL(blinnShininessExponent, maxMIPLevel, directionVec);\n}\nvec3 getIBLRefraction(const GeometricContext geometry, const float blinnShininessExponent,\nconst int maxMIPLevel, const float refrRatio) {\nvec3 directionVec = refract(-geometry.viewDir, geometry.normal, refrRatio);\ndirectionVec = inverseTransformDirection(directionVec, viewMatrix);\nvec3 posWorld = (invViewMatrix * vec4(geometry.position, 1.0)).xyz;\nif (envMapParallaxType != ENVMAP_PARALLAX_INFINITE) {\ndirectionVec = correctParallax(directionVec, posWorld, envMapParallaxType);\n}\nreturn _getIBL(blinnShininessExponent, maxMIPLevel, directionVec);\n}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n#ifdef ENV_WORLDPOS\nvWorldPosition = worldPosition.xyz;\n#else\nvec3 cameraToVertex;\nif (isOrthographic) {\ncameraToVertex = normalize(vec3(-viewMatrix[0][2], - viewMatrix[1][2], - viewMatrix[2][2]));\n} else {\ncameraToVertex = normalize(worldPosition.xyz - cameraPosition);\n}\nvec3 worldNormal = inverseTransformDirection(transformedNormal, viewMatrix);\n#ifdef ENVMAP_MODE_REFLECTION\nvReflect = reflect(cameraToVertex, worldNormal);\n#else\nvReflect = refract(cameraToVertex, worldNormal, refractionRatio);\n#endif\n#endif\n#endif",fog_vertex:"#ifdef USE_FOG\nvFogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\nvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n#ifdef FOG_EXP2\nfloat fogFactor = 1.0 - exp(-fogDensity * fogDensity * vFogDepth * vFogDepth);\n#else\nfloat fogFactor = smoothstep(fogNear, fogFar, vFogDepth);\n#endif\ngl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor);\n#endif",fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\nvarying float vFogDepth;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\nuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance(vec3 normal, vec3 lightDirection) {\nfloat dotNL = dot(normal, lightDirection);\nvec2 coord = vec2(dotNL * 0.5 + 0.5, 0.0);\n#ifdef USE_GRADIENTMAP\nreturn vec3(texture2D(gradientMap, coord).r);\n#else\nreturn (coord.x < 0.7) ? vec3(0.7) : vec3(1.0);\n#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\nvec4 lightMapTexel = texture2D(lightMap, vUv2);\nvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nlightMapIrradiance *= PI;\n#endif\nreflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nuniform sampler2D lightMap;\nuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3(1.0);\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize(transformedNormal);\ngeometry.probeNormal = geometry.normal;\ngeometry.viewDir = (isOrthographic) ? vec3(0, 0, 1) : normalize(-mvPosition.xyz);\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.probeNormal = backGeometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3(0.0);\nvIndirectFront = vec3(0.0);\n#ifdef DOUBLE_SIDED\nvLightBack = vec3(0.0);\nvIndirectBack = vec3(0.0);\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance(ambientLightColor);\nvIndirectFront += getLightProbeIrradiance(lightProbe, geometry.probeNormal);\n#ifdef DOUBLE_SIDED\nvIndirectBack += getAmbientLightIrradiance(ambientLightColor);\nvIndirectBack += getLightProbeIrradiance(lightProbe, backGeometry.probeNormal);\n#endif\n#if NUM_POINT_LIGHTS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\ngetPointLightInfo(pointLights[i], geometry, directLight);\ndotNL = dot(geometry.normal, directLight.direction);\ndirectLightColor_Diffuse = directLight.color;\nvLightFront += saturate(dotNL) * directLightColor_Diffuse;\n#ifdef DOUBLE_SIDED\nvLightBack += saturate(-dotNL) * directLightColor_Diffuse;\n#endif\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\ngetSpotLightInfo(spotLights[i], geometry, directLight);\ndotNL = dot(geometry.normal, directLight.direction);\ndirectLightColor_Diffuse = directLight.color;\nvLightFront += saturate(dotNL) * directLightColor_Diffuse;\n#ifdef DOUBLE_SIDED\nvLightBack += saturate(-dotNL) * directLightColor_Diffuse;\n#endif\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\ngetDirectionalLightInfo(directionalLights[i], geometry, directLight);\ndotNL = dot(geometry.normal, directLight.direction);\ndirectLightColor_Diffuse = directLight.color;\nvLightFront += saturate(dotNL) * directLightColor_Diffuse;\n#ifdef DOUBLE_SIDED\nvLightBack += saturate(-dotNL) * directLightColor_Diffuse;\n#endif\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_HEMI_LIGHTS; i++) {\nvIndirectFront += getHemisphereLightIrradiance(hemisphereLights[i], geometry.probeNormal);\n#ifdef DOUBLE_SIDED\nvIndirectBack += getHemisphereLightIrradiance(hemisphereLights[i], backGeometry.probeNormal);\n#endif\n}\n#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[9];\nvec3 shGetIrradianceAt(in vec3 normal, in vec3 shCoefficients[9]) {\nfloat x = normal.x, y = normal.y, z = normal.z;\nvec3 result = shCoefficients[0] * 0.886227;\nresult += shCoefficients[1] * 2.0 * 0.511664 * y;\nresult += shCoefficients[2] * 2.0 * 0.511664 * z;\nresult += shCoefficients[3] * 2.0 * 0.511664 * x;\nresult += shCoefficients[4] * 2.0 * 0.429043 * x * y;\nresult += shCoefficients[5] * 2.0 * 0.429043 * y * z;\nresult += shCoefficients[6] * (0.743125 * z * z - 0.247708);\nresult += shCoefficients[7] * 2.0 * 0.429043 * x * z;\nresult += shCoefficients[8] * 0.429043 * (x * x - y * y);\nreturn result;\n}\nvec3 getLightProbeIrradiance(const in vec3 lightProbe[9], const in vec3 normal) {\nvec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\nvec3 irradiance = shGetIrradianceAt(worldNormal, lightProbe);\nreturn irradiance;\n}\nvec3 getAmbientLightIrradiance(const in vec3 ambientLightColor) {\nvec3 irradiance = ambientLightColor;\nreturn irradiance;\n}\nfloat getDistanceAttenuation(float lightDistance, const in float cutoffDistance, const in float decayExponent) {\n#if defined (PHYSICALLY_CORRECT_LIGHTS)\nlightDistance = UNITS_SCALE_FACTOR * lightDistance;\n#ifdef MT_MAYA\nfloat distanceFalloff = 1.0 / pow(lightDistance + 1.0, decayExponent);\n#else\nfloat distanceFalloff = 1.0 / max(pow(lightDistance, decayExponent), 0.01);\n#endif\nif (cutoffDistance > 0.0) {\ndistanceFalloff *= pow2(saturate(1.0 - pow4(lightDistance / cutoffDistance)));\n}\nreturn distanceFalloff;\n#else\nif (cutoffDistance > 0.0 && decayExponent > 0.0) {\nreturn pow(saturate(-lightDistance / cutoffDistance + 1.0), decayExponent);\n}\nreturn 1.0;\n#endif\n}\nfloat getSpotAttenuation(const in float coneCosine, const in float penumbraCosine, const in float angleCosine) {\nreturn smoothstep(coneCosine, penumbraCosine, angleCosine);\n}\n#if NUM_DIR_LIGHTS > 0\nstruct DirectionalLight {\nvec3 direction;\nvec3 color;\n};\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\nvoid getDirectionalLightInfo(const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light) {\nlight.color = directionalLight.color;\nlight.direction = directionalLight.direction;\nlight.visible = true;\n}\n#endif\n#if NUM_POINT_LIGHTS > 0\nstruct PointLight {\nvec3 position;\nvec3 color;\nfloat distance;\nfloat decay;\n};\nuniform PointLight pointLights[NUM_POINT_LIGHTS];\nvoid getPointLightInfo(const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light) {\nvec3 lVector = pointLight.position - geometry.position;\nlight.direction = normalize(lVector);\nfloat lightDistance = length(lVector);\nlight.color = pointLight.color;\nlight.color *= getDistanceAttenuation(lightDistance, pointLight.distance, pointLight.decay);\nlight.visible = (light.color != vec3(0.0));\n}\n#endif\n#if NUM_SPOT_LIGHTS > 0\nstruct SpotLight {\nvec3 position;\nvec3 direction;\nvec3 color;\nfloat distance;\nfloat decay;\nfloat coneCos;\nfloat penumbraCos;\n};\nuniform SpotLight spotLights[NUM_SPOT_LIGHTS];\nvoid getSpotLightInfo(const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light) {\nvec3 lVector = spotLight.position - geometry.position;\nlight.direction = normalize(lVector);\nfloat angleCos = dot(light.direction, spotLight.direction);\n#if defined(MT_MAX) && defined(PHYSICALLY_CORRECT_LIGHTS)\nfloat coneCosDecayed = 2.0 * spotLight.coneCos - spotLight.penumbraCos;\nif (angleCos > coneCosDecayed) {\nfloat spotAttenuation = pow(max(angleCos, 0.0), log(0.5) / log(spotLight.penumbraCos) - 1.0);\nif (angleCos < spotLight.coneCos) {\nfloat decayFac = 1.0 + (spotLight.coneCos - angleCos)\n/ (spotLight.coneCos - spotLight.penumbraCos);\nspotAttenuation *= pow2(decayFac) * (3.0 - 2.0 * decayFac);\n}\nfloat lightDistance = length(lVector);\nlight.color = spotLight.color * spotAttenuation;\nlight.color *= getDistanceAttenuation(lightDistance, spotLight.distance, spotLight.decay);\nlight.visible = true;\n} else {\nlight.color = vec3(0.0);\nlight.visible = false;\n}\n#else\nfloat spotAttenuation = getSpotAttenuation(spotLight.coneCos, spotLight.penumbraCos, angleCos);\nif (spotAttenuation > 0.0) {\nfloat lightDistance = length(lVector);\nlight.color = spotLight.color * spotAttenuation;\nlight.color *= getDistanceAttenuation(lightDistance, spotLight.distance, spotLight.decay);\nlight.visible = true;\n} else {\nlight.color = vec3(0.0);\nlight.visible = false;\n}\n#endif\n}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\nstruct RectAreaLight {\nvec3 color;\nvec3 position;\nvec3 halfWidth;\nvec3 halfHeight;\n};\nuniform sampler2D ltc_1;\nuniform sampler2D ltc_2;\nuniform RectAreaLight rectAreaLights[NUM_RECT_AREA_LIGHTS];\n#endif\n#if NUM_HEMI_LIGHTS > 0\nstruct HemisphereLight {\nvec3 direction;\nvec3 skyColor;\nvec3 groundColor;\n};\nuniform HemisphereLight hemisphereLights[NUM_HEMI_LIGHTS];\nvec3 getHemisphereLightIrradiance(const in HemisphereLight hemiLight, const in vec3 normal) {\nfloat dotNL = dot(normal, hemiLight.direction);\nfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\nvec3 irradiance = mix(hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight);\nreturn irradiance;\n}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\nvec3 diffuseColor;\n};\nvoid RE_Direct_Toon(const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight) {\nvec3 irradiance = getGradientIrradiance(geometry.normal, directLight.direction) * directLight.color;\nreflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\nvoid RE_IndirectDiffuse_Toon(const in vec3 irradiance, const in vec3 iblIrradiance,\nconst in GeometricContext geometry, const in ToonMaterial material,\ninout ReflectedLight reflectedLight) {\nreflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n#define RE_Direct RE_Direct_Toon\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD(material) (0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\nvec3 diffuseColor;\nvec3 specularColor;\nfloat specularShininess;\nfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong(const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight) {\nfloat dotNL = saturate(dot(geometry.normal, directLight.direction));\nvec3 irradiance = dotNL * directLight.color;\nreflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\nreflectedLight.directSpecular += irradiance * BRDF_BlinnPhong(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong(const in vec3 irradiance, const in vec3 iblIrradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight) {\nreflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n#define RE_Direct RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse RE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD(material) (0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * (1.0 - metalnessFactor);\nvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\nfloat geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\nmaterial.roughness = max(roughnessFactor, 0.0525);\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min(material.roughness, 1.0);\n#ifdef IOR\n#ifdef SPECULAR\nfloat specularIntensityFactor = specularIntensity;\nvec3 specularColorFactor = specularColor;\n#ifdef USE_SPECULARINTENSITYMAP\nspecularIntensityFactor *= texture2D(specularIntensityMap, vUv).a;\n#endif\n#ifdef USE_SPECULARCOLORMAP\nspecularColorFactor *= texture2D(specularColorMap, vUv).rgb;\n#endif\nmaterial.specularF90 = mix(specularIntensityFactor, 1.0, metalnessFactor);\n#else\nfloat specularIntensityFactor = 1.0;\nvec3 specularColorFactor = vec3(1.0);\nmaterial.specularF90 = 1.0;\n#endif\nmaterial.specularColor = mix(min(pow2((ior - 1.0) / (ior + 1.0)) * specularColorFactor, vec3(1.0)) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor);\n#else\nmaterial.specularColor = mix(vec3(0.04), diffuseColor.rgb, metalnessFactor);\nmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\nmaterial.clearcoat = clearcoat;\nmaterial.clearcoatRoughness = clearcoatRoughness;\nmaterial.clearcoatF0 = vec3(0.04);\nmaterial.clearcoatF90 = 1.0;\n#ifdef USE_CLEARCOATMAP\nmaterial.clearcoat *= texture2D(clearcoatMap, vUv).x;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\nmaterial.clearcoatRoughness *= texture2D(clearcoatRoughnessMap, vUv).y;\n#endif\nmaterial.clearcoat = saturate(material.clearcoat);\nmaterial.clearcoatRoughness = max(material.clearcoatRoughness, 0.0525);\nmaterial.clearcoatRoughness += geometryRoughness;\nmaterial.clearcoatRoughness = min(material.clearcoatRoughness, 1.0);\n#endif\n#ifdef USE_SHEEN\nmaterial.sheenColor = sheenColor;\n#ifdef USE_SHEENCOLORMAP\nmaterial.sheenColor *= texture2D(sheenColorMap, vUv).rgb;\n#endif\nmaterial.sheenRoughness = clamp(sheenRoughness, 0.07, 1.0);\n#ifdef USE_SHEENROUGHNESSMAP\nmaterial.sheenRoughness *= texture2D(sheenRoughnessMap, vUv).a;\n#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\nvec3 diffuseColor;\nfloat roughness;\nvec3 specularColor;\nfloat specularF90;\n#ifdef USE_CLEARCOAT\nfloat clearcoat;\nfloat clearcoatRoughness;\nvec3 clearcoatF0;\nfloat clearcoatF90;\n#endif\n#ifdef USE_SHEEN\nvec3 sheenColor;\nfloat sheenRoughness;\n#endif\n};\nvec3 clearcoatSpecular = vec3(0.0);\nvec3 sheenSpecular = vec3(0.0);\nfloat IBLSheenBRDF(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\nfloat dotNV = saturate(dot(normal, viewDir));\nfloat r2 = roughness * roughness;\nfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\nfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\nfloat DG = exp(a * dotNV + b) + (roughness < 0.25 ? 0.0 : 0.1 * (roughness - 0.25));\nreturn saturate(DG * RECIPROCAL_PI);\n}\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\nfloat dotNV = saturate(dot(normal, viewDir));\nconst vec4 c0 = vec4(- 1, - 0.0275, - 0.572, 0.022);\nconst vec4 c1 = vec4(1, 0.0425, 1.04, - 0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(- 9.28 * dotNV)) * r.x + r.y;\nvec2 fab = vec2(- 1.04, 1.04) * a004 + r.zw;\nreturn fab;\n}\nvec3 EnvironmentBRDF(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness) {\nvec2 fab = DFGApprox(normal, viewDir, roughness);\nreturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\nvec2 fab = DFGApprox(normal, viewDir, roughness);\nvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\nfloat Ess = fab.x + fab.y;\nfloat Ems = 1.0 - Ess;\nvec3 Favg = specularColor + (1.0 - specularColor) * 0.047619;\nvec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\nsingleScatter += FssEss;\nmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\nvoid RE_Direct_RectArea_Physical(const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\nvec3 normal = geometry.normal;\nvec3 viewDir = geometry.viewDir;\nvec3 position = geometry.position;\nvec3 lightPos = rectAreaLight.position;\nvec3 halfWidth = rectAreaLight.halfWidth;\nvec3 halfHeight = rectAreaLight.halfHeight;\nvec3 lightColor = rectAreaLight.color;\nfloat roughness = material.roughness;\nvec3 rectCoords[4];\nrectCoords[0] = lightPos + halfWidth - halfHeight;\nrectCoords[1] = lightPos - halfWidth - halfHeight;\nrectCoords[2] = lightPos - halfWidth + halfHeight;\nrectCoords[3] = lightPos + halfWidth + halfHeight;\nvec2 uv = LTC_Uv(normal, viewDir, roughness);\nvec4 t1 = texture2D(ltc_1, uv);\nvec4 t2 = texture2D(ltc_2, uv);\nmat3 mInv = mat3(\nvec3(t1.x, 0, t1.y),\nvec3( 0, 1, 0),\nvec3(t1.z, 0, t1.w)\n);\nvec3 fresnel = (material.specularColor * t2.x + (vec3(1.0) - material.specularColor) * t2.y);\nreflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate(normal, viewDir, position, mInv, rectCoords);\nreflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate(normal, viewDir, position, mat3(1.0), rectCoords);\n}\n#endif\nvoid RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\nfloat dotNL = saturate(dot(geometry.normal, directLight.direction));\nvec3 irradiance = dotNL * directLight.color;\n#ifdef USE_CLEARCOAT\nfloat dotNLcc = saturate(dot(geometry.clearcoatNormal, directLight.direction));\nvec3 ccIrradiance = dotNLcc * directLight.color;\nclearcoatSpecular += ccIrradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);\n#endif\n#ifdef USE_SHEEN\nsheenSpecular += irradiance * BRDF_Sheen(directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness);\n#endif\nreflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\nreflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in vec3 iblIrradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\nreflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\nvoid RE_IndirectSpecular_Physical(const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n#ifdef USE_CLEARCOAT\nclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF(geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);\n#endif\n#ifdef USE_SHEEN\nsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF(geometry.normal, geometry.viewDir, material.sheenRoughness);\n#endif\nvec3 singleScattering = vec3(0.0);\nvec3 multiScattering = vec3(0.0);\nvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\ncomputeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);\nvec3 diffuse = material.diffuseColor * (1.0 - (singleScattering + multiScattering));\nreflectedLight.indirectSpecular += radiance * singleScattering;\nreflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\nreflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct RE_Direct_Physical\n#define RE_Direct_RectArea RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular RE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.roughness)\n#define Material_ClearCoat_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.clearcoatRoughness)\nfloat computeSpecularOcclusion(const in float dotNV, const in float ambientOcclusion, const in float roughness) {\nreturn saturate(pow(abs(dotNV + ambientOcclusion), exp2(- 16.0 * roughness - 1.0)) - 1.0 + ambientOcclusion);\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = -vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = (isOrthographic) ? vec3(0, 0, 1) : normalize(vViewPosition);\n#ifdef USE_CLEARCOAT\ngeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef PROBE_NORMAL\ngeometry.probeNormal = PROBE_NORMAL;\n#else\ngeometry.probeNormal = normal;\n#endif\nIncidentLight directLight;\n#if (NUM_POINT_LIGHTS > 0) && (defined(RE_Direct) || defined(RE_DirectDiffuse) || defined(RE_DirectSpecular))\nPointLight pointLight;\n#if defined(USE_SHADOWMAP) && NUM_POINT_LIGHT_SHADOWS > 0\nPointLightShadow pointLightShadow;\n#endif\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\npointLight = pointLights[i];\ngetPointLightInfo(pointLight, geometry, directLight);\n#if defined(USE_SHADOWMAP) && ((i) < NUM_POINT_LIGHT_SHADOWS)\npointLightShadow = pointLightShadows[i];\ndirectLight.color *= all(bvec2(directLight.visible, receiveShadow)) ?\ngetPointShadow(pointLightShadow, pointShadowMap[i], vPointShadowCoord[i]) : 1.0;\n#endif\n#if defined(RE_Direct)\nRE_Direct(directLight, geometry, material, reflectedLight);\n#else\n#if defined(RE_DirectDiffuse)\nRE_DirectDiffuse(directLight, geometry, material, reflectedLight);\n#endif\n#if defined(RE_DirectSpecular)\nRE_DirectSpecular(directLight, geometry, material, reflectedLight);\n#endif\n#endif\n}\n#pragma unroll_loop_end\n#endif\n#if (NUM_SPOT_LIGHTS > 0) && (defined(RE_Direct) || defined(RE_DirectDiffuse) || defined(RE_DirectSpecular))\nSpotLight spotLight;\n#if defined(USE_SHADOWMAP) && NUM_SPOT_LIGHT_SHADOWS > 0\nSpotLightShadow spotLightShadow;\n#endif\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\nspotLight = spotLights[i];\ngetSpotLightInfo(spotLight, geometry, directLight);\n#if defined(USE_SHADOWMAP) && ((i) < NUM_SPOT_LIGHT_SHADOWS)\nspotLightShadow = spotLightShadows[i];\nif (all(bvec2(directLight.visible, receiveShadow))) {\nif (spotLightShadow.shadow == 1) {\nfloat distWorld = 0.0;\n#if defined(SHADOWMAP_TYPE_ESM)\ndistWorld = length((invViewMatrix * vec4(spotLight.position\n- geometry.position, 0.0)).xyz);\n#endif\ndirectLight.color *= getSpotShadow(spotLightShadow, spotShadowMap[i],\nvSpotShadowCoord[i], distWorld);\n} else if (spotLightShadow.shadow == 2) {\ndirectLight.color *= getSpotOmniShadow(spotLightShadow,\nspotShadowMap[i], vSpotShadowCoord[i]);\n}\n}\n#endif\n#if defined(RE_Direct)\nRE_Direct(directLight, geometry, material, reflectedLight);\n#else\n#if defined(RE_DirectDiffuse)\nRE_DirectDiffuse(directLight, geometry, material, reflectedLight);\n#endif\n#if defined(RE_DirectSpecular)\nRE_DirectSpecular(directLight, geometry, material, reflectedLight);\n#endif\n#endif\n}\n#pragma unroll_loop_end\n#endif\n#if (NUM_DIR_LIGHTS > 0) && (defined(RE_Direct) || defined(RE_DirectDiffuse) || defined(RE_DirectSpecular))\nDirectionalLight directionalLight;\n#if defined(USE_SHADOWMAP) && NUM_DIR_LIGHT_SHADOWS > 0\nDirectionalLightShadow directionalLightShadow;\n#endif\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\ndirectionalLight = directionalLights[i];\ngetDirectionalLightInfo(directionalLight, geometry, directLight);\n#if defined(USE_SHADOWMAP) && ((i) < NUM_DIR_LIGHT_SHADOWS)\ndirectionalLightShadow = directionalLightShadows[i];\nfloat distWorld = 0.0;\n#if defined(SHADOWMAP_TYPE_ESM)\ndistWorld = length((invViewMatrix * vec4(directionalLightShadow.position\n- directionalLight.direction * directionalLightShadow.shadowCameraNear\n- geometry.position, 0.0)).xyz);\n#endif\ndirectLight.color *= all(bvec3(directLight.visible, receiveShadow,\nvViewPosition.z < directionalLightShadow.maxDistance))\n? getDirShadow(directionalLightShadow, directionalShadowMap[i],\nvDirectionalShadowCoord[i], distWorld) : 1.0;\n#endif\n#if defined(RE_Direct)\nRE_Direct(directLight, geometry, material, reflectedLight);\n#else\n#if defined(RE_DirectDiffuse)\nRE_DirectDiffuse(directLight, geometry, material, reflectedLight);\n#endif\n#if defined(RE_DirectSpecular)\nRE_DirectSpecular(directLight, geometry, material, reflectedLight);\n#endif\n#endif\n}\n#pragma unroll_loop_end\n#endif\n#if (NUM_RECT_AREA_LIGHTS > 0) && defined(RE_Direct_RectArea)\nRectAreaLight rectAreaLight;\n#if defined(USE_SHADOWMAP) && NUM_RECT_AREA_LIGHT_SHADOWS > 0\nRectAreaLightShadow rectAreaLightShadow;\n#endif\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_RECT_AREA_LIGHTS; i++) {\nrectAreaLight = rectAreaLights[i];\n#if defined(USE_SHADOWMAP) && ((i) < NUM_RECT_AREA_LIGHT_SHADOWS)\nrectAreaLightShadow = rectAreaLightShadows[i];\nrectAreaLight.color *= receiveShadow ?\ngetRectAreaShadow(rectAreaLightShadow, rectAreaShadowMap[i], vRectAreaShadowCoord[i]) : 1.0;\n#endif\nRE_Direct_RectArea(rectAreaLight, geometry, material, reflectedLight);\n}\n#pragma unroll_loop_end\n#endif\n#if defined(RE_IndirectDiffuse) || defined(RE_IndirectSpecular)\nvec3 iblIrradiance = vec3(0.0);\n#endif\n#if defined(RE_IndirectDiffuse)\nvec3 irradiance = getAmbientLightIrradiance(ambientLightColor);\nirradiance += getLightProbeIrradiance(lightProbe, geometry.probeNormal);\n#if (NUM_HEMI_LIGHTS > 0)\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_HEMI_LIGHTS; i++) {\nirradiance += getHemisphereLightIrradiance(hemisphereLights[i], geometry.probeNormal);\n}\n#pragma unroll_loop_end\n#endif\n#endif\n#if defined(RE_IndirectSpecular)\nvec3 radiance = vec3(0.0);\nvec3 clearcoatRadiance = vec3(0.0);\n#endif\n#if defined(RE_Refraction)\nvec3 refraction = vec3(0.0);\n#endif",lights_fragment_maps:"#if defined(RE_IndirectDiffuse)\n#ifdef USE_LIGHTMAP\nvec4 lightMapTexel = texture2D(lightMap, vUv2);\nvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nlightMapIrradiance *= PI;\n#endif\nirradiance += lightMapIrradiance;\n#endif\n#if defined(USE_ENVMAP) && defined(STANDARD) && defined(ENVMAP_TYPE_CUBE_UV)\niblIrradiance += getIBLIrradiance(geometry, maxMipLevel);\n#endif\n#endif\n#if defined(USE_ENVMAP) && (defined(STANDARD) || defined(PHYSICAL)) && defined(RE_IndirectSpecular)\nradiance += getIBLRadiance(geometry, Material_BlinnShininessExponent(material), maxMipLevel, 0);\n#if defined(USE_SSR) && !defined(USE_SSR_REFRACT)\nradiance = computeSSR(radiance, geometry.normal, 0.0);\n#endif\n#if defined(USE_PLANE_REFLECTION)\nradiance = computePlaneReflection(radiance, material.roughness, geometry.position, geometry.normal);\n#endif\n#ifdef USE_CLEARCOAT\nclearcoatRadiance += getIBLRadiance(geometry, Material_ClearCoat_BlinnShininessExponent(material), maxMipLevel, 1);\n#endif\n#endif\n#if defined(USE_ENVMAP) && defined(RE_Refraction)\nrefraction += getIBLRefraction(geometry,\nMaterial_Refraction_BlinnShininessExponent(material), maxMipLevel,\n1.0 / material.refractionIOR);\n#ifdef USE_SSR_REFRACT\nrefraction = computeSSR(refraction, geometry.normal, material.refractionIOR);\n#endif\n#endif",lights_fragment_end:"#if defined(RE_IndirectDiffuse)\nRE_IndirectDiffuse(irradiance, iblIrradiance, geometry, material, reflectedLight);\n#endif\n#if defined(RE_IndirectSpecular)\nRE_IndirectSpecular(radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight);\n#endif\n#if defined(RE_Refraction)\nRE_Refraction(refraction, material, refractedLight);\n#endif",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\nuniform float logDepthBufFC;\nvarying float vFragDepth;\nvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\nvarying float vIsPerspective;\n#else\nuniform float logDepthBufFC;\n#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvFragDepth = 1.0 + gl_Position.w;\nvIsPerspective = float(isPerspectiveMatrix(projectionMatrix));\n#else\nif (isPerspectiveMatrix(projectionMatrix)) {\ngl_Position.z = log2(max(EPSILON, gl_Position.w + 1.0)) * logDepthBufFC - 1.0;\ngl_Position.z *= gl_Position.w;\n}\n#endif\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 sampledDiffuseColor = texture2D(map, vUv);\n#ifdef DECODE_VIDEO_TEXTURE\nsampledDiffuseColor = vec4(mix(pow(sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(sampledDiffuseColor.rgb, vec3(0.04045)))), sampledDiffuseColor.w);\n#endif\ndiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined(USE_MAP) || defined(USE_ALPHAMAP)\nvec2 uv = (uvTransform * vec3(gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1)).xy;\n#endif\n#ifdef USE_MAP\ndiffuseColor *= texture2D(map, uv);\n#endif\n#ifdef USE_ALPHAMAP\ndiffuseColor.a *= texture2D(alphaMap, uv).g;\n#endif",map_particle_pars_fragment:"#if defined(USE_MAP) || defined(USE_ALPHAMAP)\nuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\nvec4 texelMetalness = texture2D(metalnessMap, vUv);\nmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\nuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nobjectNormal *= morphTargetBaseInfluence;\n#ifdef MORPHTARGETS_TEXTURE\nfor (int i = 0; i < MORPHTARGETS_COUNT; i++) {\nif (morphTargetInfluences[i] != 0.0) objectNormal += getMorph(gl_VertexID, i, 1).xyz * morphTargetInfluences[i];\n}\n#else\n#if MORPHTARGETS_COUNT > 0\nobjectNormal += morphNormal0 * morphTargetInfluences[0];\n#endif\n#if MORPHTARGETS_COUNT > 1\nobjectNormal += morphNormal1 * morphTargetInfluences[1];\n#endif\n#if MORPHTARGETS_COUNT > 2\nobjectNormal += morphNormal2 * morphTargetInfluences[2];\n#endif\n#if MORPHTARGETS_COUNT > 3\nobjectNormal += morphNormal3 * morphTargetInfluences[3];\n#endif\n#if MORPHTARGETS_COUNT > 4\nobjectNormal += morphNormal4 * morphTargetInfluences[4];\n#endif\n#if MORPHTARGETS_COUNT > 5\nobjectNormal += morphNormal5 * morphTargetInfluences[5];\n#endif\n#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetBaseInfluence;\n#ifdef MORPHTARGETS_TEXTURE\nuniform float morphTargetInfluences[MORPHTARGETS_COUNT];\nuniform sampler2DArray morphTargetsTexture;\nuniform ivec2 morphTargetsTextureSize;\nvec4 getMorph(const in int vertexIndex, const in int morphTargetIndex, const in int offset) {\nint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\nint y = texelIndex / morphTargetsTextureSize.x;\nint x = texelIndex - y * morphTargetsTextureSize.x;\nivec3 morphUV = ivec3(x, y, morphTargetIndex);\nreturn texelFetch(morphTargetsTexture, morphUV, 0);\n}\n#else\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[12];\n#else\nuniform float morphTargetInfluences[6];\n#endif\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\ntransformed *= morphTargetBaseInfluence;\n#ifdef MORPHTARGETS_TEXTURE\nfor (int i = 0; i < MORPHTARGETS_COUNT; i++) {\nif (morphTargetInfluences[i] != 0.0) transformed += getMorph(gl_VertexID, i, 0).xyz * morphTargetInfluences[i];\n}\n#else\n#if MORPHTARGETS_COUNT > 0\ntransformed += morphTarget0 * morphTargetInfluences[0];\n#endif\n#if MORPHTARGETS_COUNT > 1\ntransformed += morphTarget1 * morphTargetInfluences[1];\n#endif\n#if MORPHTARGETS_COUNT > 2\ntransformed += morphTarget2 * morphTargetInfluences[2];\n#endif\n#if MORPHTARGETS_COUNT > 3\ntransformed += morphTarget3 * morphTargetInfluences[3];\n#endif\n#if MORPHTARGETS_COUNT > 4\ntransformed += morphTarget4 * morphTargetInfluences[4];\n#endif\n#if MORPHTARGETS_COUNT > 5\ntransformed += morphTarget5 * morphTargetInfluences[5];\n#endif\n#ifndef USE_MORPHNORMALS\n#if MORPHTARGETS_COUNT > 6\ntransformed += morphTarget6 * morphTargetInfluences[6];\n#endif\n#if MORPHTARGETS_COUNT > 7\ntransformed += morphTarget7 * morphTargetInfluences[7];\n#endif\n#if MORPHTARGETS_COUNT > 8\ntransformed += morphTarget8 * morphTargetInfluences[8];\n#endif\n#if MORPHTARGETS_COUNT > 9\ntransformed += morphTarget9 * morphTargetInfluences[9];\n#endif\n#if MORPHTARGETS_COUNT > 10\ntransformed += morphTarget10 * morphTargetInfluences[10];\n#endif\n#if MORPHTARGETS_COUNT > 11\ntransformed += morphTarget1 * morphTargetInfluences[11];\n#endif\n#endif\n#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\nvec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\nvec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\nvec3 normal = normalize(cross(fdx, fdy));\n#else\nvec3 normal = normalize(vNormal);\n#ifdef DOUBLE_SIDED\n#ifdef FRONT_FACING_VALUE\nbool frontFacing = FRONT_FACING_VALUE;\n#else\nbool frontFacing = gl_FrontFacing;\n#endif\nnormal = normal * (float(frontFacing) * 2.0 - 1.0);\n#endif\n#ifdef USE_TANGENT\nvec3 tangent = normalize(vTangent);\nvec3 bitangent = normalize(vBitangent);\n#ifdef DOUBLE_SIDED\ntangent = tangent * faceDirection;\nbitangent = bitangent * faceDirection;\n#endif\n#if defined(TANGENTSPACE_NORMALMAP) || defined(USE_CLEARCOAT_NORMALMAP)\nmat3 vTBN = mat3(tangent, bitangent, normal);\n#endif\n#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\nnormal = texture2D(normalMap, vUv).xyz * 2.0 - 1.0;\n#ifdef FLIP_SIDED\nnormal = -normal;\n#endif\n#ifdef DOUBLE_SIDED\nnormal = normal * faceDirection;\n#endif\nnormal = normalize(normalMatrix * normal);\n#elif defined(TANGENTSPACE_NORMALMAP)\nvec3 mapN = texture2D(normalMap, vUv).xyz * 2.0 - 1.0;\nmapN.xy *= normalScale;\n#ifdef USE_TANGENT\nnormal = normalize(vTBN * mapN);\n#else\nnormal = perturbNormal2Arb(-vViewPosition, normal, mapN, faceDirection);\n#endif\n#elif defined(USE_BUMPMAP)\nnormal = perturbNormalArb(-vViewPosition, normal, dHdxy_fwd(), faceDirection);\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#ifdef USE_TANGENT\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#ifdef USE_TANGENT\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\nvNormal = normalize(transformedNormal);\n#ifdef USE_TANGENT\nvTangent = normalize(transformedTangent);\nvBitangent = normalize(cross(vNormal, vTangent) * tangent.w);\n#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat3 normalMatrix;\n#endif\n#if !defined (USE_TANGENT) && (defined (TANGENTSPACE_NORMALMAP) || defined (USE_CLEARCOAT_NORMALMAP))\nvec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection) {\nvec3 q0 = vec3(dFdx(eye_pos.x), dFdx(eye_pos.y), dFdx(eye_pos.z));\nvec3 q1 = vec3(dFdy(eye_pos.x), dFdy(eye_pos.y), dFdy(eye_pos.z));\nvec2 st0 = dFdx(vUv.st);\nvec2 st1 = dFdy(vUv.st);\nvec3 N = surf_norm;\nvec3 q1perp = cross(q1, N);\nvec3 q0perp = cross(N, q0);\nvec3 T = q1perp * st0.x + q0perp * st1.x;\nvec3 B = q1perp * st0.y + q0perp * st1.y;\nfloat det = max(dot(T, T), dot(B, B));\nfloat scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);\nreturn normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);\n}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\nvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\nvec3 clearcoatMapN = texture2D(clearcoatNormalMap, vUv).xyz * 2.0 - 1.0;\nclearcoatMapN.xy *= clearcoatNormalScale;\n#ifdef USE_TANGENT\nclearcoatNormal = normalize(vTBN * clearcoatMapN);\n#else\nclearcoatNormal = perturbNormal2Arb(-vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection);\n#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\nuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\nuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\nuniform sampler2D clearcoatNormalMap;\nuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4(outgoingLight, diffuseColor.a);",packing:"vec3 packNormalToRGB(const in vec3 normal) {\nreturn normalize(normal) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal(const in vec3 rgb) {\nreturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;\nconst float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.);\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA(const in float v) {\nvec4 r = vec4(fract(v * PackFactors), v);\nr.yzw -= r.xyz * ShiftRight8;\nreturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth(const in vec4 v) {\nreturn dot(v, UnpackFactors);\n}\nvec4 pack2HalfToRGBA(vec2 v) {\nvec4 r = vec4(v.x, fract(v.x * 255.0), v.y, fract(v.y * 255.0));\nreturn vec4(r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half(vec4 v) {\nreturn vec2(v.x + (v.y / 255.0), v.z + (v.w / 255.0));\n}\nfloat viewZToOrthographicDepth(const in float viewZ, const in float near, const in float far) {\nreturn (viewZ + near) / (near - far);\n}\nfloat orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {\nreturn linearClipZ * (near - far) - near;\n}\nfloat viewZToPerspectiveDepth(const in float viewZ, const in float near, const in float far) {\nreturn ((near + viewZ) * far) / ((far - near) * viewZ);\n}\nfloat perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {\nreturn (near * far) / ((far - near) * invClipZ - far);\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\ngl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4(transformed, 1.0);\n#ifdef USE_INSTANCING\nmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;\n#if defined(BACKGROUND_DEPTH)\ngl_Position.z = gl_Position.w;\n#endif",dithering_fragment:"#ifdef DITHERING\ngl_FragColor.rgb = dithering(gl_FragColor.rgb);\n#endif",dithering_pars_fragment:"#ifdef DITHERING\nvec3 dithering(vec3 color) {\nfloat grid_position = rand(gl_FragCoord.xy);\nvec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);\ndither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);\nreturn color + dither_shift_RGB;\n}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\nvec4 texelRoughness = texture2D(roughnessMap, vUv);\nroughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\nuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"\n#define BIAS_FRUSTUM_SCALE_COEFF 30.0\n#define ESM_SPOT_SINGLE_BLUR_COEFF 0.25\n#define PCF_POISSON_SPOT_OMNI_BLUR_COEFF 4.0\n#define PCF_POISSON_POINT_BLUR_COEFF 2.5\n#define PCF_PCF_SOFT_DIR_SPOT_BLUR_COEFF 0.5\n#define ESM_BIAS_COEFF 100.0\n#ifndef ESM_DISTANCE_SCALE\n#define ESM_DISTANCE_SCALE 1.0\n#endif\n#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHT_SHADOWS > 0\nuniform sampler2D directionalShadowMap[NUM_DIR_LIGHT_SHADOWS];\nvarying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHT_SHADOWS];\nstruct DirectionalLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nvec3 position;\nfloat shadowCameraNear;\nfloat maxDistance;\nfloat expBias;\n};\nuniform DirectionalLightShadow directionalLightShadows[NUM_DIR_LIGHT_SHADOWS];\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\nuniform sampler2D spotShadowMap[NUM_SPOT_LIGHT_SHADOWS];\nvarying vec4 vSpotShadowCoord[NUM_SPOT_LIGHT_SHADOWS];\nstruct SpotLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nint shadow;\nfloat shadowCameraNear;\nfloat shadowCameraFar;\nfloat expBias;\n};\nuniform SpotLightShadow spotLightShadows[NUM_SPOT_LIGHT_SHADOWS];\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\nuniform sampler2D pointShadowMap[NUM_POINT_LIGHT_SHADOWS];\nvarying vec4 vPointShadowCoord[NUM_POINT_LIGHT_SHADOWS];\nstruct PointLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nfloat shadowCameraNear;\nfloat shadowCameraFar;\nfloat expBias;\n};\nuniform PointLightShadow pointLightShadows[NUM_POINT_LIGHT_SHADOWS];\n#endif\n#if NUM_RECT_AREA_LIGHT_SHADOWS > 0\nuniform sampler2D rectAreaShadowMap[NUM_RECT_AREA_LIGHT_SHADOWS];\nvarying vec4 vRectAreaShadowCoord[NUM_RECT_AREA_LIGHT_SHADOWS];\nstruct RectAreaLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nfloat shadowCameraNear;\nfloat shadowCameraFar;\nfloat expBias;\n};\nuniform RectAreaLightShadow rectAreaLightShadows[NUM_RECT_AREA_LIGHT_SHADOWS];\n#endif\nconst vec3 PERMUTE_DIR_X = vec3(1.0, 0.0, 0.0);\nconst vec3 PERMUTE_DIR_Y = vec3(0.0, 1.0, 0.0);\nconst vec3 PERMUTE_DIR_Z = vec3(0.0, 0.0, 1.0);\nconst mat4 POISSON_DISK_0 = mat4(\n0.954845, 0.242214, -0.623893, -0.235473,\n-0.173288, 0.799228, 0.605969, -0.548050,\n-0.560406, 0.327647, -0.448307, -0.774344,\n0.308258, 0.417332, -0.125623, -0.056098\n);\nconst mat4 POISSON_DISK_1 = mat4(\n0.145585, -0.305634, 0.264060, -0.661648,\n0.617942, 0.652121, -0.041412, -0.893582,\n0.463911, 0.039752, 0.212664, 0.810727,\n-0.955989, -0.014390, -0.652588, 0.671204\n);\nfloat texture2DCompare(sampler2D depths, vec2 uv, float compare) {\nreturn step(compare, unpackRGBAToDepth(texture2D(depths, uv)));\n}\nvec2 texture2DDistribution(sampler2D shadow, vec2 uv) {\nreturn unpackRGBATo2Half(texture2D(shadow, uv));\n}\nfloat VSMShadow (sampler2D shadow, vec2 uv, float compare){\nfloat occlusion = 1.0;\nvec2 distribution = texture2DDistribution(shadow, uv);\nfloat hard_shadow = step(compare , distribution.x);\nif (hard_shadow != 1.0) {\nfloat distance = compare - distribution.x ;\nfloat variance = max(0.00000, distribution.y * distribution.y);\nfloat softness_probability = variance / (variance + distance * distance);\nsoftness_probability = clamp((softness_probability - 0.3) / (0.95 - 0.3), 0.0, 1.0);\nocclusion = clamp(max(hard_shadow, softness_probability), 0.0, 1.0);\n}\nreturn occlusion;\n}\nfloat texture2DShadowLerp(sampler2D depths, vec2 size, vec2 uv, float compare) {\nconst vec2 offset = vec2(0.0, 1.0);\nvec2 texelSize = vec2(1.0) / size;\nvec2 centroidUV = floor(uv * size + 0.5) / size;\nfloat lb = texture2DCompare(depths, centroidUV + texelSize * offset.xx, compare);\nfloat lt = texture2DCompare(depths, centroidUV + texelSize * offset.xy, compare);\nfloat rb = texture2DCompare(depths, centroidUV + texelSize * offset.yx, compare);\nfloat rt = texture2DCompare(depths, centroidUV + texelSize * offset.yy, compare);\nvec2 f = fract(uv * size + 0.5);\nfloat a = mix(lb, lt, f.y);\nfloat b = mix(rb, rt, f.y);\nfloat c = mix(a, b, f.x);\nreturn c;\n}\nvec2 cubeToUV(vec3 v, float texelSizeY) {\nvec3 absV = abs(v);\nfloat scaleToCube = 1.0 / max(absV.x, max(absV.y, absV.z));\nabsV *= scaleToCube;\nv *= scaleToCube * (1.0 - 2.0 * texelSizeY);\nvec2 planar = v.xy;\nfloat almostATexel = 1.5 * texelSizeY;\nfloat almostOne = 1.0 - almostATexel;\nif (absV.z >= almostOne) {\nif (v.z > 0.0)\nplanar.x = 4.0 - v.x;\n} else if (absV.x >= almostOne) {\nfloat signX = sign(v.x);\nplanar.x = v.z * signX + 2.0 * signX;\n} else if (absV.y >= almostOne) {\nfloat signY = sign(v.y);\nplanar.x = v.x + 2.0 * signY + 2.0;\nplanar.y = v.z * signY - 2.0;\n}\nreturn vec2(0.125, 0.25) * planar + vec2(0.375, 0.75);\n}\nfloat texture2DShadowAvgCube(sampler2D depths, vec2 size, vec3 bd3D, float compare) {\nvec2 texelSize = vec2(1.0) / size;\nvec3 dirX = normalize(abs(bd3D.y) < 0.99999 ? vec3(bd3D.z, 0.0, -bd3D.x)\n: vec3(0.0, -bd3D.z, bd3D.y));\nvec3 dirY = cross(bd3D, dirX);\nfloat theta = PI_HALF * texelSize.y;\nvec3 sX = sin(theta) * dirX;\nvec3 sY = sin(theta) * dirY;\nfloat cosT = cos(theta);\nvec3 sampleVec[4];\nsampleVec[0] = bd3D;\nsampleVec[1] = bd3D * cosT + sY;\nsampleVec[2] = bd3D * cosT + sX;\nsampleVec[3] = sampleVec[2] * cosT + sY;\nfloat avg = 0.0;\nfor (int i = 0; i < 4; i++) {\navg += texture2DCompare(depths, cubeToUV(sampleVec[i], texelSize.y), compare);\n}\navg /= 4.0;\nreturn avg;\n}\nfloat getShadow(sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord,\nfloat expBias, float distWorld) {\nfloat shadow = 1.0;\nshadowCoord.xyz /= shadowCoord.w;\nbvec4 inFrustumVec = bvec4 (shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0);\nbool inFrustum = all(inFrustumVec);\nbvec3 frustumTestVec = bvec3(inFrustum, shadowCoord.z <= 1.0, shadowCoord.z >= 0.0);\nbool frustumTest = all(frustumTestVec);\nif (frustumTest) {\n#if defined(SHADOWMAP_TYPE_BILINEAR)\nshadowCoord.z += shadowBias;\nshadow = texture2DShadowLerp(shadowMap, shadowMapSize,\nshadowCoord.xy, shadowCoord.z);\n#elif defined(SHADOWMAP_TYPE_PCF)\nshadowCoord.z += shadowBias;\nvec2 texelSize = vec2(1.0) / shadowMapSize;\nfloat dx0 = - texelSize.x * shadowRadius;\nfloat dy0 = - texelSize.y * shadowRadius;\nfloat dx1 = + texelSize.x * shadowRadius;\nfloat dy1 = + texelSize.y * shadowRadius;\nvec2 offsetVec[9];\noffsetVec[0] = vec2(dx0, dy0);\noffsetVec[1] = vec2(0.0, dy0);\noffsetVec[2] = vec2(dx1, dy0);\noffsetVec[3] = vec2(dx0, 0.0);\noffsetVec[4] = vec2(0.0);\noffsetVec[5] = vec2(dx1, 0.0);\noffsetVec[6] = vec2(dx0, dy1);\noffsetVec[7] = vec2(0.0, dy1);\noffsetVec[8] = vec2(dx1, dy1);\nshadow = 0.0;\nfor (int i = 0; i < 9; i++) {\nshadow += texture2DCompare(shadowMap, shadowCoord.xy + offsetVec[i], shadowCoord.z);\n}\nshadow /= 9.0;\n#elif defined(SHADOWMAP_TYPE_PCF_SOFT)\nshadowCoord.z += shadowBias;\nvec2 texelSize = vec2(1.0) / shadowMapSize;\nfloat dx0 = - texelSize.x * shadowRadius;\nfloat dy0 = - texelSize.y * shadowRadius;\nfloat dx1 = + texelSize.x * shadowRadius;\nfloat dy1 = + texelSize.y * shadowRadius;\nvec2 offsetVec[9];\noffsetVec[0] = vec2(dx0, dy0);\noffsetVec[1] = vec2(0.0, dy0);\noffsetVec[2] = vec2(dx1, dy0);\noffsetVec[3] = vec2(dx0, 0.0);\noffsetVec[4] = vec2(0.0);\noffsetVec[5] = vec2(dx1, 0.0);\noffsetVec[6] = vec2(dx0, dy1);\noffsetVec[7] = vec2(0.0, dy1);\noffsetVec[8] = vec2(dx1, dy1);\nshadow = 0.0;\nfor (int i = 0; i < 9; i++) {\nshadow += texture2DShadowLerp(shadowMap, shadowMapSize,\nshadowCoord.xy + offsetVec[i], shadowCoord.z);\n}\nshadow /= 9.0;\n#elif defined(SHADOWMAP_TYPE_PCF_POISSON_DISK)\nshadowCoord.z += shadowBias;\nvec2 texelSize = vec2(1.0) / shadowMapSize;\nfloat randAngle = rand(gl_FragCoord.xy) * PI2;\nfloat c = cos(randAngle), s = sin(randAngle);\nmat2 sampleMat = mat2(c, s, -s, c)\n* mat2(shadowRadius * texelSize.x, 0.0, 0.0, shadowRadius * texelSize.y);\nvec2 sampleVec[16];\nsampleVec[0] = POISSON_DISK_0[0].xy;\nsampleVec[1] = POISSON_DISK_0[0].zw;\nsampleVec[2] = POISSON_DISK_0[1].xy;\nsampleVec[3] = POISSON_DISK_0[1].zw;\nsampleVec[4] = POISSON_DISK_0[2].xy;\nsampleVec[5] = POISSON_DISK_0[2].zw;\nsampleVec[6] = POISSON_DISK_0[3].xy;\nsampleVec[7] = POISSON_DISK_0[3].zw;\nsampleVec[8] = POISSON_DISK_1[0].xy;\nsampleVec[9] = POISSON_DISK_1[0].zw;\nsampleVec[10] = POISSON_DISK_1[1].xy;\nsampleVec[11] = POISSON_DISK_1[1].zw;\nsampleVec[12] = POISSON_DISK_1[2].xy;\nsampleVec[13] = POISSON_DISK_1[2].zw;\nsampleVec[14] = POISSON_DISK_1[3].xy;\nsampleVec[15] = POISSON_DISK_1[3].zw;\nshadow = 0.0;\nfor (int i = 0; i < 16; i++) {\nshadow += texture2DCompare(shadowMap, shadowCoord.xy\n+ sampleMat * sampleVec[i], shadowCoord.z);\n}\nshadow /= 16.0;\n#elif defined(SHADOWMAP_TYPE_VSM)\nshadow = VSMShadow(shadowMap, shadowCoord.xy, shadowCoord.z);\n#elif defined(SHADOWMAP_TYPE_ESM)\nshadow = saturate(exp(expBias * (texture2D(shadowMap, shadowCoord.xy).x\n- length(distWorld) * ESM_DISTANCE_SCALE\n- ESM_BIAS_COEFF * shadowBias)));\n#else\nshadowCoord.z += shadowBias;\nshadow = texture2DCompare(shadowMap, shadowCoord.xy, shadowCoord.z);\n#endif\n}\nreturn shadow;\n}\nfloat getShadow(sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord) {\nreturn getShadow(shadowMap, shadowMapSize, shadowBias, shadowRadius, shadowCoord, 0.0, 0.0);\n}\nfloat getOmniShadow(sampler2D shadowMap, vec2 shadowMapSize, float shadowBias,\nfloat expBias, float shadowRadius, vec4 shadowCoord,\nfloat shadowCameraNear, float shadowCameraFar) {\nfloat shadow = 1.0;\nvec3 lightToPosition = shadowCoord.xyz;\nfloat dp = (length(lightToPosition) - shadowCameraNear)\n/ (shadowCameraFar - shadowCameraNear);\nbvec2 frustumTestVec = bvec2(dp <= 1.0, dp >= 0.0);\nbool frustumTest = all(frustumTestVec);\nif (frustumTest) {\nfloat biasScaleCoeff = BIAS_FRUSTUM_SCALE_COEFF\n/ (shadowCameraFar - shadowCameraNear);\ndp += shadowBias * biasScaleCoeff;\nvec3 bd3D = normalize(lightToPosition);\nvec2 texelSize = 1.0 / shadowMapSize;\n#if defined(SHADOWMAP_TYPE_BILINEAR)\nshadow = texture2DShadowAvgCube(shadowMap, shadowMapSize, bd3D, dp);\n#elif defined(SHADOWMAP_TYPE_ESM)\nshadow = saturate(exp(expBias * (texture2D(shadowMap,\ncubeVecToOctUV(bd3D, texelSize)).x\n- length(lightToPosition) * ESM_DISTANCE_SCALE\n- ESM_BIAS_COEFF * shadowBias)));\n#elif defined(SHADOWMAP_TYPE_PCF) || defined(SHADOWMAP_TYPE_PCF_SOFT)\nvec2 offset = vec2(-1, 1) * shadowRadius * texelSize.y;\nvec3 offsetVec[9];\noffsetVec[0] = offset.xyy;\noffsetVec[1] = offset.yyy;\noffsetVec[2] = offset.xyx;\noffsetVec[3] = offset.yyx;\noffsetVec[4] = vec3(0.0);\noffsetVec[5] = offset.xxy;\noffsetVec[6] = offset.yxy;\noffsetVec[7] = offset.xxx;\noffsetVec[8] = offset.yxx;\nshadow = 0.0;\nfor (int i = 0; i < 9; i++) {\nshadow += texture2DCompare(shadowMap, cubeToUV(bd3D + offsetVec[i], texelSize.y), dp);\n}\nshadow /= 9.0;\n#elif defined(SHADOWMAP_TYPE_PCF_POISSON_DISK)\nfloat randAngle = rand(gl_FragCoord.xy) * PI2;\nfloat c = cos(randAngle), s = sin(randAngle);\nmat2 sampleMat = mat2(c, s, -s, c)\n* mat2(shadowRadius * texelSize.y, 0.0, 0.0, shadowRadius * texelSize.y);\nvec3 absBd3D = abs(bd3D);\nabsBd3D /= max(absBd3D.x, max(absBd3D.y, absBd3D.z));\nbvec2 isPointingCubeFace = greaterThan(absBd3D.xy, vec2(0.999));\nmat3 permuteMat = mat3(\nisPointingCubeFace.x ? PERMUTE_DIR_Y : PERMUTE_DIR_X,\nisPointingCubeFace.x || isPointingCubeFace.y ? PERMUTE_DIR_Z : PERMUTE_DIR_Y,\nisPointingCubeFace.x ? PERMUTE_DIR_X : isPointingCubeFace.y ? PERMUTE_DIR_Y : PERMUTE_DIR_Z\n);\nvec2 sampleVec[16];\nsampleVec[0] = POISSON_DISK_0[0].xy;\nsampleVec[1] = POISSON_DISK_0[0].zw;\nsampleVec[2] = POISSON_DISK_0[1].xy;\nsampleVec[3] = POISSON_DISK_0[1].zw;\nsampleVec[4] = POISSON_DISK_0[2].xy;\nsampleVec[5] = POISSON_DISK_0[2].zw;\nsampleVec[6] = POISSON_DISK_0[3].xy;\nsampleVec[7] = POISSON_DISK_0[3].zw;\nsampleVec[8] = POISSON_DISK_1[0].xy;\nsampleVec[9] = POISSON_DISK_1[0].zw;\nsampleVec[10] = POISSON_DISK_1[1].xy;\nsampleVec[11] = POISSON_DISK_1[1].zw;\nsampleVec[12] = POISSON_DISK_1[2].xy;\nsampleVec[13] = POISSON_DISK_1[2].zw;\nsampleVec[14] = POISSON_DISK_1[3].xy;\nsampleVec[15] = POISSON_DISK_1[3].zw;\nshadow = 0.0;\nfor (int i = 0; i < 16; i++) {\nshadow += texture2DCompare(shadowMap, cubeToUV(bd3D + permuteMat * vec3(sampleMat * sampleVec[i], 0.0), texelSize.y), dp);\n}\nshadow /= 16.0;\n#else\nshadow = texture2DCompare(shadowMap, cubeToUV(bd3D, texelSize.y), dp);\n#endif\n}\nreturn shadow;\n}\n#if NUM_DIR_LIGHT_SHADOWS > 0\nfloat getDirShadow(DirectionalLightShadow light, sampler2D shadowMap,\nvec4 shadowCoord, float distWorld) {\nfloat shadowRadius = light.shadowRadius;\n#if defined(SHADOWMAP_TYPE_PCF) || defined(SHADOWMAP_TYPE_PCF_SOFT)\nshadowRadius *= PCF_PCF_SOFT_DIR_SPOT_BLUR_COEFF;\n#endif\nreturn getShadow(shadowMap, light.shadowMapSize, light.shadowBias, shadowRadius, shadowCoord, \nlight.expBias, distWorld);\n}\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\nfloat getPointShadow(PointLightShadow light, sampler2D shadowMap, vec4 shadowCoord) {\nfloat shadowRadius = light.shadowRadius;\nvec2 mapSize = light.shadowMapSize;\n#if defined(SHADOWMAP_TYPE_ESM)\nmapSize *= 2.0;\n#else\nmapSize *= vec2(4.0, 2.0);\n#if defined(SHADOWMAP_TYPE_PCF_POISSON_DISK)\nshadowRadius *= PCF_POISSON_POINT_BLUR_COEFF;\n#endif\n#endif\nreturn getOmniShadow(shadowMap, mapSize, light.shadowBias, light.expBias,\nshadowRadius, shadowCoord, light.shadowCameraNear,\nlight.shadowCameraFar);\n}\n#endif\n#if NUM_RECT_AREA_LIGHT_SHADOWS > 0\nfloat getRectAreaShadow(RectAreaLightShadow light, sampler2D shadowMap, vec4 shadowCoord) {\nfloat shadowRadius = light.shadowRadius;\nvec2 mapSize = light.shadowMapSize;\n#if defined(SHADOWMAP_TYPE_ESM)\nmapSize *= 2.0;\n#else\nmapSize *= vec2(4.0, 2.0);\n#if defined(SHADOWMAP_TYPE_PCF_POISSON_DISK)\nshadowRadius *= PCF_POISSON_POINT_BLUR_COEFF;\n#endif\n#endif\nreturn getOmniShadow(shadowMap, mapSize, light.shadowBias, light.expBias,\nshadowRadius, shadowCoord, light.shadowCameraNear,\nlight.shadowCameraFar);\n}\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\nfloat getSpotOmniShadow(SpotLightShadow light, sampler2D shadowMap, vec4 shadowCoord) {\nfloat shadowRadius = light.shadowRadius;\nvec2 mapSize = light.shadowMapSize;\n#if defined(SHADOWMAP_TYPE_ESM)\n#else\nmapSize *= vec2(4.0, 2.0);\n#if defined(SHADOWMAP_TYPE_PCF_POISSON_DISK)\nshadowRadius *= PCF_POISSON_SPOT_OMNI_BLUR_COEFF;\n#endif\n#endif\nreturn getOmniShadow(shadowMap, mapSize, light.shadowBias, light.expBias,\nshadowRadius, shadowCoord, light.shadowCameraNear,\nlight.shadowCameraFar);\n}\nfloat biasLinearNormalizedToNonlinear(float bias, float near, float far,\nfloat projZ, float projW) {\nreturn (bias * (far + near) + 2.0 * projZ) / (bias * (far - near) + 2.0 * projW)\n- projZ / projW;\n}\nfloat getSpotShadow(SpotLightShadow light, sampler2D shadowMap, vec4 shadowCoord,\nfloat distWorld) {\nfloat shadowRadius = light.shadowRadius;\nfloat shadowBias = light.shadowBias;\n#if defined(SHADOWMAP_TYPE_PCF) || defined(SHADOWMAP_TYPE_PCF_SOFT)\nshadowRadius *= PCF_PCF_SOFT_DIR_SPOT_BLUR_COEFF;\n#elif defined(SHADOWMAP_TYPE_ESM)\nshadowRadius *= ESM_SPOT_SINGLE_BLUR_COEFF;\n#endif\nshadowBias *= BIAS_FRUSTUM_SCALE_COEFF\n/ (light.shadowCameraFar - light.shadowCameraNear);\n#if defined(SHADOWMAP_TYPE_BASIC) || defined(SHADOWMAP_TYPE_BILINEAR) || defined(SHADOWMAP_TYPE_PCF) || defined(SHADOWMAP_TYPE_PCF_SOFT) || defined(SHADOWMAP_TYPE_PCF_POISSON_DISK)\nshadowBias = biasLinearNormalizedToNonlinear(shadowBias,\nlight.shadowCameraNear, light.shadowCameraFar, shadowCoord.z,\nshadowCoord.w);\n#endif\nreturn getShadow(shadowMap, light.shadowMapSize, shadowBias, shadowRadius, shadowCoord,\nlight.expBias, distWorld);\n}\n#endif\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHT_SHADOWS > 0\nuniform mat4 directionalShadowMatrix[NUM_DIR_LIGHT_SHADOWS];\nvarying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHT_SHADOWS];\nstruct DirectionalLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nvec3 position;\nfloat shadowCameraNear;\nfloat maxDistance;\nfloat expBias;\n};\nuniform DirectionalLightShadow directionalLightShadows[NUM_DIR_LIGHT_SHADOWS];\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\nuniform mat4 spotShadowMatrix[NUM_SPOT_LIGHT_SHADOWS];\nvarying vec4 vSpotShadowCoord[NUM_SPOT_LIGHT_SHADOWS];\nstruct SpotLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nint shadow;\nfloat shadowCameraNear;\nfloat shadowCameraFar;\nfloat expBias;\n};\nuniform SpotLightShadow spotLightShadows[NUM_SPOT_LIGHT_SHADOWS];\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\nuniform mat4 pointShadowMatrix[NUM_POINT_LIGHT_SHADOWS];\nvarying vec4 vPointShadowCoord[NUM_POINT_LIGHT_SHADOWS];\nstruct PointLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nfloat shadowCameraNear;\nfloat shadowCameraFar;\nfloat expBias;\n};\nuniform PointLightShadow pointLightShadows[NUM_POINT_LIGHT_SHADOWS];\n#endif\n#if NUM_RECT_AREA_LIGHT_SHADOWS > 0\nuniform mat4 rectAreaShadowMatrix[NUM_RECT_AREA_LIGHT_SHADOWS];\nvarying vec4 vRectAreaShadowCoord[NUM_RECT_AREA_LIGHT_SHADOWS];\nstruct RectAreaLightShadow {\nfloat shadowBias;\nfloat shadowNormalBias;\nfloat shadowRadius;\nvec2 shadowMapSize;\nfloat shadowCameraNear;\nfloat shadowCameraFar;\nfloat expBias;\n};\nuniform RectAreaLightShadow rectAreaLightShadows[NUM_RECT_AREA_LIGHT_SHADOWS];\n#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 || NUM_RECT_AREA_LIGHT_SHADOWS > 0\nvec3 shadowWorldNormal = inverseTransformDirection(transformedNormal, viewMatrix);\nvec4 shadowWorldPosition;\n#endif\n#if NUM_DIR_LIGHT_SHADOWS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i++) {\nshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * directionalLightShadows[i].shadowNormalBias, 0);\nvDirectionalShadowCoord[i] = directionalShadowMatrix[i] * shadowWorldPosition;\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i++) {\nshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * spotLightShadows[i].shadowNormalBias, 0);\nvSpotShadowCoord[i] = spotShadowMatrix[i] * shadowWorldPosition;\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i++) {\nshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * pointLightShadows[i].shadowNormalBias, 0);\nvPointShadowCoord[i] = pointShadowMatrix[i] * shadowWorldPosition;\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_RECT_AREA_LIGHT_SHADOWS > 0\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_RECT_AREA_LIGHT_SHADOWS; i++) {\nshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * rectAreaLightShadows[i].shadowNormalBias, 0);\nvRectAreaShadowCoord[i] = rectAreaShadowMatrix[i] * shadowWorldPosition;\n}\n#pragma unroll_loop_end\n#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\nfloat shadow = 1.0;\n#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHT_SHADOWS > 0\nDirectionalLightShadow directionalLight;\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i++) {\ndirectionalLight = directionalLightShadows[i];\nfloat distWorld = 0.0;\n#if defined(SHADOWMAP_TYPE_ESM)\ndistWorld = length((invViewMatrix * vec4(directionalLight.position\n- directionalLight.direction * directionalLight.shadowCameraNear\n+ vViewPosition, 0.0)).xyz);\n#endif\nshadow *= all(bvec2(vViewPosition.z < directionalLight.maxDistance,\nreceiveShadow)) ? getDirShadow(directionalLight,\ndirectionalShadowMap[i], vDirectionalShadowCoord[i], distWorld)\n: 1.0;\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\nSpotLightShadow spotLight;\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i++) {\nspotLight = spotLightShadows[i];\nif (receiveShadow) {\nif (spotLight.shadow == 1) {\nfloat distWorld = 0.0;\n#if defined(SHADOWMAP_TYPE_ESM)\ndistWorld = length((invViewMatrix * vec4(spotLight.position\n+ vViewPosition, 0.0)).xyz);\n#endif\nshadow *= getSpotShadow(spotLight, spotShadowMap[i], vSpotShadowCoord[i],\ndistWorld);\n} else if (spotLight.shadow == 2) {\nshadow *= getSpotOmniShadow(spotLight, spotShadowMap[i],\nvSpotShadowCoord[i]);\n}\n}\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\nPointLightShadow pointLight;\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i++) {\npointLight = pointLightShadows[i];\nshadow *= receiveShadow ? getPointShadow(pointLight, pointShadowMap[i], vPointShadowCoord[i]) : 1.0;\n}\n#pragma unroll_loop_end\n#endif\n#if NUM_RECT_AREA_LIGHT_SHADOWS > 0\nRectAreaLightShadow rectAreaLight;\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_RECT_AREA_LIGHT_SHADOWS; i++) {\nrectAreaLight = rectAreaLightShadows[i];\nshadow *= receiveShadow ? getRectAreaShadow(rectAreaLight, rectAreaShadowMap[i], vRectAreaShadowCoord[i]) : 1.0;\n}\n#pragma unroll_loop_end\n#endif\n#endif\nreturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix(skinIndex.x);\nmat4 boneMatY = getBoneMatrix(skinIndex.y);\nmat4 boneMatZ = getBoneMatrix(skinIndex.z);\nmat4 boneMatW = getBoneMatrix(skinIndex.w);\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 bindMatrix;\nuniform mat4 bindMatrixInverse;\n#ifdef BONE_TEXTURE\nuniform highp sampler2D boneTexture;\nuniform int boneTextureSize;\nmat4 getBoneMatrix(const in float i) {\nfloat j = i * 4.0;\nfloat x = mod(j, float(boneTextureSize));\nfloat y = floor(j / float(boneTextureSize));\nfloat dx = 1.0 / float(boneTextureSize);\nfloat dy = 1.0 / float(boneTextureSize);\ny = dy * (y + 0.5);\nvec4 v1 = texture2D(boneTexture, vec2(dx * (x + 0.5), y));\nvec4 v2 = texture2D(boneTexture, vec2(dx * (x + 1.5), y));\nvec4 v3 = texture2D(boneTexture, vec2(dx * (x + 2.5), y));\nvec4 v4 = texture2D(boneTexture, vec2(dx * (x + 3.5), y));\nmat4 bone = mat4(v1, v2, v3, v4);\nreturn bone;\n}\n#else\nuniform mat4 boneMatrices[MAX_BONES];\nmat4 getBoneMatrix(const in float i) {\nmat4 bone = boneMatrices[int(i)];\nreturn bone;\n}\n#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\nvec4 skinVertex = bindMatrix * vec4(transformed, 1.0);\nvec4 skinned = vec4(0.0);\nskinned += boneMatX * skinVertex * skinWeight.x;\nskinned += boneMatY * skinVertex * skinWeight.y;\nskinned += boneMatZ * skinVertex * skinWeight.z;\nskinned += boneMatW * skinVertex * skinWeight.w;\ntransformed = (bindMatrixInverse * skinned).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = mat4(0.0);\nskinMatrix += skinWeight.x * boneMatX;\nskinMatrix += skinWeight.y * boneMatY;\nskinMatrix += skinWeight.z * boneMatZ;\nskinMatrix += skinWeight.w * boneMatW;\nskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\nobjectNormal = vec4(skinMatrix * vec4(objectNormal, 0.0)).xyz;\n#ifdef USE_TANGENT\nobjectTangent = vec4(skinMatrix * vec4(objectTangent, 0.0)).xyz;\n#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D(specularMap, vUv);\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined(TONE_MAPPING)\ngl_FragColor.rgb = toneMapping(gl_FragColor.rgb);\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp(a, 0.0, 1.0)\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingMidTones;\nuniform float toneMappingPhysicalScale;\nuniform float toneMappingBrightness;\nuniform float toneMappingContrast;\nuniform bool toneMappingChromaticAdaptation;\nuniform vec3 toneMappingWhiteColor;\nuniform bool toneMappingColorDifferentiation;\nuniform bool toneMappingExteriorDaylight;\nuniform vec3 toneMappingWhiteBalance;\nuniform float toneMappingHighlights;\nuniform float toneMappingShadows;\nuniform float toneMappingSaturation;\nuniform float toneMappingAperture;\nuniform float toneMappingShutter;\nuniform float toneMappingISO;\nuniform float toneMappingVignetting;\nuniform vec2 toneMappingResolution;\nconst float FILMIC_BLENDER_LOG_MIN = -12.473931188;\nconst float FILMIC_BLENDER_LOG_MAX = 12.526068812;\nconst float FILMIC_BLENDER_EXPOSURE_LATITUDE_RATIO = 0.66;\nvec3 LinearToneMapping(vec3 color) {\nreturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping(vec3 color) {\ncolor *= toneMappingExposure;\nreturn saturate(color / (vec3(1.0) + color));\n}\nvec3 OptimizedCineonToneMapping(vec3 color) {\ncolor *= toneMappingExposure;\ncolor = max(vec3(0.0), color - 0.004);\nreturn pow((color * (6.2 * color + 0.5)) / (color * (6.2 * color + 1.7) + 0.06), vec3(2.2));\n}\nvec3 RRTAndODTFit(vec3 v) {\nvec3 a = v * (v + 0.0245786) - 0.000090537;\nvec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\nreturn a / b;\n}\nvec3 ACESFilmicToneMapping(vec3 color) {\nconst mat3 ACESInputMat = mat3(\nvec3(0.59719, 0.07600, 0.02840),\nvec3(0.35458, 0.90834, 0.13383),\nvec3(0.04823, 0.01566, 0.83777)\n);\nconst mat3 ACESOutputMat = mat3(\nvec3( 1.60475, -0.10208, -0.00327),\nvec3(-0.53108, 1.10813, -0.07276),\nvec3(-0.07367, -0.00605, 1.07602)\n);\ncolor *= toneMappingExposure / 0.6;\ncolor = ACESInputMat * color;\ncolor = RRTAndODTFit(color);\ncolor = ACESOutputMat * color;\nreturn saturate(color);\n}\nvec3 CustomToneMapping(vec3 color) { return color; }\n#define ORDERS_OF_MAG 5.0\n#define PI_TONE 3.14159265359\nfloat toneCalcBrightness(in vec3 color)\n{\nreturn (abs(color.r) * 0.263 + abs(color.g) * 0.655 + abs(color.b) * 0.082);\n}\nfloat toneApproximateScotopicLuminance(vec3 color)\n{\nreturn (0.062 * color.r + 0.608 * color.g + 0.330 * color.b);\n}\nvec3 LogarithmicMaxToneMapping(vec3 color) {\nfloat inputScaleFactor = toneMappingPhysicalScale / PI_TONE;\nfloat brightness = (toneMappingBrightness < 0.0) ? 0.0 : (toneMappingBrightness * 0.7);\nfloat powerBot = toneMappingExteriorDaylight ? 4.0 : 2.0;\nfloat res = 100.0 / ORDERS_OF_MAG;\nfloat mag = floor((50.0 / res));\nfloat power = ((brightness / 20.0 - ORDERS_OF_MAG) - powerBot) + mag;\nfloat stepsize = 9.0 / res;\nfloat step = 50.0 - (mag * res);\nfloat param_c = (0.02 * toneMappingContrast) * 2.0;\nfloat param_b = pow(10.0, power) * (1.0 + (stepsize * step));\nfloat param_a = param_b * (1.0 + param_c);\nparam_c /= pow(2.0, toneMappingMidTones - 1.0);\nparam_b *= PI_TONE;\nvec3 whiteConstancyFactor = toneMappingWhiteColor;\nif (toneMappingChromaticAdaptation) {\nfloat luminance = toneCalcBrightness(whiteConstancyFactor);\nwhiteConstancyFactor.r = (whiteConstancyFactor.r > 0.001) ? luminance / whiteConstancyFactor.r : luminance / 0.001;\nwhiteConstancyFactor.g = (whiteConstancyFactor.g > 0.001) ? luminance / whiteConstancyFactor.g : luminance / 0.001;\nwhiteConstancyFactor.b = (whiteConstancyFactor.b > 0.001) ? luminance / whiteConstancyFactor.b : luminance / 0.001;\n}\nvec3 outColor = inputScaleFactor * color;\nif (toneMappingChromaticAdaptation) {\noutColor *= whiteConstancyFactor.rgb;\n}\nfloat luminance = toneCalcBrightness(outColor);\nif (toneMappingColorDifferentiation && (luminance < 5.62)) {\nfloat sLuminance = toneApproximateScotopicLuminance(outColor);\nif (luminance <= 5.62e-3) {\noutColor = vec3(sLuminance);\n} else {\nfloat w = (luminance - 5.62e-3) / 5.61438;\noutColor = outColor * w + sLuminance * (1.0 - w);\n}\n}\noutColor = outColor * (param_a / (param_b * outColor + param_c));\nreturn outColor;\n}\nfloat maxExposurePhotographic(in vec4 color1, in vec4 color2)\n{\nreturn ((color1.r * color2.r) + (color1.g * color2.g)) + (color1.b * color2.b);\n}\nvec3 PhysicalMaxToneMapping(vec3 color) {\nfloat vignettingInfluence = 1.0;\nif (toneMappingVignetting > 0.0) {\nvec3 vignettingCoords = vec3(0.0, 0.0, 0.0);\nfloat aspect = toneMappingResolution.x / toneMappingResolution.y;\nvignettingCoords.x = gl_FragCoord.x / toneMappingResolution.x - 0.5;\nvignettingCoords.y = (gl_FragCoord.y / toneMappingResolution.y - 0.5) / aspect;\nvignettingCoords.z = 1.0;\nvignettingCoords = normalize(vignettingCoords);\nvignettingInfluence = pow(vignettingCoords.z, toneMappingVignetting);\n}\nfloat inputScaleFactor = toneMappingPhysicalScale / PI_TONE;\nfloat filmISO = toneMappingISO;\nfloat camShutter = 1.0 / toneMappingShutter;\nfloat fNumber = toneMappingAperture;\nfloat cm2 = 1.0;\nfloat burnHighlights = toneMappingHighlights;\nfloat crushBlacks = toneMappingShadows;\nfloat saturation = toneMappingSaturation;\nvec3 whitePointInfluence = toneMappingWhiteBalance;\nif (whitePointInfluence.r > 0.0) {\nwhitePointInfluence.r = 1.0 / whitePointInfluence.r;\n} else {\nwhitePointInfluence.r = 1.0;\n}\nif (whitePointInfluence.g > 0.0) {\nwhitePointInfluence.g = 1.0 / whitePointInfluence.g;\n} else {\nwhitePointInfluence.g = 1.0;\n}\nif (whitePointInfluence.b > 0.0) {\nwhitePointInfluence.b = 1.0 / whitePointInfluence.b;\n} else {\nwhitePointInfluence.b = 1.0;\n}\nvec4 lumFactor = vec4(0.212671, 0.715160, 0.072169, 0.0);\nfloat whiteLumFactor = maxExposurePhotographic(lumFactor, vec4(whitePointInfluence, 0.0));\nwhitePointInfluence.r /= whiteLumFactor;\nwhitePointInfluence.g /= whiteLumFactor;\nwhitePointInfluence.b /= whiteLumFactor;\nfloat isoInfluence = 0.0;\nfloat camShutterInv = 1.0 / camShutter;\nif (filmISO > 0.0) {\nisoInfluence = ((cm2 * 0.169811) * (filmISO * camShutterInv)) / ((15.4 * fNumber) * fNumber);\n} else {\nisoInfluence = cm2;\n}\nvec3 outColor = inputScaleFactor * color;\noutColor.r = outColor.r * whitePointInfluence.r * isoInfluence * vignettingInfluence;\noutColor.g = outColor.g * whitePointInfluence.g * isoInfluence * vignettingInfluence;\noutColor.b = outColor.b * whitePointInfluence.b * isoInfluence * vignettingInfluence;\noutColor.r = (outColor.r * (1.0 + (outColor.r * burnHighlights))) / (1.0 + outColor.r);\noutColor.g = (outColor.g * (1.0 + (outColor.g * burnHighlights))) / (1.0 + outColor.g);\noutColor.b = (outColor.b * (1.0 + (outColor.b * burnHighlights))) / (1.0 + outColor.b);\nfloat lumFactor2 = maxExposurePhotographic(lumFactor, vec4(outColor, 0.0));\nfloat tmpFloat = 1.0 - saturation;\noutColor.r = outColor.r * saturation + lumFactor2 * tmpFloat;\noutColor.g = outColor.g * saturation + lumFactor2 * tmpFloat;\noutColor.b = outColor.b * saturation + lumFactor2 * tmpFloat;\noutColor = max(vec3(0.0), outColor);\nfloat crushBlacksFac = crushBlacks * 2.0 + 1.0;\nfloat crushBlacksFac2 = pow(maxExposurePhotographic(lumFactor, vec4(outColor, 0.0)), 0.5);\ntmpFloat = (1.0 - crushBlacksFac2);\nif (crushBlacksFac2 < 1.0) {\noutColor.r = outColor.r * crushBlacksFac2 + pow(outColor.r, crushBlacksFac) * tmpFloat;\noutColor.g = outColor.g * crushBlacksFac2 + pow(outColor.g, crushBlacksFac) * tmpFloat;\noutColor.b = outColor.b * crushBlacksFac2 + pow(outColor.b, crushBlacksFac) * tmpFloat;\n}\nreturn outColor;\n}\nfloat filmicBlenderDesaturationMinIntensity(vec3 color) {\nfloat maxChannel = max(color.r, max(color.g, color.b));\nfloat x = max(maxChannel, 0.6251);\nreturn (1.2192868 * x - 0.63221059)\n* ((x - 0.65069831) / (abs(x - 0.65069831) + 0.00952982) + 0.73015231);\n}\nvec3 filmicBlenderDesaturationTransform(vec3 color) {\nconst float CURVE_SMOOTHNESS = 0.03;\nfloat minIntensity = filmicBlenderDesaturationMinIntensity(color);\nvec4 x = vec4(color, 1.0) - minIntensity;\nx = pow(x, vec4(2.0)) / (abs(x) + CURVE_SMOOTHNESS);\nreturn (x.rgb - x.a + color + 1.0) / 2.0;\n}\nvec3 filmicBlenderDynamicRangeTransform(vec3 color) {\nreturn pow(\n(0.28882259 * color - 0.15880336)\n/ (pow(color - 0.6229693, vec3(2.0)) + 0.16965022)\n+ 0.20453365 * color + 0.37847142,\nvec3(3.0)\n);\n}\nvec3 FilmicBlenderToneMapping(vec3 color) {\ncolor *= toneMappingExposure;\ncolor = max(color, 0.000175);\ncolor = clamp((log2(color) - FILMIC_BLENDER_LOG_MIN)\n/ (FILMIC_BLENDER_LOG_MAX - FILMIC_BLENDER_LOG_MIN), 0.0, 1.0);\ncolor = filmicBlenderDesaturationTransform(color);\ncolor = clamp(color / FILMIC_BLENDER_EXPOSURE_LATITUDE_RATIO, 0.0, 1.0);\ncolor = filmicBlenderDynamicRangeTransform(color);\nreturn color;\n}",transmission_fragment:"#ifdef USE_TRANSMISSION\nfloat transmissionAlpha = 1.0;\nfloat transmissionFactor = transmission;\nfloat thicknessFactor = thickness;\n#ifdef USE_TRANSMISSIONMAP\ntransmissionFactor *= texture2D(transmissionMap, vUv).r;\n#endif\n#ifdef USE_THICKNESSMAP\nthicknessFactor *= texture2D(thicknessMap, vUv).g;\n#endif\nvec3 pos = vWorldPosition;\nvec3 v = normalize(cameraPosition - pos);\nvec3 n = inverseTransformDirection(normal, viewMatrix);\nvec4 transmission = getIBLVolumeRefraction(\nn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\npos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\nattenuationColor, attenuationDistance);\ntotalDiffuse = mix(totalDiffuse, transmission.rgb, transmissionFactor);\ntransmissionAlpha = mix(transmissionAlpha, transmission.a, transmissionFactor);\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\nuniform float transmission;\nuniform float thickness;\nuniform float attenuationDistance;\nuniform vec3 attenuationColor;\n#ifdef USE_TRANSMISSIONMAP\nuniform sampler2D transmissionMap;\n#endif\n#ifdef USE_THICKNESSMAP\nuniform sampler2D thicknessMap;\n#endif\nuniform vec2 transmissionSamplerSize;\nuniform sampler2D transmissionSamplerMap;\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nvarying vec3 vWorldPosition;\nvec3 getVolumeTransmissionRay(const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix) {\nvec3 refractionVector = refract(- v, normalize(n), 1.0 / ior);\nvec3 modelScale;\nmodelScale.x = length(vec3(modelMatrix[0].xyz));\nmodelScale.y = length(vec3(modelMatrix[1].xyz));\nmodelScale.z = length(vec3(modelMatrix[2].xyz));\nreturn normalize(refractionVector) * thickness * modelScale;\n}\nfloat applyIorToRoughness(const in float roughness, const in float ior) {\nreturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n}\nvec4 getTransmissionSample(const in vec2 fragCoord, const in float roughness, const in float ior) {\nfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n#ifdef TEXTURE_LOD_EXT\nreturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n#else\nreturn texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n#endif\n}\nvec3 applyVolumeAttenuation(const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance) {\nif (attenuationDistance == 0.0) {\nreturn radiance;\n} else {\nvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\nvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\nreturn transmittance * radiance;\n}\n}\nvec4 getIBLVolumeRefraction(const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\nconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\nconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\nconst in vec3 attenuationColor, const in float attenuationDistance) {\nvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\nvec3 refractedRayExit = position + transmissionRay;\nvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\nvec2 refractionCoords = ndcPos.xy / ndcPos.w;\nrefractionCoords += 1.0;\nrefractionCoords /= 2.0;\nvec4 transmittedLight = getTransmissionSample(refractionCoords, roughness, ior);\nvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight.rgb, length(transmissionRay), attenuationColor, attenuationDistance);\nvec3 F = EnvironmentBRDF(n, v, specularColor, specularF90, roughness);\nreturn vec4((1.0 - F) * attenuatedColor * diffuseColor, transmittedLight.a);\n}\n#endif",uv_pars_fragment:"#if (defined(USE_UV) && !defined(UVS_VERTEX_ONLY))\nvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n#ifdef UVS_VERTEX_ONLY\nvec2 vUv;\n#else\nvarying vec2 vUv;\n#endif\nuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\nvUv = (uvTransform * vec3(uv, 1)).xy;\n#endif",uv2_pars_fragment:"#if defined(USE_LIGHTMAP) || defined(USE_AOMAP)\nvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined(USE_LIGHTMAP) || defined(USE_AOMAP)\nattribute vec2 uv2;\nvarying vec2 vUv2;\nuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined(USE_LIGHTMAP) || defined(USE_AOMAP)\nvUv2 = (uv2Transform * vec3(uv2, 1)).xy;\n#endif",worldpos_vertex:"#if defined(USE_ENVMAP) || defined(DISTANCE) || defined (USE_SHADOWMAP) || defined (USE_TRANSMISSION) || defined(MASK) || defined(NODE)\nvec4 worldPosition = vec4(transformed, 1.0);\n#ifdef USE_INSTANCING\nworldPosition = instanceMatrix * worldPosition;\n#endif\nworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\nvUv = (uvTransform * vec3(uv, 1)).xy;\ngl_Position = vec4(position.xy, 1.0, 1.0);\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D(t2D, vUv);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\nvWorldDirection = transformDirection(position, modelMatrix);\n#include <begin_vertex>\n#include <project_vertex>\ngl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\nvec3 vReflect = vWorldDirection;\n#include <envmap_fragment>\ngl_FragColor = envColor;\ngl_FragColor.a *= opacity;\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vViewPosition;\nvarying vec2 vProjectedPosZW;\nvoid main() {\n#include <uv_vertex>\n#include <skinbase_vertex>\n#ifdef USE_DISPLACEMENTMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = mvPosition.xyz;\nvProjectedPosZW = mat2(\nprojectionMatrix[2][2], projectionMatrix[2][3],\nprojectionMatrix[3][2], projectionMatrix[3][3]\n) * mvPosition.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\nuniform float opacity;\n#endif\n#ifdef USE_SLOPE_SCALED_BIAS\nuniform float slopeScaledBias;\nconst float ONE_MINUS_EPS = 0.9999999;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec3 vViewPosition;\nvarying vec2 vProjectedPosZW;\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(1.0);\n#if DEPTH_PACKING == 3200\ndiffuseColor.a = opacity;\n#endif\n#include <map_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <logdepthbuf_fragment>\n#if DEPTH_PACKING != 3202\nfloat depth = vProjectedPosZW.x / vProjectedPosZW.y;\ndepth = (depth + 1.0) / 2.0;\n#ifdef USE_SLOPE_SCALED_BIAS\nvec2 dxdy = abs(vec2(dFdx(depth), dFdy(depth)));\nfloat bias = slopeScaledBias * max(dxdy.x, dxdy.y);\ndepth = clamp(depth + max(bias, 1e-6), 0.0, ONE_MINUS_EPS);\n#endif\n#if DEPTH_PACKING == 3200\ngl_FragColor = vec4(vec3(1.0 - depth), opacity);\n#elif DEPTH_PACKING == 3201\ngl_FragColor = packDepthToRGBA(depth);\n#endif\n#else\ngl_FragColor = vec4(vViewPosition.z);\n#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <skinbase_vertex>\n#ifdef USE_DISPLACEMENTMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <worldpos_vertex>\n#include <clipping_planes_vertex>\nvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\n#ifdef USE_SLOPE_SCALED_BIAS\nuniform float slopeScaledBias;\nconst float ONE_MINUS_EPS = 0.9999999;\n#endif\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#ifndef DISTANCE_SCALE\n#define DISTANCE_SCALE 1.0\n#endif\nvoid main () {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(1.0);\n#include <map_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\nfloat dist = length(vWorldPosition - referencePosition);\n#if DISTANCE_PACKING == 3301\ndist = (dist - nearDistance) / (farDistance - nearDistance);\ndist = saturate(dist);\n#ifdef USE_SLOPE_SCALED_BIAS\nvec2 dxdy = abs(vec2(dFdx(dist), dFdy(dist)));\nfloat bias = slopeScaledBias * max(dxdy.x, dxdy.y);\ndist = clamp(dist + bias, 0.0, ONE_MINUS_EPS);\n#endif\ngl_FragColor = packDepthToRGBA(dist);\n#elif DISTANCE_PACKING == 3302\n#ifdef USE_SLOPE_SCALED_BIAS\nvec2 dxdy = abs(vec2(dFdx(dist), dFdy(dist)));\ndist += slopeScaledBias * max(dxdy.x, dxdy.y);\n#endif\ngl_FragColor = vec4(dist * DISTANCE_SCALE, 0.0, 0.0, 1.0);\n#endif\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\nvWorldDirection = transformDirection(position, modelMatrix);\n#include <begin_vertex>\n#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nuniform bool invertU;\nuniform float offsetU;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\nvec3 direction = normalize(vWorldDirection);\nvec2 sampleUV;\nsampleUV.y = asin(clamp(direction.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;\nsampleUV.x = atan(direction.z, direction.x) * RECIPROCAL_PI2 + 0.5;\nif (invertU) {\nsampleUV.x = 1.0 - sampleUV.x;\n}\nsampleUV.x += offsetU;\ngl_FragColor = texture2D(tEquirect, sampleUV);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\nvLineDistance = scale * lineDistance;\n#include <color_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nif (mod(vLineDistance, totalSize) > dashSize) {\ndiscard;\n}\nvec3 outgoingLight = vec3(0.0);\nvec4 diffuseColor = vec4(diffuse, opacity);\n#include <logdepthbuf_fragment>\n#include <color_fragment>\noutgoingLight = diffuseColor.rgb;\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#if defined (USE_ENVMAP) || defined (USE_SKINNING)\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(diffuse, opacity);\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_LIGHTMAP\nvec4 lightMapTexel= texture2D(lightMap, vUv2);\nreflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n#else\nreflectedLight.indirectDiffuse += vec3(1.0);\n#endif\n#include <aomap_fragment>\nreflectedLight.indirectDiffuse *= diffuseColor.rgb;\nvec3 outgoingLight = reflectedLight.indirectDiffuse;\n#include <envmap_fragment>\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\nvarying vec3 vIndirectBack;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = -mvPosition.xyz;\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <lights_lambert_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\nvarying vec3 vIndirectBack;\n#endif\nvarying vec3 vViewPosition;\n#ifdef SHADOWMAP_TYPE_ESM\nuniform mat4 invViewMatrix;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(diffuse, opacity);\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 totalEmissiveRadiance = emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n#include <emissivemap_fragment>\n#ifdef DOUBLE_SIDED\nreflectedLight.indirectDiffuse += (gl_FrontFacing) ? vIndirectFront : vIndirectBack;\n#else\nreflectedLight.indirectDiffuse += vIndirectFront;\n#endif\n#include <lightmap_fragment>\nreflectedLight.indirectDiffuse *= BRDF_Lambert(diffuseColor.rgb);\n#ifdef DOUBLE_SIDED\nreflectedLight.directDiffuse = (gl_FrontFacing) ? vLightFront : vLightBack;\n#else\nreflectedLight.directDiffuse = vLightFront;\n#endif\nreflectedLight.directDiffuse *= BRDF_Lambert(diffuseColor.rgb) * getShadowMask();\n#include <aomap_fragment>\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n#include <envmap_fragment>\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <fog_vertex>\nvViewPosition = -mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(diffuse, opacity);\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\nvec3 viewDir = normalize(vViewPosition);\nvec3 x = normalize(vec3(viewDir.z, 0.0, - viewDir.x));\nvec3 y = cross(viewDir, x);\nvec2 uv = vec2(dot(x, normal), dot(y, normal)) * 0.495 + 0.5;\n#ifdef USE_MATCAP\nvec4 matcapColor = texture2D(matcap, uv);\n#else\nvec4 matcapColor = vec4(vec3(mix(0.2, 0.8, uv.y)), 1.0);\n#endif\nvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined(FLAT_SHADED) || defined(USE_BUMPMAP) || defined(TANGENTSPACE_NORMALMAP)\nvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#if defined(FLAT_SHADED) || defined(USE_BUMPMAP) || defined(TANGENTSPACE_NORMALMAP)\nvViewPosition = -mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined(FLAT_SHADED) || defined(USE_BUMPMAP) || defined(TANGENTSPACE_NORMALMAP)\nvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\n#include <logdepthbuf_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\ngl_FragColor = vec4(packNormalToRGB(normal), opacity);\n#ifdef OPAQUE\ngl_FragColor.a = 1.0;\n#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = -mvPosition.xyz;\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(diffuse, opacity);\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 totalEmissiveRadiance = emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n#include <lights_phong_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#include <aomap_fragment>\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n#include <envmap_fragment>\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\nvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <plane_reflection_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <plane_reflection_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = -mvPosition.xyz;\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n#ifdef USE_TRANSMISSION\nvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n#define IOR\n#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\nuniform float ior;\n#endif\n#ifdef SPECULAR\nuniform float specularIntensity;\nuniform vec3 specularColor;\n#ifdef USE_SPECULARINTENSITYMAP\nuniform sampler2D specularIntensityMap;\n#endif\n#ifdef USE_SPECULARCOLORMAP\nuniform sampler2D specularColorMap;\n#endif\n#endif\n#ifdef USE_CLEARCOAT\nuniform float clearcoat;\nuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\nuniform vec3 sheenColor;\nuniform float sheenRoughness;\n#ifdef USE_SHEENCOLORMAP\nuniform sampler2D sheenColorMap;\n#endif\n#ifdef USE_SHEENROUGHNESSMAP\nuniform sampler2D sheenRoughnessMap;\n#endif\n#endif\n#if defined(SHADOWMAP_TYPE_ESM) || defined(USE_ENVMAP)\nuniform mat4 invViewMatrix;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <plane_reflection_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(diffuse, opacity);\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 totalEmissiveRadiance = emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <roughnessmap_fragment>\n#include <metalnessmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <clearcoat_normal_fragment_begin>\n#include <clearcoat_normal_fragment_maps>\n#include <emissivemap_fragment>\n#include <lights_physical_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#include <aomap_fragment>\nvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\nvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n#include <transmission_fragment>\nvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n#ifdef USE_SHEEN\nfloat sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);\noutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n#endif\n#ifdef USE_CLEARCOAT\nfloat dotNVcc = saturate(dot(geometry.clearcoatNormal, geometry.viewDir));\nvec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);\noutgoingLight = outgoingLight * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;\n#endif\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = -mvPosition.xyz;\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(diffuse, opacity);\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 totalEmissiveRadiance = emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n#include <lights_toon_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#include <aomap_fragment>\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <color_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <project_vertex>\ngl_PointSize = size;\n#ifdef USE_SIZEATTENUATION\nbool isPerspective = isPerspectiveMatrix(projectionMatrix);\nif (isPerspective) gl_PointSize *= (scale / - mvPosition.z);\n#endif\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <worldpos_vertex>\n#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec3 outgoingLight = vec3(0.0);\nvec4 diffuseColor = vec4(diffuse, opacity);\n#include <logdepthbuf_fragment>\n#include <map_particle_fragment>\n#include <color_fragment>\n#include <alphatest_fragment>\noutgoingLight = diffuseColor.rgb;\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#ifdef USE_SHADOWMAP\nvarying vec3 vViewPosition;\n#endif\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n#ifdef USE_SHADOWMAP\nvViewPosition = -mvPosition.xyz;\n#endif\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#ifdef USE_SHADOWMAP\nvarying vec3 vViewPosition;\n#ifdef SHADOWMAP_TYPE_ESM\nuniform mat4 invViewMatrix;\n#endif\n#endif\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\ngl_FragColor = vec4(color, opacity * (1.0 - getShadowMask()));\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#include <uv_vertex>\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(vec3(modelMatrix[0].x, modelMatrix[0].y, modelMatrix[0].z));\nscale.y = length(vec3(modelMatrix[1].x, modelMatrix[1].y, modelMatrix[1].z));\n#ifndef USE_SIZEATTENUATION\nbool isPerspective = isPerspectiveMatrix(projectionMatrix);\nif (isPerspective) scale *= -mvPosition.z;\n#endif\nvec2 alignedPosition = (position.xy - (center - vec2(0.5))) * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\nrotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\nmvPosition.xy += rotatedPosition;\ngl_Position = projectionMatrix * mvPosition;\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n#include <clipping_planes_fragment>\nvec3 outgoingLight = vec3(0.0);\nvec4 diffuseColor = vec4(diffuse, opacity);\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\noutgoingLight = diffuseColor.rgb;\n#include <output_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n}",equicube_vert:"varying vec2 vUv;\n#include <common>\nvoid main() {\nvUv = uv;\n#include <begin_vertex>\n#include <project_vertex>\n}",equicube_frag:"uniform sampler2D tEquirect;\nuniform int faceIndex;\nuniform bool invertU;\nuniform float offsetU;\nvarying vec2 vUv;\n#include <common>\nvoid main() {\nvec3 direction;\nvec2 uv = vUv * 2.0 - 1.0;\nif (faceIndex==0) {\ndirection = vec3(1.0, -uv.y, -uv.x);\n} else if (faceIndex==1) {\ndirection = vec3(-1.0, -uv.y, uv.x);\n} else if (faceIndex==2) {\ndirection = vec3(uv.x, 1.0, uv.y);\n} else if (faceIndex==3) {\ndirection = vec3(uv.x, -1.0, -uv.y);\n} else if (faceIndex==4) {\ndirection = vec3(uv.x, -uv.y, 1.0);\n} else {\ndirection = vec3(-uv.x, -uv.y, -1.0);\n}\ndirection = normalize(direction);\nvec2 sampleUV;\nsampleUV.y = asin(clamp(direction.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;\nsampleUV.x = atan(direction.z, direction.x) * RECIPROCAL_PI2 + 0.5;\nif (invertU) {\nsampleUV.x = 1.0 - sampleUV.x;\n}\nsampleUV.x += offsetU;\ngl_FragColor = texture2D(tEquirect, sampleUV);\n}",mask_vert:"#define MASK\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nuniform mat4 textureMatrix;\nvarying vec3 vViewPosition;\nvarying vec4 projTexCoord;\nvoid main() {\n#include <uv_vertex>\n#include <skinbase_vertex>\n#ifdef USE_DISPLACEMENTMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\nvViewPosition = -mvPosition.xyz;\n#include <worldpos_vertex>\nprojTexCoord = textureMatrix * worldPosition;\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n}",mask_frag:"#define MASK\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nuniform mat4 projectionMatrix;\nuniform float opacity;\nuniform sampler2D depthTexture;\nuniform vec2 cameraNearFar;\nvarying vec3 vViewPosition;\nvarying vec4 projTexCoord;\nvoid main() {\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4(1.0);\ndiffuseColor.a = opacity;\n#include <map_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <logdepthbuf_fragment>\nfloat depth = unpackRGBAToDepth(texture2DProj(depthTexture, projTexCoord));\nfloat viewZ;\nif (isOrtho(projectionMatrix))\nviewZ = -orthographicDepthToViewZ(depth,\ncameraNearFar.x, cameraNearFar.y);\nelse\nviewZ = -perspectiveDepthToViewZ(depth,\ncameraNearFar.x, cameraNearFar.y);\nfloat depthTest = (vViewPosition.z > viewZ) ? 1.0 : 0.0;\ngl_FragColor = vec4(0.0, depthTest, 1.0, 0.0);\n}",meshnode_vert:"#define NODE\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <plane_reflection_pars_vertex>\n#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_BL) || defined(NODE_PHY_SUN_SKY_ENV_MX) || defined(NODE_SKYDOME_LIGHT_AR) || defined(NODE_ENV_SPHERE_MY)\nvarying vec3 vWorldPosition;\n#endif\n#include <node_pars_vertex>\nvoid main() {\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\nvNormal = normalize(transformedNormal);\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <plane_reflection_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = -mvPosition.xyz;\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_BL) || defined(NODE_PHY_SUN_SKY_ENV_MX) || defined(NODE_SKYDOME_LIGHT_AR) || defined(NODE_ENV_SPHERE_MY)\nvWorldPosition = worldPosition.xyz;\n#endif\n#include <node_vertex>\n}",meshnode_frag:"#define NODE\n#define STANDARD\n#define PHYSICAL\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#if defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_VECT_TRANSFORM_BL) || defined(NODE_TEX_COORD_BL) || defined(NODE_NORMAL_MAP_BL) || defined(NODE_LAYER_WEIGHT_BL) || defined(NODE_FRESNEL_BL) || defined(NODE_BUMP_BL) || defined(NODE_BSDF_GLASS_BL) || defined(NODE_BSDF_PRINCIPLED_BL) || defined(NODE_TANGENT_BL) || defined(NODE_BITMAP_MX) || defined(NODE_GRADIENT_RAMP_MX) || defined(NODE_NOISE_MX) || defined(NODE_SAMPLER_INFO_MY) || defined(NODE_INCIDENT) || defined(NODE_POSITION) || defined(NODE_NORMAL) || defined(USE_OSL) || defined(USE_ENVMAP) || defined(SHADOWMAP_TYPE_ESM) && (defined(NODE_BSDF_DIFFUSE_BL) || defined(NODE_EEVEE_SPECULAR_BL) || defined(NODE_BSDF_GLOSSY_BL) || defined(NODE_BSDF_REFRACTION_BL) || defined(NODE_MATERIAL_MX) || defined(NODE_PHYSICAL_MX) || defined(NODE_STANDARD_SURFACE_AR) || defined(NODE_SHADOW_MATTE_AR))\nuniform mat4 invViewMatrix;\n#endif\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_node_pars_fragment>\n#include <lights_node_gtao_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#if defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_LAYER_WEIGHT_BL) || defined(NODE_FRESNEL_BL) || defined(NODE_BSDF_GLASS_BL) || defined(NODE_BSDF_PRINCIPLED_BL) || defined(USE_SSR) || (defined(NODE_NORMAL) && defined(MT_BLENDER)) || defined(USE_OSL)\nuniform mat4 projectionMatrix;\n#endif\n#if defined(NODE_VECT_TRANSFORM_BL) || defined(NODE_TEX_COORD_BL) || defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_TANGENT_BL) || defined(NODE_OBJECT_INFO_BL) || defined(NODE_BITMAP_MX) || defined(NODE_GRADIENT_RAMP_MX) || defined(NODE_NOISE_MX) || defined(NODE_SAMPLER_INFO_MY) || defined(NODE_TRANSFORM_MY) || defined(USE_OSL)\nuniform mat4 modelMatrix;\nuniform mat4 invModelMatrix;\n#endif\n#if defined(NODE_VECT_TRANSFORM_BL) || defined(NODE_NORMAL_MAP_BL) || defined(NODE_NORMAL_BUMP_MX) || defined(NODE_BUMP_2D_MY) || defined(NODE_SAMPLER_INFO_MY)\nuniform mat4 modelViewMatrix;\n#endif\n#if defined(NODE_TEX_IMAGE_BL)\nuniform mat3 normalMatrix;\n#endif\n#if defined(NODE_TEX_COORD_BL) || defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_TANGENT_BL)\nuniform vec3 boundingBoxMin;\nuniform vec3 boundingBoxMax;\n#endif\n#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_BL) || defined(NODE_PHY_SUN_SKY_ENV_MX) || defined(NODE_SKYDOME_LIGHT_AR) || defined(NODE_ENV_SPHERE_MY)\nvarying vec3 vWorldPosition;\n#endif\n#if defined(NODE_TEX_COORD_BL)\nuniform vec2 viewWidthHeight;\n#endif\n#include <ssr_pars_fragment>\n#include <plane_reflection_pars_fragment>\n#include <node_common_frag>\n#include <node_pars_fragment>\nvoid main() {\nbool _frontFacingValue = gl_FrontFacing;\n#define FRONT_FACING_VALUE _frontFacingValue\n#include <clipping_planes_fragment>\n#include <logdepthbuf_fragment>\n#include <normal_fragment_begin>\nvec4 outgoingLight = vec4(0.0);\n#include <node_fragment>\n#if WORLD_NODES == 1\noutgoingLight.a = 1.0;\n#endif\n#ifdef USE_ALPHATEST\nif (outgoingLight.a < alphaTest)\ndiscard;\nelse\noutgoingLight.a = 1.0;\n#endif\ngl_FragColor = vec4(outgoingLight);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n#include <normal_output_fragment>\n}",lights_node_pars_fragment:"\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\nstruct NodeMaterial {\nvec3 diffuseColor;\nfloat roughness;\nvec3 specularColor;\nfloat specularF90;\nvec3 fresnelRefl90;\nvec3 refractionColor;\nfloat refractionRoughness;\nfloat refractionIOR;\n#ifdef USE_CLEARCOAT\nfloat clearcoat;\nfloat clearcoatRoughness;\nvec3 clearcoatF0;\nfloat clearcoatF90;\n#endif\n#ifdef USE_SHEEN\nvec3 sheenColor;\nfloat sheenRoughness;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n#define BLENDER_SPECULAR_COEFFICIENT 0.08\nvec3 clearcoatSpecular = vec3(0.0);\nvec3 sheenSpecular = vec3(0.0);\nfloat IBLSheenBRDF(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\nfloat dotNV = saturate(dot(normal, viewDir));\nfloat r2 = roughness * roughness;\nfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\nfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\nfloat DG = exp(a * dotNV + b) + (roughness < 0.25 ? 0.0 : 0.1 * (roughness - 0.25));\nreturn saturate(DG * RECIPROCAL_PI);\n}\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\nfloat dotNV = saturate(dot(normal, viewDir));\nconst vec4 c0 = vec4(- 1, - 0.0275, - 0.572, 0.022);\nconst vec4 c1 = vec4(1, 0.0425, 1.04, - 0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(- 9.28 * dotNV)) * r.x + r.y;\nvec2 fab = vec2(- 1.04, 1.04) * a004 + r.zw;\nreturn fab;\n}\nvec3 EnvironmentBRDF(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness) {\nvec2 fab = DFGApprox(normal, viewDir, roughness);\nreturn specularColor * fab.x + specularF90 * fab.y;\n}\nfloat clearcoatDHRApprox(const in float roughness, const in float dotNL) {\nreturn DEFAULT_SPECULAR_COEFFICIENT + (1.0 - DEFAULT_SPECULAR_COEFFICIENT) * (pow(1.0 - dotNL, 5.0) * pow(1.0 - roughness, 2.0));\n}\n#if NUM_RECT_AREA_LIGHTS > 0\nvoid RE_Direct_RectArea_Node(const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {\nvec3 normal = geometry.normal;\nvec3 viewDir = geometry.viewDir;\nvec3 position = geometry.position;\nvec3 lightPos = rectAreaLight.position;\nvec3 halfWidth = rectAreaLight.halfWidth;\nvec3 halfHeight = rectAreaLight.halfHeight;\nvec3 lightColor = rectAreaLight.color;\nfloat roughness = material.roughness;\nvec3 rectCoords[4];\nrectCoords[0] = lightPos + halfWidth - halfHeight;\nrectCoords[1] = lightPos - halfWidth - halfHeight;\nrectCoords[2] = lightPos - halfWidth + halfHeight;\nrectCoords[3] = lightPos + halfWidth + halfHeight;\nvec2 uv = LTC_Uv(normal, viewDir, roughness);\nvec4 t1 = texture2D(ltc_1, uv);\nvec4 t2 = texture2D(ltc_2, uv);\nmat3 mInv = mat3(\nvec3(t1.x, 0, t1.y),\nvec3( 0, 1, 0),\nvec3(t1.z, 0, t1.w)\n);\nvec3 fresnel = (material.specularColor * t2.x + (vec3(1.0) - material.specularColor) * t2.y);\nreflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate(normal, viewDir, position, mInv, rectCoords);\nreflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate(normal, viewDir, position, mat3(1.0), rectCoords);\n}\n#endif\nvoid RE_DirectDiffuse_Node(const in IncidentLight directLight,\nconst in GeometricContext geometry, const in NodeMaterial material,\ninout ReflectedLight reflectedLight) {\nfloat dotNL = saturate(dot(geometry.normal, directLight.direction));\nvec3 irradiance = dotNL * directLight.color;\nreflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\nvoid RE_DirectSpecular_Node(const in IncidentLight directLight,\nconst in GeometricContext geometry, const in NodeMaterial material,\ninout ReflectedLight reflectedLight) {\nfloat dotNL = saturate(dot(geometry.normal, directLight.direction));\nvec3 irradiance = dotNL * directLight.color;\n#ifdef USE_CLEARCOAT\nfloat dotNLcc = saturate(dot(geometry.clearcoatNormal, directLight.direction));\nvec3 ccIrradiance = dotNLcc * directLight.color;\nclearcoatSpecular += ccIrradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);\n#endif\n#ifdef USE_SHEEN\nsheenSpecular += irradiance * BRDF_Sheen(directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness);\n#endif\nreflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\n}\nvoid RE_IndirectDiffuse_Node(const in vec3 irradiance, const in vec3 iblIrradiance,\nconst in GeometricContext geometry, const in NodeMaterial material,\ninout ReflectedLight reflectedLight) {\nreflectedLight.indirectDiffuse += (irradiance + iblIrradiance) * BRDF_Lambert(material.diffuseColor);\n}\nvoid RE_IndirectSpecular_Node(const in vec3 radiance, const in vec3 irradiance,\nconst in vec3 clearcoatRadiance, const in GeometricContext geometry,\nconst in NodeMaterial material, inout ReflectedLight reflectedLight) {\n#ifdef USE_CLEARCOAT\nclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF(geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);\n#endif\n#ifdef USE_SHEEN\nsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF(geometry.normal, geometry.viewDir, material.sheenRoughness);\n#endif\n#ifdef MT_BLENDER\n#ifdef COMPAT_USE_SPEC_ENV_BLENDER_APPROX\nvec3 specEnv = BRDF_Specular_GGX_Environment_Blender_Approx(geometry,\nmaterial.specularColor, material.fresnelRefl90,\nmaterial.roughness, 0);\n#else\nvec3 specEnv = BRDF_Specular_GGX_Environment(geometry.viewDir,\ngeometry.normal, material.specularColor,\nmaterial.roughness);\n#endif\n#elif defined(MT_MAX)\nfloat alphaEnv = pow2(pow2(material.roughness));\nvec3 specEnv = material.specularColor / (1.0 - alphaEnv + PI * alphaEnv);\n#elif defined(MT_MAYA)\nvec3 specEnv = BRDF_Specular_GGX_Environment(geometry.viewDir, geometry.normal, material.specularColor, material.roughness);\n#else\nvec3 specEnv = vec3(1.0);\n#endif\nreflectedLight.indirectSpecular += radiance * specEnv;\n}\nvoid RE_Refraction_Node(const vec3 refraction, const NodeMaterial material,\ninout vec3 refractedLight) {\nrefractedLight += refraction * material.refractionColor;\n}\n#ifdef MT_BLENDER\n#define Material_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.roughness)\n#define Material_Refraction_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.refractionRoughness)\n#elif defined(MT_MAX)\n#define Material_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.roughness * exp(0.35*(1.0-pow2(material.roughness))))\n#define Material_Refraction_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.refractionRoughness * exp(0.35*(1.0-pow2(material.refractionRoughness))))\n#else\n#define Material_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.roughness)\n#define Material_Refraction_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.refractionRoughness)\n#endif\n#define Material_ClearCoat_BlinnShininessExponent(material) GGXRoughnessToBlinnExponent(material.clearcoatRoughness)\nfloat computeSpecularOcclusion(const in float dotNV, const in float ambientOcclusion, const in float roughness) {\nreturn saturate(pow(abs(dotNV + ambientOcclusion), exp2(- 16.0 * roughness - 1.0)) - 1.0 + ambientOcclusion);\n}\n#define RE_Direct_RectArea RE_Direct_RectArea_Node",lights_node_gtao_pars_fragment:"#ifdef USE_GTAO\nuniform sampler2D gtaoMap;\nuniform vec2 currResolution;\nfloat calcGTAOVisibilityFix(vec3 viewDir, vec3 normal) {\nfloat slopeCoeff = saturate(dot(viewDir, normal));\nreturn pow(2.0 / (slopeCoeff + 1.0), log2(PI) - 1.0);\n}\nfloat calcSolidAngle(float radiusAngle) {\nreturn PI2 * (1.0 - cos(radiusAngle));\n}\nfloat calcSolidAnglesIntersectionApprox(float radiusAngle0, float radiusAngle1,\nfloat distanceAngle) {\nfloat rp = radiusAngle0, rl = radiusAngle1, d = distanceAngle;\nfloat rDiff = abs(rp - rl);\nreturn PI2 * (1.0 - cos(min(rp, rl))) * smoothstep(0.0, 1.0, 1.0 -\n(d - rDiff) / (rp + rl - rDiff));\n}\nfloat calcGTSOVisibility(float aoVisibility, vec3 bentNormal, vec3 viewDir, vec3 normal,\nfloat roughness) {\naoVisibility = saturate(aoVisibility * calcGTAOVisibilityFix(viewDir, normal));\nfloat radiusAngleVisCone = acos(clamp(sqrt(1.0 - aoVisibility), -1.0, 1.0));\nfloat radiusAngleSpecCone = acos(clamp(exp2(-3.32193 * pow2(roughness)), -1.0, 1.0));\nradiusAngleSpecCone = max(0.001, radiusAngleSpecCone);\nvec3 specularConeAxis = -reflect(viewDir, normal);\nfloat distanceAngle = acos(clamp(dot(bentNormal, specularConeAxis), -1.0, 1.0));\nfloat solidAngleIntersection = calcSolidAnglesIntersectionApprox(\nradiusAngleVisCone, radiusAngleSpecCone, distanceAngle);\nfloat solidAngleSpecular = calcSolidAngle(radiusAngleSpecCone);\nfloat specVisibility = solidAngleIntersection / solidAngleSpecular;\nreturn mix(specVisibility, 1.0, aoVisibility);\n}\n#endif",lights_fragment_gtso:"#ifdef USE_GTAO\nreflectedLight.indirectSpecular *= calcGTSOVisibility(gtaoVisibility,\ngtaoBentNormal, gtaoViewDir, gtaoNormal, gtaoRoughness);\n#endif",normal_output_fragment:"#if NORMAL_OUTPUT == 1\ngl_FragColor = vec4(packNormalToRGB(normal), gl_FragColor.a);\n#endif",ssr_pars_fragment:"#ifdef USE_SSR\nuniform sampler2D ssrSourceBuffer;\nuniform sampler2D ssrDepthBuffer;\nuniform sampler2D ssrBackfaceDepthBuffer;\nuniform mat4 invProjectionMatrix;\nuniform vec2 ssrResolution;\nuniform float ssrThickness;\nuniform float ssrStride;\nuniform float ssrJitter;\nuniform float ssrMaxDistance;\n#ifdef USE_SSR_REFRACT\n#define STEPS_FADE_AMOUNT 0.1\n#define SCREEN_FADE_THRESHOLD 0.6\n#else\n#define STEPS_FADE_AMOUNT 1.0\n#define SCREEN_FADE_THRESHOLD 0.4\n#endif\nvec3 deproject(vec3 p) {\nvec4 res = invProjectionMatrix * vec4(p, 1);\nreturn res.xyz / res.w;\n}\nbool doesIntersect(float rayzmax, float rayzmin, vec2 uv) {\nfloat sceneZMin = texture2D(ssrDepthBuffer, uv).r;\n#ifdef USE_SSR_REFRACT\nreturn rayzmin >= (sceneZMin-ssrThickness) && rayzmax <= sceneZMin;\n#else\nfloat sceneZMax = texture2D(ssrBackfaceDepthBuffer, uv).r;\nreturn rayzmin >= sceneZMax && rayzmax <= sceneZMin;\n#endif\n}\nfloat distanceSquared(vec2 a, vec2 b) { a -= b; return dot(a, a); }\nvoid swapIfBigger(inout float a, inout float b) {\nif (a > b) {\nfloat t = a;\na = b;\nb = t;\n}\n}\nbool isOutsideUvBounds(float x) { return x < 0.0 || x > 1.0; }\nbool isOutsideUvBounds(vec2 uv) { return isOutsideUvBounds(uv.x) || isOutsideUvBounds(uv.y); }\nvec3 computeSSR(vec3 color, vec3 normal, float ior) {\nvec2 uv = gl_FragCoord.xy / ssrResolution;\nvec2 screenCoord = uv * 2.0 - vec2(1, 1);\nfloat nearClip = deproject(vec3(0, 0, -1)).z;\nvec3 ray = deproject(vec3(screenCoord, -1));\nray /= ray.z;\nfloat depthSample = -vViewPosition.z;\nvec3 vpos = depthSample * ray;\n#ifdef USE_SSR_REFRACT\nvec3 dir = normalize(refract(normalize(vpos), normalize(normal), 1.0/ior));\n#else\nvec3 dir = normalize(reflect(normalize(vpos), normalize(normal)));\n#endif\nfloat maxDist = ssrMaxDistance;\nfloat rayLength = (vpos.z + dir.z * maxDist) > nearClip ? (nearClip - vpos.z) / dir.z : maxDist;\nvec3 csOrig = vpos;\nvec3 csEndPoint = csOrig + dir * rayLength;\nvec4 H0 = projectionMatrix * vec4(csOrig, 1.0);\nvec4 H1 = projectionMatrix * vec4(csEndPoint, 1.0);\nfloat k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\nvec3 Q0 = csOrig.xyz * k0, Q1 = csEndPoint.xyz * k1;\nvec2 P0 = H0.xy * k0, P1 = H1.xy * k1;\nP0 = P0 * 0.5 + vec2(0.5), P1 = P1 * 0.5 + vec2(0.5);\n#ifndef SSR_SIMPLE_REFRACT\nP0 *= ssrResolution, P1 *= ssrResolution;\nP1 += vec2((distanceSquared(P0, P1) < 0.0001) ? 0.01 : 0.0);\nvec2 delta = P1 - P0;\nbool permute = false;\nif (abs(delta.x) < abs(delta.y)) {\npermute = true; delta = delta.yx; P0 = P0.yx; P1 = P1.yx;\n}\nfloat stepDir = sign(delta.x);\nfloat invdx = stepDir / delta.x;\nvec3 dQ = (Q1 - Q0) * invdx;\nfloat dk = (k1 - k0) * invdx;\nvec2 dP = vec2(stepDir, delta.y * invdx);\nfloat pixelStride = ssrStride;\nfloat jitterMod = (gl_FragCoord.x + gl_FragCoord.y) * 0.25;\nvec4 PQK = vec4(P0, Q0.z, k0);\nvec4 dPQK = vec4(dP, dQ.z, dk);\ndPQK *= pixelStride;\nPQK += dPQK * mod(jitterMod, 1.0) * ssrJitter;\nfloat end = P1.x * stepDir;\nfloat prevZMaxEstimate = PQK.z / PQK.w;\nfloat rayZMin = prevZMaxEstimate, rayZMax = prevZMaxEstimate;\nfloat stepped = 0.0;\nvec2 hitUV;\nbool intersected = false;\nfor (float stepCount = 1.0; stepCount <= float(MAX_STEPS); stepCount ++) {\nPQK += dPQK;\nrayZMin = prevZMaxEstimate;\nrayZMax = (dPQK.z * 0.5 + PQK.z) / (dPQK.w * 0.5 + PQK.w);\nprevZMaxEstimate = rayZMax;\nswapIfBigger(rayZMax, rayZMin);\nstepped = stepCount;\nhitUV = (permute ? PQK.yx: PQK.xy) / ssrResolution;\nif (isOutsideUvBounds(hitUV)) break;\nintersected = doesIntersect(rayZMax, rayZMin, hitUV);\nif (intersected || (P0.x * stepDir) > end) break;\n}\nif (intersected && pixelStride > 1.0) {\nPQK -= dPQK;\ndPQK /= ssrStride;\nfloat ogStride = pixelStride * 0.5;\nfloat currStride = pixelStride;\nprevZMaxEstimate = PQK.z / PQK.w;\nrayZMin = prevZMaxEstimate, rayZMax = prevZMaxEstimate;\nfor(int j = 0; j < int(BINARY_SEARCH_ITERATIONS); j ++) {\nPQK += dPQK * currStride;\nrayZMin = prevZMaxEstimate;\nrayZMax = (dPQK.z * 0.5 + PQK.z) / (dPQK.w * 0.5 + PQK.w);\nprevZMaxEstimate = rayZMax;\nswapIfBigger(rayZMax, rayZMin);\nvec2 newUV = (permute ? PQK.yx: PQK.xy) / ssrResolution;\nogStride *= 0.5;\nif (doesIntersect(rayZMax, rayZMin, newUV)) {\nhitUV = newUV;\ncurrStride = -ogStride;\n} else {\ncurrStride = ogStride;\n}\n}\n}\nvec3 result = color;\n#ifdef USE_SSR_REFRACT\n#endif\nif (intersected) {\nvec4 col = texture2D(ssrSourceBuffer, hitUV);\nvec2 ndc = abs(hitUV * 2.0 - 1.0);\nfloat maxndc = max(ndc.x, ndc.y);\nfloat fadeVal =\n(1.0 - (max(0.0, maxndc - SCREEN_FADE_THRESHOLD) / (1.0 - SCREEN_FADE_THRESHOLD))) *\n(1.0 - STEPS_FADE_AMOUNT * (stepped / float(MAX_STEPS)));\ncol.a = fadeVal;\nresult = mix(result, col.rgb, col.a);\n}\n#else\nvec3 result = texture2D(ssrSourceBuffer, P1).xyz;\n#endif\nreturn result;\n}\n#endif",plane_reflection_pars_vertex:"#ifdef USE_PLANE_REFLECTION\nuniform mat4 planeReflTextureMatrix;\nvarying vec4 vPlaneReflUv;\n#endif",plane_reflection_pars_fragment:"#ifdef USE_PLANE_REFLECTION\nuniform sampler2D planeReflTexture;\nuniform mat4 planeReflTextureMatrix;\nuniform vec3 planeReflDir;\nuniform vec3 planeReflBoundingBoxMin;\nuniform vec3 planeReflBoundingBoxMax;\nuniform mat4 planeReflInvModelMatrix;\nuniform float planeReflFalloff;\nvarying vec4 vPlaneReflUv;\nvec3 computePlaneReflection(vec3 radiance, float roughness, vec3 position, vec3 normal) {\nvec3 posRefl = (planeReflInvModelMatrix * invViewMatrix * vec4(position, 1.0)).xyz;\nif (any(lessThan(posRefl, planeReflBoundingBoxMin)) || any(greaterThan(posRefl, planeReflBoundingBoxMax)))\nreturn radiance;\nvec3 norWorld = transformDirection(normal, invViewMatrix);\nvec4 uvNormalOffset = planeReflTextureMatrix * vec4(norWorld - planeReflDir, 0.0);\nvec3 result = texture2DProj(planeReflTexture, vPlaneReflUv + uvNormalOffset).rgb;\nfloat falloffFactor;\nif (planeReflFalloff < EPSILON)\nfalloffFactor = 0.0;\nelse if (posRefl.y > 0.0)\nfalloffFactor = 1.0 - clamp((planeReflBoundingBoxMax.y - posRefl.y) / (planeReflBoundingBoxMax.y * (planeReflFalloff)), 0.0, 1.0);\nelse\nfalloffFactor = 1.0 - clamp((planeReflBoundingBoxMin.y - posRefl.y) / (planeReflBoundingBoxMin.y * (planeReflFalloff)), 0.0, 1.0);\nresult = mix(result, radiance, falloffFactor);\nresult = mix(result, radiance, (roughness < 0.0526) ? 0.0 : saturate(10.0*roughness));\nreturn result;\n}\n#endif",plane_reflection_vertex:"#ifdef USE_PLANE_REFLECTION\nvPlaneReflUv = planeReflTextureMatrix * modelMatrix * vec4(position, 1.0);\n#endif",node_common_frag:"\n#define LUM_WEIGHTS vec3(0.2126, 0.7152, 0.0722)\n#define LUM_WEIGHTS_MAYA vec3(0.3, 0.59, 0.11)\n#define LUMENS_PER_WATT 683.0\n#define MAX_ENV_COORDS_DIR 0\n#define MAX_ENV_COORDS_REFLECT 1\n#define MAX_ENV_COORDS_REFRACT 2\n#if defined(NODE_COLOR_CONVERT_AR) || defined(NODE_COLOR_CORRECT_AR) || defined(NODE_COMBHSV_BL) || defined(NODE_SEPHSV_BL) || defined(NODE_HUE_SAT_BL) || defined(NODE_COLOR_CORRECTION_MX) || defined(NODE_COMPOSITE_LAYER_MX) || defined(NODE_COLOR_CORRECT_MY) || defined(USE_OSL)\n#define HSV_NODES\n#endif\nvec4 nodeTexelToLinear(in vec4 color, in int sourceType) {\nif (sourceType == 1) {\nreturn vec4(pow(color.rgb, vec3(2.2)), color.a);\n}else\nreturn color;\n}\n#if defined HSV_NODES\nvoid hsvToRGB(vec4 hsv, out vec4 outCol)\n{\nfloat i, f, p, q, t, h, s, v;\nvec3 rgb;\nh = hsv[0];\ns = hsv[1];\nv = hsv[2];\nif (s == 0.0)\nrgb = vec3(v, v, v);\nelse {\nif (h == 1.0)\nh = 0.0;\nh *= 6.0;\ni = floor(h);\nf = h - i;\nrgb = vec3(f, f, f);\np = v * (1.0 - s);\nq = v * (1.0 - (s * f));\nt = v * (1.0 - (s * (1.0 - f)));\nif (i == 0.0)\nrgb = vec3(v, t, p);\nelse if (i == 1.0)\nrgb = vec3(q, v, p);\nelse if (i == 2.0)\nrgb = vec3(p, v, t);\nelse if (i == 3.0)\nrgb = vec3(p, q, v);\nelse if (i == 4.0)\nrgb = vec3(t, p, v);\nelse\nrgb = vec3(v, p, q);\n}\noutCol = vec4(rgb, hsv.w);\n}\nvoid rgbToHSV(vec4 rgb, out vec4 outCol)\n{\nfloat cmax, cmin, h, s, v, cdelta;\nvec3 c;\ncmax = max(rgb[0], max(rgb[1], rgb[2]));\ncmin = min(rgb[0], min(rgb[1], rgb[2]));\ncdelta = cmax - cmin;\nv = cmax;\nif (cmax != 0.0)\ns = cdelta / cmax;\nelse {\ns = 0.0;\nh = 0.0;\n}\nif (s == 0.0)\nh = 0.0;\nelse {\nc = (vec3(cmax, cmax, cmax) - rgb.xyz) / cdelta;\nif (rgb.x == cmax) h = c[2] - c[1];\nelse if (rgb.y == cmax) h = 2.0 + c[0] - c[2];\nelse h = 4.0 + c[1] - c[0];\nh /= 6.0;\nif (h < 0.0)\nh += 1.0;\n}\noutCol = vec4(h, s, v, rgb.w);\n}\n#endif\nbool isPerspective(const mat4 projMatrix)\n{\nreturn (projMatrix[3][3] == 0.0);\n}\n#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_SKYDOME_LIGHT_AR) || defined(NODE_ENV_SPHERE_MY)\nvec4 sampleEquirectangular(sampler2D map, vec3 reflectVec, mat3 uvTransform, int encoding)\n{\nreflectVec = normalize(reflectVec);\nvec2 sampleUV;\nsampleUV.y = asin(clamp(reflectVec.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;\nsampleUV.x = atan(reflectVec.x, reflectVec.z) * RECIPROCAL_PI2 + 0.5;\nsampleUV.y *= -1.0;\nconst float seamWidth = 0.15;\nconst float seamBiasFactor = -10.0;\nfloat seam = max(0.0, 1.0 - abs (reflectVec.x) / seamWidth) *\nclamp (1.0 - reflectVec.z / seamWidth, 0.0, 1.0);\nsampleUV = (uvTransform * vec3(sampleUV, 1.0)).xy;\nreturn texture2D(map, sampleUV, seamBiasFactor * seam);\n}\n#endif\n#if defined(NODE_FRESNEL_BL) || defined(NODE_LAYER_WEIGHT_BL) || defined(NODE_FALLOFF_MX) || defined(NODE_BSDF_GLASS_BL) || defined(NODE_BSDF_PRINCIPLED_BL)\nfloat fresnelReflection(const vec3 dir, const vec3 normal, const float ior) {\nfloat cosTheta = clamp(abs(dot(dir, normal)), -1.0, 1.0);\nfloat gSquared = pow2(ior) + pow2(cosTheta) - 1.0;\nif (gSquared < 0.0) return 1.0;\nfloat g = sqrt(gSquared);\nreturn 0.5 * pow2((g - cosTheta) / (g + cosTheta))\n* (1.0 + pow2(\n((g + cosTheta) * cosTheta - 1.0) /\n((g - cosTheta) * cosTheta + 1.0)\n));\n}\n#endif\n#if defined(NODE_BITMAP_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_GRADIENT_RAMP_MX)\n#define MAPPING_EXPLICIT_MAP_CHANNEL 1\n#define MAPPING_VERTEX_COLOR_CHANNEL 2\n#define MAPPING_PLANAR_OBJECT_XYZ 3\n#define MAPPING_PLANAR_WORLD_XYZ 4\n#define AXIS_XY 1\n#define AXIS_YZ 2\n#define AXIS_ZX 3\n#endif\n#if defined(NODE_BITMAP_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_MX) || defined(NODE_GRADIENT_RAMP_MX) || defined(NODE_PLACE_2D_TEXTURE_MY)\nmat3 calcUvTransform(float uOffset, float vOffset, float uTiling, float vTiling, float wAngle)\n{\nif (abs(uOffset) < EPSILON && abs(vOffset) < EPSILON &&\n(abs(uTiling - 1.0)) < EPSILON && (abs(vTiling - 1.0)) < EPSILON &&\nabs(wAngle) < EPSILON)\nreturn mat3(1.0);\nfloat sx = uTiling;\nfloat sy = vTiling;\nfloat c = cos(-wAngle);\nfloat s = sin(-wAngle);\n#if defined(NODE_PLACE_2D_TEXTURE_MY)\nfloat tx = uOffset;\nfloat ty = vOffset;\nfloat cx = 0.5;\nfloat cy = 0.5;\nreturn mat3(c*sx, s*sx, 0.0,\n-s*sy, c*sy, 0.0,\ns*(ty+sy-cy)+c*(tx-cx)+cx, -c*(ty+sy-cy)+s*(tx-cx)-cy+1.0, 1.0);\n#else\nfloat tx = -uOffset;\nfloat ty = -vOffset;\nfloat cx = uOffset + 0.5;\nfloat cy = vOffset + 0.5;\nreturn mat3(sx * c, -sy * s, 0.0,\nsx * s, sy * c, 0.0,\n-sx * (c * cx + s * cy) + cx + tx, -sy * (- s * cx + c * cy) + cy + ty, 1.0);\n#endif\n}\n#endif\n#if defined(NODE_NOISE_MX)\nmat4 calcXYZTransform(vec3 offset, vec3 tiling, vec3 angle) {\nmat4 rot = mat4(\ncos(angle.y)*cos(angle.z), cos(angle.x)*sin(angle.z)+sin(angle.x)*sin(angle.y)*cos(angle.z), sin(angle.x)*sin(angle.z)-cos(angle.x)*sin(angle.y)*cos(angle.z), 0.0,\n-cos(angle.y)*sin(angle.z), cos(angle.x)*cos(angle.z)-sin(angle.x)*sin(angle.y)*sin(angle.z), cos(angle.x)*sin(angle.y)*sin(angle.z)+sin(angle.x)*cos(angle.z), 0.0,\nsin(angle.y), -sin(angle.x)*cos(angle.y), cos(angle.x)*cos(angle.y), 0.0,\n0.0, 0.0, 0.0, 1.0\n);\nmat4 til = mat4(\ntiling.x, 0.0, 0.0, 0.0,\n0.0, tiling.y, 0.0, 0.0,\n0.0, 0.0, tiling.z, 0.0,\n0.0, 0.0, 0.0, 1.0\n);\nmat4 off = mat4(\n1.0, 0.0, 0.0, 0.0,\n0.0, 1.0, 0.0, 0.0,\n0.0, 0.0, 1.0, 0.0,\noffset.x, offset.y, offset.z, 1.0\n);\nreturn (til * rot * off);\n}\n#endif\n#if defined(NODE_TEX_NOISE_BL) || defined(NODE_TEX_WAVE_BL) || defined(NODE_NOISE_MX) || defined(USE_OSL) || defined(NODE_NOISE_MY)\n#define NOISE_AMP_HACK 0.75\n#define NOISE_BLENDER_MEAN 0.78\n#define NOISE_SCALE_HACK 0.5\n#define noiseModulo(x) (x - floor(x * (1.0 / 289.0)) * 289.0)\nvec4 noisePermute(vec4 x) {\nreturn noiseModulo(((x * 34.0) + 1.0) * x);\n}\nvec4 taylorInvSqrt(vec4 r) {\nreturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\nreturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat noisePerlin(vec3 v) {\nconst vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);\nconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\nvec3 i = floor(v + dot(v, C.yyy));\nvec3 x0 = v - i + dot(i, C.xxx);\nvec3 g = step(x0.yzx, x0.xyz);\nvec3 l = 1.0 - g;\nvec3 i1 = min(g.xyz, l.zxy);\nvec3 i2 = max(g.xyz, l.zxy);\nvec3 x1 = x0 - i1 + C.xxx;\nvec3 x2 = x0 - i2 + C.yyy;\nvec3 x3 = x0 - D.yyy;\ni = noiseModulo(i);\nvec4 p = noisePermute(noisePermute(noisePermute(i.z + vec4(0.0, i1.z, i2.z, 1.0))\n+ i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));\nfloat n_ = 0.142857142857;\nvec3 ns = n_ * D.wyz - D.xzx;\nvec4 j = p - 49.0 * floor(p * ns.z * ns.z);\nvec4 x_ = floor(j * ns.z);\nvec4 y_ = floor(j - 7.0 * x_);\nvec4 x = x_ * ns.x + ns.yyyy;\nvec4 y = y_ * ns.x + ns.yyyy;\nvec4 h = 1.0 - abs(x) - abs(y);\nvec4 b0 = vec4(x.xy, y.xy);\nvec4 b1 = vec4(x.zw, y.zw);\nvec4 s0 = floor(b0) * 2.0 + 1.0;\nvec4 s1 = floor(b1) * 2.0 + 1.0;\nvec4 sh = -step(h, vec4(0.0));\nvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;\nvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;\nvec3 p0 = vec3(a0.xy, h.x);\nvec3 p1 = vec3(a0.zw, h.y);\nvec3 p2 = vec3(a1.xy, h.z);\nvec3 p3 = vec3(a1.zw, h.w);\nvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\np0 *= norm.x;\np1 *= norm.y;\np2 *= norm.z;\np3 *= norm.w;\nvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\nm = m * m;\nreturn 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1),\ndot(p2, x2), dot(p3, x3)));\n}\nvec4 permute(vec4 x) {\nreturn mod(((x*34.0)+1.0)*x, 289.0);\n}\nfloat permute(float x) {\nreturn floor(mod(((x*34.0)+1.0)*x, 289.0));\n}\nvec4 grad4(float j, vec4 ip) {\nconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\nvec4 p,s;\np.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\np.w = 1.5 - dot(abs(p.xyz), ones.xyz);\ns = vec4(lessThan(p, vec4(0.0)));\np.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\nreturn p;\n}\nfloat snoise(vec4 v) {\nconst vec2 C = vec2(0.138196601125010504,\n0.309016994374947451);\nvec4 i = floor(v + dot(v, C.yyyy) );\nvec4 x0 = v - i + dot(i, C.xxxx);\nvec4 i0;\nvec3 isX = step( x0.yzw, x0.xxx );\nvec3 isYZ = step( x0.zww, x0.yyz );\ni0.x = isX.x + isX.y + isX.z;\ni0.yzw = 1.0 - isX;\ni0.y += isYZ.x + isYZ.y;\ni0.zw += 1.0 - isYZ.xy;\ni0.z += isYZ.z;\ni0.w += 1.0 - isYZ.z;\nvec4 i3 = clamp( i0, 0.0, 1.0 );\nvec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\nvec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\nvec4 x1 = x0 - i1 + 1.0 * C.xxxx;\nvec4 x2 = x0 - i2 + 2.0 * C.xxxx;\nvec4 x3 = x0 - i3 + 3.0 * C.xxxx;\nvec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;\ni = mod(i, 289.0);\nfloat j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\nvec4 j1 = permute( permute( permute( permute (\ni.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n+ i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n+ i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n+ i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\nvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\nvec4 p0 = grad4(j0, ip);\nvec4 p1 = grad4(j1.x, ip);\nvec4 p2 = grad4(j1.y, ip);\nvec4 p3 = grad4(j1.z, ip);\nvec4 p4 = grad4(j1.w, ip);\nvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\np0 *= norm.x;\np1 *= norm.y;\np2 *= norm.z;\np3 *= norm.w;\np4 *= taylorInvSqrt(dot(p4,p4));\nvec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\nvec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\nm0 = m0 * m0;\nm1 = m1 * m1;\nreturn 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n+ dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}\nfloat noiseBlender(vec3 p) {\nreturn 0.5 * NOISE_AMP_HACK * (noisePerlin(NOISE_SCALE_HACK * vec3(p.x, p.y, p.z))) + 0.5;\n}\nfloat noiseSmooth(vec3 p, float octaveLenPerPixel, float falloffFactor,\nfloat dispersionFactor) {\nfloat mixFac = mix(1.0, smoothstep(0.0, 1.0, octaveLenPerPixel) * falloffFactor,\ndispersionFactor);\nreturn mix(noiseBlender(p), NOISE_BLENDER_MEAN, mixFac);\n}\n#define MAX_OCTAVES_NUM 16\nfloat noiseTurbulence(vec3 p, float octaves, float octaveLenPerPixel,\nfloat falloffFactor, float dispersionFactor) {\nfloat fscale = 1.0;\nfloat amp = 1.0;\nfloat sum = 0.0;\noctaves = clamp(octaves, 0.0, 16.0);\nint octavesInt = int(octaves);\nfor (int i = 0; i <= MAX_OCTAVES_NUM; i++) {\n#if __VERSION__ == 300\nif (i <= octavesInt) {\nfloat t = noiseSmooth(fscale * p, octaveLenPerPixel, falloffFactor,\ndispersionFactor);\nsum += t * amp;\namp *= 0.5;\nfscale *= 2.0;\noctaveLenPerPixel *= 2.0;\n} else {\ni = MAX_OCTAVES_NUM;\n}\n#else\nif (i > octavesInt) break;\nfloat t = noiseSmooth(fscale * p, octaveLenPerPixel, falloffFactor,\ndispersionFactor);\nsum += t * amp;\namp *= 0.5;\nfscale *= 2.0;\noctaveLenPerPixel *= 2.0;\n#endif\n}\nfloat octavesFrac = fract(octaves);\nfloat octavesCoeff = pow(2.0, float(octavesInt));\nif (octavesFrac != 0.0) {\nfloat t = noiseSmooth(fscale * p, octaveLenPerPixel, falloffFactor,\ndispersionFactor);\nfloat sum2 = sum + t * amp;\nsum *= octavesCoeff / (2.0 * octavesCoeff - 1.0);\nsum2 *= 2.0 * octavesCoeff / (4.0 * octavesCoeff - 1.0);\nreturn mix(sum, sum2, octavesFrac);\n} else {\nreturn sum * octavesCoeff / (2.0 * octavesCoeff - 1.0);\n}\n}\n#endif\n#if (defined(USE_OSL) || defined(NODE_WAVELENGTH_BL)) && __VERSION__ == 300\nvec3 cieColorMatch[81] = vec3[](\nvec3(0.0014,0.0000,0.0065), vec3(0.0022,0.0001,0.0105), vec3(0.0042,0.0001,0.0201),\nvec3(0.0076,0.0002,0.0362), vec3(0.0143,0.0004,0.0679), vec3(0.0232,0.0006,0.1102),\nvec3(0.0435,0.0012,0.2074), vec3(0.0776,0.0022,0.3713), vec3(0.1344,0.0040,0.6456),\nvec3(0.2148,0.0073,1.0391), vec3(0.2839,0.0116,1.3856), vec3(0.3285,0.0168,1.6230),\nvec3(0.3483,0.0230,1.7471), vec3(0.3481,0.0298,1.7826), vec3(0.3362,0.0380,1.7721),\nvec3(0.3187,0.0480,1.7441), vec3(0.2908,0.0600,1.6692), vec3(0.2511,0.0739,1.5281),\nvec3(0.1954,0.0910,1.2876), vec3(0.1421,0.1126,1.0419), vec3(0.0956,0.1390,0.8130),\nvec3(0.0580,0.1693,0.6162), vec3(0.0320,0.2080,0.4652), vec3(0.0147,0.2586,0.3533),\nvec3(0.0049,0.3230,0.2720), vec3(0.0024,0.4073,0.2123), vec3(0.0093,0.5030,0.1582),\nvec3(0.0291,0.6082,0.1117), vec3(0.0633,0.7100,0.0782), vec3(0.1096,0.7932,0.0573),\nvec3(0.1655,0.8620,0.0422), vec3(0.2257,0.9149,0.0298), vec3(0.2904,0.9540,0.0203),\nvec3(0.3597,0.9803,0.0134), vec3(0.4334,0.9950,0.0087), vec3(0.5121,1.0000,0.0057),\nvec3(0.5945,0.9950,0.0039), vec3(0.6784,0.9786,0.0027), vec3(0.7621,0.9520,0.0021),\nvec3(0.8425,0.9154,0.0018), vec3(0.9163,0.8700,0.0017), vec3(0.9786,0.8163,0.0014),\nvec3(1.0263,0.7570,0.0011), vec3(1.0567,0.6949,0.0010), vec3(1.0622,0.6310,0.0008),\nvec3(1.0456,0.5668,0.0006), vec3(1.0026,0.5030,0.0003), vec3(0.9384,0.4412,0.0002),\nvec3(0.8544,0.3810,0.0002), vec3(0.7514,0.3210,0.0001), vec3(0.6424,0.2650,0.0000),\nvec3(0.5419,0.2170,0.0000), vec3(0.4479,0.1750,0.0000), vec3(0.3608,0.1382,0.0000),\nvec3(0.2835,0.1070,0.0000), vec3(0.2187,0.0816,0.0000), vec3(0.1649,0.0610,0.0000),\nvec3(0.1212,0.0446,0.0000), vec3(0.0874,0.0320,0.0000), vec3(0.0636,0.0232,0.0000),\nvec3(0.0468,0.0170,0.0000), vec3(0.0329,0.0119,0.0000), vec3(0.0227,0.0082,0.0000),\nvec3(0.0158,0.0057,0.0000), vec3(0.0114,0.0041,0.0000), vec3(0.0081,0.0029,0.0000),\nvec3(0.0058,0.0021,0.0000), vec3(0.0041,0.0015,0.0000), vec3(0.0029,0.0010,0.0000),\nvec3(0.0020,0.0007,0.0000), vec3(0.0014,0.0005,0.0000), vec3(0.0010,0.0004,0.0000),\nvec3(0.0007,0.0002,0.0000), vec3(0.0005,0.0002,0.0000), vec3(0.0003,0.0001,0.0000),\nvec3(0.0002,0.0001,0.0000), vec3(0.0002,0.0001,0.0000), vec3(0.0001,0.0000,0.0000),\nvec3(0.0001,0.0000,0.0000), vec3(0.0001,0.0000,0.0000), vec3(0.0000,0.0000,0.0000)\n);\n#endif\n#if defined(USE_OSL) || defined(NODE_BLACKBODY_BL)\nvec3 colorTempToRGB(float temp)\n{\nvec3 retColor;\ntemp = clamp(temp, 100.0, 40000.0) / 100.0;\nif (temp <= 66.0) {\nretColor.r = 1.0;\nretColor.g = saturate(0.390081578 * log(temp) - 0.631841443);\n} else {\nfloat t = temp - 60.0;\nretColor.r = saturate(1.292936186 * pow(t, -0.133204759));\nretColor.g = saturate(1.129890860 * pow(t, -0.075514849));\n}\nif (temp >= 66.0)\nretColor.b = 1.0;\nelse if (temp <= 19.0)\nretColor.b = 0.0;\nelse\nretColor.b = saturate(0.543206789 * log(temp - 10.0) - 1.196254089);\nretColor.rgb = pow(retColor.rgb, vec3(2.2));\nreturn retColor;\n}\n#endif\n#ifdef USE_OSL\n#define M_PI PI\n#define M_PI_2 PI / 2.0\n#define M_PI_4 PI / 4.0\n#define M_2_PI 2.0 / PI\n#define M_2PI 2.0 * PI\n#define M_4PI 4.0 * PI\n#define M_2_SQRTPI 2.0 / sqrt(PI)\n#define M_E 2.718281828459\n#define M_LN2 0.69314718056\n#define M_LN10 2.30258509299\n#define M_LOG2E 1.4426950409\n#define M_LOG10E 0.43429448190\n#define M_SQRT2 sqrt(2.0)\n#define M_SQRT1_2 sqrt(0.5)\n#define OSL_ALPHA 33633\n#define OSL_ANISOTROPIC 40205\n#define OSL_AVERAGEALPHA 57701\n#define OSL_AVERAGECOLOR 46077\n#define OSL_BANDWIDTH 37485\n#define OSL_BEZIER 27645\n#define OSL_BLACK 62409\n#define OSL_BSPLINE 16959\n#define OSL_CAMERA 8198\n#define OSL_CAMERA_CLIP 34380\n#define OSL_CAMERA_CLIP_FAR 31933\n#define OSL_CAMERA_CLIP_NEAR 21485\n#define OSL_CAMERA_FOV 60706\n#define OSL_CAMERA_PIXELASPECT 4950\n#define OSL_CAMERA_PROJECTION 29369\n#define OSL_CAMERA_RESOLUTION 39679\n#define OSL_CAMERA_SCREEN_WINDOW 47009\n#define OSL_CAMERA_SHUTTER 7107\n#define OSL_CAMERA_SHUTTER_CLOSE 34406\n#define OSL_CAMERA_SHUTTER_OPEN 40085\n#define OSL_CATMULL_ROM 31642\n#define OSL_CELL 20984\n#define OSL_CHANNELS 8726\n#define OSL_CLAMP 20052\n#define OSL_COLOR 53753\n#define OSL_COMMON 49871\n#define OSL_CONSTANT 25144\n#define OSL_DATAWINDOW 54276\n#define OSL_DEFAULT 54870\n#define OSL_DIFFUSE 40389\n#define OSL_DIRECTION 42220\n#define OSL_DISPLAYWINDOW 30728\n#define OSL_DISTANCE 51337\n#define OSL_DO_FILTER 35765\n#define OSL_EMPTY 9314\n#define OSL_ERRORMESSAGE 38305\n#define OSL_EXISTS 41510\n#define OSL_FILL 39132\n#define OSL_FIRSTCHANNEL 48155\n#define OSL_GABOR 57764\n#define OSL_GEOM_NAME 63686\n#define OSL_GLOSSY 47998\n#define OSL_HASH 49390\n#define OSL_HERMITE 63643\n#define OSL_HIT 48491\n#define OSL_HITDIST 22029\n#define OSL_HSL 49898\n#define OSL_HSV 29073\n#define OSL_IMPULSES 56191\n#define OSL_INDEX 1731\n#define OSL_INTERP 10557\n#define OSL_LINEAR 2182\n#define OSL_MIRROR 64591\n#define OSL_MISSINGALPHA 39755\n#define OSL_MISSINGCOLOR 51667\n#define OSL_NDC 48899\n#define OSL_NORMAL 16520\n#define OSL_OBJECT 59084\n#define OSL_OSL_VERSION 47920\n#define OSL_PERIODIC 8749\n#define OSL_PERLIN 730\n#define OSL_POSITION 43041\n#define OSL_RASTER 2618\n#define OSL_REFLECTION 37621\n#define OSL_REFRACTION 37287\n#define OSL_RESOLUTION 48704\n#define OSL_RGB 26673\n#define OSL_RWRAP 47801\n#define OSL_SCREEN 55875\n#define OSL_SHADER 21066\n#define OSL_SHADER_GROUPNAME 62327\n#define OSL_SHADER_LAYERNAME 51796\n#define OSL_SHADER_SHADERNAME 65123\n#define OSL_SHADOW 60708\n#define OSL_SIMPLEX 61636\n#define OSL_SUBIMAGE 33526\n#define OSL_SUBIMAGES 2366\n#define OSL_SWRAP 4328\n#define OSL_TEXTUREFORMAT 17851\n#define OSL_TIME 52235\n#define OSL_TRACE 62908\n#define OSL_TWRAP 30524\n#define OSL_TYPE 64071\n#define OSL_UPERLIN 65308\n#define OSL_USIMPLEX 11314\n#define OSL_WIDTH 48751\n#define OSL_WORLD 9059\n#define OSL_WORLDTOCAMERA 32273\n#define OSL_WORLDTOSCREEN 33876\n#define OSL_WRAP 58300\n#define OSL_XYY 2228\n#define OSL_XYZ 47351\n#define OSL_YIQ 15839\nvec3 oslGetP(vec3 viewPos) {\n#if WORLD_NODES == 1\nreturn swizzleUpZ((invViewMatrix * vec4(-viewPos, 0.0)).xyz);\n#else\nreturn swizzleUpZ((invViewMatrix * vec4(-viewPos, 1.0)).xyz);\n#endif\n}\nvec3 oslGetI(vec3 viewPos) {\n#if WORLD_NODES == 1\nreturn swizzleUpZ((invViewMatrix * vec4(normalize(-viewPos), 0.0)).xyz);\n#else\nreturn swizzleUpZ((invViewMatrix * vec4(normalize(-viewPos), 0.0)).xyz);\n#endif\n}\nvec3 oslGetN(vec3 viewNorm) {\nreturn swizzleUpZ(normalize(invViewMatrix * vec4(viewNorm, 0.0)).xyz);\n}\nvec3 oslBlackbody(float temperatureK) {\nreturn vec4(colorTempToRGB(temperatureK), 1.0).rgb;\n}\nfloat oslDistance(vec3 p0, vec3 p1) {\nreturn distance(p0, p1);\n}\nfloat oslDistance(vec3 p0, vec3 p1, vec3 q) {\nvec3 d = p1 - p0;\nfloat dd = dot(d, d);\nif (dd == 0.0)\nreturn distance(q, p0);\nfloat t = dot(q - p0, d) / dd;\nreturn distance(q, p0 + clamp(t, 0.0, 1.0) * d);\n}\nint oslEndsWith(int name1, int name2) {\nreturn int(name1 == name2);\n}\nint oslFormat(int name1, int name2) {\nreturn name2;\n}\nint oslGetAttribute(int name, out int value) {\nvalue = 0;\nreturn 0;\n}\nint oslGetAttribute(int name, out float value) {\nvalue = 0.0;\nreturn 0;\n}\nint oslGetAttribute(int name, out vec3 vec) {\nvec = vec3(0.0, 0.0, 0.0);\nreturn 0;\n}\nvoid oslGetTextureInfo(int filename, int name, out int value) {\nvalue = 4;\n}\nvoid oslGetTextureInfo(int filename, int name, out int value[2]) {\nvalue[0] = 1024;\nvalue[1] = 1024;\n}\nvec3 oslHSV(float h, float s, float v) {\nvec4 outCol;\nhsvToRGB(vec4(h, s, v, 1.0), outCol);\nreturn outCol.rgb;\n}\nfloat oslHypot(float x, float y) {\nreturn sqrt(x*x + y*y);\n}\nfloat oslHypot(float x, float y, float z) {\nreturn sqrt(x*x + y*y + z*z);\n}\nfloat oslLog2(float x, float y) {\nreturn log(x) / log(y);\n}\nfloat oslLuminance(vec3 color) {\nreturn linearToRelativeLuminance(color);\n}\nfloat oslNoise(int type, vec3 vec, float phase) {\nfloat n = snoise(vec4(vec, phase));\nif (type == OSL_UPERLIN)\nn = n * 0.5 + 0.5;\nreturn n;\n}\nfloat oslNoise(int type, float value, float phase) {\nreturn oslNoise(type, vec3(value), phase);\n}\nfloat oslNoise(int type, vec3 vec) {\nreturn oslNoise(type, vec, 0.0);\n}\nfloat oslNoise(int type, float value) {\nreturn oslNoise(type, vec3(value), 0.0);\n}\nvec3 oslNoise3D(int type, vec3 vec, float phase) {\nfloat x = snoise(vec4(vec, phase));\nfloat y = snoise(vec4(vec.y, vec.x, vec.z, phase));\nfloat z = snoise(vec4(vec.y, vec.z, vec.x, phase));\nvec3 n = vec3(x, y, z);\nif (type == OSL_UPERLIN)\nn = n * 0.5 + 0.5;\nreturn n;\n}\nvec3 oslNoise3D(int type, float value, float phase) {\nreturn oslNoise3D(type, vec3(value), phase);\n}\nvec3 oslNoise3D(int type, vec3 vec) {\nreturn oslNoise3D(type, vec, 0.0);\n}\nvec3 oslNoise3D(int type, float value) {\nreturn oslNoise3D(type, vec3(value), 0.0);\n}\nfloat oslPow(float a, float b) {\nreturn pow(a, b);\n}\nvec3 oslPow(vec3 a, float b) {\nreturn pow(a, vec3(b));\n}\nint oslRayType(int name) {\nif (name == OSL_CAMERA)\n#if LIGHT_PATH_IS_CAM_RAY\nreturn 1;\n#else\nreturn 0;\n#endif\nelse\nreturn 0;\n}\nvec3 oslRotate(vec3 vec, float angle, vec3 p0, vec3 p1) {\nvec3 axis = normalize(p1 - p0);\nfloat c = cos(angle);\nfloat s = sin(angle);\nfloat x = axis[0];\nfloat y = axis[1];\nfloat z = axis[2];\nmat4 mat = mat4(\nx * x + (1.0 - x * x) * c, x * y * (1.0 - c) + z * s, x * z * (1.0 - c) - y * s, 0.0,\nx * y * (1.0 - c) - z * s, y * y + (1.0 - y * y) * c, y * z * (1.0 - c) + x * s, 0.0,\nx * z * (1.0 - c) + y * s, y * z * (1.0 - c) - x * s, z * z + (1.0 - z * z) * c, 0.0,\n0.0, 0.0, 0.0, 1.0\n);\nreturn (mat * vec4((vec - p0), 1.0) + vec4(p0, 1.0)).xyz;\n}\nvec3 oslRotate(vec3 vec, float angle, vec3 axis) {\nreturn oslRotate(vec, angle, vec3(0.0), axis);\n}\nint oslStartsWith(int name1, int name2) {\nreturn int(name1 == name2);\n}\nint oslStrLen(int name) {\nif (name == OSL_EMPTY)\nreturn 0;\nelse\nreturn 1;\n}\nint oslSubStr(int s, int start, int len) {\nreturn s;\n}\nint oslSubStr(int s, int start) {\nreturn s;\n}\nvec3 oslTexture(sampler2D image, float u, float v, int wrapModeFlag, int wrapMode, int alphaFlag, out float alpha) {\nif (wrapMode == OSL_DEFAULT || wrapMode == OSL_BLACK) {\nif (u < 0.0 || u > 1.0 || v < 0.0 || v > 1.0)\nreturn vec3(0.0);\n} else if (wrapMode == OSL_CLAMP) {\nu = clamp(u, 0.0, 1.0);\nv = clamp(v, 0.0, 1.0);\n} else if (wrapMode == OSL_PERIODIC) {\nu = mod(u, 1.0);\nv = mod(v, 1.0);\n} else if (wrapMode == OSL_MIRROR) {\nif (mod(floor(u), 2.0) == 0.0)\nu = u - floor(u);\nelse\nu = 1.0 - (u - floor(u));\nif (mod(floor(v), 2.0) == 0.0)\nv = v - floor(v);\nelse\nv = 1.0 - (v - floor(v));\n}\nvec4 colAlpha = texture2D(image, vec2(u, v));\nalpha = colAlpha.a;\nreturn colAlpha.rgb;\n}\nvec3 oslTexture(sampler2D image, float u, float v, int alphaFlag, out float alpha, int wrapModeFlag, int wrapMode) {\nreturn oslTexture(image, u, v, wrapModeFlag, wrapMode, alphaFlag, alpha);\n}\nvec3 oslTexture(sampler2D image, float u, float v, int alphaFlag, out float alpha) {\nreturn oslTexture(image, u, v, OSL_WRAP, OSL_DEFAULT, alphaFlag, alpha);\n}\nvec3 oslTexture(sampler2D image, float u, float v, int wrapModeFlag, int wrapMode) {\nfloat alpha;\nreturn oslTexture(image, u, v, wrapModeFlag, wrapMode, OSL_ALPHA, alpha);\n}\nvec3 oslTexture(sampler2D image, float u, float v) {\nfloat alpha;\nreturn oslTexture(image, u, v, OSL_WRAP, OSL_DEFAULT, OSL_ALPHA, alpha);\n}\nvec3 oslTransform(int fromSpace, int toSpace, vec4 vec) {\nif (toSpace == OSL_WORLD || toSpace == OSL_SHADER || toSpace == OSL_COMMON) {\nreturn vec.xyz;\n} else if (toSpace == OSL_OBJECT) {\nvec = vec4(swizzleUpY(vec.xyz), vec.w);\nvec = invModelMatrix * vec;\nreturn swizzleUpZ(vec.xyz);\n} else if (toSpace == OSL_CAMERA) {\nvec = vec4(swizzleUpY(vec.xyz), vec.w);\nreturn (viewMatrix * vec).xyz;\n} else if (toSpace == OSL_SCREEN) {\nreturn vec.xyz;\n} else if (toSpace == OSL_RASTER) {\nreturn gl_FragCoord.xyz;\n} else if (toSpace == OSL_NDC) {\nreturn vec.xyz;\n} else {\nreturn vec.xyz;\n}\n}\nvec3 oslTransform(int fromSpace, int toSpace, vec3 vec) {\nreturn oslTransform(fromSpace, toSpace, vec4(vec, 1.0));\n}\nvec3 oslTransform(int toSpace, vec3 vec) {\nreturn oslTransform(OSL_COMMON, toSpace, vec4(vec, 1.0));\n}\nvec3 oslTransformDir(int fromSpace, int toSpace, vec3 vec) {\nreturn oslTransform(fromSpace, toSpace, vec4(vec, 0.0));\n}\nvec3 oslTransformDir(int toSpace, vec3 vec) {\nreturn oslTransform(OSL_COMMON, toSpace, vec4(vec, 0.0));\n}\nvec3 oslTransformC(int fromSpace, int toSpace, vec3 vec) {\nvec4 outVec = vec4(vec, 1.0);\nif (fromSpace == OSL_HSV && toSpace == OSL_RGB)\nhsvToRGB(vec4(vec, 1.0), outVec);\nelse if (fromSpace == OSL_RGB && toSpace == OSL_HSV)\nrgbToHSV(vec4(vec, 1.0), outVec);\nreturn outVec.rgb;\n}\nvec3 oslTransformC(int toSpace, vec3 vec) {\nreturn oslTransformC(OSL_RGB, toSpace, vec);\n}\nvoid oslError() {}\nvoid oslFPrintf() {}\nvoid oslPrintf() {}\nvoid oslWarning() {}\nvec3 oslWaveLengthColor(float lambdaNM) {\n#if __VERSION__ == 300\nvec3 xyz = vec3(0.0);\nfloat ii = (lambdaNM - 380.0) / 5.0;\nint i = int(ii);\nif (i < 0 || i >= 80)\nreturn xyz;\nii -= float(i);\nvec3 c1 = cieColorMatch[i];\nvec3 c2 = cieColorMatch[i+1];\nxyz = mix(c1, c2, ii);\nreturn xyz_to_sRGB(xyz);\n#else\nreturn vec3(0.0);\n#endif\n}\n#endif",node_incident_frag:"void node_incident(vec3 viewPos, out vec3 incident)\n{\n\nvec4 viewDir = vec4(normalize(viewPos), 0.0);\nincident = -swizzleUpZ(viewDir.xyz);\n}",node_normal_frag:"void node_normal(vec3 norParam, out vec3 norOut)\n{\n#ifdef MT_BLENDER\n#if WORLD_NODES == 1\nvec4 viewDir = isOrtho(projectionMatrix) ? vec4(0.0, 0.0, -1.0, 0.0) : vec4(normalize(-vViewPosition), 0.0);\nviewDir = invViewMatrix * viewDir;\nnorOut = -swizzleUpZ(viewDir.xyz);\n#else\nnorOut = normalize(invViewMatrix * vec4(norParam, 0.0)).xyz;\nnorOut = swizzleUpZ(norOut);\n#endif\n#else\nnorOut = norParam;\n#endif\n}",node_position_frag:"void node_position(vec3 posParam, out vec3 posOut)\n{\n#if defined(MT_BLENDER) || defined(MT_MAX)\nposOut = swizzleUpZ(-posParam);\n#else\nposOut = -posParam;\n#endif\n}",node_rgb_alpha_frag:"\nuniform vec4 nodeRGB[NODE_RGB_NUM];\nvoid node_rgb_alpha(vec4 color, out vec3 outColor, out float outAlpha)\n{\noutColor = color.rgb;\noutAlpha = color.a;\n}",node_value_frag:"uniform float nodeValue[NODE_VALUE_NUM];\nvoid node_value(float val, out float outVal)\n{\noutVal = val;\n}",node_u_float_frag:"void node_u_float(vec2 inUv, out float u)\n{\nu = inUv.x;\n}",node_abs_ar_frag:"void node_abs(\nvec3 inputVal,\nout vec3 outColor)\n{\noutColor = abs(inputVal);\n}",node_add_ar_frag:"void node_add(\nvec3 input1, vec3 input2,\nout vec3 outColor)\n{\noutColor = input1 + input2;\n}",node_atan_ar_frag:"void node_atan(\nint units,\nvec3 x, vec3 y,\nout vec3 outColor)\n{\noutColor = atan(y, x);\nif (units == 1)\noutColor = degrees(outColor);\n}",node_checkerboard_ar_frag:"void node_checkerboard(\nconst vec2 inUv, vec3 color1, vec3 color2, float uFrequency, float vFrequency, float uOffset, float vOffset, float contrast,\nout vec3 outColor) {\nvec2 uv = -1.0 + 2.0 * inUv;\nfloat fmodResult = mod(floor(uOffset * 2.0 + uFrequency * uv.x) + floor(vOffset * 2.0 + vFrequency * uv.y), 2.0);\nfloat final = max(sign(fmodResult), 0.0);\nvec3 col = vec3(final);\nif (final == 0.0)\ncol = color1;\nelse\ncol = color2;\noutColor = col * vec3(contrast) + vec3(1.0 - contrast);\n}",node_clamp_ar_frag:"void node_clamp(\nconst int mode,\nvec3 inputValue, float minValue, float maxValue, vec3 minColor, vec3 maxColor,\nout vec3 outColor, out vec3 outTransparency)\n{\nif (mode == 0)\noutColor = clamp(inputValue, vec3(minValue), vec3(maxValue));\nelse\noutColor = clamp(inputValue, minColor, maxColor);\noutTransparency = outColor;\n}",node_color_convert_ar_frag:"void node_color_convert(\nconst int from, const int to,\nvec3 inputValue,\nout vec3 outColor, out vec3 outTransparency)\n{\nvec4 c;\nif (from == to)\nc = vec4(inputValue, 1.0);\nelse if (from == 0) \nrgbToHSV(vec4(inputValue, 1.0), c);\nelse if (from == 1)\nhsvToRGB(vec4(inputValue, 1.0), c);\noutColor = c.rgb;\noutTransparency = outColor;\n}",node_color_correct_ar_frag:"void node_color_correct(\nvec3 inputValue, float mask, float gamma, float hueShift, float saturation, float contrast, float contrastPivot,\nfloat exposure, vec3 multiply, vec3 add, bool invert, bool alphaIsLuminance, float alphaMultiply, float alphaAdd, bool invertAlpha,\nout vec3 outColor, out float outAlpha)\n{ \noutColor = inputValue;\noutColor = invert ? 1.0 - outColor : outColor;\noutColor = vec3(pow(abs(outColor.r), gamma), pow(abs(outColor.g), gamma), pow(abs(outColor.b), gamma));\nvec4 hsv;\nrgbToHSV(vec4(outColor, 1.0), hsv);\nhsv[0] += hueShift / 360.0;\nif (hsv[0] > 1.0)\nhsv[0] -= 1.0;\nelse if (hsv[0] < 0.0)\nhsv[0] += 1.0;\n\nhsv[1] *= (saturation);\nhsv[1] = saturate(hsv[1]);\nhsv[2] += exposure * 2.0;\nvec4 c = hsv;\nhsvToRGB(hsv, c);\nc = ((c - contrastPivot) * contrast + contrastPivot) * vec4(multiply, 1.0) + vec4(add, 1.0);\noutColor = c.rgb;\noutAlpha = 1.0;\n}",node_color_to_float_ar_frag:"void node_color_to_float(\nconst int mode,\nvec3 inputValue,\nout float outValue)\n{\nif (mode == 0)\noutValue = min(min(inputValue.r, inputValue.g), inputValue.b);\nelse if (mode == 1)\noutValue = max(max(inputValue.r, inputValue.g), inputValue.b);\nelse if (mode == 2)\noutValue = (inputValue.r + inputValue.g + inputValue.b) / 3.0;\nelse if (mode == 3)\noutValue = inputValue.r + inputValue.g + inputValue.b;\nelse if (mode == 4) {\noutValue = dot(inputValue, LUM_WEIGHTS);\n}\nelse if (mode == 5)\noutValue = inputValue.r;\nelse if (mode == 6)\noutValue = inputValue.g;\nelse if (mode == 7)\noutValue = inputValue.b;\n}",node_compare_ar_frag:"void node_compare(\nint test,\nfloat input1, float input2,\nout bool outValue)\n{\nif (test == 0)\noutValue = input1 == input2;\nelse if (test == 1)\noutvalue = input1 != input2;\nelse if (test == 2)\noutValue = input1 < input2;\nelse if (test == 3)\noutValue = input1 > input2;\nelse if (test == 4)\noutValue = input1 <= input2;\nelse if (test == 5)\noutValue = input1 >= input2;\n}",node_complement_ar_frag:"void node_complement(\nvec3 inputValue,\nout vec3 outColor)\n{\noutColor = 1.0 - inputValue;\n}",node_composite_ar_frag:"void node_composite(\nconst int operation, const int alphaOperation,\nvec3 A, vec3 B, float AA, float BA,\nout float outAlpha, out vec3 outColor, out vec3 outTransparency)\n{\nvec4 A1 = vec4(A, AA);\nvec4 B1 = vec4(B, BA);\nvec4 color = vec4(0.0);\nif (operation == 0)\ncolor = A1;\nelse if (operation == 1)\ncolor = B1;\nelse if (operation == 2)\ncolor = A1 * B1.a + B1 * (1.0 - A1.a);\nelse if (operation == 3)\ncolor = (A1 + B1) / 2.0;\nelse if (operation == 4)\ncolor = A1.a > B1.a ? A1 : (A1 + B1 * (1.0 - A1.a) / B1.a);\nelse if (operation == 5)\ncolor = abs(A1 - B1);\nelse if (operation == 6)\ncolor = A1.a + B1.a < 1.0 ? A1 + B1 : A1 + B1 * (1.0 - A1.a) / B1.a;\nelse if (operation == 7)\nfor (int i = 0; i < 4; i++)\ncolor[i] = B1[i] == 0.0 ? 0.0 : (A1[i] / B1[i]);\nelse if (operation == 8)\ncolor = A1 + B1 - 2.0 * A1 * B1;\nelse if (operation == 9)\ncolor = B1 - A1;\nelse if (operation == 10)\ncolor = 2.0 * A1 * B1 / (A1 + B1);\nelse if (operation == 11)\nfor (int i = 0; i < 4; i++)\ncolor[i] = A1[i] < 0.5 ? (A1[i] * B1[i]) : (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);\nelse if (operation == 12)\ncolor = sqrt(A1 * A1 + B1 * B1);\nelse if (operation == 13)\ncolor = A1 * B1.a;\nelse if (operation == 14)\ncolor = B1 * A1.a;\nelse if (operation == 15)\ncolor = A1 * A1.a + B1 * (1.0 - A1.a);\nelse if (operation == 16)\ncolor = max(A1, B1);\nelse if (operation == 17)\ncolor = min(A1, B1);\nelse if (operation == 18)\ncolor = A1 - B1;\nelse if (operation == 19)\ncolor = A1 * B1;\nelse if (operation == 20)\ncolor = A1 * (1.0 - B1.a);\nelse if (operation == 21)\ncolor = A1 + B1 * (1.0 - A1.a);\nelse if (operation == 22)\nfor (int i = 0; i < 4; i++)\ncolor[i] = B1[i] < 0.5 ? (A1[i] * B1[i]) : (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);\nelse if (operation == 23)\ncolor = A1 + B1;\nelse if (operation == 24)\nfor (int i = 0; i < 4; i++)\ncolor[i] = (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);\n\nelse if (operation == 25)\nfor (int i = 0; i < 4; i++)\ncolor[i] = (A1[i] < .75) ? (A1[i] * B1[i]) : (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);\nelse if (operation == 26)\ncolor = B1 * (1.0 - A1.a);\nelse if (operation == 27)\ncolor = A1 * (1.0 - B1.a) + B1;\nelse if (operation == 28)\ncolor = A1 * (1.0 - B1.a) + B1 * (1.0 - A1.a);\nif (alphaOperation == 1)\ncolor.a = AA;\nelse if (alphaOperation ==2)\ncolor.a = BA;\noutColor = color.rgb;\noutAlpha = color.a;\noutTransparency = outColor;\n}",node_cross_ar_frag:"void node_cross(\nvec3 input1, vec3 input2,\nout vec3 outValue)\n{\noutValue = cross(input1, input2);\n}",node_divide_ar_frag:"void node_divide(\nvec3 input1, vec3 input2,\nout vec3 outColor)\n{\noutColor = input1 / input2;\n}",node_dot_ar_frag:"void node_dot(\nvec3 input1, vec3 input2,\nout vec3 outValue)\n{\noutValue = dot(input1, input2);\n}",node_exp_ar_frag:"void node_exp(\nvec3 inputVal,\nout vec3 outColor)\n{\noutColor = exp(inputVal);\n}",node_facing_ratio_ar_frag:"void node_facing_ratio(\nvec3 viewNorm,\nconst float bias, const float gain, const bool invert, const bool linear,\nout float outValue)\n{\noutValue = dot(normalize(viewNorm), normalize(vViewPosition));\n}",node_flat_ar_frag:"void node_flat(vec3 color, out vec3 outColor)\n{\noutColor = color;\n}",node_float_to_int_ar_frag:"void node_float_to_int(\nconst int mode, \nfloat inputValue,\nout int outValue)\n{\nif (mode == 0)\noutValue = round(inputValue);\nelse if (mode == 1)\noutValue = trunc(inputValue);\nelse if (mode == 2)\noutValue = floor(inputValue);\nelse if (mode == 3)\noutValue = ceil(inputValue);\n}",node_float_to_matrix_ar_frag:"void node_float_to_matrix(\nfloat input00, float input01, float input02, float input03, float input10, float input11, float input12, float input13, float input20, float input21, float input22, float input23, float input30, float input31, float input32, float input33,\nout mat4 outValue)\n{\noutValue = mat4(input00, input01, input02, input03,\ninput10, input11, input12, input13,\ninput20, input21, input22, input23,\ninput30, input31, input32, input33);\n}",node_float_to_rgba_ar_frag:"void node_float_to_rgba(\nfloat r, float g, float b, float a,\nout vec4 outColor, out float outAlpha, out vec3 outTransparency)\n{\noutAlpha = a;\noutColor = vec4(r, g, b, a);\noutTransparency = vec3(1.0 - a);\n}",node_float_to_rgb_ar_frag:"void node_float_to_rgb(\nfloat r, float g, float b,\nout vec3 outValue)\n{\noutValue = vec3(r, g, b);\n}",node_fraction_ar_frag:"void node_fraction(\nvec3 inputValue,\nout vec3 outColor)\n{\noutColor = fract(inputValue);\n}",node_is_finite_ar_frag:"void node_is_finite(\nvec3 inputValue,\nout bool outValue)\n{\noutValue = !any(isinf(inputValue));\n}",node_image_ar_frag:"float check(bool value) {\nif (value == true) return -1.0;\nreturn 1.0;\n}\nvoid node_image(sampler2D ima, const int encoding, \nvec3 multiply, vec3 offset, vec2 uvcoords, float soffset, float toffset, float sscale, float tscale, bool sflip, bool tflip, bool swapSt,\nout vec3 outColor, out float outAlpha, out vec3 outTransparency) {\n\nvec2 uv = vec2(uvcoords.x, uvcoords.y);\nif (swapSt == false) {\nif (sflip) uv.x = 1.0 - uv.x;\nif (tflip) uv.y = 1.0 - uv.y;\nuv = vec2(sscale, tscale) * (uv + vec2(soffset * check(sflip), toffset * check(tflip)));\n} else {\nif (sflip) uv.y = 1.0 - uv.y;\nif (tflip) uv.x = 1.0 - uv.x;\nuv = vec2(sscale, tscale) * (uv.yx + vec2(toffset * check(sflip), soffset * check(tflip)));\n}\nuv.y = 1.0 - uv.y;\nvec4 tex = texture2D(ima, uv);\noutColor = nodeTexelToLinear(tex, encoding).rgb * multiply + offset;\noutAlpha = tex.a;\noutTransparency = outColor.rgb;\n}\nvoid node_image(sampler2D ima, const int encoding, \nvec4 multiply, vec4 offset, vec2 uvcoords, float soffset, float toffset, float sscale, float tscale, bool sflip, bool tflip, bool swapSt,\nout vec4 outColor) {\nvec2 uv = vec2(uvcoords.x, uvcoords.y);\nif (swapSt == false) {\nif (sflip) uv.x = 1.0 - uv.x;\nif (tflip) uv.y = 1.0 - uv.y;\nuv = vec2(sscale, tscale) * (uv + vec2(soffset * check(sflip), toffset * check(tflip)));\n} else {\nif (sflip) uv.y = 1.0 - uv.y;\nif (tflip) uv.x = 1.0 - uv.x;\nuv = vec2(sscale, tscale) * (uv.yx + vec2(toffset * check(sflip), soffset * check(tflip)));\n}\nuv.y = 1.0 - uv.y;\nvec4 tex = texture2D(ima, uv);\noutColor = nodeTexelToLinear(tex, encoding).rgba * multiply + offset;\n}",node_lambert_ar_frag:"void node_lambert(\nvec3 geometryNormal,\nfloat Kd, vec3 KdColor, vec3 normalCamera, vec3 opacity,\nout vec4 outColor, out float outAlpha, out vec3 outTransparency)\n{\nNodeMaterial material;\nmaterial.diffuseColor = Kd * KdColor;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\nvec3 normal = normalCamera;\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_IndirectDiffuse\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\noutAlpha = average(opacity);\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, outAlpha);\noutTransparency = vec3(1.0) - opacity;\n}",node_length_ar_frag:"void node_length(\nint mode,\nvec3 inputVec,\nout float outValue)\n{\nif (mode == 0)\noutValue = length(inputVec);\nelse if (mode == 1)\noutValue = dot(inputVec, inputVec);\nelse\noutValue = abs(inputVec.x) + abs(inputVec.y) + abs(inputVec.z);\n}",node_log_ar_frag:"void node_log(\nvec3 inputVec, vec3 base,\nout vec3 outColor)\n{\noutColor = log(inputVec) / log(base);\n}",node_map_to_mtl_ar_frag:"\nvoid node_map_to_mtl(bool opaqueEnabled, vec4 color, out vec4 outColor)\n{\noutColor = vec4(color.rgb, opaqueEnabled ? color.a : 1.0);\n}",node_max_ar_frag:"void node_max(\nvec3 input1, vec3 input2,\nout vec3 outColor)\n{\noutColor = max(input1, input2);\n}",node_min_ar_frag:"void node_min(\nvec3 input1, vec3 input2,\nout vec3 outColor)\n{\noutColor = min(input1, input2);\n}",node_mix_shader_ar_frag:"void node_mix_shader(const int mode,\nconst float mixAmt, vec4 shader1, vec4 shader2,\nout vec4 color)\n{\nshader1.rgb *= shader1.a;\nshader2.rgb *= shader2.a;\nif (mode == 0)\ncolor = mix(shader1, shader2, clamp(mixAmt, 0.0, 1.0));\nelse\ncolor = vec4(shader1.rgb + shader2.rgb, min(shader1.a, shader2.a));\ncolor.rgb /= color.a;\n}",node_modulo_ar_frag:"void node_modulo(\nvec3 inputVec, vec3 divisor,\nout vec3 outColor)\n{\noutColor = mod(inputVec, divisor);\n}",node_multiply_ar_frag:"void node_multiply(\nvec3 input1, vec3 input2,\nout vec3 outColor)\n{\noutColor = input1 * input2;\n}",node_negate_ar_frag:"void node_negate(\nvec3 inputVec,\nout vec3 outColor)\n{\noutColor = -inputVec;\n}",node_normalize_ar_frag:"void node_normalize(\nvec3 inputVec,\nout vec3 outValue)\n{\noutValue = normalize(inputVec);\n}",node_normal_map_ar_frag:"void node_normal_map(\nvec4 tangentParam,\nvec3 inputVal, vec3 normal, float strength, vec3 tangent,\nout vec3 outValue) {\n#ifdef DOUBLE_SIDED\nnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n#endif\nvec3 normalTex = inputVal.xyz * 2.0 - 1.0;\nvec3 bitangent = tangentParam.w * cross(normal, tangent);\noutValue = normalize(normalTex.x * tangent + normalTex.y * bitangent + normalTex.z * normal);\n}",node_pow_ar_frag:"void node_pow(\nvec3 base, vec3 exponent,\nout vec3 outColor)\n{\noutColor = pow(base, exponent);\n}",node_random_ar_frag:"void node_abs(\nvec3 inputColor,\nout vec3 outColor)\n{\noutColor = inputColor;\n}",node_range_ar_frag:"void node_range(\nvec3 inputValue, float inputMin, float inputMax, \nfloat outputMin, float outputMax, bool smoothstep1, \nfloat contrast, float contrastPivot, float bias, float gain,\nout vec3 outColor, out vec3 outTransparency)\n{\n\noutColor = min(max(inputValue, vec3(inputMin)), vec3(inputMax));\noutColor = (outColor - contrastPivot) * contrast + contrastPivot;\nif (smoothstep1 == true) {\nfor (int i = 0; i < 3; i++)\noutColor[i] = smoothstep(outputMin, outputMax, outColor[i]);\n} else\noutColor = min(max(outColor, vec3(outputMin)), vec3(outputMax));\noutTransparency = outColor;\n}",node_ray_switch_ar_frag:"void node_ray_switch(vec3 camera, vec3 diffuseReflection, vec3 diffuseTransmission,\nvec3 shadow, vec3 specularReflection, vec3 specularTransmission,\nout vec3 outColor, out float outAlpha)\n{\n#if LIGHT_PATH_IS_CAM_RAY\noutColor = camera;\n#else\noutColor = diffuseReflection;\n#endif\noutAlpha = 1.0;\n}",node_reciprocal_ar_frag:"void node_reciprocal(\nvec3 inputVec,\nout vec3 outColor)\n{\noutColor = 1.0 / inputVec;\n}",node_rgba_to_float_ar_frag:"void node_rgba_to_float(\nconst int mode,\nvec3 inputValue, float inputA,\nout float outValue, out vec3 outTransparency)\n{\noutTransparency = inputValue + vec3(inputA / 4.0);\nif (mode == 0)\noutValue = min(min(min(inputValue.r, inputValue.g), inputValue.b), inputA);\nelse if (mode == 1)\noutValue = max(max(max(inputValue.r, inputValue.g), inputValue.b), inputA);\nelse if (mode == 2)\noutValue = (inputValue.r + inputValue.g + inputValue.b + inputA) / 4.0;\nelse if (mode == 3)\noutValue = inputValue.r + inputValue.g + inputValue.b + inputA;\nelse if (mode == 4) {\noutValue = dot(inputValue, LUM_WEIGHTS);\n}\nelse if (mode == 5)\noutValue = inputValue.r;\nelse if (mode == 6)\noutValue = inputValue.g;\nelse if (mode == 7)\noutValue = inputValue.b;\n}",node_rgb_to_float_ar_frag:"void node_rgb_to_float(\nconst int mode,\nvec3 inputValue,\nout float outValue)\n{\nif (mode == 0)\noutValue = min(min(inputValue.r, inputValue.g), inputValue.b);\nelse if (mode == 1)\noutValue = max(max(inputValue.r, inputValue.g), inputValue.b);\nelse if (mode == 2)\noutValue = (inputValue.r + inputValue.g + inputValue.b) / 3.0;\nelse if (mode == 3)\noutValue = inputValue.r + inputValue.g + inputValue.b;\nelse if (mode == 4) {\noutValue = dot(inputValue, LUM_WEIGHTS);\n}\nelse if (mode == 5)\noutValue = inputValue.r;\nelse if (mode == 6)\noutValue = inputValue.g;\nelse if (mode == 7)\noutValue = inputValue.b;\n}",node_rgb_to_vector_ar_frag:"void node_rgb_to_vector(\nconst int mode, \nvec3 inputValue,\nout vec3 outValue)\n{\n\noutValue = inputValue;\n}",node_shadow_matte_ar_frag:"#include <shadowmask_pars_fragment>\nvoid node_shadow_matte(\nvec3 normal,\nvec3 shadowColor, float backlighting, float shadowOpacity,\nout vec4 outColor, out float outAlpha) {\nfloat shadow = getShadowMask();\noutColor = vec4(shadowColor, shadowOpacity * (1.0 - shadow));\noutAlpha = outColor.a;\n}",node_shuffle_ar_frag:"\nvoid node_shuffle(const int channelR, const int channelG, const int channelB, const int channelA,\nvec3 color, float alpha, bool negateR, bool negateG, bool negateB, bool negateA,\nout vec3 outColor, out float outAlpha)\n{\noutColor = vec3(0.0);\nvec4 choose = vec4(color, alpha);\noutAlpha = 1.0;\noutColor.r = choose[channelR];\noutColor.g = choose[channelG];\noutColor.b = choose[channelB];\noutAlpha = choose[channelA];\nif (negateR)\noutColor.r = -outColor.r;\nif (negateG)\noutColor.g = -outColor.g;\nif (negateB)\noutColor.b = -outColor.b;\nif (negateA)\noutAlpha = -outAlpha;\n}\nvoid node_shuffle(const int channelR, const int channelG, const int channelB, const int channelA,\nvec4 color, float alpha, bool negateR, bool negateG, bool negateB, bool negateA,\nout vec4 outColor)\n{\noutColor = vec4(0.0);\nvec4 choose = vec4(color.rgb, alpha);\noutColor.r = choose[channelR];\noutColor.g = choose[channelG];\noutColor.b = choose[channelB];\noutColor.a = choose[channelA];\nif (negateR)\noutColor.r = -outColor.r;\nif (negateG)\noutColor.g = -outColor.g;\nif (negateB)\noutColor.b = -outColor.b;\nif (negateA)\noutColor.a = -outColor.a;\n}",node_sign_ar_frag:"void node_sign(\nvec3 inputVec,\nout vec3 outColor)\n{\noutColor = sign(inputVec);\n}",node_skydome_light_ar_frag:"void node_skydome_light(vec3 color, float intensity,\nout vec4 outgoingLight)\n{\noutgoingLight = vec4(color * intensity, 1.0);\n}\nvoid node_skydome_light(sampler2D envMap, int encoding, vec3 normal,\nfloat intensity,\nout vec4 outgoingLight)\n{\nvec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);\nvec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\nvec3 reflectVec = normalize(cameraToVertex);\nmat3 uvTransform = mat3(1.0);\nvec4 color = sampleEquirectangular(envMap, reflectVec, uvTransform, encoding);\n#if LIGHT_PATH_IS_CAM_RAY\nintensity = 1.0;\n#endif\noutgoingLight = color * intensity;\n}",node_sqrt_ar_frag:"void node_sqrt(\nvec3 inputVec,\nout vec3 outColor)\n{\noutColor = sqrt(inputVec);\n}",node_standard_surface_ar_frag:"#define DEFAULT_REFLECTION_EDGE 1.0\n#define DEFAULT_REFLECTION_SLOPE 5.0\nvoid node_standard_surface(\nvec3 geometryNormal, const bool thinWalled,\nconst float base, const vec3 baseColor, const float diffuseRoughness,\nconst float metalness, const float specular, const vec3 specularColor,\nconst float specularRoughness, const float trans, const vec3 transColor,\nconst float transDepth, const vec3 transScatter, const float transExtraRoughness,\nconst float subsurface, const vec3 subsurfaceColor, const vec3 subsurfaceRadius,\nconst float coat, const vec3 coatColor, const float coatRoughness,\nconst float sheen, const vec3 sheenColor, const float sheenRoughness,\nconst float emission, const vec3 emissionColor, const vec3 opacity,\nconst vec3 normal, const vec3 clearcoatNormal, const float specularIOR,\nout vec4 outColor, out vec3 outTransparency)\n{\nNodeMaterial material;\nvec3 baseColorWeighted = base * baseColor.rgb;\nmaterial.diffuseColor = baseColorWeighted * (1.0 - metalness) * (1.0 - trans);\n#ifdef USE_CLEARCOAT\nmaterial.clearcoat = saturate(coat);\nmaterial.clearcoatRoughness = clamp(coatRoughness, 0.0, 1.0);\nmaterial.clearcoatF0 = vec3(0.04);\nmaterial.clearcoatF90 = 1.0;\n#endif\n#ifdef USE_SHEEN\nmaterial.sheenColor = saturate(sheen * sheenColor);\nmaterial.sheenRoughness = clamp(sheenRoughness, 0.0, 1.0);\n#endif\nvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\nfloat geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\nmaterial.roughness = max(specularRoughness, 0.0525);\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min(material.roughness, 1.0);\nvec3 dielRefl = DEFAULT_SPECULAR_COEFFICIENT * specular * specularColor;\nmaterial.specularColor = mix(dielRefl, baseColorWeighted, metalness);\nmaterial.refractionColor = pow(trans * (1.0 - metalness) * transColor.rgb, vec3(2.0));\nmaterial.refractionIOR = specularIOR;\nmaterial.refractionRoughness = material.roughness;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 refractedLight = vec3(0.0);\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#define RE_Refraction RE_Refraction_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#undef RE_Refraction\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef USE_GTAO\nreflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;\nfloat gtaoVisibility = gtaoVisibilityBentNormal.r;\nvec3 gtaoBentNormal = bentNormal;\nvec3 gtaoViewDir = geometry.viewDir;\nvec3 gtaoNormal = normal;\nfloat gtaoRoughness = material.roughness;\n#endif\n#include <lights_fragment_gtso>\nvec3 totalEmissiveRadiance = emission * emissionColor;\nvec3 outSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\nvec3 outColor3 = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\noutSpecular + totalEmissiveRadiance;\n#ifdef USE_SHEEN\nfloat sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);\noutColor3 = outColor3 * sheenEnergyComp + sheenSpecular;\n#endif\n#ifdef USE_CLEARCOAT\nfloat dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));\nvec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);\noutColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;\n#endif\nfloat alpha = 1.0;\nif (thinWalled) {\nalpha = average(opacity) * (1.0 - saturate(trans) + maxFromRGB(outSpecular) * saturate(trans));\n} else {\noutColor3 += refractedLight;\n}\noutColor = vec4(outColor3, saturate(alpha));\noutTransparency = outColor3;\n}\nvoid node_standard_surface(\nvec3 geometryNormal, const bool thinWalled,\nconst float base, const vec3 baseColor, const float diffuseRoughness,\nconst float metalness, const float specular, const vec3 specularColor,\nconst float specularRoughness, const float trans, const vec3 transColor,\nconst float transDepth, const vec3 transScatter, const float transExtraRoughness,\nconst float subsurface, const vec3 subsurfaceColor, const vec3 subsurfaceRadius,\nconst float coat, const vec3 coatColor, const float coatRoughness,\nconst float sheen, const vec3 sheenColor, const float sheenRoughness,\nconst float emission, const vec3 emissionColor, const vec3 opacity,\nconst vec3 normal, const vec3 clearcoatNormal,\nout vec4 outColor, out vec3 outTransparency)\n{\nnode_standard_surface(\ngeometryNormal, thinWalled,\nbase, baseColor, diffuseRoughness,\nmetalness, specular, specularColor,\nspecularRoughness, trans, transColor,\ntransDepth, transScatter, transExtraRoughness,\nsubsurface, subsurfaceColor, subsurfaceRadius,\ncoat, coatColor, coatRoughness,\nsheen, sheenColor, sheenRoughness,\nemission, emissionColor, opacity,\nnormal, clearcoatNormal, 1.5,\noutColor, outTransparency);\n}",node_subtract_ar_frag:"void node_subtract(\nvec3 input1, vec3 input2,\nout vec3 outColor)\n{\noutColor = input1 - input2;\n}",node_trigo_ar_frag:"void node_trigo(\nconst int function, const int units,\nvec3 inputVec, float frequency, float phase,\nout vec3 outColor)\n{\nif (units == 1 && function >= 0 && function <=2)\ninputVec = radians(inputVec);\nif (function == 0)\noutColor = cos(inputVec * frequency + phase);\nelse if (function == 1)\noutColor = sin(inputVec * frequency + phase);\nelse if (function == 2)\noutColor = tan(inputVec * frequency + phase);\nelse if (function == 3)\noutColor = acos(inputVec * frequency + phase);\nelse if (function == 4)\noutColor = asin(inputVec * frequency + phase);\nelse if (function == 5)\noutColor = atan(inputVec * frequency + phase);\nelse if (function == 6)\noutColor = cosh(inputVec * frequency + phase);\nelse if (function == 7)\noutColor = sinh(inputVec * frequency + phase);\nelse\noutColor = tanh(inputVec * frequency + phase);\nif (units == 1 && function >= 3 && function <=5)\noutColor = degrees(outColor);\n}",node_two_sided_ar_frag:"void node_two_sided(\nbool frontFacing, \nvec3 front, vec3 back,\nout vec3 outColor)\n{\noutColor = frontFacing ? front : back;\n}",node_vector_to_rgb_ar_frag:"void node_vector_to_rgb(\nconst int mode, \nvec3 inputValue,\nout vec3 outColor)\n{\nif (mode == 0)\noutColor = inputValue;\nelse if (mode == 1)\noutColor = normalize(inputValue);\nelse if (mode == 2)\noutColor = inputValue;\n}",node_add_shader_bl_frag:"void node_add_shader(vec4 color1, vec4 color2, out vec4 outColor) {\noutColor.rgb = color1.rgb + color2.rgb;\noutColor.a = clamp(color1.a + color2.a, 0.0, 1.0);\n}",node_ambient_occlusion_bl_frag:"void node_ambient_occlusion(vec4 color, float distance, vec3 normal,\nout vec4 outColor, out float outAO) {\noutColor = color;\noutAO = 1.0;\n}",node_attribute_bl_frag:"void node_attribute(\nvec4 paramAttr,\nout vec4 outColor, out vec3 outVector, out float outFac,\nout float outAlpha) {\noutColor = vec4(paramAttr.xyz, 1.0);\noutVector = paramAttr.xyz;\noutFac = average(paramAttr.xyz);\noutAlpha = paramAttr.w;\n}\nvoid node_attribute(\nvec4 paramAttr,\nout vec4 outColor, out vec3 outVector, out float outFac) {\nfloat outAlpha;\nnode_attribute(paramAttr, outColor, outVector, outFac, outAlpha);\n}",node_background_bl_frag:"void node_background(vec4 color, float strength, out vec4 outColor)\n{\noutColor = strength * color;\n}",node_bevel_bl_frag:"void node_bevel(float radius, vec3 normal, out vec3 outNormal) {\noutNormal = normal;\n}",node_blackbody_bl_frag:"void node_blackbody(float temp, out vec4 outColor)\n{\noutColor = vec4(colorTempToRGB(temp), 1.0);\n}",node_brightcontrast_bl_frag:"\nvoid node_brightcontrast(vec4 color, float bright, float contrast, out vec4 outColor)\n{\nfloat bminc = bright - contrast * 0.5;\noutColor.r = max((1.0 + contrast) * color.r + bminc, 0.0);\noutColor.g = max((1.0 + contrast) * color.g + bminc, 0.0);\noutColor.b = max((1.0 + contrast) * color.b + bminc, 0.0);\noutColor.a = color.a;\n}",node_bsdf_anisotropic_bl_frag:"void node_bsdf_anisotropic(\nvec4 color, float roughness, float anisotropy, float rotation, vec3 normal, vec3 tangent,\nout vec4 outColor)\n{\noutColor = color;\n}",node_bsdf_diffuse_bl_frag:"\nvoid node_bsdf_diffuse(\nvec3 geometryNormal,\nvec4 color, float roughness, vec3 normal,\nout vec4 outColor) {\nnormal = vec3(normal[0], normal[2], -normal[1]);\nnormal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;\nNodeMaterial material;\nmaterial.diffuseColor = color.rgb;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_IndirectDiffuse\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\n#ifdef USE_GTAO\nreflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;\n#endif\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, 1.0);\n}",node_bsdf_glass_bl_frag:"void node_bsdf_glass(\nvec3 geometryNormal,\nvec4 color, float roughness, float ior, vec3 normal,\nout vec4 outColor) {\nnormal = normalize(normal);\nnormal = swizzleUpY(normal);\nvec3 normalWorld = normal;\nnormal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;\nNodeMaterial material;\nmaterial.specularColor = vec3(1.0);\nmaterial.fresnelRefl90 = vec3(1.0);\nmaterial.roughness = clamp(roughness, 0.0, 1.0);\nmaterial.refractionColor = vec3(1.0);\nmaterial.refractionIOR = ior;\nmaterial.refractionRoughness = pow2(roughness);\n#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat geomRoughness = calcGeometryRoughness(geometryNormal);\nmaterial.roughness = calcCubeUVAdjustedRoughness(\nmaterial.roughness, geomRoughness);\nmaterial.refractionRoughness = calcCubeUVAdjustedRoughness(\nmaterial.refractionRoughness, geomRoughness);\n#endif\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0),\nvec3(0.0), vec3(0.0));\nvec3 refractedLight = vec3(0.0);\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#define RE_Refraction RE_Refraction_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectSpecular\n#undef RE_IndirectSpecular\n#undef RE_Refraction\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\n#ifdef USE_GTAO\nfloat gtaoVisibility = gtaoVisibilityBentNormal.r;\nvec3 gtaoBentNormal = bentNormal;\nvec3 gtaoViewDir = geometry.viewDir;\nvec3 gtaoNormal = normal;\nfloat gtaoRoughness = material.roughness;\n#endif\n#include <lights_fragment_gtso>\nvec3 viewWorld;\nif (isPerspective(projectionMatrix))\nviewWorld = (invViewMatrix * vec4(-vViewPosition, 0.0)).xyz;\nelse\nviewWorld = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\nviewWorld = normalize(viewWorld);\nfloat fresnel = fresnelReflection(viewWorld, normalWorld, ior);\noutColor = vec4(color.rgb * mix(refractedLight, reflectedLight.directSpecular\n+ reflectedLight.indirectSpecular, fresnel), 1.0);\n}",node_bsdf_glossy_bl_frag:"\nvoid node_bsdf_glossy(\nvec3 geometryNormal,\nvec4 color, float roughness, vec3 normal,\nout vec4 outColor) {\nnormal = vec3(normal[0], normal[2], -normal[1]);\nnormal = normalize((viewMatrix * vec4(normal.xyz, 0.0)).xyz);\nNodeMaterial material;\nmaterial.specularColor = vec3(1.0);\nmaterial.fresnelRefl90 = vec3(1.0);\nmaterial.roughness = clamp(roughness, 0.0, 1.0);\n#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat geomRoughness = calcGeometryRoughness(geometryNormal);\nmaterial.roughness = calcCubeUVAdjustedRoughness(\nmaterial.roughness, geomRoughness);\n#endif\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectSpecular\n#undef RE_IndirectSpecular\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\n#ifdef USE_GTAO\nfloat gtaoVisibility = gtaoVisibilityBentNormal.r;\nvec3 gtaoBentNormal = bentNormal;\nvec3 gtaoViewDir = geometry.viewDir;\nvec3 gtaoNormal = normal;\nfloat gtaoRoughness = material.roughness;\n#endif\n#include <lights_fragment_gtso>\noutColor = vec4(color.rgb * (reflectedLight.directSpecular\n+ reflectedLight.indirectSpecular), 1.0);\n}",node_bsdf_hair_bl_frag:"void node_bsdf_hair(vec4 color, float offset, float roughnessU, float roughnessV, vec3 tangent, out vec4 outColor)\n{\noutColor = color;\n}",node_bsdf_principled_bl_frag:"\nvec3 tintFromColor(vec3 color) {\nfloat lum = dot(color, vec3(0.3, 0.6, 0.1));\nreturn lum > 0.0 ? color / lum : vec3(1.0);\n}\nvec3 fresnelBlend(float ior, float fresnel, vec3 fresnelColor) {\nfloat fresnelFac = fresnelReflection(vec3(1.0, 0.0, 0.0), vec3(1.0, 0.0, 0.0), ior);\nfloat mixFac = saturate((fresnel - fresnelFac) / max(1e-8, 1.0 - fresnelFac));\nreturn mix(fresnelColor, vec3(1.0), mixFac);\n}\nvoid node_bsdf_principled(\nvec3 geometryNormal,\nvec4 baseColor, float subsurface, vec3 subsurfaceRadius, vec4 subsurfaceColor,\nfloat subsurfaceIOR, float subsurfaceAnisotropy,\nfloat metallic, float specular, float specularTint, float roughness,\nfloat anisotropic, float anisotropicRotation, float sheen, float sheenTint,\nfloat clearcoat, float clearcoatRoughness, float ior,\nfloat transmission, float transmissionRoughness, vec4 emission,\nfloat emissionStrength, float alpha, vec3 normal, vec3 clearcoatNormal,\nvec3 tangent,\nout vec4 outColor) {\nnormal = vec3(normal[0], normal[2], -normal[1]);\nvec3 normalWorld = normal;\nnormal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;\nNodeMaterial material;\nmetallic = clamp(metallic, 0.0, 1.0);\nfloat dielectric = 1.0 - metallic;\ntransmission *= dielectric;\nmaterial.diffuseColor = baseColor.rgb * dielectric;\n#ifndef USE_CLEARCOAT\nfloat dielReflCoeff = BLENDER_SPECULAR_COEFFICIENT;\n#else\nfloat dielReflCoeff = MAXIMUM_SPECULAR_COEFFICIENT;\nmaterial.clearcoat = saturate(clearcoat);\nmaterial.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);\nmaterial.clearcoatF0 = vec3(0.04);\nmaterial.clearcoatF90 = 1.0;\n#endif\n#ifdef USE_SHEEN\nmaterial.sheenColor = sheen * mix(vec3(0.05), baseColor.rgb, sheenTint);\nmaterial.sheenRoughness = 0.25;\n#endif\nvec3 dielRefl = dielReflCoeff * specular\n* mix(vec3(1.0), tintFromColor(baseColor.rgb), specularTint);\nmaterial.specularColor = mix(dielRefl, baseColor.rgb, metallic);\nmaterial.roughness = clamp(roughness, 0.0, 1.0);\nvec3 viewWorld;\nif (isPerspective(projectionMatrix))\nviewWorld = (invViewMatrix * vec4(-vViewPosition, 0.0)).xyz;\nelse\nviewWorld = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\nviewWorld = normalize(viewWorld);\nfloat fresnel = fresnelReflection(viewWorld, normalWorld, ior);\nvec3 fresnelColor = mix(vec3(1.0), baseColor.rgb, specularTint);\nmaterial.specularColor = mix(material.specularColor,\nfresnelBlend(ior, fresnel, fresnelColor) * fresnel, transmission);\nfloat isStrictDielectric = step(0.0, -length(vec4(subsurface, clearcoat,\ntransmission, float(metallic == 1.0))));\nmaterial.fresnelRefl90 = mix(vec3(1.0), material.specularColor,\n(1.0 - specular) * metallic * (1.0 - isStrictDielectric));\nmaterial.specularF90 = average(material.fresnelRefl90);\nmaterial.refractionColor = baseColor.rgb;\nmaterial.refractionIOR = ior;\nmaterial.refractionRoughness = pow2(roughness);\n#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat geomRoughness = calcGeometryRoughness(geometryNormal);\nmaterial.roughness = calcCubeUVAdjustedRoughness(\nmaterial.roughness, geomRoughness);\nmaterial.refractionRoughness = calcCubeUVAdjustedRoughness(\nmaterial.refractionRoughness, geomRoughness);\n#ifdef USE_CLEARCOAT\nmaterial.clearcoatRoughness = calcCubeUVAdjustedRoughness(\nmaterial.clearcoatRoughness, geomRoughness);\nclearcoatNormal = normalize(vec3(clearcoatNormal[0], clearcoatNormal[2], -clearcoatNormal[1]));\nclearcoatNormal = (viewMatrix * vec4(clearcoatNormal.xyz, 0.0)).xyz;\n#endif\n#endif\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 refractedLight = vec3(0.0);\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#define RE_Refraction RE_Refraction_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#undef RE_Refraction\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef USE_GTAO\nreflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;\nfloat gtaoVisibility = gtaoVisibilityBentNormal.r;\nvec3 gtaoBentNormal = bentNormal;\nvec3 gtaoViewDir = geometry.viewDir;\nvec3 gtaoNormal = normal;\nfloat gtaoRoughness = material.roughness;\n#endif\n#include <lights_fragment_gtso>\nvec3 outColor3 = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * (1.0 - transmission)\n+ reflectedLight.directSpecular + reflectedLight.indirectSpecular\n+ refractedLight * transmission * (1.0 - fresnel)\n+ emission.rgb * emissionStrength;\n#ifdef USE_SHEEN\nfloat sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);\noutColor3 = outColor3 * sheenEnergyComp + sheenSpecular;\n#endif\n#ifdef USE_CLEARCOAT\nfloat dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));\nvec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);\noutColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;\n#endif\noutColor = vec4(outColor3, alpha);\n}\nvoid node_bsdf_principled(\nvec3 geometryNormal,\nvec4 baseColor, float subsurface, vec3 subsurfaceRadius, vec4 subsurfaceColor,\nfloat metallic, float specular, float specularTint, float roughness,\nfloat anisotropic, float anisotropicRotation, float sheen, float sheenTint,\nfloat clearcoat, float clearcoatRoughness, float ior,\nfloat transmission, float transmissionRoughness, vec4 emission, float alpha,\nvec3 normal, vec3 clearcoatNormal, vec3 tangent,\nout vec4 outColor) {\nnode_bsdf_principled(geometryNormal, baseColor, subsurface, subsurfaceRadius,\nsubsurfaceColor, 0.0, 0.0, metallic, specular, specularTint, roughness,\nanisotropic, anisotropicRotation, sheen, sheenTint, clearcoat,\nclearcoatRoughness, ior, transmission, transmissionRoughness,\nemission, 1.0, alpha, normal, clearcoatNormal, tangent, outColor);\n}\nvoid node_bsdf_principled(\nvec3 geometryNormal,\nvec4 baseColor, float subsurface, vec3 subsurfaceRadius, vec4 subsurfaceColor,\nfloat metallic, float specular, float specularTint, float roughness,\nfloat anisotropic, float anisotropicRotation, float sheen, float sheenTint,\nfloat clearcoat, float clearcoatRoughness, float ior,\nfloat transmission, float transmissionRoughness, vec4 emission,\nfloat emissionStrength, float alpha, vec3 normal, vec3 clearcoatNormal,\nvec3 tangent,\nout vec4 outColor) {\nnode_bsdf_principled(geometryNormal, baseColor, subsurface, subsurfaceRadius,\nsubsurfaceColor, 0.0, 0.0, metallic, specular, specularTint, roughness,\nanisotropic, anisotropicRotation, sheen, sheenTint, clearcoat,\nclearcoatRoughness, ior, transmission, transmissionRoughness,\nemission, emissionStrength, alpha, normal, clearcoatNormal, tangent, outColor);\n}",node_bsdf_refraction_bl_frag:"#define BSDF_REFRACTION_GGX 0\n#define BSDF_REFRACTION_BECKMANN 1\n#define BSDF_REFRACTION_SHARP 2\nvoid node_bsdf_refraction(\nvec3 geometryNormal, const int distribution,\nvec4 color, float roughness, float ior, vec3 normal,\nout vec4 outColor) {\nnormal = swizzleUpY(normal);\nnormal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;\nNodeMaterial material;\nmaterial.refractionColor = color.rgb;\nmaterial.refractionIOR = ior;\nif (distribution == BSDF_REFRACTION_SHARP) {\nmaterial.refractionRoughness = 0.0;\n} else {\nmaterial.refractionRoughness = pow2(roughness);\n}\n#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat geomRoughness = calcGeometryRoughness(geometryNormal);\nmaterial.refractionRoughness = calcCubeUVAdjustedRoughness(\nmaterial.refractionRoughness, geomRoughness);\n#endif\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 refractedLight = vec3(0.0);\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\n#define RE_Refraction RE_Refraction_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_Refraction\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\noutColor = vec4(refractedLight, 1.0);\n}",node_bsdf_toon_bl_frag:"void node_bsdf_toon(\nvec4 color, float size, float smoothFac, vec3 normal,\nout vec4 outColor)\n{\noutColor = color;\n}",node_bsdf_translucent_bl_frag:"void node_bsdf_translucent(vec4 color, vec3 normal, out vec4 outColor) {\nnormal = -vec3(normal[0], normal[2], -normal[1]);\nnormal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;\nNodeMaterial material;\nmaterial.diffuseColor = color.rgb;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_IndirectDiffuse\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, 1.0);\n}",node_bsdf_transparent_bl_frag:"\nvoid node_bsdf_transparent(vec4 color, out vec4 outColor)\n{\nfloat alpha = saturate(1.0 - dot(color.rgb, vec3(0.333333)));\noutColor = vec4(0.0, 0.0, 0.0, alpha);\n}",node_bsdf_velvet_bl_frag:"void node_bsdf_velvet(vec4 color, float sigma, vec3 normal, out vec4 outColor)\n{\noutColor = color;\n}",node_bump_bl_frag:"\nvoid node_bump(\nconst bool invert,\nfloat strength, float bumpDist, float height, float height_dx,\nfloat height_dy, vec3 normal,\nout vec3 outNormal) {\nvec3 position = swizzleUpZ(vWorldPosition);\nif (invert)\nbumpDist *= -1.0;\nvec3 dPdx = dFdx(position);\nvec3 dPdy = dFdy(position);\nfloat dHdx = dFdx(height);\nfloat dHdy = dFdy(height);\nvec3 tanX = cross(dPdy, normal);\nvec3 tanY = cross(normal, dPdx);\nvec3 surfaceGrad = dHdx * tanX + dHdy * tanY;\nfloat dotPosTanX = dot(dPdx, tanX);\noutNormal = normalize(normal * abs(dotPosTanX) - surfaceGrad * bumpDist * sign(dotPosTanX));\noutNormal = normalize(mix(normal, outNormal, max(0.0, strength)));\n}\nvoid node_bump(\nconst bool invert,\nfloat strength, float bumpDist, float height, vec3 normal,\nout vec3 outNormal) {\nnode_bump(invert, strength, bumpDist, height, 0.0, 0.0, normal, outNormal);\n}",node_camera_bl_frag:"\nvoid node_camera(\nvec3 viewPos, const bool invCamZ,\nout vec3 outViewVector, out float outViewZDepth, out float outViewDistance)\n{\nviewPos = -viewPos;\nif (invCamZ)\nviewPos.z = -viewPos.z;\noutViewVector = normalize(viewPos);\noutViewZDepth = abs(viewPos.z);\noutViewDistance = length(viewPos);\n}",node_clamp_bl_frag:"void node_clamp(float value, float minVal, float maxVal, out float result) {\nresult = max(min(value, maxVal), minVal);\n}",node_combhsv_bl_frag:"\nvoid node_combhsv(float h, float s, float v, out vec4 col)\n{\nhsvToRGB(vec4(h, s, v, 1.0), col);\n}",node_combrgb_bl_frag:"\nvoid node_combrgb(float r, float g, float b, out vec4 col)\n{\ncol = vec4(r, g, b, 1.0);\n}",node_combxyz_bl_frag:"void node_combxyz(float x, float y, float z, out vec3 outVector)\n{\noutVector = vec3(x, y, z);\n}",node_curve_rgb_bl_frag:"\nvoid node_curve_rgb(sampler2D curveData, float fac, vec4 col, out vec4 outCol)\n{\noutCol.r = texture2D(curveData, vec2(texture2D(curveData, vec2(col.r, 0.0)).a, 0.0)).r;\noutCol.g = texture2D(curveData, vec2(texture2D(curveData, vec2(col.g, 0.0)).a, 0.0)).g;\noutCol.b = texture2D(curveData, vec2(texture2D(curveData, vec2(col.b, 0.0)).a, 0.0)).b;\noutCol = mix(col, outCol, fac);\noutCol.a = col.a;\n}",node_curve_vec_bl_frag:"\nvoid node_curve_vec(sampler2D curveData, float fac, vec3 vec, out vec3 outVec)\n{\noutVec.x = texture2D(curveData, vec2((vec.x + 1.0) * 0.5, 0.0)).x;\noutVec.y = texture2D(curveData, vec2((vec.y + 1.0) * 0.5, 0.0)).y;\noutVec.z = texture2D(curveData, vec2((vec.z + 1.0) * 0.5, 0.0)).z;\noutVec = mix(vec, outVec * 2.0 - vec3(1.0), fac);\n}",node_displacement_bl_frag:"void node_displacement(float height, float midlevel, float scale, vec3 normal, out vec3 outDisplacement) {\noutDisplacement = vec3(0.0);\n}",node_eevee_specular_bl_frag:"void node_eevee_specular(\nvec3 geometryNormal,\nvec4 baseColor, vec4 specular, float roughness, vec4 emissiveColor,\nfloat transparency, vec3 normal, float clearcoat, float clearcoatRoughness,\nvec3 clearcoatNormal, float ambientOcclusion,\nout vec4 outColor) {\nnormal = vec3(normal[0], normal[2], -normal[1]);\nvec3 normalWorld = normal;\nnormal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;\nNodeMaterial material;\nmaterial.diffuseColor = baseColor.rgb;\nmaterial.specularColor = specular.rgb;\nmaterial.roughness = clamp(roughness, 0.0, 1.0);\n#ifdef USE_CLEARCOAT\nmaterial.clearcoat = saturate(clearcoat);\nmaterial.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);\n#endif\n#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat geomRoughness = calcGeometryRoughness(geometryNormal);\nmaterial.roughness = calcCubeUVAdjustedRoughness(\nmaterial.roughness, geomRoughness);\n#ifdef USE_CLEARCOAT\nmaterial.clearcoatRoughness = calcCubeUVAdjustedRoughness(\nmaterial.clearcoatRoughness, geomRoughness);\nclearcoatNormal = normalize(vec3(clearcoatNormal[0], clearcoatNormal[2], -clearcoatNormal[1]));\nclearcoatNormal = (viewMatrix * vec4(clearcoatNormal.xyz, 0.0)).xyz;\n#endif\n#endif\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef USE_GTAO\nreflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;\nfloat gtaoVisibility = gtaoVisibilityBentNormal.r;\nvec3 gtaoBentNormal = bentNormal;\nvec3 gtaoViewDir = geometry.viewDir;\nvec3 gtaoNormal = normal;\nfloat gtaoRoughness = material.roughness;\n#endif\n#include <lights_fragment_gtso>\nvec3 outColor3 = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse\n+ reflectedLight.directSpecular + reflectedLight.indirectSpecular) * ambientOcclusion\n+ emissiveColor.rgb;\noutColor = vec4(outColor3, 1.0 - transparency);\n}",node_emission_bl_frag:"\nvoid node_emission(vec4 color, float strength, out vec4 outColor)\n{\noutColor = vec4(strength * color.rgb, 1.0);\n}",node_fresnel_bl_frag:"void node_fresnel(vec3 viewPos, float IOR, vec3 normal, out float fac)\n{\nvec3 worldDir;\nif (isPerspective(projectionMatrix))\nworldDir = (invViewMatrix * vec4(-viewPos, 0.0)).xyz;\nelse\nworldDir = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\n\nworldDir = normalize(swizzleUpZ(worldDir));\nfloat eta = max(IOR, 0.00001);\nfac = fresnelReflection(worldDir, normal, (gl_FrontFacing) ? eta : 1.0 / eta);\n}",node_gamma_bl_frag:"\nvoid node_gamma(vec4 col, float gamma, out vec4 outCol)\n{\noutCol = col;\nif (col.r > 0.0)\noutCol.r = powCompat(col.r, gamma);\nif (col.g > 0.0)\noutCol.g = powCompat(col.g, gamma);\nif (col.b > 0.0)\noutCol.b = powCompat(col.b, gamma);\n}",node_hair_info_bl_frag:"void node_hair_info(out float isStrand, out float intercept, out float thickness,\nout vec3 tangentNormal, out float random) {\nisStrand = 0.0;\nintercept = 0.0;\nthickness = 0.0;\ntangentNormal = vec3(0.0);\nrandom = 0.0;\n}",node_holdout_bl_frag:"void node_holdout(out vec4 outColor)\n{\noutColor = vec4(0.0);\n}",node_hue_sat_bl_frag:"\nvoid node_hue_sat(float hue, float sat, float value, float fac, vec4 col, out vec4 outCol)\n{\nvec4 hsv;\nrgbToHSV(col, hsv);\nhsv[0] += (fract(hue) - 0.5);\nif (hsv[0] > 1.0) hsv[0] -= 1.0; else if (hsv[0] < 0.0) hsv[0] += 1.0;\nhsv[1] *= sat;\nif (hsv[1] > 1.0) hsv[1] = 1.0; else if (hsv[1] < 0.0) hsv[1] = 0.0;\nhsv[2] *= value;\nhsvToRGB(hsv, outCol);\noutCol = mix(col, outCol, fac);\n}",node_invert_bl_frag:"\nvoid node_invert(float fac, vec4 col, out vec4 outCol)\n{\noutCol.xyz = mix(col.xyz, vec3(1.0, 1.0, 1.0) - col.xyz, fac);\noutCol.w = col.w;\n}",node_layer_weight_bl_frag:"\nvoid node_layer_weight(vec3 viewPos, float blend, vec3 normal, out float fresnel, out float facing)\n{\nvec3 worldDir;\nif (isPerspective(projectionMatrix))\nworldDir = (invViewMatrix * vec4(-viewPos, 0.0)).xyz;\nelse\nworldDir = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\n\nworldDir = normalize(swizzleUpZ(worldDir));\nfloat eta = max(1.0 - blend, EPSILON);\nfresnel = fresnelReflection(worldDir, normal, (gl_FrontFacing) ? 1.0 / eta : eta);\nfacing = abs(dot(worldDir, normal));\nif (blend != 0.5) {\nblend = clamp(blend, 0.0, 1.0 - EPSILON);\nblend = (blend < 0.5) ? blend * 2.0 : 0.5 / (1.0 - blend);\nfacing = pow(facing, blend);\n}\nfacing = 1.0 - facing;\n}",node_light_falloff_bl_frag:"void node_light_falloff(\nfloat strength, float inSmooth,\nout float quadratic, out float linear, out float constant)\n{\nquadratic = 1.0;\nlinear = 1.0;\nconstant = 1.0;\n}",node_light_path_bl_frag:"void node_light_path(\nout float isCameraRay, out float isShadowRay, out float isDiffuseRay, \nout float isGlossyRay, out float isSingularRay, out float isReflectionRay,\nout float isTransmissionRay, out float rayLength, out float rayDepth, \nout float diffuseDepth, out float glossyDepth, out float transparentDepth, \nout float transmissionDepth)\n{\n#if LIGHT_PATH_IS_CAM_RAY\nisCameraRay = 1.0;\n#else\nisCameraRay = 0.0;\n#endif\nisShadowRay = 0.0;\nisDiffuseRay = 0.0;\nisGlossyRay = 0.0;\nisSingularRay = 0.0;\nisReflectionRay = 0.0;\nisTransmissionRay = 0.0;\nrayLength = 1.0;\nrayDepth = 1.0;\ndiffuseDepth = 1.0;\nglossyDepth = 1.0;\ntransparentDepth = 1.0; \ntransmissionDepth = 1.0;\n}",node_mapping_bl_frag:"\nvoid node_mapping(mat4 mat, vec3 minVec, vec3 maxVec, bool useMin, bool useMax, vec3 vec, out vec3 outVec)\n{\noutVec = (mat * vec4(vec, 1.0)).xyz;\nif (useMin)\noutVec = max(outVec, minVec);\nif (useMax)\noutVec = min(outVec, maxVec);\n}\nmat3 rotationMatrix(float angleX, float angleY, float angleZ) {\nfloat cx = cos(angleX);\nfloat sx = sin(angleX);\nfloat cy = cos(angleY);\nfloat sy = sin(angleY);\nfloat cz = cos(angleZ);\nfloat sz = sin(angleZ);\nmat3 mat;\nmat[0][0] = cy * cz;\nmat[0][1] = cy * sz;\nmat[0][2] = -sy;\nmat[1][0] = sy * sx * cz - cx * sz;\nmat[1][1] = sy * sx * sz + cx * cz;\nmat[1][2] = cy * sx;\nmat[2][0] = sy * cx * cz + sx * sz;\nmat[2][1] = sy * cx * sz - sx * cz;\nmat[2][2] = cy * cx;\nreturn mat;\n}\n#define NODE_MAPPING_POINT 1\n#define NODE_MAPPING_TEXTURE 2\n#define NODE_MAPPING_VECTOR 3\n#define NODE_MAPPING_NORMAL 4\nvoid node_mapping(int type, vec3 vec, vec3 loc, vec3 rot, vec3 scale, out vec3 outVec)\n{\nif (type == NODE_MAPPING_POINT)\noutVec = rotationMatrix(rot.x, rot.y, rot.z) * (vec * scale) + loc;\nelse if (type == NODE_MAPPING_TEXTURE)\noutVec = transposeMat3(rotationMatrix(rot.x, rot.y, rot.z)) * (vec - loc) / scale;\nelse if (type == NODE_MAPPING_VECTOR)\noutVec = rotationMatrix(rot.x, rot.y, rot.z) * (vec * scale);\nelse {\nmat3 rot = rotationMatrix(rot.x, rot.y, rot.z) * mat3(\nscale[0], 0.0, 0.0,\n0.0, scale[1], 0.0,\n0.0, 0.0, scale[2]\n);\noutVec = normalize(mat3GetInverseTransposed(rot) * vec);\n}\n}",node_map_range_bl_frag:"#define NODE_MAP_RANGE_INTERP_LINEAR 0\n#define NODE_MAP_RANGE_INTERP_STEPPED 1\n#define NODE_MAP_RANGE_INTERP_SMOOTHSTEP 2\n#define NODE_MAP_RANGE_INTERP_SMOOTHERSTEP 3\nvoid node_map_range(const int interpolation, bool inClamp, float value, float fromMin, float fromMax,\nfloat toMin, float toMax, float steps, out float result) {\nif (fromMax == fromMin) {\nresult = 0.0;\n} else if (interpolation == NODE_MAP_RANGE_INTERP_LINEAR) {\nresult = (value - fromMin) / (fromMax - fromMin) * (toMax - toMin) + toMin;\n} else if (interpolation == NODE_MAP_RANGE_INTERP_STEPPED) {\nfloat fac = (value - fromMin) / (fromMax - fromMin);\nfac = (steps > 0.0) ? floor(fac * (steps + 1.0)) / steps : 0.0;\nresult = fac * (toMax - toMin) + toMin;\n} else if (interpolation == NODE_MAP_RANGE_INTERP_SMOOTHSTEP) {\nfloat fac = (fromMin > fromMax) ?\n1.0 - smoothstep(fromMax, fromMin, value) :\nsmoothstep(fromMin, fromMax, value);\nresult = fac * (toMax - toMin) + toMin;\n} else {\nfloat fac = (fromMin > fromMax) ?\n1.0 - smootherstep(fromMax, fromMin, value) :\nsmootherstep(fromMin, fromMax, value);\nresult = fac * (toMax - toMin) + toMin;\n}\nif (inClamp && interpolation <= NODE_MAP_RANGE_INTERP_STEPPED) {\nresult = clamp(result, toMin, toMax);\n}\n}\nvoid node_map_range(const int interpolation, bool inClamp, float value,\nfloat fromMin, float fromMax, float toMin, float toMax, out float result) {\nnode_map_range(NODE_MAP_RANGE_INTERP_LINEAR, inClamp, value, fromMin,\nfromMax, toMin, toMax, 0.0, result);\n}",node_math_bl_frag:"\nvoid node_math_add(float val1, float val2, float val3, out float outVal)\n{\noutVal = val1 + val2;\n}\nvoid node_math_subtract(float val1, float val2, float val3, out float outVal)\n{\noutVal = val1 - val2;\n}\nvoid node_math_multiply(float val1, float val2, float val3, out float outVal)\n{\noutVal = val1 * val2;\n}\nvoid node_math_divide(float val1, float val2, float val3, out float outVal)\n{\nif (val2 == 0.0)\noutVal = 0.0;\nelse\noutVal = val1 / val2;\n}\nvoid node_math_sine(float val, float val2, float val3, out float outVal)\n{\noutVal = sin(val);\n}\nvoid node_math_cosine(float val, float val2, float val3, out float outVal)\n{\noutVal = cos(val);\n}\nvoid node_math_tangent(float val, float val2, float val3, out float outVal)\n{\noutVal = tan(val);\n}\nvoid node_math_arcsine(float val, float val2, float val3, out float outVal)\n{\nif (val <= 1.0 && val >= -1.0)\noutVal = asin(val);\nelse\noutVal = 0.0;\n}\nvoid node_math_arccosine(float val, float val2, float val3, out float outVal)\n{\nif (val <= 1.0 && val >= -1.0)\noutVal = acos(val);\nelse\noutVal = 0.0;\n}\nvoid node_math_arctangent(float val, float val2, float val3, out float outVal)\n{\noutVal = atan(val);\n}\nvoid node_math_arctan2(float val, float val2, float val3, out float outVal)\n{\noutVal = atan(val, val2);\n}\nvoid node_math_power(float val1, float val2, float val3, out float outVal)\n{\nif (val1 >= 0.0)\noutVal = powCompat(val1, val2);\nelse {\nfloat val2_mod_1 = mod(abs(val2), 1.0);\nif (val2_mod_1 > 0.999 || val2_mod_1 < 0.001)\noutVal = powCompat(val1, floor(val2 + 0.5));\nelse\noutVal = 0.0;\n}\n}\nvoid node_math_logarithm(float val1, float val2, float val3, out float outVal)\n{\nif (val1 > 0.0 && val2 > 0.0)\noutVal = log2(val1) / log2(val2);\nelse\noutVal = 0.0;\n}\nvoid node_math_sqrt(float val1, float val2, float val3, out float outVal)\n{\noutVal = sqrt(val1);\n}\nvoid node_math_maximum(float val1, float val2, float val3, out float outVal)\n{\noutVal = max(val1, val2);\n}\nvoid node_math_minimum(float val1, float val2, float val3, out float outVal)\n{\noutVal = min(val1, val2);\n}\nvoid node_math_round(float val1, float val2, float val3, out float outVal)\n{\noutVal = floor(val1 + 0.5);\n}\nvoid node_math_floor(float val1, float val2, float val3, out float outVal)\n{\noutVal = floor(val1);\n}\nvoid node_math_ceil(float val1, float val2, float val3, out float outVal)\n{\noutVal = ceil(val1);\n}\nvoid node_math_fract(float val1, float val2, float val3, out float outVal)\n{\noutVal = fract(val1);\n}\nvoid node_math_less_than(float val1, float val2, float val3, out float outVal)\n{\nif (val1 < val2)\noutVal = 1.0;\nelse\noutVal = 0.0;\n}\nvoid node_math_greater_than(float val1, float val2, float val3, out float outVal)\n{\nif (val1 > val2)\noutVal = 1.0;\nelse\noutVal = 0.0;\n}\nvoid node_math_modulo(float val1, float val2, float val3, out float outVal)\n{\nif (val2 == 0.0)\noutVal = 0.0;\nelse\noutVal = mod(val1, val2);\noutVal = (val1 > 0.0) ? outVal : outVal - val2;\n}\nvoid node_math_absolute(float val1, float val2, float val3, out float outVal)\n{\noutVal = abs(val1);\n}\nvoid node_math_compare(float val1, float val2, float val3, out float outVal) {\noutVal = step(abs(val1 - val2), val3);\n}\nvoid node_math_cosh(float val1, float val2, float val3, out float outVal) {\noutVal = cosh(val1);\n}\nvoid node_math_degrees(float val1, float val2, float val3, out float outVal) {\noutVal = val1 / PI * 180.0;\n}\nvoid node_math_exponent(float val1, float val2, float val3, out float outVal) {\noutVal = exp(val1);\n}\nvoid node_math_inverse_sqrt(float val1, float val2, float val3, out float outVal) {\nif (val1 >= 0.0) {\noutVal = 1.0 / sqrt(val1);\n} else {\noutVal = 0.0;\n}\n}\nvoid node_math_multiply_add(float val1, float val2, float val3, out float outVal) {\noutVal = val1 * val2 + val3;\n}\nvoid node_math_pingpong(float val1, float val2, float val3, out float outVal) {\nif (val2 == 0.0) {\noutVal = 0.0;\n} else {\nfloat absVal2 = abs(val2);\nfloat rem = mod(val1, absVal2);\noutVal = mix(rem, absVal2 - rem, mod(floor(val1 / absVal2), 2.0));\n}\n}\nvoid node_math_radians(float val1, float val2, float val3, out float outVal) {\noutVal = val1 / 180.0 * PI;\n}\nvoid node_math_sign(float val1, float val2, float val3, out float outVal) {\noutVal = sign(val1);\n}\nvoid node_math_sinh(float val1, float val2, float val3, out float outVal) {\noutVal = sinh(val1);\n}\nvoid node_math_smooth_max(float val1, float val2, float val3, out float outVal) {\noutVal = smoothMax(val1, val2, val3);\n}\nvoid node_math_smooth_min(float val1, float val2, float val3, out float outVal) {\noutVal = smoothMin(val1, val2, val3);\n}\nvoid node_math_snap(float val1, float val2, float val3, out float outVal) {\nval1 += 1e-5 * sign(val2);\nfloat quot = val1 / val2;\noutVal = floor(quot) * val2;\n}\nvoid node_math_tanh(float val1, float val2, float val3, out float outVal) {\noutVal = tanh(val1);\n}\nvoid node_math_trunc(float val1, float val2, float val3, out float outVal) {\nval1 += 1e-5;\noutVal = trunc(val1);\n}\nvoid node_math_wrap(float val1, float val2, float val3, out float outVal) {\nval1 += 1e-5;\noutVal = mod(val1 - val3, val2 - val3) + val3;\n}\nvoid node_math_add(float val1, float val2, out float outVal) {\nnode_math_add(val1, val2, 0.0, outVal);\n}\nvoid node_math_subtract(float val1, float val2, out float outVal) {\nnode_math_subtract(val1, val2, 0.0, outVal);\n}\nvoid node_math_multiply(float val1, float val2, out float outVal) {\nnode_math_multiply(val1, val2, 0.0, outVal);\n}\nvoid node_math_divide(float val1, float val2, out float outVal) {\nnode_math_divide(val1, val2, 0.0, outVal);\n}\nvoid node_math_sine(float val1, float val2, out float outVal) {\nnode_math_sine(val1, val2, 0.0, outVal);\n}\nvoid node_math_cosine(float val1, float val2, out float outVal) {\nnode_math_cosine(val1, val2, 0.0, outVal);\n}\nvoid node_math_tangent(float val1, float val2, out float outVal) {\nnode_math_tangent(val1, val2, 0.0, outVal);\n}\nvoid node_math_arcsine(float val1, float val2, out float outVal) {\nnode_math_arcsine(val1, val2, 0.0, outVal);\n}\nvoid node_math_arccosine(float val1, float val2, out float outVal) {\nnode_math_arccosine(val1, val2, 0.0, outVal);\n}\nvoid node_math_arctangent(float val1, float val2, out float outVal) {\nnode_math_arctangent(val1, val2, 0.0, outVal);\n}\nvoid node_math_arctan2(float val1, float val2, out float outVal) {\nnode_math_arctan2(val1, val2, 0.0, outVal);\n}\nvoid node_math_power(float val1, float val2, out float outVal) {\nnode_math_power(val1, val2, 0.0, outVal);\n}\nvoid node_math_logarithm(float val1, float val2, out float outVal) {\nnode_math_logarithm(val1, val2, 0.0, outVal);\n}\nvoid node_math_sqrt(float val1, float val2, out float outVal) {\nnode_math_sqrt(val1, val2, 0.0, outVal);\n}\nvoid node_math_maximum(float val1, float val2, out float outVal) {\nnode_math_maximum(val1, val2, 0.0, outVal);\n}\nvoid node_math_minimum(float val1, float val2, out float outVal) {\nnode_math_minimum(val1, val2, 0.0, outVal);\n}\nvoid node_math_round(float val1, float val2, out float outVal) {\nnode_math_round(val1, val2, 0.0, outVal);\n}\nvoid node_math_floor(float val1, float val2, out float outVal) {\nnode_math_floor(val1, val2, 0.0, outVal);\n}\nvoid node_math_ceil(float val1, float val2, out float outVal) {\nnode_math_ceil(val1, val2, 0.0, outVal);\n}\nvoid node_math_fract(float val1, float val2, out float outVal) {\nnode_math_fract(val1, val2, 0.0, outVal);\n}\nvoid node_math_less_than(float val1, float val2, out float outVal) {\nnode_math_less_than(val1, val2, 0.0, outVal);\n}\nvoid node_math_greater_than(float val1, float val2, out float outVal) {\nnode_math_greater_than(val1, val2, 0.0, outVal);\n}\nvoid node_math_modulo(float val1, float val2, out float outVal) {\nnode_math_modulo(val1, val2, 0.0, outVal);\n}\nvoid node_math_absolute(float val1, float val2, out float outVal) {\nnode_math_absolute(val1, val2, 0.0, outVal);\n}",node_mix_rgb_bl_frag:"\nvoid node_mix_rgb_mix(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = mix(col1, col2, fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_add(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = mix(col1, col1 + col2, fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_multiply(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = mix(col1, col1 * col2, fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_screen(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\noutCol = vec4(1.0) - (vec4(facm) + fac * (vec4(1.0) - col2)) * (vec4(1.0) - col1);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_overlay(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\noutCol = col1;\nif (outCol.r < 0.5)\noutCol.r *= facm + 2.0 * fac * col2.r;\nelse\noutCol.r = 1.0 - (facm + 2.0 * fac * (1.0 - col2.r)) * (1.0 - outCol.r);\nif (outCol.g < 0.5)\noutCol.g *= facm + 2.0 * fac * col2.g;\nelse\noutCol.g = 1.0 - (facm + 2.0 * fac * (1.0 - col2.g)) * (1.0 - outCol.g);\nif (outCol.b < 0.5)\noutCol.b *= facm + 2.0 * fac * col2.b;\nelse\noutCol.b = 1.0 - (facm + 2.0 * fac * (1.0 - col2.b)) * (1.0 - outCol.b);\n}\nvoid node_mix_rgb_subtract(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = mix(col1, col1 - col2, fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_divide(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\noutCol = col1;\nif (col2.r != 0.0) outCol.r = facm * outCol.r + fac * outCol.r / col2.r;\nif (col2.g != 0.0) outCol.g = facm * outCol.g + fac * outCol.g / col2.g;\nif (col2.b != 0.0) outCol.b = facm * outCol.b + fac * outCol.b / col2.b;\n}\nvoid node_mix_rgb_difference(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = mix(col1, abs(col1 - col2), fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_darken(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol.rgb = min(col1.rgb, col2.rgb * fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_lighten(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol.rgb = max(col1.rgb, col2.rgb * fac);\noutCol.a = col1.a;\n}\nvoid node_mix_rgb_dodge(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = col1;\nif (outCol.r != 0.0) {\nfloat tmp = 1.0 - fac * col2.r;\nif (tmp <= 0.0)\noutCol.r = 1.0;\nelse if ((tmp = outCol.r / tmp) > 1.0)\noutCol.r = 1.0;\nelse\noutCol.r = tmp;\n}\nif (outCol.g != 0.0) {\nfloat tmp = 1.0 - fac * col2.g;\nif (tmp <= 0.0)\noutCol.g = 1.0;\nelse if ((tmp = outCol.g / tmp) > 1.0)\noutCol.g = 1.0;\nelse\noutCol.g = tmp;\n}\nif (outCol.b != 0.0) {\nfloat tmp = 1.0 - fac * col2.b;\nif (tmp <= 0.0)\noutCol.b = 1.0;\nelse if ((tmp = outCol.b / tmp) > 1.0)\noutCol.b = 1.0;\nelse\noutCol.b = tmp;\n}\n}\nvoid node_mix_rgb_burn(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat tmp, facm = 1.0 - fac;\noutCol = col1;\ntmp = facm + fac * col2.r;\nif (tmp <= 0.0)\noutCol.r = 0.0;\nelse if ((tmp = (1.0 - (1.0 - outCol.r) / tmp)) < 0.0)\noutCol.r = 0.0;\nelse if (tmp > 1.0)\noutCol.r = 1.0;\nelse\noutCol.r = tmp;\ntmp = facm + fac * col2.g;\nif (tmp <= 0.0)\noutCol.g = 0.0;\nelse if ((tmp = (1.0 - (1.0 - outCol.g) / tmp)) < 0.0)\noutCol.g = 0.0;\nelse if (tmp > 1.0)\noutCol.g = 1.0;\nelse\noutCol.g = tmp;\ntmp = facm + fac * col2.b;\nif (tmp <= 0.0)\noutCol.b = 0.0;\nelse if ((tmp = (1.0 - (1.0 - outCol.b) / tmp)) < 0.0)\noutCol.b = 0.0;\nelse if (tmp > 1.0)\noutCol.b = 1.0;\nelse\noutCol.b = tmp;\n}\n#ifdef HSV_NODES\nvoid node_mix_rgb_hue(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\noutCol = col1;\nvec4 hsv, hsv2, tmp;\nrgbToHSV(col2, hsv2);\nif (hsv2.y != 0.0) {\nrgbToHSV(outCol, hsv);\nhsv.x = hsv2.x;\nhsvToRGB(hsv, tmp);\noutCol = mix(outCol, tmp, fac);\noutCol.a = col1.a;\n}\n}\nvoid node_mix_rgb_saturation(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\noutCol = col1;\nvec4 hsv, hsv2;\nrgbToHSV(outCol, hsv);\nif (hsv.y != 0.0) {\nrgbToHSV(col2, hsv2);\nhsv.y = facm * hsv.y + fac * hsv2.y;\nhsvToRGB(hsv, outCol);\n}\n}\nvoid node_mix_rgb_value(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\nvec4 hsv, hsv2;\nrgbToHSV(col1, hsv);\nrgbToHSV(col2, hsv2);\nhsv.z = facm * hsv.z + fac * hsv2.z;\nhsvToRGB(hsv, outCol);\n}\nvoid node_mix_rgb_color(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\noutCol = col1;\nvec4 hsv, hsv2, tmp;\nrgbToHSV(col2, hsv2);\nif (hsv2.y != 0.0) {\nrgbToHSV(outCol, hsv);\nhsv.x = hsv2.x;\nhsv.y = hsv2.y;\nhsvToRGB(hsv, tmp);\noutCol = mix(outCol, tmp, fac);\noutCol.a = col1.a;\n}\n}\n#endif\nvoid node_mix_rgb_soft_light(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\nfloat facm = 1.0 - fac;\nvec4 one = vec4(1.0);\nvec4 scr = one - (one - col2) * (one - col1);\noutCol = facm * col1 + fac * ((one - col1) * col2 * col1 + col1 * scr);\n}\nvoid node_mix_rgb_linear_light(float fac, vec4 col1, vec4 col2, out vec4 outCol)\n{\nfac = clamp(fac, 0.0, 1.0);\noutCol = col1 + fac * (2.0 * (col2 - vec4(0.5)));\n}",node_mix_shader_bl_frag:"\nvoid node_mix_shader(int transpShaderNum,\nfloat fac, vec4 color1, vec4 color2, out vec4 outColor)\n{\nif (transpShaderNum == 0)\ncolor1.rgb = color2.rgb;\nelse if (transpShaderNum == 1)\ncolor2.rgb = color1.rgb;\noutColor = mix(color1, color2, fac);\n}",node_new_geometry_bl_frag:"void node_new_geometry(\nbool frontFacing, vec3 viewPos, vec3 viewNorm,\nout vec3 position, out vec3 normal, out vec3 tangent,\nout vec3 trueNormal, out vec3 incoming, out vec3 parametric,\nout float backfacing, out float pointiness, out float randomPerIsland)\n{\nvec4 posWorld = invViewMatrix * vec4(-viewPos, 1.0);\nposition = swizzleUpZ(posWorld.xyz);\nvec4 viewDir = isOrtho(projectionMatrix) ? vec4(0.0, 0.0, -1.0, 0.0) : vec4(normalize(-viewPos), 0.0);\nviewDir = invViewMatrix * viewDir;\nvec3 incomingVec = -swizzleUpZ(viewDir.xyz);\n#if WORLD_NODES == 1\nnormal = incomingVec;\ntangent = vec3(0.0);\n#else\nvec3 norWorld = normalize(invViewMatrix * vec4(viewNorm, 0.0)).xyz;\nnormal = swizzleUpZ(norWorld);\nvec4 posLocal = invModelMatrix * posWorld;\nvec3 posLocalDelta = posLocal.xyz - boundingBoxMin;\nvec3 bbDelta = boundingBoxMax - boundingBoxMin;\nvec3 posOrco = vec3(\nbbDelta.x < 1e-5 ? -sign(posLocal.y) : posLocalDelta.x / bbDelta.x,\n0.0,\nbbDelta.z < 1e-5 ? sign(posLocal.y) : posLocalDelta.z / bbDelta.z\n);\nposOrco -= 0.5;\nvec3 tangWorld = (modelMatrix * vec4(posOrco.z, 0.0, -posOrco.x, 0.0)).xyz;\ntangWorld = cross(norWorld, normalize(cross(tangWorld, norWorld)));\ntangent = swizzleUpZ(tangWorld);\n#endif\ntrueNormal = normal;\nincoming = incomingVec;\nparametric = vec3(0.0);\nbackfacing = (frontFacing) ? 0.0 : 1.0;\n#if WORLD_NODES == 1\npointiness = 0.0;\n#else\npointiness = 0.5;\n#endif\nrandomPerIsland = 0.0;\n}\nvoid node_new_geometry(\nbool frontFacing, vec3 viewPos, vec3 viewNorm,\nout vec3 position, out vec3 normal, out vec3 tangent,\nout vec3 trueNormal, out vec3 incoming, out vec3 parametric,\nout float backfacing, out float pointiness) {\nfloat randomPerIsland;\nnode_new_geometry(frontFacing, viewPos, viewNorm, position, normal, tangent,\ntrueNormal, incoming, parametric, backfacing, pointiness, randomPerIsland);\n}",node_normal_bl_frag:"\nvoid node_normal(vec3 norParam, vec3 norIn, out vec3 norOut, out float dotOut)\n{\nnorOut = norParam;\ndotOut = dot(normalize(norIn), norParam);\n}",node_normal_map_bl_frag:"\nvoid node_normal_map(vec4 tangent, vec3 normal, float strength, vec4 normalColor, out vec3 normalOut)\n{\n#ifdef DOUBLE_SIDED\nnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n#endif\nvec3 normalTex = (normalColor.xyz * 2.0 - 1.0);\nvec4 viewTangent = vec4(normalize((modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz), tangent.w);\nvec3 bitangent = viewTangent.w * cross(normal, viewTangent.xyz);\nnormalOut = normalize(normalTex.x * viewTangent.xyz + normalTex.y * bitangent \n+ normalTex.z * normal);\nnormalOut = mix(normal, normalOut, strength);\nnormalOut = normalize((invViewMatrix * vec4(normalOut, 0.0)).xyz);\nnormalOut = swizzleUpZ(normalOut);\n}",node_object_info_bl_frag:"uniform int objectIndex;\nuniform vec3 objectColor;\nuniform int materialIndex;\nuniform float objectRandom;\nvoid node_object_info(out vec3 location, out vec4 color, out float objIndex,\nout float matIndex, out float random) {\n#if WORLD_NODES == 1\nlocation = vec3(0.0);\ncolor = vec4(1.0);\nobjIndex = 0.0;\nmatIndex = 0.0;\nrandom = 0.0;\n#else\nlocation = swizzleUpZ(modelMatrix[3].xyz);\ncolor = vec4(objectColor, 1.0);\nobjIndex = float(objectIndex);\nmatIndex = float(materialIndex);\nrandom = float(objectRandom);\n#endif\n}\nvoid node_object_info(out vec3 location, out float objIndex, out float matIndex, out float random) {\n#if WORLD_NODES == 1\nlocation = vec3(0.0);\nobjIndex = 0.0;\nmatIndex = 0.0;\nrandom = 0.0;\n#else\nlocation = vec3(0.0);\nobjIndex = 0.0;\nmatIndex = 0.0;\nrandom = 0.5;\n#endif\n}",node_output_lamp_bl_frag:"void node_output_lamp(out vec4 outColor)\n{\noutColor = vec4(0.0);\n}",node_output_material_bl_frag:"void node_output_material(vec4 surface, vec4 volume, vec3 displacement, out vec4 outgoingLight) {\noutgoingLight = surface + volume;\n}",node_output_world_bl_frag:"void node_output_world(vec4 surface, vec4 volume, out vec4 outgoingLight)\n{\noutgoingLight = surface;\n}",node_particle_info_bl_frag:"\nvoid node_particle_info(out float index, out float random, out float age,\nout float lifeTime, out vec3 location, out float size, out vec3 velocity,\nout vec3 angularVelocity) {\n#if WORLD_NODES == 1\nindex = 0.0;\nrandom = 0.0;\nage = 0.0;\nlifeTime = 0.0;\nlocation = vec3(0.0);\nsize = 0.0;\nvelocity = vec3(0.0);\nangularVelocity = vec3(0.0);\n#else\nindex = 0.0;\nrandom = 0.0;\nage = 0.0;\nlifeTime = 0.0;\nlocation = vec3(0.0);\nsize = 0.0;\nvelocity = vec3(0.0);\nangularVelocity = vec3(0.0);\n#endif\n}",node_principled_volume_bl_frag:"void node_principled_volume(vec4 color, float colorAttribute, float density,\nfloat densityAttribute, float anisotropy, vec4 absorptionColor,\nfloat emissionStrength, vec4 emissionColor, float blackbodyIntensity,\nvec4 blackbodyTint, float temperature, float temperatureAttribute,\nout vec4 volume) {\nvolume = vec4(0.0);\n}",node_rgb_bl_frag:"\nuniform vec4 nodeRGB[NODE_RGB_NUM];\nvoid node_rgb(vec4 color, out vec4 outColor)\n{\noutColor = color;\n}",node_rgbtobw_bl_frag:"\nvoid node_rgbtobw(vec4 color, out float outVal) {\noutVal = linearToRelativeLuminance(color.rgb);\n}",node_script_bl_frag:"void node_script(out vec4 outColor)\n{\noutColor = vec4(0.0);\n}",node_sephsv_bl_frag:"\nvoid node_sephsv(vec4 col, out float h, out float s, out float v)\n{\nvec4 hsv;\nrgbToHSV(col, hsv);\nh = hsv[0];\ns = hsv[1];\nv = hsv[2];\n}",node_seprgb_bl_frag:"\nvoid node_seprgb(vec4 col, out float r, out float g, out float b)\n{\nr = col.r;\ng = col.g;\nb = col.b;\n}",node_sepxyz_bl_frag:"void node_sepxyz(vec3 vector, out float x, out float y, out float z)\n{\nx = vector.x;\ny = vector.y;\nz = vector.z;\n}",node_shadertorgb_bl_frag:"void node_shadertorgb(vec4 shader, out vec4 color, out float alpha) {\ncolor = vec4(shader.rgb, 1.0);\nalpha = shader.a;\n}",node_squeeze_bl_frag:"\nvoid node_squeeze(float val, float width, float center, out float outVal)\n{\noutVal = 1.0 / (1.0 + pow(2.71828183, -((val - center) * width)));\n}",node_subsurface_scattering_bl_frag:"void node_subsurface_scattering(\nvec4 color, float scale, vec3 radius, float sharpen, float textureBlur, vec3 normal,\nout vec4 outColor)\n{\noutColor = color;\n}",node_tangent_bl_frag:"#define TANGENT_AXIS_X 0\n#define TANGENT_AXIS_Y 1\n#define TANGENT_AXIS_Z 2\nvoid node_tangent(int axis, vec3 viewPos, vec3 viewNorm, out vec3 outTangent) {\noutTangent = vec3(0.0);\n#if WORLD_NODES == 0\nvec4 posWorld = invViewMatrix * vec4(-viewPos, 1.0);\nvec3 norWorld = normalize(invViewMatrix * vec4(viewNorm, 0.0)).xyz;\nvec3 posLocal = (invModelMatrix * posWorld).xyz;\nvec3 posOrco = (posLocal - boundingBoxMin)\n/ (boundingBoxMax - boundingBoxMin) - 0.5;\nvec4 posOrcoPermuted;\nif (axis == TANGENT_AXIS_X) {\nposOrcoPermuted = vec4(0.0, -posOrco.z, posOrco.y, 0.0);\n} else if (axis == TANGENT_AXIS_Y) {\nposOrcoPermuted = vec4(-posOrco.y, posOrco.x, 0.0, 0.0);\n} else if (axis == TANGENT_AXIS_Z) {\nposOrcoPermuted = vec4(posOrco.z, 0.0, -posOrco.x, 0.0);\n}\nvec3 tangWorld = (modelMatrix * posOrcoPermuted).xyz;\ntangWorld = cross(norWorld, normalize(cross(tangWorld, norWorld)));\noutTangent = swizzleUpZ(tangWorld);\n#endif\n}\nvoid node_tangent(vec4 tangent, out vec3 outTangent) {\n#if WORLD_NODES == 0\noutTangent = normalize((modelMatrix * vec4(tangent.xyz, 0.0)).xyz);\noutTangent = swizzleUpZ(outTangent);\n#endif\n}",node_tex_brick_bl_frag:"float integer_noise(int rowCount, int brickCount)\n{\n#if __VERSION__ == 300\nint n = (rowCount << 16) + (brickCount & 0xFFFF);\nn = (n + 1013) & 0x7fffffff;\nn = (n >> 13) ^ n;\nint nn = (n * (n * n * 60493 + 19990303) + 1376312589) & 0x7fffffff;\nreturn 0.5 * (float(nn) / 1073741824.0);\n#else\nconst int RAND_MAX = 32767;\nint next = ((123456 * rowCount) + brickCount) * 1103515245 + 12345;\nreturn (mod(float(next/65536), float(RAND_MAX + 1))) / float(RAND_MAX);\n#endif\n}\nvoid node_tex_brick(\nfloat offset, int offsetFrequency, float squash, int squashFrequency, \nvec3 vector, vec4 color1, vec4 color2, vec4 mortar, float scale,\nfloat mortarSize, float mortarSmooth, float bias, float brickWidth,\nfloat rowHeight,\nout vec4 outColor, out float outFac)\n{\nfloat x, y;\nvec3 p = vector * scale;\nfloat rowCount = floor(p.y / rowHeight);\nif (offsetFrequency != 0 && squashFrequency != 0) {\nbrickWidth *= mod(rowCount, float(squashFrequency)) > 0.5 ? 1.0 : squash;\noffset = mod(rowCount, float(offsetFrequency)) > 0.5 ? 0.0 : (brickWidth * offset);\n} \nint brickCount = int((p.x + offset) / brickWidth); \nfloat tint = clamp((integer_noise(int(rowCount), brickCount) + bias), 0.0, 1.0);\n\nx = abs((p.x + offset) - brickWidth * float(brickCount));\ny = abs(p.y - rowHeight * rowCount);\nfloat min_dist = min(min(x, y), min(brickWidth - x, rowHeight - y));\n\nfloat f = step(min_dist, mortarSize);\nif (mortarSmooth > 0.0) {\nmin_dist = 1.0 - min_dist / mortarSize;\nf *= smoothstep(0.0, mortarSmooth, min_dist);\n}\noutColor = mix(mix(color1, color2, tint), mortar, f);\noutFac = f;\n}",node_tex_checker_bl_frag:"void node_tex_checker(vec3 vector, vec4 color1, vec4 color2, float scale, \nout vec4 outColor, out float outFac)\n{\nvec3 p = vector * scale;\np = (p + 0.00001) * 0.99999;\nfloat cx = floor(p.x);\nfloat cy = floor(p.y);\nfloat cz = floor(p.z);\nfloat result = sign(mod(cx + cy + cz, 2.0));\noutFac = max(result, 0.0);\noutColor = mix(color2, color1, outFac);\n}",node_tex_coord_bl_frag:"uniform mat4 nodeTexCoordObjectMatrices[NODE_TEX_COORD_NUM];\nvoid node_tex_coord(\nmat4 objectMat, vec3 viewPos, vec3 viewNorm, vec2 uv,\nout vec3 outGenerated, out vec3 outNormal, out vec3 outUV, out vec3 outObject,\nout vec3 outCamera, out vec3 outWindow, out vec3 outReflection)\n{\nvec4 view = vec4(-viewPos, 1.0);\nvec4 posWorld = invViewMatrix * view;\nvec3 loc = swizzleUpZ((invModelMatrix * posWorld).xyz);\n#if WORLD_NODES == 1\nloc = normalize(loc);\n#endif\n#if WORLD_NODES == 1\noutGenerated = loc;\n#else\nvec3 boxMin = vec3(boundingBoxMin.x, -boundingBoxMax.z, boundingBoxMin.y);\nvec3 boxMax = vec3(boundingBoxMax.x, -boundingBoxMin.z, boundingBoxMax.y);\nvec3 boxSize = boxMax - boxMin;\nif (abs(boxSize.x) < 0.001) {\noutGenerated.x = 0.5;\n} else {\noutGenerated.x = (loc.x - boxMin.x) / boxSize.x;\n}\nif (abs(boxSize.y) < 0.001) {\noutGenerated.y = 0.5;\n} else {\noutGenerated.y = (loc.y - boxMin.y) / boxSize.y;\n}\nif (abs(boxSize.z) < 0.001) {\noutGenerated.z = 0.5;\n} else {\noutGenerated.z = (loc.z - boxMin.z) / boxSize.z;\n}\n#endif\n#if WORLD_NODES == 1\noutNormal = -loc;\n#else\noutNormal = normalize(invModelMatrix * invViewMatrix * vec4(viewNorm, 0.0)).rgb;\noutNormal = swizzleUpZ(outNormal);\n#endif\n#if WORLD_NODES == 1\noutUV = vec3(0.0);\n#else\nuv.y = 1.0 - uv.y;\noutUV = vec3(uv, 0.0);\n#endif\n#if WORLD_NODES == 1\noutObject = loc;\n#else\noutObject = swizzleUpZ((objectMat * posWorld).xyz);\n#endif\noutCamera = vec3(view.xy, -view.z);\n#if WORLD_NODES == 1\noutWindow = vec3(0.0);\n#else\noutWindow = vec3(gl_FragCoord.xy / viewWidthHeight, 0.0);\n#endif\n#if WORLD_NODES == 1\noutReflection = -loc;\n#else\nvec4 reflection = (invViewMatrix * vec4(reflect(view.xyz, normalize(viewNorm)), 0.0));\noutReflection = normalize(swizzleUpZ(reflection.xyz));\n#endif\n}",node_tex_environment_bl_frag:"#define TEX_PROJ_EQUIRECTANGULAR 0\n#define TEX_PROJ_MIRROR_BALL 1\nvoid node_tex_environment(sampler2D tex, const int encoding, const int projection, vec3 vector, out vec4 outColor) {\nvec2 uv;\nfloat bias;\nif (projection == TEX_PROJ_EQUIRECTANGULAR) {\nvec3 direction = swizzleUpY(vector);\nif (length(direction) == 0.0) {\ndirection = vec3(0.0, 1.0, 0.0);\n} else {\ndirection = normalize(direction);\n}\nuv.y = asin(clamp(direction.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;\nuv.x = atan(direction.z, direction.x) * RECIPROCAL_PI2 + 0.5;\n#if WORLD_NODES == 1\nbias = -16.0;\n#else\nconst float seamWidth = 0.15;\nconst float seamBiasFactor = -10.0;\nfloat seam = max(0.0, 1.0 - abs (direction.z) / seamWidth) *\nclamp (1.0 - direction.x / seamWidth, 0.0, 1.0);\nbias = seamBiasFactor * seam;\n#endif\n} else {\nvec3 normal = normalize(vector);\nnormal.y -= 1.0;\nnormal /= (2.0 * sqrt(max(-0.5 * normal.y, 0.0)));\nuv = clamp(0.5 * normal.xz + 0.5, 0.0, 1.0);\nbias = 0.0;\n}\nuv.y = 1.0 - uv.y;\noutColor = texture2D(tex, uv, bias);\noutColor = nodeTexelToLinear(outColor, encoding);\n}",node_tex_environment_none_bl_frag:"void node_tex_environment_none(vec3 vector, out vec4 outColor) {\noutColor = vec4(1.0, 0.0, 1.0, 1.0);\n}",node_tex_gradient_bl_frag:"#define TEX_GRAD_LINEAR 0\n#define TEX_GRAD_QUADRATIC 1\n#define TEX_GRAD_EASING 2\n#define TEX_GRAD_DIAGONAL 3\n#define TEX_GRAD_SPHERICAL 4\n#define TEX_GRAD_QUADRATIC_SPHERE 5\n#define TEX_GRAD_RADIAL 6\nvoid node_tex_gradient(const int type, vec3 vector, out vec4 outColor, out float outFac)\n{\nfloat x, y, z, r;\nx = vector.x;\ny = vector.y;\nz = vector.z;\nif (type == TEX_GRAD_LINEAR) {\noutFac = x;\n} else if (type == TEX_GRAD_QUADRATIC) {\nr = max(x, 0.0);\noutFac = pow2(r);\n} else if (type == TEX_GRAD_EASING) {\nr = min(max(x, 0.0), 1.0);\noutFac = (3.0 * pow2(r) - 2.0 * pow3(r));\n} else if (type == TEX_GRAD_DIAGONAL) {\noutFac = (x + y) * 0.5;\n} else if (type == TEX_GRAD_RADIAL) {\noutFac = atan(y, x) / PI2 + 0.5;\n} else {\nr = max(0.99999 - sqrt(x * x + y * y + z * z), 0.0);\nif (type == TEX_GRAD_QUADRATIC_SPHERE) {\noutFac = pow2(r);\n} else if (type == TEX_GRAD_SPHERICAL) {\noutFac = r;\n}\n}\noutFac = clamp(outFac, 0.0, 1.0);\noutColor = vec4(outFac, outFac, outFac, 1.0);\n}",node_tex_ies_bl_frag:"void node_tex_ies(vec3 vector, float strength, out float fac) {\nfac = 0.0;\n}",node_tex_image_bl_frag:"#define TEX_PROJ_FLAT 0\n#define TEX_PROJ_BOX 1\n#define TEX_PROJ_SPHERE 2\n#define TEX_PROJ_TUBE 3\nvoid node_tex_image(sampler2D ima, const int encoding, vec3 viewNorm,\nconst int projection, const float projectionBlend, const bool clampToEdgeNoExtend,\nvec3 vector,\nout vec4 outColor, out float outAlpha) {\nif (projection == TEX_PROJ_FLAT) {\nvec2 uv = vector.xy;\nuv.y = 1.0 - uv.y;\nif (clampToEdgeNoExtend && (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0)) {\noutColor = vec4(0.0);\noutAlpha = 0.0;\n} else {\noutColor = texture2D(ima, uv);\noutAlpha = outColor.a;\n}\noutColor = nodeTexelToLinear(outColor, encoding);\n} else if (projection == TEX_PROJ_BOX) {\nvec3 norm = normalize(viewNorm * normalMatrix);\nvector = swizzleUpY(vector);\nvec2 uvX = vec2(-sign(norm.x) * vector.z, -vector.y);\nvec2 uvY = vec2(sign(norm.y) * vector.z, -vector.x);\nvec2 uvZ = vec2(sign(norm.z) * vector.x, -vector.y);\nvec4 colX = nodeTexelToLinear(texture2D(ima, uvX), encoding);\nvec4 colY = nodeTexelToLinear(texture2D(ima, uvY), encoding);\nvec4 colZ = nodeTexelToLinear(texture2D(ima, uvZ), encoding);\nvec3 barycentric = abs(norm);\nbarycentric /= barycentric.x + barycentric.y + barycentric.z;\nvec3 edgeShape = min(min(barycentric.yzx, barycentric.zxy),\n(projectionBlend - 1.0) / (projectionBlend - 3.0));\nvec3 edgeValue = (1.0 - projectionBlend) * (1.0 - edgeShape) / 2.0;\nvec3 weight = max((barycentric - edgeValue) / (1.0 - edgeValue), EPSILON);\nweight /= (weight.x + weight.y + weight.z);\noutColor = weight.x * colX + weight.y * colY + weight.z * colZ;\noutAlpha = outColor.a;\n} else if (projection == TEX_PROJ_SPHERE) {\nvector = normalize(vector * 2.0 - 1.0);\nvector = swizzleUpY(vector);\nvec2 uv = vec2(atan(vector.x, vector.z) / PI2, acos(vector.y) / PI);\nuv.x = mod(uv.x, 1.0);\noutColor = texture2D(ima, uv);\noutAlpha = outColor.a;\noutColor = nodeTexelToLinear(outColor, encoding);\n} else if (projection == TEX_PROJ_TUBE) {\nvector = vector * 2.0 - 1.0;\nvector = swizzleUpY(vector);\nvec2 uv = vec2(atan(vector.x, vector.z) / PI2, (1.0 - vector.y) / 2.0);\nuv.x = mod(uv.x, 1.0);\noutColor = texture2D(ima, uv);\noutAlpha = outColor.a;\noutColor = nodeTexelToLinear(outColor, encoding);\n}\n}",node_tex_image_none_bl_frag:"void node_tex_image_none(vec3 vector, out vec4 color, out float alpha)\n{\ncolor = vec4(1.0, 0.0, 1.0, 1.0);\nalpha = 1.0;\n}",node_tex_magic_bl_frag:"void node_tex_magic(vec3 vector, float scale, float distortion,\nout vec4 outColor, out float outFac)\n{\noutColor = vec4(0.0);\noutFac = 0.0;\n}",node_tex_musgrave_bl_frag:"void node_tex_musgrave(vec3 vector, float w, float scale, float detail,\nfloat dimension, float lacunarity, float offset, float gain,\nout float outFac) {\noutFac = 0.0;\n}\nvoid node_tex_musgrave(\nvec3 vector, float scale, float detail, float dimension, float lacunarity,\nfloat offset, float gain,\nout vec4 outColor, out float outFac)\n{\noutColor = vec4(0.0);\noutFac = 0.0;\n}",node_tex_noise_bl_frag:"\nvoid node_tex_noise(\nfloat falloffFactor, float dispersionFactor,\nvec3 vector, float w, float scale, float detail, float roughness,\nfloat distortion, out float outFac, out vec4 outColor) {\nvec3 p = vector * scale;\nvec3 dx = dFdx(p);\nvec3 dy = dFdy(p);\nfloat octaveLenPerPixel = (length(dx) + length(dy)) / 4.0;\nif (distortion != 0.0) {\nvec3 r, offset = vec3(13.5, 13.5, 13.5);\nr.x = noiseSmooth(p + offset, octaveLenPerPixel, falloffFactor,\ndispersionFactor) * distortion;\nr.y = noiseSmooth(p, octaveLenPerPixel, falloffFactor,\ndispersionFactor) * distortion;\nr.z = noiseSmooth(p - offset, octaveLenPerPixel, falloffFactor,\ndispersionFactor) * distortion;\np += r;\n}\noutFac = noiseTurbulence(p, detail, octaveLenPerPixel, falloffFactor,\ndispersionFactor);\nvec3 color = vec3(outFac,\nnoiseTurbulence(vec3(p.y, p.x, p.z), detail, octaveLenPerPixel,\nfalloffFactor, dispersionFactor),\nnoiseTurbulence(vec3(p.y, p.z, p.x), detail, octaveLenPerPixel,\nfalloffFactor, dispersionFactor)\n);\noutColor = vec4(color, 1.0);\n}\nvoid node_tex_noise(\nfloat falloffFactor, float dispersionFactor,\nvec3 vector, float w, float scale, float detail, float distortion,\nout float outFac, out vec4 outColor) {\nnode_tex_noise(falloffFactor, dispersionFactor, vector, w, scale, detail,\n0.5, distortion, outFac, outColor);\n}\nvoid node_tex_noise(\nfloat falloffFactor, float dispersionFactor,\nvec3 vector, float scale, float detail, float distortion,\nout vec4 outColor, out float outFac) {\nnode_tex_noise(falloffFactor, dispersionFactor, vector, 0.0, scale, detail,\ndistortion, outFac, outColor);\n}",node_tex_pointdensity_bl_frag:"void node_tex_pointdensity(\nvec3 vector,\nout vec4 outColor, out float outDensity)\n{\noutColor = vec4(0.0);\noutDensity = 0.0;\n}",node_tex_sky_bl_frag:"\n#define TEX_SKY_PREETHAM 0\n#define TEX_SKY_HOSEK_WILKIE 1\n#define TEX_SKY_NISHITA 2\n#define Km 683.0\nvoid node_tex_sky(const int skyType, vec3 param0, vec3 param1, vec3 param2,\nvec3 param3, vec3 param4, vec3 param5, vec3 param6, vec3 param7,\nvec3 param8, vec3 radiance, vec3 sunDirection, vec3 vectorIn,\nout vec4 outColor) {\nif (length(vectorIn) == 0.0) {\nvectorIn = vec3(0.0, 1.0, 0.0);\n} else {\nvectorIn = normalize(vectorIn);\n}\nvectorIn = swizzleUpY(vectorIn);\nsunDirection = swizzleUpY(sunDirection);\nfloat cosGamma = clamp(dot(vectorIn, sunDirection), -1.0, 1.0);\nfloat cosTheta = clamp(vectorIn.y, 0.0, 1.0);\nif (skyType == TEX_SKY_PREETHAM) {\nvec3 radInternal = (1.0 + param0 * exp(param1 / cosTheta)) * (\n1.0 + param2 * exp(param3 * acos(cosGamma))\n+ param4 * pow(cosGamma, 2.0)\n);\nvec3 XYZ = xyY_to_XYZ(radInternal.y * radiance.y,\nradInternal.z * radiance.z, radInternal.x * radiance.x);\noutColor = vec4(max(xyz_to_sRGB(XYZ), 0.0), 1.0);\n} else if (skyType == TEX_SKY_HOSEK_WILKIE) {\nfloat cosGammaSq = pow(cosGamma, 2.0);\nvec3 chi = (1.0 + cosGammaSq) / pow(1.0 + pow(param8, vec3(2.0))\n- 2.0 * param8 * cosGamma, vec3(1.5));\nvec3 radInternal = (1.0 + param0 * exp(param1 / (cosTheta + 0.01))) * (\nparam2 + param3 * exp(param4 * acos(cosGamma))\n+ param5 * cosGammaSq + param6 * chi + param7 * sqrt(cosTheta)\n);\noutColor = vec4(max(xyz_to_sRGB(radInternal * radiance), 0.0) * PI2/Km, 1.0);\n} else {\noutColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}",node_tex_voronoi_bl_frag:"#define DISTANCE_EUCLIDEAN 0\n#define DISTANCE_MANHATTAN 1\n#define DISTANCE_CHEBYCHEV 2\n#define DISTANCE_MINKOWSKI 3\n#define FEATURE_F1 0\n#define FEATURE_F2 1\n#define FEATURE_SMOOTH_F1 2\n#define FEATURE_DISTANCE_TO_EDGE 3\n#define FEATURE_N_SPHERE_RADIUS 4\nstruct VoronoiGridData {\nvec3 point;\nvec3 randVec;\nvec3 toClosest;\nfloat dist;\n};\nfloat worleyLength(vec3 vec, int distance, float exponent) {\nif (distance == DISTANCE_EUCLIDEAN) {\nreturn length(vec);\n} else if (distance == DISTANCE_MANHATTAN) {\nreturn abs(vec.x) + abs(vec.y) + abs(vec.z);\n} else if (distance == DISTANCE_CHEBYCHEV) {\nreturn max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n} else if (distance == DISTANCE_MINKOWSKI) {\nreturn pow(pow(abs(vec.x), exponent)\n+ pow(abs(vec.y), exponent)\n+ pow(abs(vec.z), exponent), 1.0 / exponent);\n}\nreturn 0.0;\n}\nvoid worleyNoise(vec3 pos, int distance, float exponent, int feature,\nfloat smoothness, float randomness, out float outDist, out vec4 outColor,\nout vec3 outPosition, out float outW, out float outRadius) {\nconst highp float RAND_FIX_ZERO = 0.125;\nvec3 posI = floor(pos);\nvec3 posF = fract(pos);\nVoronoiGridData vgd[27];\n#pragma unroll_loop_start\nfor (int i = 0; i <= 2; i++) {\n#pragma unroll_loop_start\nfor (int j = 0; j <= 2; j++) {\n#pragma unroll_loop_start\nfor (int k = 0; k <= 2; k++) {\nvec3 point = vec3((i), (j), (k)) - 1.0;\nvec3 randVec = rand3(posI + point + RAND_FIX_ZERO);\nvec3 toClosest = point + randomness * randVec - posF;\nconst int counter = (i) + (j) * 3 + (k) * 9;\nvgd[counter].point = point;\nvgd[counter].randVec = randVec;\nvgd[counter].toClosest = toClosest;\nvgd[counter].dist = worleyLength(toClosest, distance, exponent);\n}\n#pragma unroll_loop_end\n}\n#pragma unroll_loop_end\n}\n#pragma unroll_loop_end\nfloat f1 = 1e10;\nfloat f2 = 1e10;\nvec3 edgeToClosest = vec3(0.0);\nfloat distToEdge = 1e10;\nvec3 randColF1 = vec3(0.0);\nvec3 randColF2 = vec3(0.0);\nvec3 toClosestF1 = vec3(0.0);\nvec3 toClosestF2 = vec3(0.0);\nvec3 radPoint = vec3(0.0);\nvec3 radToClosest = vec3(0.0);\n#pragma unroll_loop_start\nfor (int i = 0; i < 27; i++) {\nif (feature == FEATURE_F1) {\nif (vgd[i].dist < f1) {\nf1 = vgd[i].dist;\nrandColF1 = vgd[i].randVec;\ntoClosestF1 = vgd[i].toClosest;\n}\n} else if (feature == FEATURE_F2) {\nif (vgd[i].dist < f1) {\nf2 = f1;\nf1 = vgd[i].dist;\nrandColF2 = randColF1;\nrandColF1 = vgd[i].randVec;\ntoClosestF2 = toClosestF1;\ntoClosestF1 = vgd[i].toClosest;\n} else if (vgd[i].dist < f2) {\nf2 = vgd[i].dist;\nrandColF2 = vgd[i].randVec;\ntoClosestF2 = vgd[i].toClosest;\n}\n} else if (feature == FEATURE_SMOOTH_F1) {\nf1 = smoothMin(f1, vgd[i].dist, smoothness);\n} else if (feature == FEATURE_DISTANCE_TO_EDGE) {\nfloat dist = worleyLength(vgd[i].toClosest, DISTANCE_EUCLIDEAN, exponent);\nif (dist < f1) {\nf1 = dist;\nedgeToClosest = vgd[i].toClosest;\n}\n} else if (feature == FEATURE_N_SPHERE_RADIUS) {\nfloat dist = worleyLength(vgd[i].toClosest, DISTANCE_EUCLIDEAN, exponent);\nif (dist < f1) {\nf1 = dist;\nradPoint = vgd[i].point;\nradToClosest = vgd[i].toClosest;\n}\n}\n}\n#pragma unroll_loop_end\nif (feature == FEATURE_F1) {\noutDist = f1;\noutColor = vec4(randColF1, 1.0);\noutPosition = pos + toClosestF1;\n} else if (feature == FEATURE_F2) {\noutDist = f2;\noutColor = vec4(randColF2, 1.0);\noutPosition = pos + toClosestF2;\n} else if (feature == FEATURE_SMOOTH_F1) {\noutDist = f1;\nvec3 avgCol = vec3(0.0);\nvec3 avgOff = vec3(0.0);\nfloat sumWeightsCol = 0.0;\nfloat sumWeightsOff = 0.0;\n#pragma unroll_loop_start\nfor (int i = 0; i < 27; i++) {\nfloat smoothFac = getSmoothFactor(f1, vgd[i].dist, smoothness);\nfloat weightOff = smoothFac * smoothFac * smoothFac;\nfloat weightCol = weightOff * smoothFac;\navgCol += vgd[i].randVec * weightCol;\navgOff += vgd[i].toClosest * weightOff;\nsumWeightsCol += weightCol;\nsumWeightsOff += weightOff;\n}\n#pragma unroll_loop_end\noutColor = vec4(avgCol / sumWeightsCol, 1.0);\noutPosition = pos + avgOff / sumWeightsOff;\n} else if (feature == FEATURE_DISTANCE_TO_EDGE) {\n#pragma unroll_loop_start\nfor (int i = 0; i < 27; i++) {\nif (vgd[i].toClosest != edgeToClosest) {\nfloat dist = dot(0.5 * (edgeToClosest + vgd[i].toClosest),\nnormalize(vgd[i].toClosest - edgeToClosest));\ndistToEdge = min(distToEdge, dist);\n}\n}\n#pragma unroll_loop_end\noutDist = distToEdge;\n} else if (feature == FEATURE_N_SPHERE_RADIUS) {\nfloat diam = 1e10;\n#pragma unroll_loop_start\nfor (int i = 0; i <= 2; i++) {\n#pragma unroll_loop_start\nfor (int j = 0; j <= 2; j++) {\n#pragma unroll_loop_start\nfor (int k = 0; k <= 2; k++) {\nvec3 localPoint = vec3((i), (j), (k)) - 1.0;\nif (length(localPoint) > 0.0) {\nvec3 point = localPoint + radPoint;\nvec3 randVec = rand3(posI + point + RAND_FIX_ZERO);\nvec3 toClosest = point + randomness * randVec - posF;\ndiam = min(diam, length(toClosest - radToClosest));\n}\n}\n#pragma unroll_loop_end\n}\n#pragma unroll_loop_end\n}\n#pragma unroll_loop_end\noutRadius = diam / 2.0;\n}\n}\n#define VORONOI_SMOOTH_COEFF 0.74\nvoid node_tex_voronoi(\nint distance, int feature,\nvec3 vector, float w, float scale, float smoothness, float exponent,\nfloat randomness,\nout float outDistance, out vec4 outColor, out vec3 outPosition,\nout float outW, out float outRadius) {\nvector = scale * (vector - 0.0001);\nsmoothness = clamp(smoothness, 1e-3, 1.0);\nsmoothness *= VORONOI_SMOOTH_COEFF;\nworleyNoise(vector, distance, exponent, feature, smoothness, randomness,\noutDistance, outColor, outPosition, outW, outRadius);\noutPosition /= scale;\n}\n#define DISTANCE_DISTANCE DISTANCE_EUCLIDEAN\n#define FEATURE_F3 5\n#define FEATURE_F4 6\n#define FEATURE_F2F1 7\n#define COLORING_INTENSITY 0\n#define COLORING_CELLS 1\nstruct VoronoiClosest {\nvec4 closestDists;\nvec4 closestInds;\n};\nvoid updateVoronoiClosest(inout VoronoiClosest vf, vec3 newDistances,\nvec3 newIndices) {\n#pragma unroll_loop_start\nfor (int i = 0; i < 3; i++) {\nfloat currDist = newDistances[i];\nfloat currIdx = newIndices[i];\n#pragma unroll_loop_start\nfor (int j = 0; j < 4; j++) {\nif (currDist < vf.closestDists[j]) {\nfloat tmp = vf.closestDists[j];\nvf.closestDists[j] = currDist;\ncurrDist = tmp;\ntmp = vf.closestInds[j];\nvf.closestInds[j] = currIdx;\ncurrIdx = tmp;\n}\n}\n#pragma unroll_loop_end\n}\n#pragma unroll_loop_end\n}\nvec3 worleyPermute(vec3 x) {\nreturn mod((34.0 * x + 1.0) * x, 289.0);\n}\nvec3 worleyDist(vec3 x, vec3 y, vec3 z, int distance, float exponent) {\nif (distance == DISTANCE_EUCLIDEAN) {\nreturn x * x + y * y + z * z;\n} else if (distance == DISTANCE_MANHATTAN) {\nreturn abs(x) + abs(y) + abs(z);\n} else if (distance == DISTANCE_CHEBYCHEV) {\nreturn max(max(abs(x), abs(y)), abs(z));\n} else if (distance == DISTANCE_MINKOWSKI) {\nvec3 expVec = vec3(exponent);\nreturn pow(pow(abs(x), expVec)\n+ pow(abs(y), expVec)\n+ pow(abs(z), expVec), 1.0 / expVec);\n}\nreturn vec3(0.0);\n}\nVoronoiClosest worleyClosest(vec3 P, float jitter, int distance, float exponent) {\nfloat K = 0.142857142857;\nfloat Ko = 0.428571428571;\nfloat K2 = 0.020408163265306;\nfloat Kz = 0.166666666667;\nfloat Kzo = 0.416666666667;\nvec3 Pi = mod(floor(P), 289.0);\nvec3 Pf = fract(P) - 0.5;\nvec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\nvec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\nvec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\nvec3 p = worleyPermute(Pi.x + vec3(-1.0, 0.0, 1.0));\nvec3 p1 = worleyPermute(p + Pi.y - 1.0);\nvec3 p2 = worleyPermute(p + Pi.y);\nvec3 p3 = worleyPermute(p + Pi.y + 1.0);\nvec3 p11 = worleyPermute(p1 + Pi.z - 1.0);\nvec3 p12 = worleyPermute(p1 + Pi.z);\nvec3 p13 = worleyPermute(p1 + Pi.z + 1.0);\nvec3 p21 = worleyPermute(p2 + Pi.z - 1.0);\nvec3 p22 = worleyPermute(p2 + Pi.z);\nvec3 p23 = worleyPermute(p2 + Pi.z + 1.0);\nvec3 p31 = worleyPermute(p3 + Pi.z - 1.0);\nvec3 p32 = worleyPermute(p3 + Pi.z);\nvec3 p33 = worleyPermute(p3 + Pi.z + 1.0);\nvec3 ox11 = fract(p11*K) - Ko;\nvec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\nvec3 oz11 = floor(p11*K2)*Kz - Kzo;\nvec3 ox12 = fract(p12*K) - Ko;\nvec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\nvec3 oz12 = floor(p12*K2)*Kz - Kzo;\nvec3 ox13 = fract(p13*K) - Ko;\nvec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\nvec3 oz13 = floor(p13*K2)*Kz - Kzo;\nvec3 ox21 = fract(p21*K) - Ko;\nvec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\nvec3 oz21 = floor(p21*K2)*Kz - Kzo;\nvec3 ox22 = fract(p22*K) - Ko;\nvec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\nvec3 oz22 = floor(p22*K2)*Kz - Kzo;\nvec3 ox23 = fract(p23*K) - Ko;\nvec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\nvec3 oz23 = floor(p23*K2)*Kz - Kzo;\nvec3 ox31 = fract(p31*K) - Ko;\nvec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\nvec3 oz31 = floor(p31*K2)*Kz - Kzo;\nvec3 ox32 = fract(p32*K) - Ko;\nvec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\nvec3 oz32 = floor(p32*K2)*Kz - Kzo;\nvec3 ox33 = fract(p33*K) - Ko;\nvec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\nvec3 oz33 = floor(p33*K2)*Kz - Kzo;\nvec3 dx11 = Pfx + jitter*ox11;\nvec3 dy11 = Pfy.x + jitter*oy11;\nvec3 dz11 = Pfz.x + jitter*oz11;\nvec3 dx12 = Pfx + jitter*ox12;\nvec3 dy12 = Pfy.x + jitter*oy12;\nvec3 dz12 = Pfz.y + jitter*oz12;\nvec3 dx13 = Pfx + jitter*ox13;\nvec3 dy13 = Pfy.x + jitter*oy13;\nvec3 dz13 = Pfz.z + jitter*oz13;\nvec3 dx21 = Pfx + jitter*ox21;\nvec3 dy21 = Pfy.y + jitter*oy21;\nvec3 dz21 = Pfz.x + jitter*oz21;\nvec3 dx22 = Pfx + jitter*ox22;\nvec3 dy22 = Pfy.y + jitter*oy22;\nvec3 dz22 = Pfz.y + jitter*oz22;\nvec3 dx23 = Pfx + jitter*ox23;\nvec3 dy23 = Pfy.y + jitter*oy23;\nvec3 dz23 = Pfz.z + jitter*oz23;\nvec3 dx31 = Pfx + jitter*ox31;\nvec3 dy31 = Pfy.z + jitter*oy31;\nvec3 dz31 = Pfz.x + jitter*oz31;\nvec3 dx32 = Pfx + jitter*ox32;\nvec3 dy32 = Pfy.z + jitter*oy32;\nvec3 dz32 = Pfz.y + jitter*oz32;\nvec3 dx33 = Pfx + jitter*ox33;\nvec3 dy33 = Pfy.z + jitter*oy33;\nvec3 dz33 = Pfz.z + jitter*oz33;\nvec3 d11 = worleyDist(dx11, dy11, dz11, distance, exponent);\nvec3 d12 = worleyDist(dx12, dy12, dz12, distance, exponent);\nvec3 d13 = worleyDist(dx13, dy13, dz13, distance, exponent);\nvec3 d21 = worleyDist(dx21, dy21, dz21, distance, exponent);\nvec3 d22 = worleyDist(dx22, dy22, dz22, distance, exponent);\nvec3 d23 = worleyDist(dx23, dy23, dz23, distance, exponent);\nvec3 d31 = worleyDist(dx31, dy31, dz31, distance, exponent);\nvec3 d32 = worleyDist(dx32, dy32, dz32, distance, exponent);\nvec3 d33 = worleyDist(dx33, dy33, dz33, distance, exponent);\nVoronoiClosest vf = VoronoiClosest(vec4(1e10), vec4(0.0));\nupdateVoronoiClosest(vf, d11, p11);\nupdateVoronoiClosest(vf, d12, p12);\nupdateVoronoiClosest(vf, d13, p13);\nupdateVoronoiClosest(vf, d21, p21);\nupdateVoronoiClosest(vf, d22, p22);\nupdateVoronoiClosest(vf, d23, p23);\nupdateVoronoiClosest(vf, d31, p31);\nupdateVoronoiClosest(vf, d32, p32);\nupdateVoronoiClosest(vf, d33, p33);\nreturn vf;\n}\nvoid node_tex_voronoi(int coloring, int distance, int feature, vec3 vector,\nfloat scale, float exponent, out vec4 outColor, out float outFac) {\nvector = scale * (vector - 0.0001);\nVoronoiClosest vf = worleyClosest(vector, 1.0, distance, exponent);\nvec4 vorColorData;\nif (coloring == COLORING_INTENSITY) {\nvorColorData = vf.closestDists;\n} else if (coloring == COLORING_CELLS) {\nvorColorData = vf.closestInds;\n}\nfloat vorColorFac;\nif (feature == FEATURE_F1) {\nvorColorFac = vorColorData.x;\n} else if (feature == FEATURE_F2) {\nvorColorFac = vorColorData.y;\n} else if (feature == FEATURE_F3) {\nvorColorFac = vorColorData.z;\n} else if (feature == FEATURE_F4) {\nvorColorFac = vorColorData.w;\n} else if (feature == FEATURE_F2F1) {\nvorColorFac = vorColorData.y - vorColorData.x;\n}\nif (coloring == COLORING_INTENSITY) {\noutFac = vorColorFac;\noutColor = vec4(vec3(outFac), 1.0);\n} else if (coloring == COLORING_CELLS) {\nvorColorFac += 1e-3;\nfloat r = rand(vec2(vorColorFac / 289.0));\nfloat g = rand(vec2(vorColorFac / 23535.0));\nfloat b = rand(vec2(vorColorFac / 4353.0));\noutFac = (r + g + b) / 3.0;\noutColor = vec4(r, g, b, 1.0);\n}\n}",node_tex_wave_bl_frag:"#define TEX_WAVE_TYPE_BANDS 0\n#define TEX_WAVE_TYPE_RINGS 1\n#define TEX_WAVE_PROFILE_SIN 0\n#define TEX_WAVE_PROFILE_SAW 1\n#define TEX_WAVE_PROFILE_TRI 2\n#define TEX_WAVE_BANDS_DIR_X 0\n#define TEX_WAVE_BANDS_DIR_Y 1\n#define TEX_WAVE_BANDS_DIR_Z 2\n#define TEX_WAVE_BANDS_DIR_DIAGONAL 3\n#define TEX_WAVE_RINGS_DIR_X 0\n#define TEX_WAVE_RINGS_DIR_Y 1\n#define TEX_WAVE_RINGS_DIR_Z 2\n#define TEX_WAVE_RINGS_DIR_SPHERICAL 3\nvoid node_tex_wave(\nint waveType, int waveProfile, int bandsDirection, int ringsDirection,\nvec3 vector, float scale, float distortion, float detail, float detailScale,\nfloat detailRoughness, float phaseOffset,\nout vec4 outColor, out float outFac) {\nvec3 coScaled = vector * scale;\nfloat waveFac;\nvec3 waveVec = coScaled;\nif (waveType == TEX_WAVE_TYPE_BANDS) {\nconst float BANDS_AXIS_SCALE = 2.0 / 3.0;\nif (bandsDirection == TEX_WAVE_BANDS_DIR_X) {\nwaveVec = waveVec.xxx * BANDS_AXIS_SCALE;\n} else if (bandsDirection == TEX_WAVE_BANDS_DIR_Y) {\nwaveVec = waveVec.yyy * BANDS_AXIS_SCALE;\n} else if (bandsDirection == TEX_WAVE_BANDS_DIR_Z) {\nwaveVec = waveVec.zzz * BANDS_AXIS_SCALE;\n} else if (bandsDirection == TEX_WAVE_BANDS_DIR_DIAGONAL) {\n}\nwaveFac = (waveVec.x + waveVec.y + waveVec.z) * 10.0;\n} else {\nif (ringsDirection == TEX_WAVE_RINGS_DIR_X) {\nwaveVec.x = 0.0;\n} else if (ringsDirection == TEX_WAVE_RINGS_DIR_Y) {\nwaveVec.y = 0.0;\n} else if (ringsDirection == TEX_WAVE_RINGS_DIR_Z) {\nwaveVec.z = 0.0;\n} else if (ringsDirection == TEX_WAVE_RINGS_DIR_SPHERICAL) {\n}\nwaveFac = length(waveVec) * 20.0;\n}\nif (distortion != 0.0) {\nwaveFac += distortion * noiseTurbulence(coScaled * detailScale, detail,\n0.0, 0.0, 1.0);\n}\nif (waveProfile == TEX_WAVE_PROFILE_SIN) {\nwaveFac = 0.5 + 0.5 * sin(waveFac - PI_HALF + phaseOffset);\n} else if (waveProfile == TEX_WAVE_PROFILE_SAW) {\nwaveFac = fract((waveFac + phaseOffset + 1e-4) / PI2);\n} else if (waveProfile == TEX_WAVE_PROFILE_TRI) {\nwaveFac = abs(2.0 * fract((waveFac + PI + phaseOffset) / PI2) - 1.0);\n}\noutColor = vec4(waveFac, waveFac, waveFac, 1.0);\noutFac = waveFac;\n}\nvoid node_tex_wave(int waveType, int waveProfile, int bandsDirection,\nint ringsDirection, vec3 vector, float scale, float distortion,\nfloat detail, float detailScale, out vec4 outColor, out float outFac) {\nfloat legacyOffset = 0.0;\nif (waveProfile == TEX_WAVE_PROFILE_SIN) {\nlegacyOffset = PI_HALF;\n}\nnode_tex_wave(waveType, waveProfile, bandsDirection, ringsDirection, vector,\nscale, distortion, detail, detailScale, 0.5, legacyOffset, outColor,\noutFac);\n}",node_tex_white_noise_bl_frag:"void node_tex_white_noise(vec3 vector, float w, out float outValue,\nout vec4 outColor) {\noutValue = 0.0;\noutColor = vec4(0.0);\n}\nvoid node_tex_white_noise(vec3 vector, float w, out float outValue) {\noutValue = 0.0;\n}",node_uvmap_bl_frag:"void node_uvmap(vec2 uv, out vec3 outUV) {\n#if WORLD_NODES == 1\noutUV = vec3(0.0);\n#else\nuv.y = 1.0 - uv.y;\noutUV = vec3(uv, 0.0);\n#endif\n}",node_valtorgb_bl_frag:"\nvoid node_valtorgb(sampler2D colormap, float fac, out vec4 colOut, out float alphaOut)\n{\ncolOut = texture2D(colormap, vec2(fac, 0.0));\nalphaOut = colOut.a;\n}",node_value_bl_frag:"\nuniform float nodeValue[NODE_VALUE_NUM];\nvoid node_value(float val, out float outVal)\n{\noutVal = val;\n}",node_vect_math_bl_frag:"void node_vect_math_add(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = v1 + v2;\n}\nvoid node_vect_math_subtract(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = v1 - v2;\n}\nvoid node_vect_math_multiply(vec3 v1, vec3 v2, vec3 v3, float val,\nout vec3 outVec, out float outVal) {\noutVec = v1 * v2;\n}\nvoid node_vect_math_divide(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec.x = v2.x == 0.0 ? 0.0 : v1.x / v2.x;\noutVec.y = v2.y == 0.0 ? 0.0 : v1.y / v2.y;\noutVec.z = v2.z == 0.0 ? 0.0 : v1.z / v2.z;\n}\nvoid node_vect_math_cross_product(vec3 v1, vec3 v2, vec3 v3, float val,\nout vec3 outVec, out float outVal) {\noutVec = cross(v1, v2);\n}\nvoid node_vect_math_project(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\nfloat d = dot(v2, v2);\noutVec = (d != 0.0) ? (dot(v1, v2) / d) * v2 : vec3(0.0);\n}\nvoid node_vect_math_reflect(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\nif (v2 != vec3(0.0)) {\nv2 = normalize(v2);\n}\noutVec = reflect(v1, v2);\n}\nvoid node_vect_math_dot_product(vec3 v1, vec3 v2, vec3 v3, float val,\nout vec3 outVec, out float outVal) {\noutVal = dot(v1, v2);\n}\nvoid node_vect_math_distance(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVal = distance(v1, v2);\n}\nvoid node_vect_math_length(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVal = length(v1);\n}\nvoid node_vect_math_scale(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = v1 * val;\n}\nvoid node_vect_math_normalize(vec3 v1, vec3 v2, vec3 v3, float val,\nout vec3 outVec, out float outVal) {\nif (v1 != vec3(0.0)) {\nv1 = normalize(v1);\n}\noutVec = v1;\n}\nvoid node_vect_math_snap(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec.x = v2.x == 0.0 ? 0.0 : floor(v1.x / v2.x) * v2.x;\noutVec.y = v2.y == 0.0 ? 0.0 : floor(v1.y / v2.y) * v2.y;\noutVec.z = v2.z == 0.0 ? 0.0 : floor(v1.z / v2.z) * v2.z;\n}\nvoid node_vect_math_floor(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = floor(v1);\n}\nvoid node_vect_math_ceil(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = ceil(v1);\n}\nvoid node_vect_math_modulo(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\nvec3 signProduct = sign(v1) * sign(v2);\nv1 += 1e-5 * signProduct;\noutVec.x = signProduct.x > 0.0 ? mod(v1.x, abs(v2.x)) : 0.0;\noutVec.y = signProduct.y > 0.0 ? mod(v1.y, abs(v2.y)) : 0.0;\noutVec.z = signProduct.z > 0.0 ? mod(v1.z, abs(v2.z)) : 0.0;\n}\nvoid node_vect_math_fraction(vec3 v1, vec3 v2, vec3 v3, float val,\nout vec3 outVec, out float outVal) {\noutVec = fract(v1);\n}\nvoid node_vect_math_absolute(vec3 v1, vec3 v2, vec3 v3, float val,\nout vec3 outVec, out float outVal) {\noutVec = abs(v1);\n}\nvoid node_vect_math_minimum(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = min(v1, v2);\n}\nvoid node_vect_math_maximum(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = max(v1, v2);\n}\nvoid node_vect_math_cosine(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = cos(v1);\n}\nvoid node_vect_math_sine(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = sin(v1);\n}\nvoid node_vect_math_tangent(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\noutVec = tan(v1);\n}\nvoid node_vect_math_wrap(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,\nout float outVal) {\nv1 += 1e-5;\noutVec.x = v2.x == v3.x ? v2.x : mod(v1.x - v3.x, v2.x - v3.x) + v3.x;\noutVec.y = v2.y == v3.y ? v2.y : mod(v1.y - v3.y, v2.y - v3.y) + v3.y;\noutVec.z = v2.z == v3.z ? v2.z : mod(v1.z - v3.z, v2.z - v3.z) + v3.z;\n}\nvoid node_vect_math_absolute(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_absolute(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_add(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_add(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_ceil(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_ceil(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_cross_product(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_cross_product(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_distance(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_distance(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_divide(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_divide(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_dot_product(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_dot_product(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_floor(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_floor(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_fraction(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_fraction(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_maximum(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_maximum(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_length(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_length(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_minimum(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_minimum(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_modulo(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_modulo(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_project(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_project(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_normalize(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_normalize(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_multiply(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_multiply(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_scale(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_scale(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_reflect(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_reflect(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_subtract(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_subtract(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_snap(vec3 v1, vec3 v2, float val, out vec3 outVec,\nout float outVal) {\nnode_vect_math_snap(v1, v2, vec3(0.0), val, outVec, outVal);\n}\nvoid node_vect_math_add(vec3 v1, vec3 v2, out vec3 outVec, out float outVal)\n{\noutVec = v1 + v2;\noutVal = (abs(outVec[0]) + abs(outVec[1]) + abs(outVec[2])) * RECIPROCAL_3;\n}\nvoid node_vect_math_subtract(vec3 v1, vec3 v2, out vec3 outVec, out float outVal)\n{\noutVec = v1 - v2;\noutVal = (abs(outVec[0]) + abs(outVec[1]) + abs(outVec[2])) * RECIPROCAL_3;\n}\nvoid node_vect_math_average(vec3 v1, vec3 v2, out vec3 outVec, out float outVal)\n{\noutVec = v1 + v2;\noutVal = length(outVec);\noutVec = normalize(outVec);\n}\nvoid node_vect_math_dot_product(vec3 v1, vec3 v2, out vec3 outVec, out float outVal)\n{\noutVec = vec3(0, 0, 0);\noutVal = dot(v1, v2);\n}\nvoid node_vect_math_cross_product(vec3 v1, vec3 v2, out vec3 outVec, out float outVal)\n{\noutVec = cross(v1, v2);\noutVal = length(outVec);\noutVec /= outVal;\n}\nvoid node_vect_math_normalize(vec3 v, vec3 v2, out vec3 outVec, out float outVal)\n{\noutVal = length(v);\noutVec = normalize(v);\n}",node_vect_transform_bl_frag:"\n#define VEC_TRANS_NONE 0\n#define VEC_TRANS_W_O 1\n#define VEC_TRANS_W_C 2\n#define VEC_TRANS_O_W 3\n#define VEC_TRANS_O_C 4\n#define VEC_TRANS_C_W 5\n#define VEC_TRANS_C_O 6\n#define VEC_TRANS_W_O_DIR 7\n#define VEC_TRANS_W_C_DIR 8\n#define VEC_TRANS_O_W_DIR 9\n#define VEC_TRANS_O_C_DIR 10\n#define VEC_TRANS_C_W_DIR 11\n#define VEC_TRANS_C_O_DIR 12\nvoid node_vect_transform(const int vecTransType, const bool invCamZ, vec3 vIn, out vec3 vOut)\n{\nif (vecTransType == VEC_TRANS_NONE)\nvOut = vIn;\nelse {\nvec4 vec;\nif (vecTransType < VEC_TRANS_W_O_DIR)\nvec = vec4(vIn.xyz, 1.0);\nelse\nvec = vec4(vIn.xyz, 0.0);\nif (vecTransType == VEC_TRANS_W_O || vecTransType == VEC_TRANS_W_O_DIR) {\nvec = vec4(vec.x, vec.z, -vec.y, vec.w);\nvec = invModelMatrix * vec;\nvec = vec4(vec.x, -vec.z, vec.y, vec.w);\n} else if (vecTransType == VEC_TRANS_W_C || vecTransType == VEC_TRANS_W_C_DIR) {\nvec = vec4(vec.x, vec.z, -vec.y, vec.w);\nvec = viewMatrix * vec;\nif (invCamZ)\nvec[2] = -vec[2];\n} else if (vecTransType == VEC_TRANS_O_W || vecTransType == VEC_TRANS_O_W_DIR) {\nvec = vec4(vec.x, vec.z, -vec.y, vec.w);\nvec = modelMatrix * vec;\nvec = vec4(vec.x, -vec.z, vec.y, vec.w);\n} else if (vecTransType == VEC_TRANS_O_C || vecTransType == VEC_TRANS_O_C_DIR) {\nvec = vec4(vec.x, vec.z, -vec.y, vec.w);\nvec = modelViewMatrix * vec;\nif (invCamZ)\nvec[2] = -vec[2];\n} else if (vecTransType == VEC_TRANS_C_W || vecTransType == VEC_TRANS_C_W_DIR) {\nif (invCamZ)\nvec[2] = -vec[2];\nvec = invViewMatrix * vec;\nvec = vec4(vec.x, -vec.z, vec.y, vec.w);\n} else if (vecTransType == VEC_TRANS_C_O || vecTransType == VEC_TRANS_C_O_DIR) {\nif (invCamZ)\nvec[2] = -vec[2];\nvec = invModelMatrix * invViewMatrix * vec;\nvec = vec4(vec.x, -vec.z, vec.y, vec.w);\n}\nvOut = vec.xyz;\n}\n}",node_vector_displacement_bl_frag:"void node_vector_displacement(vec4 vector, float midLevel, float scale,\nout vec3 displacement) {\ndisplacement = vec3(0.0);\n}",node_vector_rotate_bl_frag:"void node_vector_rotate_axis_angle(float invert, vec3 vector, vec3 center,\nvec3 axis, float angle, vec3 rotation, out vec3 outVector) {\nif (length(axis) > 0.0) {\nvector -= center;\noutVector = vec3RotateAxisAngle(vector, axis, invert * angle);\noutVector += center;\n} else {\noutVector = vector;\n}\n}\nvoid node_vector_rotate_euler_xyz(float invert, vec3 vector, vec3 center,\nvec3 axis, float angle, vec3 rotation, out vec3 outVector) {\nvec4 axisAngle = eulerToAxisAngle(rotation);\nvector -= center;\noutVector = vec3RotateAxisAngle(vector, axisAngle.xyz, invert * axisAngle.w);\noutVector += center;\n}\nvoid node_vector_rotate_x_axis(float invert, vec3 vector, vec3 center,\nvec3 axis, float angle, vec3 rotation, out vec3 outVector) {\nvector -= center;\noutVector = vec3RotateXAngle(vector, invert * angle);\noutVector += center;\n}\nvoid node_vector_rotate_y_axis(float invert, vec3 vector, vec3 center,\nvec3 axis, float angle, vec3 rotation, out vec3 outVector) {\nvector -= center;\noutVector = vec3RotateYAngle(vector, invert * angle);\noutVector += center;\n}\nvoid node_vector_rotate_z_axis(float invert, vec3 vector, vec3 center,\nvec3 axis, float angle, vec3 rotation, out vec3 outVector) {\nvector -= center;\noutVector = vec3RotateZAngle(vector, invert * angle);\noutVector += center;\n}",node_vertex_color_bl_frag:"void node_vertex_color(vec4 color, out vec4 outColor, out float outAlpha) {\noutColor = color;\noutAlpha = color.a;\n}",node_volume_absorption_bl_frag:"void node_volume_absorption(vec4 color, float density, out vec4 outColor)\n{\noutColor = color;\n}",node_volume_info_bl_frag:"void node_volume_info(out vec4 color, out float density, out float flame,\nout float temperature) {\ncolor = vec4(vec3(0.0), 1.0);\ndensity = 0.0;\nflame = 0.0;\ntemperature = 0.0;\n}",node_volume_scatter_bl_frag:"void node_volume_scatter(vec4 color, float density, float anisotropy, out vec4 outColor)\n{\noutColor = vec4(color);\n}",node_wavelength_bl_frag:"void node_wavelength(float wavelength, out vec4 outColor)\n{\noutColor = vec4(0.0, 0.0, 0.0, 1.0);\n#if __VERSION__ == 300\nvec3 xyz = vec3(0.0);\nfloat ii = (wavelength - 380.0) / 5.0;\nint i = int(ii);\nif (i < 0 || i >= 80) {\nreturn;\n}\nii -= float(i);\nvec3 c1 = cieColorMatch[i];\nvec3 c2 = cieColorMatch[i+1];\nxyz = mix(c1, c2, ii);\noutColor = vec4(xyz_to_sRGB(xyz), 1.0);\n#endif\n}",node_wireframe_bl_frag:"void node_wireframe(float size, out float outFac)\n{\noutFac = 0.0;\n}",node_bitmap_none_mx_frag:"void node_bitmap_none(out vec4 color)\n{\ncolor = vec4(1.0);\n}",node_bitmap_env_mx_frag:"void node_bitmap_env(sampler2D envMap, int reflectMode, float IOR,\nconst int encoding, const bool alphaAsMono, const bool alphaAsRGB,\nfloat uOffset, float vOffset, float uTiling, float vTiling, float wAngle, vec3 normal,\nout vec4 color, out float value)\n{\nvec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);\nvec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\nvec3 reflectVec;\n#if WORLD_NODES\nreflectVec = normalize(cameraToVertex);\n#else\nif (reflectMode == MAX_ENV_COORDS_REFLECT)\nreflectVec = reflect(cameraToVertex, worldNormal);\nelse {\nfloat refrRatio = 1.0 / IOR;\nreflectVec = refract(cameraToVertex, worldNormal, refrRatio);\n}\n#endif\nmat3 uvTransform = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle);\ncolor = sampleEquirectangular(envMap, reflectVec, uvTransform, encoding);\nif (alphaAsMono)\nvalue = color.a;\nelse\nvalue = average(color.rgb);\nif (alphaAsRGB)\ncolor = vec4(color.a);\n}",node_bitmap_mx_frag:"void node_bitmap(sampler2D map, const vec2 uvIn, const int mapping, const int axis,\nconst ivec2 clampToEdgeNoExtend,\nconst int encoding, const bool alphaAsMono, const bool alphaAsRGB,\nfloat uOffset, float vOffset, float uTiling, float vTiling, float wAngle,\nout vec4 color, out float value)\n{\nvec3 coordsIn;\nif (mapping == MAPPING_EXPLICIT_MAP_CHANNEL) {\ncoordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 0.0);\n} else if (mapping == MAPPING_VERTEX_COLOR_CHANNEL) {\ncoordsIn = vec3(0.0);\n} else if (mapping == MAPPING_PLANAR_OBJECT_XYZ) {\ncoordsIn = swizzleUpZ((invModelMatrix * invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);\n} else {\ncoordsIn = swizzleUpZ((invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);\n}\nif (axis == AXIS_XY)\ncoordsIn = vec3(coordsIn.x, coordsIn.y, 1.0);\nelse if (axis == AXIS_YZ)\ncoordsIn = vec3(coordsIn.y, coordsIn.z, 1.0);\nelse if (axis == AXIS_ZX)\ncoordsIn = vec3(coordsIn.z, coordsIn.x, 1.0);\nvec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;\nvec2 uv = vec2(coordsOut.x, 1.0 - coordsOut.y);\nif ((clampToEdgeNoExtend[0] == 1 && (uvIn.x < 0.0 || uvIn.x > 1.0)) ||\n(clampToEdgeNoExtend[1] == 1 && (uvIn.y < 0.0 || uvIn.y > 1.0))) {\ncolor = vec4(0.0, 0.0, 0.0, 1.0);\n} else {\ncolor = texture2D(map, uv);\ncolor = nodeTexelToLinear(color, encoding);\n}\nif (alphaAsMono)\nvalue = color.a;\nelse\nvalue = average(color.rgb);\nif (alphaAsRGB)\ncolor = vec4(color.a);\n}",node_bump_mx_frag:"void node_bump(sampler2D bumpMap, const vec3 eyePos, const vec3 normal, const vec2 uvIn,\nfloat uOffset, float vOffset, float uTiling, float vTiling, float wAngle,\nout vec3 normalOut)\n{\nvec3 coordsIn;\ncoordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 1.0);\nvec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;\nvec2 uv = vec2(coordsOut.x, 1.0 - coordsOut.y);\nvec2 dSTdx = dFdx(uv);\nvec2 dSTdy = dFdy(uv);\nif (any(equal(dSTdx, vec2(0.0))) || any(equal(dSTdy, vec2(0.0)))) {\nnormalOut = normal;\n} else {\nconst float bumpScale = 1.0;\nvec3 vSigmaX = vec3(dFdx(eyePos.x), dFdx(eyePos.y), dFdx(eyePos.z));\nvec3 vSigmaY = vec3(dFdy(eyePos.x), dFdy(eyePos.y), dFdy(eyePos.z));\nvec3 vN = normal;\nvec3 R1 = cross(vSigmaY, vN);\nvec3 R2 = cross(vN, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nfloat Hll = bumpScale * texture2D(bumpMap, uv).x;\nfloat dBx = bumpScale * texture2D(bumpMap, uv + dSTdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpMap, uv + dSTdy).x - Hll;\nvec2 dHdxy = vec2(dBx, dBy);\nvec3 vGrad = sign(fDet) * (dHdxy.x * R1 + dHdxy.y * R2);\nnormalOut = normalize(abs(fDet) * normal - vGrad);\n}\n}",node_blend_mx_frag:"void node_blend(\nconst bool useCurve, const float curveLower, const float curveUpper,\nconst vec4 color1, const vec4 color2, float mask,\nout vec4 color)\n{\nif (useCurve)\nmask = smoothstep(curveLower, curveUpper, mask);\nelse\nmask = clamp(mask, 0.0, 1.0);\ncolor = mix(color1, color2, mask);\n}",node_color_correction_mx_frag:"#define REWIRE_RED 0\n#define REWIRE_GREEN 1\n#define REWIRE_BLUE 2\n#define REWIRE_ALPHA 3\n#define REWIRE_RED_INV 4\n#define REWIRE_GREEN_INV 5\n#define REWIRE_BLUE_INV 6\n#define REWIRE_ALPHA_INV 7\n#define REWIRE_MONOCHROME 8\n#define REWIRE_ONE 9\n#define REWIRE_ZERO 10\nfloat rewireChannel(int type, vec4 color)\n{\nif (type == REWIRE_RED)\nreturn color.r;\nelse if (type == REWIRE_GREEN)\nreturn color.g;\nelse if (type == REWIRE_BLUE)\nreturn color.b;\nelse if (type == REWIRE_ALPHA)\nreturn color.a;\nelse if (type == REWIRE_RED_INV)\nreturn 1.0-color.r;\nelse if (type == REWIRE_GREEN_INV)\nreturn 1.0-color.g;\nelse if (type == REWIRE_BLUE_INV)\nreturn 1.0-color.b;\nelse if (type == REWIRE_ALPHA_INV)\nreturn 1.0-color.a;\nelse if (type == REWIRE_MONOCHROME)\nreturn average(color.rgb);\nelse if (type == REWIRE_ONE)\nreturn 1.0;\nelse\nreturn 0.0;\n}\nvoid node_color_correction(const ivec4 rewire,\nconst vec4 color, const float hueShift, const float saturation,\nconst vec4 tint, const float tintStrength,\nconst float brightness, const float contrast,\nout vec4 outColor)\n{\nif (all(equal(rewire, ivec4(REWIRE_RED, REWIRE_GREEN, REWIRE_BLUE, REWIRE_ALPHA)))) {\noutColor = color;\n} else {\noutColor.r = rewireChannel(rewire.x, color);\noutColor.g = rewireChannel(rewire.y, color);\noutColor.b = rewireChannel(rewire.z, color);\noutColor.a = rewireChannel(rewire.w, color);\n}\nvec4 hsv;\nrgbToHSV(outColor, hsv);\nhsv[0] += hueShift / 360.0;\nif (hsv[0] > 1.0)\nhsv[0] -= 1.0;\nelse if (hsv[0] < 0.0)\nhsv[0] += 1.0;\nhsv[1] *= (saturation / 100.0 + 1.0);\nhsv[1] = saturate(hsv[1]);\nif (tintStrength > 0.0) {\nvec4 hsvTint;\nrgbToHSV(tint, hsvTint);\nhsv[0] = hsv[0] + (hsvTint[0] - hsv[0]) * tintStrength / 100.0;\n}\nhsvToRGB(hsv, outColor);\noutColor = (outColor - 0.5) * (contrast / 100.0 + 1.0) + 0.5 + brightness / 100.0;\noutColor = max(outColor, 0.0);\n}",node_color_map_mx_frag:"void node_color_map(const bool reverseGamma,\nconst vec4 color, const float gamma, const float gain,\nout vec4 outColor)\n{\nfloat p = reverseGamma ? gamma : 1.0 / gamma;\nfloat g = reverseGamma ? (gain > EPSILON ? 1.0 / gain : 1.0) : gain;\noutColor = vec4(g * pow(abs(color.rgb), vec3(p)), color.a);\n}",node_composite_layer_mx_frag:"#define COMP_BLEND_NORMAL 0\n#define COMP_BLEND_AVERAGE 1\n#define COMP_BLEND_ADD 2\n#define COMP_BLEND_SUBTRACT 3\n#define COMP_BLEND_DARKEN 4\n#define COMP_BLEND_MULTIPLY 5\n#define COMP_BLEND_COLORBURN 6\n#define COMP_BLEND_LINEARBURN 7\n#define COMP_BLEND_LIGHTEN 8\n#define COMP_BLEND_SCREEN 9\n#define COMP_BLEND_COLORDODGE 10\n#define COMP_BLEND_LINEARDODGE 11\n#define COMP_BLEND_SPOT 12\n#define COMP_BLEND_SPOTBLEND 13\n#define COMP_BLEND_OVERLAY 14\n#define COMP_BLEND_SOFTLIGHT 15\n#define COMP_BLEND_HARDLIGHT 16\n#define COMP_BLEND_PINLIGHT 17\n#define COMP_BLEND_HARDMIX 18\n#define COMP_BLEND_DIFFERENCE 19\n#define COMP_BLEND_EXCLUSION 20\n#define COMP_BLEND_HUE 21\n#define COMP_BLEND_SATURATION 22\n#define COMP_BLEND_COLOR 23\n#define COMP_BLEND_VALUE 24\nvec4 calcBlending(const vec4 colorBG, const vec4 colorFG, const int blendMode) {\nif (blendMode == COMP_BLEND_NORMAL)\nreturn colorFG;\nelse if (blendMode == COMP_BLEND_AVERAGE)\nreturn (colorFG + colorBG) / 2.0;\nelse if (blendMode == COMP_BLEND_ADD)\nreturn colorBG + colorFG;\nelse if (blendMode == COMP_BLEND_SUBTRACT)\nreturn colorBG - colorFG;\nelse if (blendMode == COMP_BLEND_DARKEN)\nreturn min(colorFG, colorBG);\nelse if (blendMode == COMP_BLEND_MULTIPLY)\nreturn colorBG * colorFG;\nelse if (blendMode == COMP_BLEND_COLORBURN) {\nif (colorFG.r == 0.0 && colorFG.g == 0.0 && colorFG.b == 0.0)\nreturn vec4(0.0, 0.0, 0.0, 1.0);\nelse\nreturn max(1.0 - (1.0 - colorBG) / colorFG, 0.0);\n} else if (blendMode == COMP_BLEND_LINEARBURN)\nreturn max(colorFG + colorBG - 1.0, 0.0);\nelse if (blendMode == COMP_BLEND_LIGHTEN)\nreturn max(colorFG, colorBG);\nelse if (blendMode == COMP_BLEND_SCREEN)\nreturn colorFG + colorBG - colorFG * colorBG;\nelse if (blendMode == COMP_BLEND_COLORDODGE) {\nif (colorFG.r == 1.0 && colorFG.g == 1.0 && colorFG.b == 1.0)\nreturn vec4(1.0);\nelse\nreturn min(colorBG / (1.0 - colorFG), 1.0);\n} else if (blendMode == COMP_BLEND_LINEARDODGE)\nreturn min(colorFG + colorBG, 1.0);\nelse if (blendMode == COMP_BLEND_SPOT)\nreturn min(2.0 * colorFG * colorBG, 1.0);\nelse if (blendMode == COMP_BLEND_SPOTBLEND)\nreturn min(colorFG * colorBG + colorBG, 1.0);\nelse if (blendMode == COMP_BLEND_OVERLAY) {\nif (colorBG.r <= 0.5 && colorBG.g <= 0.5 && colorBG.b <= 0.5)\nreturn saturate(2.0 * colorFG * colorBG);\nelse\nreturn saturate(1.0 - 2.0 * (1.0-colorFG) * (1.0-colorBG));\n} else if (blendMode == COMP_BLEND_SOFTLIGHT) {\nif (colorFG.r <= 0.5 && colorFG.g <= 0.5 && colorFG.b <= 0.5)\nreturn saturate(colorBG * (colorBG + 2.0 * colorFG * (1.0 - colorBG)));\nelse\nreturn saturate(colorBG + (2.0 * colorFG - 1.0) * (sqrt(colorBG) - colorBG));\n} else if (blendMode == COMP_BLEND_HARDLIGHT) {\nif (colorFG.r <= 0.5 && colorFG.g <= 0.5 && colorFG.b <= 0.5)\nreturn saturate(2.0 * colorFG * colorBG);\nelse\nreturn saturate(1.0 - 2.0*(1.0 - colorFG)*(1.0 - colorBG));\n} else if (blendMode == COMP_BLEND_PINLIGHT) {\nif (((colorFG.r > 0.5 && colorFG.g > 0.5 && colorFG.b > 0.5) && all(greaterThan(colorFG, colorBG))) ||\n((colorFG.r <= 0.5 && colorFG.g <= 0.5 && colorFG.b <= 0.5) && all(lessThan(colorFG, colorBG))))\nreturn colorFG;\nelse\nreturn colorBG;\n} else if (blendMode == COMP_BLEND_HARDMIX) {\nif (colorFG.r + colorBG.r <= 1.0 && colorFG.g + colorBG.g <= 1.0 && colorFG.b + colorBG.b <= 1.0)\nreturn vec4(0.0, 0.0, 0.0, 1.0);\nelse\nreturn vec4(1.0);\n} else if (blendMode == COMP_BLEND_DIFFERENCE)\nreturn abs(colorFG - colorBG);\nelse if (blendMode == COMP_BLEND_EXCLUSION)\nreturn colorFG + colorBG - 2.0 * colorFG * colorBG;\n}\nvec4 calcBlendingHSV(const vec4 colorBG, const vec4 colorFG, const int blendMode)\n{\nvec4 hsvBG, hsvFG;\nvec4 outColor;\nif (blendMode == COMP_BLEND_HUE) {\nrgbToHSV(colorBG, hsvBG);\nrgbToHSV(colorFG, hsvFG);\nhsvToRGB(vec4(hsvFG[0], hsvBG[1], hsvBG[2], 1.0), outColor);\n} else if (blendMode == COMP_BLEND_SATURATION) {\nrgbToHSV(colorBG, hsvBG);\nrgbToHSV(colorFG, hsvFG);\nhsvToRGB(vec4(hsvBG[0], hsvFG[1], hsvBG[2], 1.0), outColor);\n} else if (blendMode == COMP_BLEND_COLOR) {\nrgbToHSV(colorBG, hsvBG);\nrgbToHSV(colorFG, hsvFG);\nhsvToRGB(vec4(hsvFG[0], hsvFG[1], hsvBG[2], 1.0), outColor);\n} else if (blendMode == COMP_BLEND_VALUE) {\nrgbToHSV(colorBG, hsvBG);\nrgbToHSV(colorFG, hsvFG);\nhsvToRGB(vec4(hsvBG[0], hsvBG[1], hsvFG[2], 1.0), outColor);\n}\nreturn outColor;\n}\nvoid node_composite_layer(const int blendMode, const float opacity, \nconst vec4 colorBG, const vec4 colorFG, const vec4 mask,\nout vec4 outColor)\n{\nfloat fac = saturate(opacity * average(mask.rgb));\nif (blendMode < COMP_BLEND_HUE)\noutColor = calcBlending(colorBG, colorFG, blendMode);\nelse\noutColor = calcBlendingHSV(colorBG, colorFG, blendMode);\noutColor = mix(colorBG, outColor, fac);\n}",node_falloff_mx_frag:"void node_falloff(vec3 viewPos, float IOR,\nconst vec4 color1, const vec4 color2, vec3 normal, out vec4 color)\n{\nfloat fac;\n\nvec3 dir = normalize(viewPos);\nfloat eta = max(IOR, 0.00001);\nfac = fresnelReflection(dir, normal, (gl_FrontFacing) ? eta : 1.0 / eta);\ncolor = mix(color1, color2, fac);\n}",node_gradient_ramp_mx_frag:"#define GRAD_TYPE_4_CORNER 0\n#define GRAD_TYPE_BOX 1\n#define GRAD_TYPE_DIAGONAL 2\n#define GRAD_TYPE_LIGHTING 3\n#define GRAD_TYPE_LINEAR 4\n#define GRAD_TYPE_MAPPED 5\n#define GRAD_TYPE_NORMAL 6\n#define GRAD_TYPE_PONG 7\n#define GRAD_TYPE_RADIAL 8\n#define GRAD_TYPE_SPIRAL 9\n#define GRAD_TYPE_SWEEP 10\n#define GRAD_TYPE_TARTAN 11\nvoid node_gradient_ramp(\nsampler2D gradientData, int gradientType, vec2 uvIn, vec3 geometryNormal,\nvec3 viewPos, int mapping, int axis, ivec2 clampToEdgeNoExtend,\nvec4 sourceMap, float uOffset, float vOffset, float uTiling, float vTiling, float wAngle,\nout vec4 outCol)\n{\nvec3 coordsIn;\nif (mapping == MAPPING_EXPLICIT_MAP_CHANNEL) {\ncoordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 0.0);\n} else if (mapping == MAPPING_VERTEX_COLOR_CHANNEL) {\ncoordsIn = vec3(0.0);\n} else if (mapping == MAPPING_PLANAR_OBJECT_XYZ) {\ncoordsIn = swizzleUpZ((invModelMatrix * invViewMatrix * vec4(-viewPos, 1.0)).xyz);\n} else {\ncoordsIn = swizzleUpZ((invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);\n}\nif (axis == AXIS_XY)\ncoordsIn = vec3(coordsIn.x, coordsIn.y, 1.0);\nelse if (axis == AXIS_YZ)\ncoordsIn = vec3(coordsIn.y, coordsIn.z, 1.0);\nelse if (axis == AXIS_ZX)\ncoordsIn = vec3(coordsIn.z, coordsIn.x, 1.0);\nvec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;\nfloat coord = uvIn.x;\nuvIn = coordsOut.xy;\nif ((clampToEdgeNoExtend[0] == 1 && (uvIn.x < 0.0 || uvIn.x > 1.0)) ||\n(clampToEdgeNoExtend[1] == 1 && (uvIn.y < 0.0 || uvIn.y > 1.0))) {\noutCol = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nuvIn = fract(uvIn);\nif (gradientType == GRAD_TYPE_4_CORNER) {\ncoord = pow(uvIn.x, 2.0);\n} else if (gradientType == GRAD_TYPE_BOX) {\nvec2 boxUv = abs(uvIn - vec2(0.5)) * 2.0;\ncoord = max(boxUv.x, boxUv.y);\n} else if (gradientType == GRAD_TYPE_DIAGONAL) {\ncoord = abs(uvIn.x - uvIn.y) * sqrt(2.0);\n} else if (gradientType == GRAD_TYPE_LIGHTING) {\nIncidentLight directLight;\nGeometricContext geometry;\ngeometry.position = -viewPos;\nvec3 irr = vec3(0.0);\n#if (NUM_POINT_LIGHTS > 0)\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\ngetPointLightInfo(pointLights[i], geometry, directLight);\nfloat dotNL = saturate(dot(geometryNormal, directLight.direction));\nirr += dotNL * directLight.color;\n}\n#pragma unroll_loop_end\n#endif\n#if (NUM_SPOT_LIGHTS > 0)\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\ngetSpotLightInfo(spotLights[i], geometry, directLight);\nfloat dotNL = saturate(dot(geometryNormal, directLight.direction));\nirr += dotNL * directLight.color;\n}\n#pragma unroll_loop_end\n#endif\n#if (NUM_DIR_LIGHTS > 0)\n#pragma unroll_loop_start\nfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\ngetDirectionalLightInfo(directionalLights[i], geometry, directLight);\nfloat dotNL = saturate(dot(geometryNormal, directLight.direction));\nirr += dotNL * directLight.color;\n}\n#pragma unroll_loop_end\n#endif\n#if defined(PHYSICALLY_CORRECT_LIGHTS)\nirr /= PI;\n#endif\nvec3 ambIrr = getAmbientLightIrradiance(ambientLightColor);\n#if !defined(PHYSICALLY_CORRECT_LIGHTS)\nambIrr /= PI;\n#endif\nirr += ambIrr;\ncoord = (irr.x + irr.y + irr.z) / 3.0;\n} else if (gradientType == GRAD_TYPE_LINEAR) {\ncoord = uvIn.x;\n} else if (gradientType == GRAD_TYPE_MAPPED) {\ncoord = (sourceMap.x + sourceMap.y + sourceMap.z) / 3.0;\n} else if (gradientType == GRAD_TYPE_NORMAL) {\nfloat angle = acos(clamp(dot(geometryNormal, normalize(viewPos)), -1.0, 1.0));\nfloat k = 100.0;\ncoord = 1.0 - sin(pow2(k) - k * sqrt(pow2(k) - pow2(angle)));\n} else if (gradientType == GRAD_TYPE_PONG) {\nfloat y = min(uvIn.y, uvIn.x);\nfloat x = max(uvIn.y, uvIn.x);\ncoord = y / x;\n} else if (gradientType == GRAD_TYPE_RADIAL) {\ncoord = length(uvIn - vec2(0.5)) * 2.0;\n} else if (gradientType == GRAD_TYPE_SPIRAL) {\nvec2 uvSpiral = mat2(0.0, 1.0, -1.0, 0.0) * (uvIn - vec2(0.5));\ncoord = atan(uvSpiral.y, uvSpiral.x) / PI2 + 0.5;\n} else if (gradientType == GRAD_TYPE_SWEEP) {\ncoord = atan(uvIn.x, uvIn.y) / PI_HALF;\n} else if (gradientType == GRAD_TYPE_TARTAN) {\nvec2 uvTartan = abs(uvIn - vec2(0.5));\ncoord = 1.0 - min(uvTartan.x, uvTartan.y) * 2.0;\n}\noutCol = texture2D(gradientData, vec2(coord, 0.0));\n}",node_map_mx_frag:"\nvoid node_map(const vec4 colorIn, out vec4 color)\n{\ncolor = colorIn;\n}",node_mask_mx_frag:"void node_mask(const bool maskInverted,\nconst vec4 color, vec4 mask,\nout vec4 outColor)\n{\nmask = maskInverted ? vec4(vec3(1.0) - mask.rgb, mask.a) : mask;\noutColor = color * mask;\n}",node_material_mx_frag:"void node_material(\nfloat reflectionRatio, const float refractionRatio,\nconst bool selfIllumColorOn,\nconst vec4 ambientColor, const vec4 diffuseColor, const vec4 specularColor,\nconst float glossiness, const float specularLevel, const vec4 selfIllum,\nconst float opacity, const vec4 filterColor, const vec3 normal,\nconst vec4 reflection, const vec4 refraction, const float displacement,\nout vec4 outColor)\n{\nvec3 diffuse, specular;\nNodeMaterial material;\nfloat ior = 1.5;\nfloat facing = pow2((1.0 - ior) / (1.0 + ior));\nfloat edge = 1.0;\nfloat slope = 5.0;\nfloat cosTheta = saturate(dot(normal, normalize(vViewPosition)));\nfloat fresnelRefl = (facing + (edge - facing) * pow(1.0 - cosTheta, slope)) * saturate(specularLevel);\nfloat kd = 1.0 - fresnelRefl;\nmaterial.diffuseColor = diffuseColor.rgb * kd;\nmaterial.specularColor = mix(vec3(0.0), specularColor.rgb, fresnelRefl);\nmaterial.roughness = 1.0 - glossiness;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\ndiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\nif (selfIllumColorOn) {\ndiffuse += selfIllum.rgb;\n} else {\ndiffuse = mix(diffuse, material.diffuseColor, selfIllum[0]);\n}\nspecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\noutColor = vec4(saturate(diffuse + specular), 1.0);\nfloat alpha = opacity - saturate(maxFromRGB(specular)) * (opacity - 1.0);\noutColor += reflection * specularColor * reflectionRatio;\noutColor += refraction * refractionRatio;\nalpha += saturate(maxFromRGB(reflection.rgb) * maxFromRGB(specularColor.rgb)) * reflectionRatio;\nalpha += saturate(maxFromRGB(refraction.rgb)) * refractionRatio;\noutColor.a = alpha;\n}",node_matte_shadow_mx_frag:"#include <shadowmask_pars_fragment>\nvoid node_matte_shadow(\nvec3 normal, bool receiveShadow, float shadowBrightness, vec3 color,\nout vec4 outColor) {\nfloat shadow = getShadowMask();\noutColor = vec4(color, 1.0 - (shadowBrightness + (1.0 - shadowBrightness) * shadow));\n}",node_mix_mx_frag:"void node_mix(const vec4 color1, const vec4 color2, const float amount, out vec4 color)\n{\ncolor = mix(color1, color2, clamp(amount, 0.0, 1.0));\n}",node_noise_mx_frag:"#define NOISE_REGULAR 0\n#define NOISE_FRACTAL 1\n#define NOISE_TURBULENCE 2\nfloat noise(vec3 vec, const int noiseType, const float size, const float thresholdLow, const float thresholdHigh, const float levels, float phase) {\nvec /= size;\nfloat n = 0.0;\nif (noiseType == NOISE_REGULAR) {\nn = (1.0 + snoise(vec4(vec, phase))) * 0.5;\n} else if (noiseType == NOISE_FRACTAL) {\nfloat l, f = 1.0;\nfor (l = levels; l >= 1.0; l-=1.0) { \nn += snoise(vec4(vec * f, phase)) / f;\nf *= 2.0;\n}\nif (l > 0.0) \nn += l * snoise(vec4(vec * f, phase)) / f; \nn = 0.5 * (n + 1.0);\n} else {\nfloat l, f = 1.0;\nfloat ml = levels;\nfor (l = levels; l >= 1.0; l-=1.0, ml-=1.0) {\nn += abs(snoise(vec4(vec * f, phase))) / f;\nf *= 2.0f;\n}\nif (l > 0.0)\nn += l * abs(snoise(vec4(vec * f, phase))) / f;\n}\nreturn clamp(smoothstep(thresholdLow, thresholdHigh, n), 0.0, 1.0);\n}\nvoid node_noise(const vec2 uv, const int noiseType, const int coordType, \nconst vec3 color1, const vec3 color2, const float size,\nconst float thresholdLow, const float thresholdHigh, const float levels,\nconst float phase, const vec3 offset, const vec3 tiling, const vec3 angle,\nout vec4 color) {\nvec3 vec = (calcXYZTransform(offset, tiling, angle) * vec4(uv.x, 1.0 - uv.y, 1.0, 1.0)).xyz;\ncolor = vec4(mix(color1, color2, noise(vec, noiseType, size, thresholdLow, thresholdHigh, levels, phase)), 1.0);\n}\nvoid node_noise(const vec3 viewPos, const int noiseType, const int coordType,\nconst vec3 color1, const vec3 color2, const float size,\nconst float thresholdLow, const float thresholdHigh, const float levels,\nconst float phase, const vec3 offset, const vec3 tiling, const vec3 angle,\nout vec4 color) {\nvec4 posWorld = invViewMatrix * vec4(-viewPos, 1.0);\nvec3 vec;\nif (coordType == 0)\nvec = (invModelMatrix * posWorld).xyz;\nelse\nvec = posWorld.xyz;\nvec = (calcXYZTransform(offset, tiling, angle) * vec4(swizzleUpZ(vec), 1.0)).xyz;\ncolor = vec4(mix(color1, color2, noise(vec, noiseType, size, thresholdLow, thresholdHigh, levels, phase)), 1.0);\n}",node_normal_bump_mx_frag:"void node_normal_bump(const vec4 tangent, const vec3 normal, ivec2 flip,\nvec4 normalColor, vec3 additionalBump, float normalMult, float addBumpMult,\nout vec3 normalOut)\n{\nif (flip[0] == 1)\nnormalColor.x = 1.0 - normalColor.x;\nif (flip[1] == 0)\nnormalColor.y = 1.0 - normalColor.y;\nvec3 normalTex = (normalColor.xyz * 2.0 - 1.0);\nvec4 viewTangent = vec4(normalize(modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz, tangent.w);\nvec3 bitangent = viewTangent.w * cross(normal, viewTangent.xyz);\nnormalOut = normalize(normalTex.x * viewTangent.xyz + normalTex.y * bitangent \n+ normalTex.z * normal);\nnormalOut = mix(normal, normalOut, normalMult);\nadditionalBump = mix(normal, additionalBump, addBumpMult);\nnormalOut = normalize(normalOut + additionalBump);\n}",node_output_map_mx_frag:"vec4 processOutputColor(vec4 color, const bool invert, const bool clampColor, const bool alphaFromRGB,\nconst float rgbLevel, const float rgbOffset, const float outputAmount)\n{\nvec3 color3 = color.rgb;\ncolor3 = clampColor ? saturate(color3) : color3;\ncolor3 = color3 * rgbLevel + vec3(rgbOffset);\ncolor3 = invert ? (vec3(1.0) - color3) : color3;\ncolor = outputAmount * vec4(color3, color.a);\ncolor.a = alphaFromRGB ? average(color.rgb) : color.a;\nreturn color;\n}\nvoid node_output_map(\nconst bool invert, const bool clampColor, const bool alphaFromRGB,\nconst vec4 color, const float rgbLevel, const float rgbOffset,\nconst float outputAmount, const float bumpAmount,\nout vec4 outColor)\n{\noutColor = processOutputColor(color, invert, clampColor, alphaFromRGB, rgbLevel, rgbOffset, outputAmount);\n}\nvoid node_output_map(\nconst bool invert, const bool clampColor, const bool alphaFromRGB, sampler2D colormap,\nvec4 color, const float rgbLevel, const float rgbOffset,\nconst float outputAmount, const float bumpAmount,\nout vec4 outColor)\n{\nfloat r = texture2D(colormap, vec2(color.r, 0.0)).r;\nfloat g = texture2D(colormap, vec2(color.g, 0.0)).g;\nfloat b = texture2D(colormap, vec2(color.b, 0.0)).b;\noutColor = processOutputColor(vec4(r, g, b, color.a),\ninvert, clampColor, alphaFromRGB, rgbLevel, rgbOffset, outputAmount);\n}",node_output_mx_frag:"void node_output(vec4 color, out vec4 outgoingLight)\n{\noutgoingLight = color;\n}",node_physical_mx_frag:"#define DEFAULT_REFLECTION_EDGE 1.0\n#define DEFAULT_REFLECTION_SLOPE 5.0\nvoid node_physical(\nvec3 geometryNormal, const float emitLuminance, const bool useCustomReflCurve,\nconst float reflFacing, const float reflEdge, const float reflSlope,\nconst bool roughnessInv, const bool transRoughnessLock, const bool transRoughnessInv,\nconst bool thinWalled,\nconst float baseWeight, const vec4 baseColor, const float reflectivity,\nconst vec4 reflColor, const float roughness, const float metalness,\nconst float diffRoughness, const float anisotropy, const float anisoangle,\nconst float transparency, const vec4 transColor, const float transRoughness,\nconst float ior, const float scattering, const vec4 sssColor,\nconst float sssScale, const float emission, const vec4 emitColor,\nconst float coating, const vec4 coatColor, const float coatRoughness,\nconst vec3 normal, const vec3 clearcoatNormal, const float displacement,\nconst float opacity,\nout vec4 outColor)\n{\nNodeMaterial material;\nvec3 baseColorWeighted = baseWeight * baseColor.rgb;\nmaterial.diffuseColor = baseColorWeighted * (1.0 - transparency);\n#ifdef USE_CLEARCOAT\nmaterial.clearcoat = saturate(coating);\nmaterial.clearcoatRoughness = clamp(coatRoughness, 0.0, 1.0);\nmaterial.clearcoatF0 = vec3(0.04);\nmaterial.clearcoatF90 = 1.0;\n#endif\nfloat facing, edge, slope;\nif (useCustomReflCurve) {\nfacing = reflFacing;\nedge = reflEdge;\nslope = reflSlope;\n} else {\nfacing = pow2((1.0 - ior) / (1.0 + ior));\nedge = DEFAULT_REFLECTION_EDGE;\nslope = DEFAULT_REFLECTION_SLOPE;\n}\nfloat cosTheta = saturate(dot(normal, normalize(vViewPosition)));\nfloat fresnelRefl = (facing + (edge - facing) * pow(1.0 - cosTheta, slope))\n* saturate(reflectivity + metalness);\nfloat kd = 1.0 - (metalness * (1.0 - fresnelRefl) + fresnelRefl);\nmaterial.specularColor = mix(metalness * baseColorWeighted, reflColor.rgb, fresnelRefl);\nmaterial.diffuseColor *= kd;\nmaterial.specularF90 = 1.0;\nmaterial.roughness = clamp(roughnessInv ? (1.0 - roughness) : roughness, 0.0, 1.0);\nmaterial.refractionColor = pow(transparency * (1.0 - metalness) * transColor.rgb, vec3(2.0));\nmaterial.refractionIOR = ior;\nfloat tRough;\nif (transRoughnessLock) {\ntRough = roughnessInv ? 1.0 - roughness : roughness;\n} else {\ntRough = transRoughnessInv ? 1.0 - transRoughness : transRoughness;\n}\nmaterial.refractionRoughness = pow2(tRough);\n#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)\nfloat geomRoughness = calcGeometryRoughness(geometryNormal);\nmaterial.roughness = calcCubeUVAdjustedRoughness(\nmaterial.roughness, geomRoughness);\nmaterial.refractionRoughness = calcCubeUVAdjustedRoughness(\nmaterial.refractionRoughness, geomRoughness);\n#ifdef USE_CLEARCOAT\nmaterial.clearcoatRoughness = calcCubeUVAdjustedRoughness(\nmaterial.clearcoatRoughness, geomRoughness);\n#endif\n#endif\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\nvec3 refractedLight = vec3(0.0);\n#ifdef USE_GTAO\nvec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,\ngl_FragCoord.xy / currResolution);\nvec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));\n#define PROBE_NORMAL bentNormal\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#define RE_Refraction RE_Refraction_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#undef RE_Refraction\n#ifdef PROBE_NORMAL\n#undef PROBE_NORMAL\n#endif\n#ifdef USE_GTAO\nreflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;\nfloat gtaoVisibility = gtaoVisibilityBentNormal.r;\nvec3 gtaoBentNormal = bentNormal;\nvec3 gtaoViewDir = geometry.viewDir;\nvec3 gtaoNormal = normal;\nfloat gtaoRoughness = material.roughness;\n#endif\n#include <lights_fragment_gtso>\nvec3 totalEmissiveRadiance = emitLuminance / LUMENS_PER_WATT * emission * emitColor.rgb;\nvec3 specular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\nvec3 outColor3 = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\nspecular + totalEmissiveRadiance;\n#ifdef USE_CLEARCOAT\nfloat dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));\nvec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);\noutColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;\n#endif\nfloat alpha = 1.0;\nif (thinWalled) {\nalpha = 1.0 - saturate(transparency) + maxFromRGB(specular) * saturate(transparency);\n} else {\noutColor3 += refractedLight;\n}\noutColor = vec4(outColor3, saturate(alpha) * opacity);\n}",node_phy_sun_sky_env_mx_frag:"vec3 perezSky(vec3 paramA, vec3 paramB, vec3 paramC, vec3 paramD, vec3 paramE,\nvec3 radiance, vec3 sunDirection, vec3 direction)\n{\nfloat cosGamma = clamp(dot(direction, sunDirection), -1.0, 1.0);\nfloat cosTheta = clamp(direction.y, 0.0, 1.0);\nvec3 radInternal = (1.0 + paramA * exp(paramB / cosTheta)) * (\n1.0 + paramC * exp(paramD * acos(cosGamma))\n+ paramE * pow(cosGamma, 2.0)\n);\nfloat ciex = radInternal.y * radiance.y;\nfloat ciey = radInternal.z * radiance.z;\nfloat cieY = clamp(radInternal.x * radiance.x, 0.0, 1000000.0);\nvec3 XYZ = xyY_to_XYZ(ciex, ciey, cieY);\nreturn max(xyz_to_sRGB(XYZ), 0.0);\n}\n#define GROUND_SKY_SAMPLES 16\nvec3 groundSky(vec3 paramA, vec3 paramB, vec3 paramC, vec3 paramD, vec3 paramE, vec3 radiance, vec3 sunDirection, vec3 sunIlluminance)\n{\nconst int horizSamples = GROUND_SKY_SAMPLES;\nconst int vertSamples = GROUND_SKY_SAMPLES / 2;\nvec3 result = vec3(0.0);\nfor (int horizSampleIdx = 0; horizSampleIdx < horizSamples; horizSampleIdx++) {\nfloat horizSample = float(horizSampleIdx) / float(horizSamples);\nfloat horizAngle = PI2 * horizSample;\nfor (int vertSampleIdx = 0; vertSampleIdx < vertSamples; vertSampleIdx++) {\nfloat vertSample = float(vertSampleIdx) / float(vertSamples);\nfloat y = 1.0 - vertSample;\nfloat x = sqrt(1.0 - y*y) * cos(horizAngle);\nfloat z = -sqrt(1.0 - y*y) * sin(horizAngle);\nvec3 direction = vec3(x, y, z);\nvec3 sampleColor = perezSky(paramA, paramB, paramC, paramD, paramE,\nradiance, sunDirection, direction);\n\nresult += direction.y * sampleColor;\n}\n}\nresult /= float(horizSamples * vertSamples);\nresult += (sunIlluminance * sunDirection.y) / PI;\nreturn result;\n}\nvoid node_phy_sun_sky_env(vec3 paramA, vec3 paramB, vec3 paramC, vec3 paramD, vec3 paramE,\nvec3 radiance, vec3 sunDirection, vec3 sunIlluminance, vec3 sunLuminance, \nfloat globalIntensity, vec4 groundColor,\nout vec4 outColor) \n{\nvec3 dir = vWorldPosition;\nif (length(dir) == 0.0) {\ndir = vec3(0.0, 0.0, -1.0);\n} else {\ndir = normalize(dir);\n}\nif (dir.y < 0.0) {\noutColor = groundColor * vec4(groundSky(paramA, paramB, paramC, paramD, paramE, radiance, sunDirection, sunIlluminance), 1.0);\n} else {\noutColor = vec4(perezSky(paramA, paramB, paramC, paramD, paramE,\nradiance, sunDirection, dir), 1.0);\n}\noutColor = globalIntensity * outColor;\n}",node_reflect_refract_mx_frag:"void node_reflect_refract(sampler2D envMap,\nint reflectMode, const float IOR, const int encoding,\nvec3 normal, out vec4 color)\n{\nvec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);\nvec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\nvec3 reflectVec;\nif (reflectMode == MAX_ENV_COORDS_REFLECT)\nreflectVec = reflect(cameraToVertex, worldNormal);\nelse {\nfloat refrRatio = 1.0 / IOR;\nreflectVec = refract(cameraToVertex, worldNormal, refrRatio);\n}\nreflectVec = normalize(reflectVec);\ncolor = sampleEquirectangular(envMap, reflectVec, mat3(1.0), encoding);\n}",node_reflect_refract_color_mx_frag:"void node_reflect_refract_color(const vec4 colorIn, out vec4 color)\n{\ncolor = vec4(colorIn);\n}",node_rgb_multiply_mx_frag:"void node_rgb_multiply(const vec4 color1, const vec4 color2, out vec4 color)\n{\ncolor = color1 * color2;\n}",node_rgb_tint_mx_frag:"void node_rgb_tint(const vec4 color, const vec4 red, const vec4 green, const vec4 blue,\nout vec4 outColor)\n{\nmat3 tintMatrix = mat3(red.rgb, green.rgb, blue.rgb);\noutColor = vec4(tintMatrix * color.rgb, color.a);\n}",node_rgb_mx_frag:"uniform vec4 nodeRGB[NODE_RGB_NUM];\nvoid node_rgb(vec4 color, out vec4 outColor)\n{\noutColor = color;\n}",node_shellac_mx_frag:"void node_shellac(const vec4 color1, const vec4 color2, const float amount,\nout vec4 color)\n{\ncolor = mix(color1, color2, clamp(amount, 0.0, 1.0));\n}",node_tex_environment_mx_frag:"\nvoid node_tex_environment(sampler2D tex, const int encoding, vec3 vector, out vec4 outColor) {\n\nvec3 direction = swizzleUpY(vector);\nif (length(direction) == 0.0) {\ndirection = vec3(0.0, 1.0, 0.0);\n} else {\ndirection = normalize(direction);\n}\nvec2 uv;\nuv.y = asin(clamp(direction.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;\nuv.x = atan(direction.x, direction.z) * RECIPROCAL_PI2 + 0.5;\nuv.y *= -1.0;\nconst float seamWidth = 0.15;\nconst float seamBiasFactor = -10.0;\nfloat seam = max(0.0, 1.0 - abs (direction.x) / seamWidth) *\nclamp (1.0 - direction.z / seamWidth, 0.0, 1.0);\noutColor = texture2D(tex, uv, seamBiasFactor * seam);\noutColor = nodeTexelToLinear(outColor, encoding);\n}",node_value_mx_frag:"uniform float nodeValue[NODE_VALUE_NUM];\nvoid node_value(float val, out float outVal)\n{\noutVal = val;\n}",node_vertex_color_mx_frag:"void node_vertex_color(vec3 color, out vec4 outColor)\n{\noutColor = vec4(color, 1.0);\n}",node_add_double_linear_my_frag:"void node_add_double_linear(\nfloat input1, float input2,\nout float outValue) {\noutValue = input1 + input2;\n}",node_add_matrix_my_frag:"void node_add_matrix(\nmat4 matrixIn1,\nout mat4 matrixSum)\n{\nmatrixSum = matrixIn1;\n}\nvoid node_add_matrix(\nmat4 matrixIn1, mat4 matrixIn2,\nout mat4 matrixSum)\n{\nmatrixSum = matrixIn1 + matrixIn2;\n}\nvoid node_add_matrix(\nmat4 matrixIn1, mat4 matrixIn2, mat4 matrixIn3,\nout mat4 matrixSum)\n{\nmatrixSum = matrixIn1 + matrixIn2 + matrixIn3;\n}",node_anim_curve_ta_my_frag:"uniform float nodeValue[NODE_VALUE_NUM];\nvoid node_anim_curve_ta(float val, out float outVal)\n{\noutVal = val;\n}",node_anim_curve_tu_my_frag:"uniform float nodeValue[NODE_VALUE_NUM];\nvoid node_anim_curve_tu(float val, out float outVal)\n{\noutVal = val;\n}",node_blend_colors_my_frag:"void node_blend_colors(float blender, vec3 color1, vec3 color2, out vec3 outColor)\n{\nblender = clamp(blender, 0.0, 1.0);\noutColor = mix(color1, color2, 1.0 - blender);\n}\nvoid node_blend_colors(float blender, vec4 color1, vec4 color2, out vec4 outColor)\n{\nblender = clamp(blender, 0.0, 1.0);\noutColor = mix(color1, color2, 1.0 - blender);\n}",node_bulge_my_frag:"void node_bulge(\nfloat uWidth, float vWidth, vec2 uvCoord,\nout float outAlpha, out vec3 outColor) {\nuvCoord = 2.0 * fract(uvCoord); \nfloat bulge = 0.0;\nif (uvCoord.x > uWidth && uvCoord.x < 2.0 - uWidth &&\nuvCoord.y > vWidth && uvCoord.y < 2.0 - vWidth) {\nuvCoord.x = (uvCoord.x - uWidth) / (1.0 - uWidth);\nuvCoord.y = (uvCoord.y - vWidth) / (1.0 - vWidth);\nbulge = uvCoord.x * (2.0 - uvCoord.x) * uvCoord.y * (2.0 - uvCoord.y);\n}\noutAlpha = bulge; \noutColor = vec3(bulge, bulge, bulge); \n}",node_blinn_my_frag:"void node_blinn(\nvec3 geometryNormal,\nvec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,\nfloat diffuse, vec3 normal, float reflectivity, vec3 reflectedColor,\nfloat eccentricity, vec3 specularColor, float specularRollOff, float translucence,\nvec3 transparency,\nout vec4 outColor) {\nNodeMaterial material;\nmaterial.diffuseColor = diffuse * color;\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\nvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\nfloat geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\nmaterial.roughness = max(eccentricity, 0.0525);\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min(material.roughness, 1.0);\nmaterial.specularColor = specularColor;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\nfloat alpha = 1.0 - average(transparency);\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\nreflectedLight.directSpecular + reflectedLight.indirectSpecular + incandescence, alpha);\n}",node_bump_2d_my_frag:"void node_bump_2d(\nvec3 normal,\nfloat bumpDepth, float bumpValue,\nout vec3 outNormal) {\nvec3 position = vViewPosition;\nvec3 dPdx = dFdx(position);\nvec3 dPdy = dFdy(position);\nfloat dHdx = dFdx(bumpValue);\nfloat dHdy = dFdy(bumpValue);\nvec3 tanX = cross(dPdy, normal);\nvec3 tanY = cross(normal, dPdx);\nvec3 surfaceGrad = dHdx * tanX + dHdy * tanY;\nfloat dotPosTanX = dot(dPdx, tanX);\noutNormal = normalize(normal * abs(dotPosTanX) - surfaceGrad * sign(dotPosTanX));\noutNormal = normalize(mix(normal, outNormal, max(0.0, bumpDepth)));\n}\nvoid node_bump_2d(\nvec3 normal, vec4 tangent,\nfloat bumpDepth, vec3 bumpValue,\nout vec3 outNormal) {\n#ifdef DOUBLE_SIDED\nnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n#endif\nvec3 normalTex = (bumpValue.xyz * 2.0 - 1.0);\nvec4 viewTangent = vec4(normalize((modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz), tangent.w);\nvec3 bitangent = viewTangent.w * cross(normal, viewTangent.xyz);\noutNormal = normalize(normalTex.x * viewTangent.xyz + normalTex.y * bitangent \n+ normalTex.z * normal);\noutNormal = mix(normal, outNormal, bumpDepth);\n}",node_channels_my_frag:"void node_channels(\nint channelR, int channelG, int channelB, int channelA,\nfloat inAlpha, vec3 inColor,\nout float outAlpha, out vec3 outColor) {\noutAlpha = 1.0;\noutColor = vec3(1.0);\nif (channelR == 0)\noutColor.r = inColor.r;\nelse if (channelR == 1)\noutColor.r = inColor.g;\nelse if (channelR == 2)\noutColor.r = inColor.b;\nelse\noutColor.r = inAlpha;\nif (channelG == 0)\noutColor.g = inColor.r;\nelse if (channelG == 1)\noutColor.g = inColor.g;\nelse if (channelG == 2)\noutColor.g = inColor.b;\nelse\noutColor.g = inAlpha;\nif (channelB == 0)\noutColor.b = inColor.r;\nelse if (channelB == 1)\noutColor.b = inColor.g;\nelse if (channelB == 2)\noutColor.b = inColor.b;\nelse\noutColor.b = inAlpha;\nif (channelA == 0)\noutAlpha = inColor.r;\nelse if (channelA == 1)\noutAlpha = inColor.g;\nelse if (channelA == 2)\noutAlpha = inColor.b;\nelse\noutAlpha = inAlpha;\n}",node_checker_my_frag:"void node_checker(\nvec3 color1, vec3 color2, float contrast, vec2 uvCoord,\nout float outAlpha, out vec3 outColor) {\nuvCoord -= floor(uvCoord); \nvec3 deltaColor = color2 - color1;\ncolor1 += (1.0 - contrast) * 0.5 * deltaColor;\ncolor2 -= (1.0 - contrast) * 0.5 * deltaColor;\nif ((uvCoord.x < 0.5 && uvCoord.y >= 0.5) || (uvCoord.x >= 0.5 && uvCoord.y < 0.5)) { \noutColor = color2; \noutAlpha = 1.0; \n} else {\noutColor = color1; \noutAlpha = 0.0; \n}\n}",node_clamp_my_frag:"void node_clamp(\nvec3 inputValue, vec3 maxValue, vec3 minValue,\nout vec3 outputValue) {\noutputValue = clamp(inputValue, minValue, maxValue);\n}",node_cloth_my_frag:"void node_cloth(\nfloat brightSpread, vec3 gapColor, float randomness, vec3 uColor, float uWave, float uWidth,\nvec3 vColor, float vWave, float vWidth, float widthSpread, vec2 uvCoord,\nout float outAlpha, out vec3 outColor) {\nif (abs(uWave) > -EPSILON || abs(vWave) > -EPSILON) {\nuvCoord.x += - uWave * sin(PI2 * uvCoord.y);\nuvCoord.y += vWave * sin(PI2 * uvCoord.x);\n}\nuvCoord = fract(uvCoord);\nint thread = 0;\nif ((uvCoord.x >= 0.5 && uvCoord.y < 0.5) || (uvCoord.x < 0.5 && uvCoord.y >= 0.5)) {\nfloat flippedCoord;\nflippedCoord = uvCoord.x;\nuvCoord.x = uvCoord.y;\nuvCoord.y = flippedCoord;\nflippedCoord = uWidth;\nuWidth = vWidth;\nvWidth = flippedCoord;\nthread = 1;\n}\nuvCoord = fract(2.0 * uvCoord);\nfloat cloth = 1.0;\nif (uvCoord.y <= vWidth) {\nfloat clothU = uvCoord.x - 0.5 * uWidth;\nfloat clothV = 2.0 * uvCoord.y / vWidth - 1.0;\ncloth = 0.75 * (clothU * clothU + clothV * clothV);\n} else if (uvCoord.x <= uWidth) {\nfloat clothU = 2.0 * uvCoord.x / uWidth - 1.0;\nfloat clothV = uvCoord.y - 0.5 * vWidth - 1.0;\ncloth = 0.75 * (clothU * clothU + clothV * clothV);\nthread = 1 - thread;\n}\noutColor = gapColor;\nif (cloth < 1.0) {\ncloth = 1.0 - cloth;\ncloth = min(cloth, 1.0);\noutColor *= (1.0 - cloth);\nvec3 threadColor = uColor;\nif (thread == 0)\nthreadColor = vColor;\noutColor += threadColor * cloth;\n}\noutAlpha = dot(outColor, LUM_WEIGHTS_MAYA);\n}",node_color_condition_my_frag:"void node_color_condition(\nfloat alphaA, float alphaB, vec3 colorA, vec3 colorB, bool condition,\nout float outAlpha, out vec3 outColor) {\noutAlpha = condition ? alphaA : alphaB;\noutColor = condition ? colorA : colorB;\n}",node_color_composite_my_frag:"void node_color_composite(int operation,\nvec3 colorA, float alphaA, vec3 colorB, float alphaB, float factor,\nout vec3 outColor, out float outAlpha)\n{\nif (factor <= 0.0) {\noutColor = colorA;\noutAlpha = alphaA;\nreturn;\n}\nif (operation == 0) {\noutColor[0] = colorA[0] + (colorB[0] * factor);\noutColor[1] = colorA[1] + (colorB[1] * factor);\noutColor[2] = colorA[2] + (colorB[2] * factor);\noutAlpha = alphaA + (alphaB * factor);\n} else if (operation == 1) {\noutColor[0] = colorA[0] + ((colorB[0] - 1.0) * factor);\noutColor[1] = colorA[1] + ((colorB[1] - 1.0) * factor);\noutColor[2] = colorA[2] + ((colorB[2] - 1.0) * factor);\noutAlpha = alphaA + ((alphaB - 1.0) * factor);\n} else if (operation == 2) {\nif (factor >= 1.0) {\noutColor = colorB;\noutAlpha = alphaB;\nreturn;\n}\noutColor[0] = mix(colorA[0], colorB[0], factor);\noutColor[1] = mix(colorA[1], colorB[1], factor);\noutColor[2] = mix(colorA[2], colorB[2], factor);\noutAlpha = mix(alphaA, alphaB, factor);\n} else if (operation == 3) {\noutColor[0] = colorA[0] * (colorB[0] * factor + (1.0 - factor));\noutColor[1] = colorA[1] * (colorB[1] * factor + (1.0 - factor));\noutColor[2] = colorA[2] * (colorB[2] * factor + (1.0 - factor));\noutAlpha = alphaA * (alphaB * factor + (1.0 - factor));\n} else if (operation == 4) {\noutColor[0] = 1.0 - ((1.0 - colorA[0]) * (1.0 - colorB[0] * factor));\noutColor[1] = 1.0 - ((1.0 - colorA[1]) * (1.0 - colorB[1] * factor));\noutColor[2] = 1.0 - ((1.0 - colorA[2]) * (1.0 - colorB[2] * factor));\noutAlpha = 1.0 - ((1.0 - alphaA) * (1.0 - alphaB * factor));\n} else if (operation == 5) {\noutColor[0] = colorB[0] > 0.5 ? (2.0 * colorA[0] * colorB[0] * factor) + colorA[0] * (1.0 - factor) :\n1.0 - ((1.0 - colorA[0]) * (1.0 - colorB[0] * factor)) * (2.0 - (1.0 - factor));\noutColor[1] = colorB[1] > 0.5 ? (2.0 * colorA[1] * colorB[1] * factor) + colorA[1] * (1.0 - factor) :\n1.0 - ((1.0 - colorA[1]) * (1.0 - colorB[1] * factor)) * (2.0 - (1.0 - factor));\noutColor[2] = colorB[2] > 0.5 ? (2.0 * colorA[2] * colorB[2] * factor) + colorA[2] * (1.0 - factor) :\n1.0 - ((1.0 - colorA[2]) * (1.0 - colorB[2] * factor)) * (2.0 - (1.0 - factor));\noutAlpha = alphaB > 0.5 ? (2.0 * alphaA * alphaB * factor) + alphaA * (1.0 - factor) :\n1.0 - ((1.0 - alphaA) * (1.0 - alphaB * factor)) * (2.0 - (1.0 - factor));\n} else if (operation == 6) {\noutColor[0] = abs(colorA[0] - (colorB[0] * factor));\noutColor[1] = abs(colorA[1] - (colorB[1] * factor));\noutColor[2] = abs(colorA[2] - (colorB[2] * factor));\noutAlpha = abs(alphaA - (alphaB * factor));\n} else if (operation == 7) {\noutColor[0] = clamp(mix(colorA[0], colorA[0] / max(1.0 - colorB[0], 0.00001), factor), colorA[0], colorB[0]);\noutColor[1] = clamp(mix(colorA[1], colorA[1] / max(1.0 - colorB[1], 0.00001), factor), colorA[1], colorB[1]);\noutColor[2] = clamp(mix(colorA[2], colorA[2] / max(1.0 - colorB[2], 0.00001), factor), colorA[2], colorB[2]);\noutAlpha = clamp(mix(alphaA, alphaA / max(1.0 - alphaB, 0.00001), factor), alphaA, alphaB);\n} else if (operation == 8) {\noutColor[0] = clamp(mix(colorA[0], 1.0 - (colorA[0] / max(1.0 - colorB[0], 0.00001)), factor), colorA[0], colorB[0]);\noutColor[1] = clamp(mix(colorA[1], 1.0 - (colorA[1] / max(1.0 - colorB[1], 0.00001)), factor), colorA[1], colorB[1]);\noutColor[2] = clamp(mix(colorA[2], 1.0 - (colorA[2] / max(1.0 - colorB[2], 0.00001)), factor), colorA[2], colorB[2]);\noutAlpha = clamp(mix(alphaA, 1.0 - (alphaA / max(1.0 - alphaB, 0.00001)), factor), alphaA, alphaB);\n}\n}",node_color_constant_my_frag:"void node_color_constant(vec3 inColor, float inAlpha, out vec3 outColor, out float outAlpha)\n{\noutColor = inColor;\noutAlpha = inAlpha;\n}",node_color_correct_my_frag:"void node_color_correct(\nbool colClamp, vec3 colClampMin, vec3 colClampMax,\nbool alphaClamp, float alphaClampMin, float alphaClampMax,\nbool unpremultInput, bool premultResult,\nfloat alphaGain, float alphaGamma, float alphaOffset,\nvec3 colGain, vec3 colGamma, vec3 colOffset, float hueShift,\nfloat inAlpha, vec3 inColor, float satGain, float valGain,\nout float outAlpha, out vec3 outColor)\n{\noutColor = unpremultInput ? inColor/inAlpha : inColor;\nif (hueShift != 0.0 || satGain != 1.0 || valGain != 1.0) {\nvec4 color = vec4(outColor, 1.0);\nrgbToHSV(vec4(inColor, 1.0), color);\ncolor.r += hueShift / 360.0;\nif (color.r > 1.0)\ncolor.r -= 1.0;\nelse if (color.r < 0.0)\ncolor.r += 1.0;\ncolor.g *= satGain;\ncolor.b *= valGain;\nhsvToRGB(color, color);\noutColor = color.rgb;\n}\noutColor *= colGain;\noutColor += colOffset;\nif (any(notEqual(colGamma, vec3(1.0))))\noutColor = pow(outColor, 1.0 / colGamma);\nif (colClamp)\noutColor = clamp(outColor, colClampMin, colClampMax);\noutAlpha = inAlpha * alphaGain;\noutAlpha += alphaOffset;\nif (alphaGamma != 1.0)\noutAlpha = pow(outAlpha, 1.0 / alphaGamma);\nif (alphaClamp)\noutAlpha = clamp(outAlpha, alphaClampMin, alphaClampMax);\nif (premultResult)\noutColor *= outAlpha;\n}",node_color_logic_my_frag:"void node_color_logic(\nint operation,\nvec3 colorA, vec3 colorB,\nout bool outBool) {\nif (operation == 0) {\noutBool = all(equal(colorA, colorB));\n} else if (operation == 1) {\noutBool = any(notEqual(colorA, colorB));\n} else if (operation == 2) {\noutBool = ((colorA.x + colorA.y + colorA.z) < (colorB.x + colorB.y + colorB.z));\n} else if (operation == 3) {\noutBool = ((colorA.x + colorA.y + colorA.z) > (colorB.x + colorB.y + colorB.z));\n} else if (operation == 4) {\noutBool = ((colorA.x + colorA.y + colorA.z) <= (colorB.x + colorB.y + colorB.z));\n} else {\noutBool = ((colorA.x + colorA.y + colorA.z) >= (colorB.x + colorB.y + colorB.z));\n}\n}",node_color_mask_my_frag:"void node_color_mask(\nbool maskAlphaIsLuminance,\nfloat inAlpha, vec3 inColor, vec3 mask, float maskAlpha,\nout float outAlpha, out vec3 outColor) {\nif (maskAlphaIsLuminance)\nmaskAlpha = 1.0 - dot(mask, LUM_WEIGHTS_MAYA);\noutColor = inColor * (1.0 - maskAlpha);\n}",node_color_math_my_frag:"void node_color_math(\nint operation,\nfloat alphaA, float alphaB, vec3 colorA, vec3 colorB,\nout float outAlpha, out vec3 outColor) {\nif (operation == 0) {\noutColor = colorA + colorB;\noutAlpha = alphaA + alphaB;\n} else if (operation == 1) {\noutColor = colorA - colorB;\noutAlpha = alphaA - alphaB;\n} else if (operation == 2) {\noutColor = colorA * colorB;\noutAlpha = alphaA * alphaB;\n} else if (operation == 3) {\noutColor = colorA / colorB;\noutAlpha = alphaA / alphaB;\n} else if (operation == 4) {\noutColor = min(colorA, colorB);\noutAlpha = min(alphaA, alphaB);\n} else {\noutColor = max(colorA, colorB);\noutAlpha = max(alphaA, alphaB);\n}\n}",node_compose_matrix_my_frag:"mat3 quatToMat3(vec4 quat) {\nfloat x = quat.x,\ny = quat.y,\nz = quat.z,\nw = quat.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\n\nfloat xx = x * x2;\nfloat yx = y * x2;\nfloat yy = y * y2;\nfloat zx = z * x2;\nfloat zy = z * y2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\n\nmat3 mat;\n\nmat[0][0] = 1.0 - yy - zz;\nmat[1][0] = yx - wz;\nmat[2][0] = zx + wy;\n\nmat[0][1] = yx + wz;\nmat[1][1] = 1.0 - xx - zz;\nmat[2][1] = zy - wx;\n\nmat[0][2] = zx - wy;\nmat[1][2] = zy + wx;\nmat[2][2] = 1.0 - xx - yy;\nreturn mat;\n}\nvoid node_compose_matrix(\nbool useEulerRotation, int inputRotateOrder,\nvec4 inputQuat, vec3 inputRotate, vec3 inputScale, vec3 inputShear, vec3 inputTranslate,\nout mat4 outputMatrix)\n{\nmat4 rotateMatrix;\ninputRotate = radians(inputRotate);\nif (useEulerRotation)\nrotateMatrix = toMat4(mat3RotateX(inputRotate.x) * mat3RotateY(inputRotate.y) * mat3RotateZ(inputRotate.z));\nelse\nrotateMatrix = toMat4(quatToMat3(normalize(inputQuat)));\nmat4 scaleMatrix = mat4(inputScale.x, 0.0, 0.0, 0.0,\n0.0, inputScale.y, 0.0, 0.0,\n0.0, 0.0, inputScale.z, 0.0,\n0.0, 0.0, 0.0, 1.0);\nmat4 shearMatrix = mat4(1.0, 0.0, 0.0, 0.0,\ninputShear.x, 1.0, 0.0, 0.0,\ninputShear.y, inputShear.z, 1.0, 0.0,\n0.0, 0.0, 0.0, 1.0);\nmat4 transMatrix = mat4(1.0, 0.0, 0.0, 0.0,\n0.0, 1.0, 0.0, 0.0,\n0.0, 0.0, 1.0, 0.0,\ninputTranslate.x, inputTranslate.y, inputTranslate.z, 1.0);\noutputMatrix = scaleMatrix * shearMatrix * rotateMatrix * transMatrix;\n}",node_condition_my_frag:"void node_condition(\nint operation,\nvec3 colorIfFalse, vec3 colorIfTrue, float firstTerm, float secondTerm,\nout vec3 outColor) {\nif (operation == 0) {\nif (firstTerm == secondTerm)\noutColor = colorIfTrue;\nelse\noutColor = colorIfFalse;\n} else if (operation == 1) {\nif (firstTerm != secondTerm)\noutColor = colorIfTrue;\nelse\noutColor = colorIfFalse;\n} else if (operation == 2) {\nif (firstTerm > secondTerm)\noutColor = colorIfTrue;\nelse\noutColor = colorIfFalse;\n} else if (operation == 3) {\nif (firstTerm >= secondTerm)\noutColor = colorIfTrue;\nelse\noutColor = colorIfFalse;\n} else if (operation == 4) {\nif (firstTerm < secondTerm)\noutColor = colorIfTrue;\nelse\noutColor = colorIfFalse;\n} else if (operation == 5) {\nif (firstTerm <= secondTerm)\noutColor = colorIfTrue;\nelse\noutColor = colorIfFalse;\n}\n}",node_decompose_matrix_my_frag:"vec4 mat3ToQuat(mat3 m) {\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 q = vec4(0.0, 0.0, 0.0, 0.0);\nif (trace > 0.0) {\nfloat s = sqrt(trace + 1.0) * 2.0;\nq.w = 0.25 * s;\nq.x = (m[2][1] - m[1][2]) / s;\nq.y = (m[0][2] - m[2][0]) / s;\nq.z = (m[1][0] - m[0][1]) / s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]) * 2.0;\nq.w = (m[2][1] - m[1][2]) / s;\nq.x = 0.25 * s;\nq.y = (m[0][1] + m[1][0]) / s;\nq.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]) * 2.0;\nq.w = (m[0][2] - m[2][0]) / s;\nq.x = (m[0][1] + m[1][0]) / s;\nq.y = 0.25 * s;\nq.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]) * 2.0;\nq.w = (m[1][0] - m[0][1]) / s;\nq.x = (m[0][2] + m[2][0]) / s;\nq.y = (m[1][2] + m[2][1]) / s;\nq.z = 0.25 * s;\n}\nreturn q;\n}\nvec3 mat3ToEuler(mat3 m) {\nfloat m11 = m[0][0], m12 = m[1][0], m13 = m[2][0];\nfloat m21 = m[0][1], m22 = m[1][1], m23 = m[2][1];\nfloat m31 = m[0][2], m32 = m[1][2], m33 = m[2][2];\nvec3 euler;\neuler.y = asin(clamp(m13, -1.0, 1.0));\nif (abs(m13) < 0.9999999) {\neuler.x = atan(-m23, m33);\neuler.z = atan(-m12, m11);\n} else {\neuler.x = atan(m32, m22);\neuler.z = 0.0;\n}\nreturn euler;\n}\nvoid decomposeMat4(mat4 m, out vec3 position, out vec4 quat, out vec3 euler, out vec3 scale) {\nfloat sx = length(vec3(m[0][0], m[0][1], m[0][2]));\nfloat sy = length(vec3(m[1][0], m[1][1], m[1][2]));\nfloat sz = length(vec3(m[2][0], m[2][1], m[2][2]));\nfloat det = mat3GetDeterminant(toMat3(m));\nif (det < 0.0)\nsx = -sx;\nposition.x = m[3][0];\nposition.y = m[3][1];\nposition.z = m[3][2];\nfloat invSX = 1.0 / sx;\nfloat invSY = 1.0 / sy;\nfloat invSZ = 1.0 / sz;\nm[0][0] *= invSX;\nm[0][1] *= invSX;\nm[0][2] *= invSX;\nm[1][0] *= invSY;\nm[1][1] *= invSY;\nm[1][2] *= invSY;\nm[2][0] *= invSZ;\nm[2][1] *= invSZ;\nm[2][2] *= invSZ;\nquat = mat3ToQuat(toMat3(m));\neuler = mat3ToEuler(toMat3(m));\nscale.x = sx;\nscale.y = sy;\nscale.z = sz;\n}\nvoid node_decompose_matrix(\nmat4 inputMatrix,\nout vec4 outputQuat, out vec3 outputRotate, out vec3 outputScale, out vec3 outputShear, out vec3 outputTranslate)\n{\ndecomposeMat4(inputMatrix, outputTranslate, outputQuat, outputRotate, outputScale);\noutputShear = vec3(0.0, 0.0, 0.0);\n}",node_env_sphere_my_frag:"void node_env_sphere(sampler2D envMap, int encoding, vec3 normal,\nmat4 placementMatrix,\nout float outAlpha, out vec3 outColor)\n{\nvec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);\nvec3 reflectVec;\n#if WORLD_NODES\nreflectVec = normalize(cameraToVertex);\n#else\nvec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\nreflectVec = reflect(cameraToVertex, worldNormal);\n#endif\nmat3 uvTransform = mat3(1.0);\nreflectVec = toMat3(placementMatrix) * reflectVec;\nvec4 tex = sampleEquirectangular(envMap, reflectVec, uvTransform, encoding);\noutAlpha = tex.a;\noutColor = tex.rgb;\n}",node_file_my_frag:"void node_file(sampler2D ima, const int encoding, const bool rgbToAlpha,\nvec2 uvCoord,\nout float outAlpha, out vec3 outColor, out vec2 outSize, out vec3 outTransparency) {\nvec2 uv = vec2(uvCoord.x, 1.0 - uvCoord.y);\nvec4 tex = texture2D(ima, uv);\noutColor = nodeTexelToLinear(tex, encoding).rgb;\nif (rgbToAlpha)\noutAlpha = dot(tex.rgb, LUM_WEIGHTS_MAYA);\nelse\noutAlpha = tex.a;\noutSize = vec2(0.0);\noutTransparency = vec3(1.0 - outAlpha, 1.0 - outAlpha, 1.0 - outAlpha);\n}",node_float_condition_my_frag:"void node_float_condition(\nbool condition, float floatA, float floatB, \nout float outFloat) {\noutFloat = condition ? floatA : floatB;\n}",node_float_composite_my_frag:"void node_float_composite(int operation,\nfloat floatA, float floatB, float factor,\nout float outFloat)\n{\nif (factor <= 0.0) {\noutFloat = floatA;\nreturn;\n}\nif (operation == 0) {\noutFloat = floatA + (floatB * factor);\n} else if (operation == 1) {\noutFloat = floatA + ((floatB - 1.0) * factor);\n} else if (operation == 2) {\nif (factor >= 1.0) {\noutFloat = floatB;\nreturn;\n}\noutFloat = mix(floatA, floatB, factor);\n} else if (operation == 3) {\noutFloat = floatA * (floatB * factor + (1.0 - factor));\n} else if (operation == 4) {\noutFloat = 1.0 - ((1.0 - floatA) * (1.0 - floatB * factor));\n} else if (operation == 5) {\noutFloat = floatB > 0.5 ? (2.0 * floatA * floatB * factor) + floatA * (1.0 - factor) :\n1.0 - ((1.0 - floatA) * (1.0 - floatB * factor)) * (2.0 - (1.0 - factor));\n} else if (operation == 6) {\noutFloat = abs(floatA - (floatB * factor));\n} else if (operation == 7) {\noutFloat = clamp(mix(floatA, floatA / max(1.0 - floatB, 0.00001), factor), floatA, floatB);\n} else if (operation == 8) {\noutFloat = clamp(mix(floatA, 1.0 - (floatA / max(1.0 - floatB, 0.00001)), factor), floatA, floatB);\n}\n}",node_float_constant_my_frag:"void node_float_constant(float inFloat, out float outFloat)\n{\noutFloat = inFloat;\n}",node_float_logic_my_frag:"void node_float_logic(\nint operation,\nfloat floatA, float floatB,\nout bool outBool) {\nif (operation == 0) {\noutBool = (floatA == floatB);\n} else if (operation == 1) {\noutBool = (floatA != floatB);\n} else if (operation == 2) {\noutBool = (floatA < floatB);\n} else if (operation == 3) {\noutBool = (floatA > floatB);\n} else if (operation == 4) {\noutBool = (floatA <= floatB);\n} else {\noutBool = (floatA >= floatB);\n}\n}",node_float_mask_my_frag:"void node_float_mask(\nfloat inFloat, float mask,\nout float outFloat) {\noutFloat = inFloat - mask;\n}",node_float_math_my_frag:"void node_float_math(\nint operation,\nfloat floatA, float floatB,\nout float outFloat) {\nif (operation == 0) {\noutFloat = floatA + floatB;\n} else if (operation == 1) {\noutFloat = floatA - floatB;\n} else if (operation == 2) {\noutFloat = floatA * floatB;\n} else if (operation == 3) {\noutFloat = floatA / floatB;\n} else if (operation == 4) {\noutFloat = min(floatA, floatB);\n} else if (operation == 5) {\noutFloat = max(floatA, floatB);\n} else {\noutFloat = pow(floatA, floatB);\n}\n}",node_four_by_four_matrix_my_frag:"void node_four_by_four_matrix(\nfloat in00, float in01, float in02, float in03,\nfloat in10, float in11, float in12, float in13,\nfloat in20, float in21, float in22, float in23,\nfloat in30, float in31, float in32, float in33,\nout mat4 outMatrix)\n{\noutMatrix = mat4(in00, in01, in02, in03,\nin10, in11, in12, in13,\nin20, in21, in22, in23,\nin30, in31, in32, in33);\n}",node_gamma_correct_my_frag:"void node_gamma_correct(\nvec3 gamma, vec3 value,\nout vec3 outValue) {\noutValue = pow(value, 1.0 / gamma);\n}",node_grid_my_frag:"void node_grid(\nfloat contrast, vec3 fillerColor, vec3 lineColor, float uWidth, float vWidth, vec2 uvCoord,\nout float outAlpha, out vec3 outColor) {\nuvCoord = fract(uvCoord); \nfloat v0 = max(uvCoord.y, 0.5 * vWidth);\nfloat v1 = min(uvCoord.y, 1.0 - 0.5 * vWidth);\nfloat u0 = max(uvCoord.x, 0.5 * uWidth);\nfloat u1 = min(uvCoord.x, 1.0 - 0.5 * uWidth);\nfloat gridFactor = (v0 <= v1 && u0 <= u1) ? 1.0 : 0.0;\ngridFactor = 0.5 - contrast * (gridFactor - 0.5);\ngridFactor = max(gridFactor, 0.0);\nvec3 gridColor = mix(fillerColor, lineColor, gridFactor); \ngridColor.r = max(gridColor.r, 0.0);\ngridColor.g = max(gridColor.g, 0.0);\ngridColor.b = max(gridColor.b, 0.0);\noutAlpha = saturate(gridFactor); \noutColor = gridColor; \n}",node_inverse_matrix_my_frag:"\nmat4 inverseMat4(mat4 m) {\nfloat a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\nfloat b00 = a00 * a11 - a01 * a10,\nb01 = a00 * a12 - a02 * a10,\nb02 = a00 * a13 - a03 * a10,\nb03 = a01 * a12 - a02 * a11,\nb04 = a01 * a13 - a03 * a11,\nb05 = a02 * a13 - a03 * a12,\nb06 = a20 * a31 - a21 * a30,\nb07 = a20 * a32 - a22 * a30,\nb08 = a20 * a33 - a23 * a30,\nb09 = a21 * a32 - a22 * a31,\nb10 = a21 * a33 - a23 * a31,\nb11 = a22 * a33 - a23 * a32;\nfloat det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\nreturn mat4(a11 * b11 - a12 * b10 + a13 * b09,\na02 * b10 - a01 * b11 - a03 * b09,\na31 * b05 - a32 * b04 + a33 * b03,\na22 * b04 - a21 * b05 - a23 * b03,\na12 * b08 - a10 * b11 - a13 * b07,\na00 * b11 - a02 * b08 + a03 * b07,\na32 * b02 - a30 * b05 - a33 * b01,\na20 * b05 - a22 * b02 + a23 * b01,\na10 * b10 - a11 * b08 + a13 * b06,\na01 * b08 - a00 * b10 - a03 * b06,\na30 * b04 - a31 * b02 + a33 * b00,\na21 * b02 - a20 * b04 - a23 * b00,\na11 * b07 - a10 * b09 - a12 * b06,\na00 * b09 - a01 * b07 + a02 * b06,\na31 * b01 - a30 * b03 - a32 * b00,\na20 * b03 - a21 * b01 + a22 * b00) / det;\n}\nvoid node_inverse_matrix(\nmat4 inputMatrix,\nout mat4 outputMatrix)\n{\noutputMatrix = inverseMat4(inputMatrix);\n}",node_lambert_my_frag:"\nvoid node_lambert(\nvec3 geometryNormal,\nvec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,\nfloat diffuse, vec3 normal, float translucence, vec3 transparency,\nout vec4 outColor) {\nNodeMaterial material;\nmaterial.diffuseColor = diffuse * color.rgb;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_IndirectDiffuse\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\nfloat alpha = 1.0 - average(transparency);\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + incandescence, alpha);\n}",node_layered_texture_layer_my_frag:"#define LAYER_BLEND_MODE_NONE 0.0\n#define LAYER_BLEND_MODE_OVER 1.0\n#define LAYER_BLEND_MODE_IN 2.0\n#define LAYER_BLEND_MODE_OUT 3.0\n#define LAYER_BLEND_MODE_ADD 4.0\n#define LAYER_BLEND_MODE_SUBTRACT 5.0\n#define LAYER_BLEND_MODE_MULTIPLY 6.0\n#define LAYER_BLEND_MODE_DIFFERENCE 7.0\n#define LAYER_BLEND_MODE_LIGHTEN 8.0\n#define LAYER_BLEND_MODE_DARKEN 9.0\n#define LAYER_BLEND_MODE_SATURATE 10.0\n#define LAYER_BLEND_MODE_DESATURATE 11.0\n#define LAYER_BLEND_MODE_ILLUMINATE 12.0\nvoid node_layered_texture_layer(\nconst float alphaBG, const vec3 colorBG, \nconst vec3 color, const float alpha, const float blendMode, const bool isVisible,\nout float outAlpha, out vec3 outColor)\n{\noutAlpha = alphaBG;\noutColor = colorBG;\nif (!isVisible)\nreturn;\nif (blendMode == LAYER_BLEND_MODE_NONE) {\noutColor = color;\n} else if (blendMode == LAYER_BLEND_MODE_OVER) {\noutColor = mix(colorBG, color, alpha);\n} else if (blendMode == LAYER_BLEND_MODE_IN) {\noutColor = alpha * colorBG;\n} else if (blendMode == LAYER_BLEND_MODE_OUT) {\noutColor = (1.0 - alpha) * colorBG;\n} else if (blendMode == LAYER_BLEND_MODE_ADD) {\noutColor = mix(colorBG, colorBG + color, alpha);\n} else if (blendMode == LAYER_BLEND_MODE_SUBTRACT) {\noutColor = mix(colorBG, colorBG - color, alpha);\n} else if (blendMode == LAYER_BLEND_MODE_MULTIPLY) {\noutColor = mix(colorBG, colorBG * color, alpha);\n} else {\noutColor = mix(colorBG, color, alpha);\n}\n}",node_light_path_my_frag:"void node_light_path(out float isCameraRay)\n{\n#if LIGHT_PATH_IS_CAM_RAY\nisCameraRay = 1.0;\n#else\nisCameraRay = 0.0;\n#endif\n}",node_luminance_my_frag:"void node_luminance(\nvec3 value,\nout float outValue) {\noutValue = dot(value, LUM_WEIGHTS_MAYA);\n}",node_multiply_divide_my_frag:"void node_multiply_divide(\nint operation,\nvec3 input1, vec3 input2,\nout vec3 outValue) {\nif (operation == 0) {\noutValue = input1;\n} else if (operation == 1) {\noutValue = input1 * input2;\n} else if (operation == 2) {\n\noutValue = input1 / input2;\n} else {\noutValue = pow(input1, input2);\n}\n}",node_mult_double_linear_my_frag:"void node_mult_double_linear(\nfloat input1, float input2,\nout float outValue) {\noutValue = input1 * input2;\n}",node_mult_matrix_my_frag:"\nvoid node_mult_matrix(\nmat4 matrixIn1,\nout mat4 matrixSum)\n{\nmatrixSum = matrixIn1;\n}\nvoid node_mult_matrix(\nmat4 matrixIn1, mat4 matrixIn2,\nout mat4 matrixSum)\n{\nmatrixSum = matrixIn2 * matrixIn1;\n}\nvoid node_mult_matrix(\nmat4 matrixIn1, mat4 matrixIn2, mat4 matrixIn3,\nout mat4 matrixSum)\n{\nmatrixSum = matrixIn3 * matrixIn2 * matrixIn1;\n}",node_noise_my_frag:"vec2 calcNoiseImplode(float implode, vec2 implodeCenter, vec2 uv) {\nif (abs(implode) >= EPSILON) {\nuv -= implodeCenter;\nfloat len = length(uv);\nif (len > EPSILON) {\nfloat factor = pow(len, 1.0-implode) / len;\nuv *= factor;\n}\nuv += implodeCenter;\n}\nreturn uv;\n}\nvoid node_noise(\nfloat amplitude, int depthMax, float frequency, float frequencyRatio, float implode,\nvec2 implodeCenter, bool inflection, float ratio, float threshold, float time, vec2 uvCoord,\nout float outAlpha, out vec3 outColor) {\nuvCoord = calcNoiseImplode(implode, implodeCenter, uvCoord);\nfrequency *= 0.6;\namplitude *= 0.9;\nuvCoord *= frequency;\nfloat noiseAccum = 0.0;\nvec2 freqOffset = vec2(0.02, 0.3);\nint depthId = 0;\nwhile (depthId < depthMax) {\nint stepVal = depthId;\nfloat noise = noisePerlin(vec3(uvCoord + freqOffset, time + 0.5 * float(stepVal)));\nif (inflection)\nnoise = abs(noise);\nnoiseAccum += amplitude * noise;\nuvCoord *= frequencyRatio;\ntime *= sqrt(frequencyRatio);\namplitude *= ratio;\nfreqOffset += vec2(0.02, 0.3);\ndepthId++;\n}\nif (!inflection)\nnoiseAccum = 0.5 * noiseAccum + 0.5;\nnoiseAccum += threshold;\noutAlpha = min(1.0, noiseAccum);\noutColor = vec3(outAlpha, outAlpha, outAlpha);\n}",node_output_my_frag:"void node_output(vec4 rgb, out vec4 outgoingLight)\n{\noutgoingLight = rgb;\n}",node_place_2d_texture_my_frag:"void node_place_2d_texture(const vec2 inUv,\nvec2 offset, vec2 repeatUv, float rotateUv,\nout vec2 outUv)\n{\noutUv = (calcUvTransform(offset.x, offset.y, repeatUv.x, repeatUv.y, rotateUv) * vec3(inUv, 1.0)).xy;\noutUv.y = 1.0 - outUv.y;\n}",node_phong_my_frag:"void node_phong(\nvec3 geometryNormal,\nvec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,\nfloat diffuse, vec3 normal, float reflectivity, vec3 reflectedColor,\nfloat cosinePower, vec3 specularColor, float translucence, vec3 transparency,\nout vec4 outColor) {\nNodeMaterial material;\nmaterial.diffuseColor = diffuse * color;\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\nvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\nfloat geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\nfloat roughness = sqrt(1.0 / (0.454 * cosinePower + 3.357));\nmaterial.roughness = max(roughness, 0.0525);\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min(material.roughness, 1.0);\nmaterial.specularColor = specularColor;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\nfloat alpha = 1.0 - average(transparency);\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\nreflectedLight.directSpecular + reflectedLight.indirectSpecular + incandescence, alpha);\n}",node_phong_e_my_frag:"void node_phong_e(\nvec3 geometryNormal,\nvec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,\nfloat diffuse, vec3 normal, float reflectivity, vec3 reflectedColor,\nfloat highlightSize, float roughness, vec3 specularColor, float translucence, vec3 transparency,\nout vec4 outColor) {\nNodeMaterial material;\nmaterial.diffuseColor = diffuse * color;\n#ifdef USE_CLEARCOAT\n#undef USE_CLEARCOAT\n#define _CLEARCOAT_RESTORE\n#endif\nvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\nfloat geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\nmaterial.roughness = max(roughness, 0.0525);\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min(material.roughness, 1.0);\nmaterial.specularColor = specularColor;\nReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n#define RE_DirectDiffuse RE_DirectDiffuse_Node\n#define RE_DirectSpecular RE_DirectSpecular_Node\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Node\n#define RE_IndirectSpecular RE_IndirectSpecular_Node\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#undef RE_DirectDiffuse\n#undef RE_DirectSpecular\n#undef RE_IndirectDiffuse\n#undef RE_IndirectSpecular\n#ifdef _CLEARCOAT_RESTORE\n#undef _CLEARCOAT_RESTORE\n#define USE_CLEARCOAT\n#endif\nfloat alpha = 1.0 - average(transparency);\noutColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +\nreflectedLight.directSpecular + reflectedLight.indirectSpecular + incandescence, alpha);\n}",node_premultiply_my_frag:"void node_premultiply(\nfloat inAlpha, vec3 inColor,\nout float outAlpha, out vec3 outColor) {\noutColor = inColor * inAlpha;\noutAlpha = inAlpha;\n}",node_ramp_my_frag:"void node_ramp(\nsampler2D rampData, int rampType,\nvec2 uvCoord,\nout float outAlpha, out vec3 outColor)\n{\nfloat coord;\nif (rampType == 0) {\ncoord = uvCoord.y;\n} else if (rampType == 1) {\ncoord = uvCoord.x;\n} else if (rampType == 2) {\ncoord = abs(uvCoord.x + uvCoord.y) / 2.0;\n} else if (rampType == 3) {\nvec2 uvSpiral = mat2(0.0, 1.0, 1.0, 0.0) * (uvCoord - vec2(0.5));\ncoord = atan(uvSpiral.y, uvSpiral.x) / PI2 + 0.5;\n} else if (rampType == 4) {\ncoord = length(uvCoord - vec2(0.5)) * sqrt(2.0);\n} else if (rampType == 5) {\nvec2 boxUv = abs(uvCoord - vec2(0.5)) * 2.0;\ncoord = max(boxUv.x, boxUv.y);\n} else if (rampType == 6) {\nuvCoord = abs((uvCoord - vec2(0.5)) * 2.0);\ncoord = uvCoord.y;\n} else if (rampType == 7) {\ncoord = uvCoord.y;\n} else {\ncoord = uvCoord.y;\n}\nvec4 tex = texture2D(rampData, vec2(coord, 0.0));\noutAlpha = average(tex.xyz);\noutColor = tex.xyz;\n}",node_remap_hsv_my_frag:"void node_remap_hsv(vec3 color, out vec3 outColor)\n{\noutColor = color;\n}",node_reverse_my_frag:"void node_reverse(\nvec3 inValue,\nout vec3 outValue) {\noutValue = 1.0 - inValue;\n}",node_sampler_info_my_frag:"void node_sampler_info(\nbool frontFacing, vec4 tangent, vec2 uv,\nvec3 viewNorm,\nout float facingRatio, out bool flippedNormal, out mat4 matrixEyeToWorld,\nout vec3 normalCamera, out vec2 pixelCenter, out vec3 pointCamera,\nout vec3 pointObj, out vec3 pointWorld,\nout vec3 tangentUCamera, out vec3 tangentVCamera, out vec2 uvCoord)\n{\nvec4 worldPos = invViewMatrix * vec4(-vViewPosition, 1.0);\nfacingRatio = dot(normalize(viewNorm), normalize(vViewPosition));\nflippedNormal = frontFacing;\nmatrixEyeToWorld = invViewMatrix;\nnormalCamera = viewNorm;\npixelCenter = vec2(1.0);\npointCamera = -vViewPosition;\npointObj = (invModelMatrix * worldPos).xyz;\npointWorld = worldPos.xyz;\ntangentUCamera = normalize((modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz);\ntangentVCamera = tangent.w * cross(viewNorm, tangentUCamera);\nuvCoord = vec2(uv.x, 1.0-uv.y);\n}",node_set_range_my_frag:"void node_set_range(\nvec3 maxValue, vec3 minValue, vec3 oldMax, vec3 oldMin, vec3 value,\nout vec3 outValue) {\noutValue = minValue + (((value - oldMin) / (oldMax - oldMin)) * (maxValue - minValue));\n}",node_shading_engine_my_frag:"void node_shading_engine(vec4 surface, vec4 volume, vec3 displacement, out vec4 outgoingLight) {\noutgoingLight = surface + volume;\n}",node_surface_shader_my_frag:"void node_surface_shader(\nvec3 color, vec3 glowColor, vec3 matteOpacity, vec3 transparency,\nout vec3 outColor, out vec3 outGlowColor, out vec3 outMatteOpacity, out vec3 outTransparency)\n{\noutColor = color;\noutGlowColor = glowColor;\noutMatteOpacity = matteOpacity;\noutTransparency = transparency;\n}",node_transform_my_frag:"void node_transform(\nout vec3 center, out mat4 inverseMatrix, out mat4 matrix,\nout mat4 parentInverseMatrix, out mat4 parentMatrix, out mat4 worldInverseMatrix,\nout mat4 worldMatrix, out mat4 xformMatrix)\n{\ncenter = modelMatrix[3].xyz;\ninverseMatrix = invModelMatrix;\nmatrix = modelMatrix;\nparentInverseMatrix = mat4(1.0);\nparentMatrix = mat4(1.0);\nworldInverseMatrix = invModelMatrix;\nworldMatrix = modelMatrix;\nxformMatrix = matrix;\n}",node_transpose_matrix_my_frag:"mat4 transposeMat4(mat4 m) {\nreturn mat4(vec4(m[0].x, m[1].x, m[2].x, m[3].x),\nvec4(m[0].y, m[1].y, m[2].y, m[3].y),\nvec4(m[0].z, m[1].z, m[2].z, m[3].z),\nvec4(m[0].w, m[1].w, m[2].w, m[3].w));\n}\nvoid node_transpose_matrix(\nmat4 inputMatrix,\nout mat4 outputMatrix)\n{\noutputMatrix = transposeMat4(inputMatrix);\n}",node_unit_conversion_my_frag:"void node_unit_conversion(float conversionFactor, float inInput, out float outOutput)\n{\noutOutput = conversionFactor * inInput;\n}\nvoid node_unit_conversion(float conversionFactor, vec3 inInput, out vec3 outOutput)\n{\noutOutput = conversionFactor * inInput;\n}",node_unpremultiply_my_frag:"void node_unpremultiply(\nfloat inAlpha, vec3 inColor,\nout float outAlpha, out vec3 outColor) {\noutColor = inColor / inAlpha;\noutAlpha = inAlpha;\n}",node_vector_product_my_frag:"void node_vector_product(\nconst int operation, const bool normalizeOutput,\nvec3 input1, vec3 input2, mat4 matrix,\nout vec3 outVector) {\nif (operation == 0) {\noutVector = input1;\n} else if (operation == 1) {\nif (normalizeOutput) {\ninput1 = normalize(input1);\ninput2 = normalize(input2);\n}\noutVector = vec3(dot(input1, input2));\n} else if (operation == 2) {\noutVector = cross(input1, input2);\n} else if (operation == 3) {\noutVector = (matrix * vec4(input1, 0.0)).xyz;\n} else {\noutVector = (matrix * vec4(input1, 1.0)).xyz;\n}\n\nif (operation > 1 && normalizeOutput)\noutVector = normalize(outVector);\n}",node_wt_add_matrix_my_frag:"void node_wt_add_matrix(\nmat4 matrixIn1, float weightIn1,\nout mat4 matrixSum)\n{\nmatrixSum = weightIn1 * matrixIn1;\n}\nvoid node_wt_add_matrix(\nmat4 matrixIn1, float weightIn1, mat4 matrixIn2, float weightIn2,\nout mat4 matrixSum)\n{\nmatrixSum = weightIn1 * matrixIn1 + weightIn2 * matrixIn2;\n}\nvoid node_wt_add_matrix(\nmat4 matrixIn1, float weightIn1, mat4 matrixIn2, float weightIn2, mat4 matrixIn3, float weightIn3,\nout mat4 matrixSum)\n{\nmatrixSum = weightIn1 * matrixIn1 + weightIn2 * matrixIn2 + weightIn3 * matrixIn3;\n}",pp_plane_vert:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",pp_afterimage_frag:"uniform float damp;\nuniform sampler2D tOld;\nuniform sampler2D tNew;\nvarying vec2 vUv;\nvec4 when_gt(vec4 x, float y) {\nreturn max(sign(x - y), 0.0);\n}\nvoid main() {\nvec4 texelOld = texture2D(tOld, vUv);\nvec4 texelNew = texture2D(tNew, vUv);\n\ntexelOld *= damp * when_gt(texelOld, 0.1);\ngl_FragColor = max(texelNew, texelOld);\n}",pp_bloom_composite_frag:"varying vec2 vUv;\nuniform sampler2D blurTexture1;\nuniform sampler2D blurTexture2;\nuniform sampler2D blurTexture3;\nuniform sampler2D blurTexture4;\nuniform sampler2D blurTexture5;\nuniform sampler2D dirtTexture;\nuniform float bloomStrength;\nuniform float bloomRadius;\nuniform float bloomFactors[NUM_MIPS];\nuniform vec3 bloomTintColors[NUM_MIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, bloomRadius);\n}\nvoid main() {\ngl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv)\n);\n}",pp_bloom_lum_high_pass_frag:"uniform sampler2D tDiffuse;\nuniform vec3 defaultColor;\nuniform float defaultOpacity;\nuniform float luminosityThreshold;\nuniform float smoothWidth;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D(tDiffuse, vUv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(defaultColor.rgb, defaultOpacity);\nfloat alpha = smoothstep(luminosityThreshold, luminosityThreshold + smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\ngl_FragColor = clamp(gl_FragColor, 0.0, 10.0);\n}",pp_bloom_separable_blur_frag:"#include <common>\nvarying vec2 vUv;\nuniform sampler2D colorTexture;\nuniform vec2 texSize;\nuniform vec2 direction;\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x/(sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec3 diffuseSum = texture2D(colorTexture, vUv).rgb * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = direction * invSize * x;\nvec3 sample1 = texture2D(colorTexture, vUv + uvOffset).rgb;\nvec3 sample2 = texture2D(colorTexture, vUv - uvOffset).rgb;\ndiffuseSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n}",pp_blur_frag:"#include <common>\nvarying vec2 vUv;\nuniform sampler2D colorTexture;\nuniform vec2 texSize;\nuniform vec2 direction;\nuniform float kernelRadius;\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / texSize;\nfloat weightSum = gaussianPdf(0.0, kernelRadius);\n#if LOG_SPACE == 1\nvec3 origDiffuse = texture2D(colorTexture, vUv).rgb;\nvec3 diffuseSum = vec3(weightSum);\n#else\nvec3 diffuseSum = texture2D(colorTexture, vUv).rgb * weightSum;\n#endif\nvec2 delta = direction * invSize * kernelRadius/float(MAX_SAMPLE_RADIUS);\nvec2 uvOffset = delta;\n#if OCTAHEDRAL_MAP == 1\nvec3 cubeDir = normalize(octUVToCubeVec(vUv, invSize));\nvec3 dirX = normalize(abs(cubeDir.y) < 0.99999 ? vec3(cubeDir.z, 0.0, -cubeDir.x)\n: vec3(0.0, -cubeDir.z, cubeDir.y));\nvec3 dirY = cross(cubeDir, dirX);\n#endif\n#pragma unroll_loop_start\nfor (int i = 1; i <= MAX_SAMPLE_RADIUS; i++) {\nfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n#if OCTAHEDRAL_MAP == 1\nvec3 cubeOffset = uvOffset.x * dirX + uvOffset.y * dirY;\nvec2 uv1 = cubeVecToOctUV(cubeDir + cubeOffset, invSize);\nvec2 uv2 = cubeVecToOctUV(cubeDir - cubeOffset, invSize);\n#else\nvec2 uv1 = vUv + uvOffset;\nvec2 uv2 = vUv - uvOffset;\n#endif\nvec3 sample1 = texture2D(colorTexture, uv1).rgb;\nvec3 sample2 = texture2D(colorTexture, uv2).rgb;\n#if LOG_SPACE == 1\ndiffuseSum += (\nclamp(exp(sample1 - origDiffuse), 0.0, 1e38) +\nclamp(exp(sample2 - origDiffuse), 0.0, 1e38)\n) * w;\n#else\ndiffuseSum += ((sample1 + sample2) * w);\n#endif\nweightSum += 2.0 * w;\nuvOffset += delta;\n}\n#pragma unroll_loop_end\n#if LOG_SPACE == 1\ngl_FragColor = vec4(origDiffuse + log(diffuseSum/weightSum), 1.0);\n#else\ngl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n#endif\n}",pp_brightness_contrast_frag:"\nuniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D(tDiffuse, vUv);\ntexel.rgb += brightness;\nif (contrast > 0.0)\ntexel.rgb = (texel.rgb - 0.5) / (1.0 - contrast) + 0.5;\nelse\ntexel.rgb = (texel.rgb - 0.5) * (1.0 + contrast) + 0.5;\ngl_FragColor = texel;\n}",pp_bokeh_frag:"#include <common>\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float nearClip;\nuniform float farClip;\nuniform float focus;\nuniform float aspect;\nuniform float depthLeakThreshold;\n#include <packing>\nfloat getDepth(const in vec2 screenPosition) {\n#if DEPTH_PACKING == 1\nreturn unpackRGBAToDepth(texture2D(tDepth, screenPosition));\n#else\nreturn texture2D(tDepth, screenPosition).x;\n#endif\n}\nfloat getViewZ(const in float depth) {\n#if PERSPECTIVE_CAMERA == 1\nreturn perspectiveDepthToViewZ(depth, nearClip, farClip);\n#else\nreturn orthoDepthToViewZ(depth, nearClip, farClip);\n#endif\n}\nvec4 blurSample(vec2 uvOffset, vec4 centerCol, float viewZCenter) {\nfloat viewZ = -getViewZ(getDepth(vUv + uvOffset));\nfloat blurFactor = (viewZ >= viewZCenter) ? 1.0 : \nmin(depthLeakThreshold * abs((focus - viewZ) / aperture), 1.0);\nreturn mix(centerCol, texture2D(tColor, vUv + uvOffset), blurFactor);\n}\nvoid main() {\nvec2 aspectcorrect = vec2(1.0, aspect);\nfloat viewZ = -getViewZ(getDepth(vUv));\nfloat factor = abs(focus - viewZ);\n\nfloat dofblur = maxblur * min(factor / aperture, 1.0);\nfloat dofblur9 = dofblur * 0.9;\nfloat dofblur7 = dofblur * 0.7;\nfloat dofblur4 = dofblur * 0.4;\nvec4 centerCol = texture2D(tColor, vUv);\nvec4 col = centerCol;\ncol += blurSample((vec2( 0.0, 0.4 ) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.15, 0.37) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.29, 0.29) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.37, 0.15) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.40, 0.0 ) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.37, -0.15) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.29, -0.29) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.15, -0.37) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.0, -0.4 ) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.15, 0.37) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.29, 0.29) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.37, 0.15) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.4, 0.0 ) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.37, -0.15) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2(-0.29, -0.29) * aspectcorrect) * dofblur, centerCol, viewZ);\ncol += blurSample((vec2( 0.15, -0.37) * aspectcorrect) * dofblur, centerCol, viewZ);\n\ncol += blurSample((vec2( 0.15, 0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2(-0.37, 0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2( 0.37, -0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2(-0.15, -0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2(-0.15, 0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2( 0.37, 0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2(-0.37, -0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);\ncol += blurSample((vec2( 0.15, -0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);\n\ncol += blurSample((vec2( 0.29, 0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2( 0.40, 0.0 ) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2( 0.29, -0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2( 0.0, -0.4 ) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2(-0.29, 0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2(-0.4, 0.0 ) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2(-0.29, -0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);\ncol += blurSample((vec2( 0.0, 0.4 ) * aspectcorrect) * dofblur7, centerCol, viewZ);\n\ncol += blurSample((vec2( 0.29, 0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2( 0.4, 0.0 ) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2( 0.29, -0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2( 0.0, -0.4 ) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2(-0.29, 0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2(-0.4, 0.0 ) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2(-0.29, -0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);\ncol += blurSample((vec2( 0.0, 0.4 ) * aspectcorrect) * dofblur4, centerCol, viewZ);\ngl_FragColor = col / 41.0;\ngl_FragColor.a = centerCol.a;\n}",pp_copy_frag:"uniform sampler2D tDiffuse;\nuniform float opacity;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = (texture2D(tDiffuse, vUv));\ngl_FragColor = opacity * texel;\n}",pp_cube_octahedral_proj_frag:"#include <common>\nuniform samplerCube tCube;\nuniform vec2 texelSize;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = textureCube(tCube, octUVToCubeVec(gl_FragCoord.xy * texelSize,\ntexelSize));\n}",pp_fxaa_frag:"precision highp float;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#ifndef FXAA_GLSL_120\n#define FXAA_GLSL_120 0\n#endif\n#ifndef FXAA_GLSL_130\n#define FXAA_GLSL_130 0\n#endif\n#ifndef FXAA_GREEN_AS_LUMA\n#define FXAA_GREEN_AS_LUMA 0\n#endif\n#ifndef FXAA_EARLY_EXIT\n#define FXAA_EARLY_EXIT 1\n#endif\n#ifndef FXAA_DISCARD\n#define FXAA_DISCARD 1\n#endif\n#ifndef FXAA_FAST_PIXEL_OFFSET\n#ifdef GL_EXT_gpu_shader4\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifdef GL_NV_gpu_shader5\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifdef GL_ARB_gpu_shader5\n#define FXAA_FAST_PIXEL_OFFSET 1\n#endif\n#ifndef FXAA_FAST_PIXEL_OFFSET\n#define FXAA_FAST_PIXEL_OFFSET 0\n#endif\n#endif\n#ifndef FXAA_QUALITY_PRESET\n#define FXAA_QUALITY_PRESET 12\n#endif\n#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if 1\n#define FxaaBool bool\n#define FxaaDiscard discard\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 ivec2\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTex sampler2D\n#endif\n#if (FXAA_GLSL_100 == 1)\n#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n#endif\n#if (FXAA_GLSL_120 == 1)\n#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n#if (FXAA_FAST_PIXEL_OFFSET == 1)\n#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n#else\n#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n#endif\n#endif\n#if (FXAA_GLSL_130 == 1)\n#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n#endif\n#if (FXAA_GREEN_AS_LUMA == 0)\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n#else\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n#endif\nFxaaFloat4 FxaaPixelShader(\nFxaaFloat2 pos,\nFxaaFloat4 fxaaConsolePosPos,\nFxaaTex tex,\nFxaaTex fxaaConsole360TexExpBiasNegOne,\nFxaaTex fxaaConsole360TexExpBiasNegTwo,\nFxaaFloat2 fxaaQualityRcpFrame,\nFxaaFloat4 fxaaConsoleRcpFrameOpt,\nFxaaFloat4 fxaaConsoleRcpFrameOpt2,\nFxaaFloat4 fxaaConsole360RcpFrameOpt2,\nFxaaFloat fxaaQualitySubpix,\nFxaaFloat fxaaQualityEdgeThreshold,\nFxaaFloat fxaaQualityEdgeThresholdMin\n) {\nFxaaFloat2 posM;\nposM.x = pos.x;\nposM.y = pos.y;\n#if 1\nFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n#if (FXAA_GREEN_AS_LUMA == 0)\n#define lumaM rgbyM.w\n#else\n#define lumaM rgbyM.y\n#endif\n#if (FXAA_GLSL_100 == 1)\nFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(0.0, 1.0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, 0.0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(0.0,-1.0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n#else\nFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(0, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(0,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n#endif\n#endif\nFxaaFloat maxSM = max(lumaS, lumaM);\nFxaaFloat minSM = min(lumaS, lumaM);\nFxaaFloat maxESM = max(lumaE, maxSM);\nFxaaFloat minESM = min(lumaE, minSM);\nFxaaFloat maxWN = max(lumaN, lumaW);\nFxaaFloat minWN = min(lumaN, lumaW);\nFxaaFloat rangeMax = max(maxWN, maxESM);\nFxaaFloat rangeMin = min(minWN, minESM);\nFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\nFxaaFloat range = rangeMax - rangeMin;\nFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\nFxaaBool earlyExit = range < rangeMaxClamped;\nif(earlyExit)\n#if (FXAA_DISCARD == 1)\nreturn rgbyM;\n#else\nreturn rgbyM;\n#endif\n#if 1\n#if (FXAA_GLSL_100 == 1)\nFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, 1.0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0,-1.0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n#else\nFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n#endif\n#else\nFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n#endif\nFxaaFloat lumaNS = lumaN + lumaS;\nFxaaFloat lumaWE = lumaW + lumaE;\nFxaaFloat subpixRcpRange = 1.0/range;\nFxaaFloat subpixNSWE = lumaNS + lumaWE;\nFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\nFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\nFxaaFloat lumaNESE = lumaNE + lumaSE;\nFxaaFloat lumaNWNE = lumaNW + lumaNE;\nFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\nFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\nFxaaFloat lumaNWSW = lumaNW + lumaSW;\nFxaaFloat lumaSWSE = lumaSW + lumaSE;\nFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\nFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\nFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\nFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\nFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\nFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\nFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\nFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\nFxaaBool horzSpan = edgeHorz >= edgeVert;\nFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\nif(!horzSpan) lumaN = lumaW;\nif(!horzSpan) lumaS = lumaE;\nif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\nFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\nFxaaFloat gradientN = lumaN - lumaM;\nFxaaFloat gradientS = lumaS - lumaM;\nFxaaFloat lumaNN = lumaN + lumaM;\nFxaaFloat lumaSS = lumaS + lumaM;\nFxaaBool pairN = abs(gradientN) >= abs(gradientS);\nFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\nif(pairN) lengthSign = -lengthSign;\nFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\nFxaaFloat2 posB;\nposB.x = posM.x;\nposB.y = posM.y;\nFxaaFloat2 offNP;\noffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\noffNP.y = (horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\nif(!horzSpan) posB.x += lengthSign * 0.5;\nif(horzSpan) posB.y += lengthSign * 0.5;\nFxaaFloat2 posN;\nposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\nposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\nFxaaFloat2 posP;\nposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\nposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\nFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\nFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\nFxaaFloat subpixE = subpixC * subpixC;\nFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\nif(!pairN) lumaNN = lumaSS;\nFxaaFloat gradientScaled = gradient * 1.0/4.0;\nFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\nFxaaFloat subpixF = subpixD * subpixE;\nFxaaBool lumaMLTZero = lumaMM < 0.0;\nlumaEndN -= lumaNN * 0.5;\nlumaEndP -= lumaNN * 0.5;\nFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\nFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\nFxaaBool doneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\nFxaaFloat dstN = posM.x - posN.x;\nFxaaFloat dstP = posP.x - posM.x;\nif(!horzSpan) dstN = posM.y - posN.y;\nif(!horzSpan) dstP = posP.y - posM.y;\nFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\nFxaaFloat spanLength = (dstP + dstN);\nFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\nFxaaFloat spanLengthRcp = 1.0/spanLength;\nFxaaBool directionN = dstN < dstP;\nFxaaFloat dst = min(dstN, dstP);\nFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\nFxaaFloat subpixG = subpixF * subpixF;\nFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\nFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\nFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\nFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\nif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\nif(horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n#if (FXAA_DISCARD == 1)\nreturn FxaaTexTop(tex, posM);\n#else\nreturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n#endif\n}\nvoid main() {\ngl_FragColor = FxaaPixelShader(\nvUv,\nvec4(0.0),\ntDiffuse,\ntDiffuse,\ntDiffuse,\nresolution,\nvec4(0.0),\nvec4(0.0),\nvec4(0.0),\n0.75,\n0.166,\n0.0833\n);\n}",pp_grayscale_frag:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D(tDiffuse, vUv);\nfloat bw = texel.r * 0.35 + texel.g * 0.45 + texel.b * 0.2;\ntexel = vec4(bw, bw, bw, texel.a);\ngl_FragColor = texel;\n}",pp_gtao_blur_frag:"uniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform vec2 direction;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#include <packing>\nconst float SIGMA_SPATIAL = 1.5;\nconst float SIGMA_INTENSITY = 0.01;\nfloat gaussianPdf(float x, float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;\n}\nvoid main() {\nfloat weightSum = gaussianPdf(0.0, SIGMA_SPATIAL)\n* gaussianPdf(0.0, SIGMA_INTENSITY);\nvec4 diffSample = texture2D(tDiffuse, vUv);\nvec4 gtaoDataSum = vec4(diffSample.r, unpackRGBToNormal(diffSample.gba)) * weightSum;\nvec3 normCenter = unpackRGBToNormal(texture2D(tNormal, vUv).xyz);\nvec2 delta = direction / resolution;\nvec2 offset = delta;\n#pragma unroll_loop_start\nfor (int i = 1; i <= BLUR_RADIUS_PX; i++) {\nvec2 uvCoords0 = vUv + offset;\nvec2 uvCoords1 = vUv - offset;\nvec4 diffSample0 = texture2D(tDiffuse, uvCoords0);\nvec4 diffSample1 = texture2D(tDiffuse, uvCoords1);\nvec4 gtaoData0 = vec4(diffSample0.r, unpackRGBToNormal(diffSample0.gba));\nvec4 gtaoData1 = vec4(diffSample1.r, unpackRGBToNormal(diffSample1.gba));\nvec3 normSample0 = unpackRGBToNormal(texture2D(tNormal, uvCoords0).xyz);\nvec3 normSample1 = unpackRGBToNormal(texture2D(tNormal, uvCoords1).xyz);\nfloat weightSpatial = gaussianPdf(float(i), SIGMA_SPATIAL);\nfloat weight0 = weightSpatial * gaussianPdf(1.0 - max(0.0,\ndot(normCenter, normSample0)), SIGMA_INTENSITY);\nfloat weight1 = weightSpatial * gaussianPdf(1.0 - max(0.0,\ndot(normCenter, normSample1)), SIGMA_INTENSITY);\nweightSum += weight0 + weight1;\ngtaoDataSum += weight0 * gtaoData0 + weight1 * gtaoData1;\noffset += delta;\n}\n#pragma unroll_loop_end\nfloat visibility = gtaoDataSum.r / weightSum;\nvec3 bentNormal = normalize(gtaoDataSum.gba);\ngl_FragColor = vec4(visibility, packNormalToRGB(bentNormal));\n}",pp_gtao_frag:"uniform sampler2D tNormal;\nuniform sampler2D tDepth;\nuniform sampler2D tNoise;\nuniform float occlDistance;\nuniform float factor;\nuniform float occlPrecision;\nuniform bool bounceApprox;\nuniform mat4 mainCameraProjMat;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#include <common>\n#include <packing>\nconst vec3 AXIS_Z = vec3(0.0, 0.0, 1.0);\nconst float NUM_SAMPLES_HALF_MIN = 4.0;\nconst float NUM_SAMPLES_HALF_MAX = 8.0;\nconst float NOISE_TEX_SIZE = 32.0;\nconst float NEAR_FIELD_COEFF = 0.5;\nconst float SELF_OCCL_BIAS = -1e-5;\nconst float NORMAL_RENDER_GEOM_MAX_DIFF_ANGLE = 0.85 * PI_HALF;\nfloat integrateArc(vec2 horizonAngles, float normalAngle) {\nvec2 visCoeffs = (-cos(2.0 * horizonAngles - normalAngle) + cos(normalAngle)\n+ 2.0 * horizonAngles * sin(normalAngle)) / 4.0;\nreturn visCoeffs.x + visCoeffs.y;\n}\nvec3 calcViewFromUVDepth(vec2 uv, float depth, float zBias) {\nvec3 ndcCo = 2.0 * vec3(uv, depth) - 1.0;\n#if ORTHO_CAMERA == 1\nfloat viewZ = (ndcCo.z - mainCameraProjMat[3][2]) / mainCameraProjMat[2][2] + zBias;\nvec2 _00_11 = vec2(mainCameraProjMat[0][0], mainCameraProjMat[1][1]);\nvec2 _30_31 = vec2(mainCameraProjMat[3][0], mainCameraProjMat[3][1]);\nreturn vec3((ndcCo.xy - _30_31) / _00_11, viewZ);\n#else\nfloat viewZ = -mainCameraProjMat[3][2] / (mainCameraProjMat[2][2] + ndcCo.z) + zBias;\nvec2 _00_11 = vec2(mainCameraProjMat[0][0], mainCameraProjMat[1][1]);\nvec2 _20_21 = vec2(mainCameraProjMat[2][0], mainCameraProjMat[2][1]);\nreturn vec3(-viewZ * (ndcCo.xy + _20_21) / _00_11, viewZ);\n#endif\n}\nvec2 calcSliceRadiusUV(float viewZ) {\nvec4 distView = vec4(occlDistance, occlDistance, viewZ, 1.0);\nvec4 distClip = mainCameraProjMat * distView;\nvec2 xyNDC = distClip.xy / distClip.w;\nreturn clamp(0.5 * xyNDC, 0.0, 0.5);\n}\nvec2 calcHorizonAngles(vec3 viewPos, vec3 viewVec, vec2 sliceDir,\nfloat offsetNoise) {\nvec2 maxHorizonCos = vec2(-1.0);\nvec2 sliceRadius = calcSliceRadiusUV(viewPos.z);\nvec2 pxSize = 1.0 / resolution;\nint NUM_SAMPLES_HALF = int(occlPrecision\n* (NUM_SAMPLES_HALF_MAX - NUM_SAMPLES_HALF_MIN) + NUM_SAMPLES_HALF_MIN);\n#if __VERSION__ == 300\nfor (int i = 0; i < NUM_SAMPLES_HALF; i++) {\n#else\nfor (int i = 0; i < int(NUM_SAMPLES_HALF_MAX); i++) {\nif (i >= NUM_SAMPLES_HALF) continue;\n#endif\nvec2 offset = sliceDir * (pxSize * (1.0 + float(i))\n+ sliceRadius * pow((float(i) + offsetNoise) / float(NUM_SAMPLES_HALF), 2.0));\nvec2 uvs = vUv - offset;\nvec3 ps = calcViewFromUVDepth(uvs, texture2D(tDepth, uvs).x, SELF_OCCL_BIAS);\nvec3 ds = normalize(ps - viewPos);\nvec2 uvt = vUv + offset;\nvec3 pt = calcViewFromUVDepth(uvt, texture2D(tDepth, uvt).x, SELF_OCCL_BIAS);\nvec3 dt = normalize(pt - viewPos);\nvec2 sampleLen = vec2(length(ps - viewPos), length(pt - viewPos));\nvec2 blendWeight = (sampleLen / occlDistance - 1.0) / (NEAR_FIELD_COEFF - 1.0);\nblendWeight = clamp(blendWeight, 0.0, 1.0);\nvec2 maxHorizonCosNoBlending = max(maxHorizonCos, vec2(dot(ds, viewVec),\ndot(dt, viewVec)));\nmaxHorizonCos = mix(maxHorizonCos, maxHorizonCosNoBlending, blendWeight);\n}\nvec2 horizons = acos(maxHorizonCos);\nreturn vec2(-horizons.x, horizons.y);\n}\nvec2 calcNormalAngleAndProjLen(vec3 viewVec, vec3 normal, vec2 sliceDir) {\nvec3 sliceVec = vec3(sliceDir, 0.0);\nsliceVec = sliceVec - dot(sliceVec, viewVec) * viewVec;\nvec3 sliceOrthoVec = cross(sliceVec, viewVec);\nvec3 normalProj = normal - dot(normal, sliceOrthoVec) * sliceOrthoVec;\nfloat normalProjLen = length(normalProj);\nfloat normalAngle = acos(clamp(dot(normalProj / normalProjLen, viewVec), 0.0, 1.0));\nnormalAngle *= sign(dot(normalProj, sliceVec));\nreturn vec2(normalAngle, normalProjLen);\n}\n#if CALC_BENT_NORMALS == 1\nvec3 calcSliceBentNormal(vec2 sliceDir, vec2 h, float n) {\nvec2 t = vec2(\n6.0 * sin(h[0] - n) - sin(3.0 * h[0] - n) + 6.0 * sin(h[1] - n)\n- sin(3.0 * h[1] - n) + 16.0 * sin(n) - 3.0 * (sin(h[0] + n) + sin(h[1] + n)),\n-cos(3.0 * h[0] - n) - cos(3.0 * h[1] - n) + 8.0 * cos(n)\n- 3.0 * (cos(h[0] + n) + cos(h[1] + n))\n) / 12.0;\nreturn vec3(sliceDir * t[0], t[1]);\n}\n#endif\nvec2 clampHorizonAnglesAroundNormal(vec2 horizonAngles, float normalAngle,\nfloat geomNormalAngle) {\nhorizonAngles = normalAngle + clamp(horizonAngles - normalAngle, -PI_HALF, PI_HALF);\nif (abs(normalAngle - geomNormalAngle) < NORMAL_RENDER_GEOM_MAX_DIFF_ANGLE) {\nhorizonAngles = geomNormalAngle + clamp(horizonAngles - geomNormalAngle, -PI_HALF, PI_HALF);\n}\nreturn horizonAngles;\n}\nvoid main() {\nfloat depth = texture2D(tDepth, vUv).x;\n#ifndef GTAO_DISABLE_BKG_FIX\nif (depth == 1.0) {\ngl_FragColor = vec4(vec3(1.0), 1.0);\n} else {\n#endif\nvec3 viewPos = calcViewFromUVDepth(vUv, depth, 0.0);\n#if ORTHO_CAMERA == 1\nvec3 viewVec = vec3(0.0, 0.0, 1.0);\n#else\nvec3 viewVec = normalize(-viewPos);\n#endif\nvec3 viewNormal = unpackRGBToNormal(texture2D(tNormal, vUv).xyz);\nvec3 geomViewNormal = normalize(cross(dFdx(viewPos), dFdy(viewPos)));\nvec2 noiseScale = resolution / NOISE_TEX_SIZE;\nvec4 noiseData = texture2D(tNoise, vUv * noiseScale);\nfloat randAngle = noiseData.r * PI_HALF;\nfloat visibility = 0.0;\nvec3 bentNormalAvg = viewNormal;\nfloat normalAngle, normalProjLen, geomNormalAngle;\nvec2 horizonAngles, _vec2Tmp;\nvec3 sliceBentNormal;\n#if CALC_BENT_NORMALS == 1\nbentNormalAvg = vec3(0.0);\n#if ORTHO_CAMERA == 0\nvec3 bentRotAxis = cross(AXIS_Z, viewVec);\nfloat bentRotAngle = acos(clamp(dot(AXIS_Z, viewVec), -1.0, 1.0));\n#endif\n#endif\nvec2 sliceDir = vec2(cos(randAngle), sin(randAngle));\n#pragma unroll_loop_start\nfor (int i = 0; i < 2; i++) {\n_vec2Tmp = calcNormalAngleAndProjLen(viewVec, viewNormal, sliceDir);\nnormalAngle = _vec2Tmp[0], normalProjLen = _vec2Tmp[1];\n_vec2Tmp = calcNormalAngleAndProjLen(viewVec, geomViewNormal, sliceDir);\ngeomNormalAngle = _vec2Tmp[0];\nhorizonAngles = calcHorizonAngles(viewPos, viewVec, sliceDir, noiseData.g);\nhorizonAngles = clampHorizonAnglesAroundNormal(horizonAngles,\nnormalAngle, geomNormalAngle);\nvisibility += normalProjLen * integrateArc(horizonAngles, normalAngle);\n#if CALC_BENT_NORMALS == 1\nsliceBentNormal = calcSliceBentNormal(sliceDir, horizonAngles, normalAngle);\n#if ORTHO_CAMERA == 0\nsliceBentNormal = vec3RotateAxisAngle(sliceBentNormal,\nbentRotAxis, bentRotAngle);\n#endif\nbentNormalAvg += sliceBentNormal * normalProjLen;\n#endif\nsliceDir = vec2(-sliceDir.y, sliceDir.x);\n}\n#pragma unroll_loop_end\nvisibility /= 2.0;\n#if CALC_BENT_NORMALS == 1\nfloat mixFactor = clamp((1.0 - 2.0 * visibility) / (3.0 * visibility - 4.0), 0.0, 1.0);\nbentNormalAvg = normalize(mix(bentNormalAvg, viewNormal, mixFactor));\n#endif\ngl_FragColor = vec4(pow(visibility, factor), packNormalToRGB(bentNormalAvg));\n#ifndef GTAO_DISABLE_BKG_FIX\n}\n#endif\n}",pp_outline_edge_frag:"varying vec2 vUv;\nuniform sampler2D maskTexture;\nuniform vec2 texSize;\nuniform vec4 visibleEdgeColor;\nuniform vec4 hiddenEdgeColor;\nvoid main() {\nvec2 invSize = 1.0 / texSize;\nvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\nvec4 c1 = texture2D(maskTexture, vUv + uvOffset.xy);\nvec4 c2 = texture2D(maskTexture, vUv - uvOffset.xy);\nvec4 c3 = texture2D(maskTexture, vUv + uvOffset.yw);\nvec4 c4 = texture2D(maskTexture, vUv - uvOffset.yw);\nfloat diff1 = (c1.r - c2.r) * 0.5;\nfloat diff2 = (c3.r - c4.r) * 0.5;\nfloat d = length(vec2(diff1, diff2));\nfloat a1 = min(c1.g, c2.g);\nfloat a2 = min(c3.g, c4.g);\nfloat visibilityFactor = min(a1, a2);\nvec4 edgeColor = (1.0 - visibilityFactor > 0.001) ? visibleEdgeColor : hiddenEdgeColor;\ngl_FragColor = edgeColor * vec4(d);\n}",pp_outline_blur_frag:"#include <common>\nvarying vec2 vUv;\nuniform sampler2D colorTexture;\nuniform vec2 texSize;\nuniform vec2 direction;\nuniform float kernelRadius;\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / texSize;\nfloat weightSum = gaussianPdf(0.0, kernelRadius);\nvec4 diffuseSum = texture2D(colorTexture, vUv);\n#if defined(LOG_SPACE)\ndiffuseSum = exp(diffuseSum);\n#endif\ndiffuseSum *= weightSum;\nvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\nvec2 uvOffset = delta;\nfor (int i = 1; i <= MAX_RADIUS; i++) {\nfloat w = gaussianPdf(uvOffset.x, kernelRadius);\nvec4 sample1 = texture2D(colorTexture, vUv + uvOffset);\nvec4 sample2 = texture2D(colorTexture, vUv - uvOffset);\n#if defined(LOG_SPACE)\nsample1 = exp(sample1);\nsample2 = exp(sample2);\n#endif\ndiffuseSum += ((sample1 + sample2) * w);\nweightSum += (2.0 * w);\nuvOffset += delta;\n}\nvec4 finalCol = diffuseSum / weightSum;\n#if defined(LOG_SPACE)\nfinalCol = log(finalCol);\n#endif\ngl_FragColor = finalCol;\n}",pp_outline_overlay_frag:"varying vec2 vUv;\nuniform sampler2D maskTexture;\nuniform sampler2D edgeTexture1;\nuniform sampler2D edgeTexture2;\nuniform sampler2D patternTexture;\nuniform float edgeStrength;\nuniform float edgeGlow;\nuniform bool usePatternTexture;\nvoid main() {\nvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\nvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\nvec4 maskColor = texture2D(maskTexture, vUv);\nvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\nfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\nvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\nvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\nif (usePatternTexture)\nfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\nfloat maxChannel = max(finalColor.r, max(finalColor.g, finalColor.b));\nif (maxChannel != 0.0) {\nfinalColor.rgb /= maxChannel;\n}\ngl_FragColor = finalColor;\n}",pp_tonemap_frag:"#include <common>\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D(tDiffuse, vUv);\nfloat alpha = clamp(texel.a, 0.0, 1.0);\ngl_FragColor = texel;\ngl_FragColor.rgb /= alpha;\n#include <tonemapping_fragment>\ngl_FragColor = LinearTosRGB(gl_FragColor);\ngl_FragColor.rgb *= alpha;\n#if ALPHA_AS_LUMA == 1\ngl_FragColor.a = linearToRelativeLuminance(gl_FragColor.rgb);\n#endif\n}",raw_meshline_vert:"precision highp float;\nattribute vec3 position;\nattribute vec3 previous;\nattribute vec3 next;\nattribute float side;\nattribute float width;\nattribute vec2 uv;\nattribute float counters;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 resolution;\nuniform float lineWidth;\nuniform float sizeAttenuation;\nvarying float vCounters;\nvarying vec2 vUV;\nconst float EQ_EPS = 0.000001;\nvec2 fix(vec4 i, float aspect) {\nvec2 res = i.xy / i.w;\nres.x *= aspect;\nreturn res;\n}\nbool posEqual(vec2 pos0, vec2 pos1) {\nreturn length(pos0 - pos1) < EQ_EPS;\n}\nvoid main() {\nfloat aspect = resolution.x / resolution.y;\nvCounters = counters;\nvUV = uv;\nmat4 m = projectionMatrix * modelViewMatrix;\nvec4 finalPosition = m * vec4(position, 1.0);\nvec4 prevPos = m * vec4(previous, 1.0);\nvec4 nextPos = m * vec4(next, 1.0);\nvec2 currentP = fix(finalPosition, aspect);\nvec2 prevP = fix(prevPos, aspect);\nvec2 nextP = fix(nextPos, aspect);\nfloat w = lineWidth * width;\nif (sizeAttenuation == 0.0) {\nw *= finalPosition.w / resolution.x;\n}\nvec2 dir;\nif (posEqual(nextP, currentP)) {\ndir = normalize(currentP - prevP);\n} else if (posEqual(prevP, currentP)) {\ndir = normalize(nextP - currentP);\n} else {\nvec2 dir1 = normalize(currentP - prevP);\nvec2 dir2 = normalize(nextP - currentP);\ndir = normalize(dir1 + dir2);\n}\nvec2 offset = vec2(-dir.y, dir.x);\noffset.y *= aspect;\noffset *= w;\nfinalPosition.xy += offset * side;\ngl_Position = finalPosition;\n}",raw_meshline_frag:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D alphaMap;\nuniform float useMap;\nuniform float useAlphaMap;\nuniform float visibility;\nuniform float alphaTest;\nuniform vec2 repeat;\nuniform vec3 color;\nuniform float opacity;\nvarying vec2 vUV;\nvarying float vCounters;\n#include <encodings_pars_fragment>\nvoid main() {\nvec4 c = vec4(color, opacity);\nif (useMap == 1.0) {\nc *= texture2D(map, vUV * repeat);\n}\nif (useAlphaMap == 1.0) {\nc.a *= texture2D(alphaMap, vUV * repeat).a;\n}\nif (c.a < alphaTest) {\ndiscard;\n}\ngl_FragColor = c;\ngl_FragColor.a *= step(vCounters, visibility);\ngl_FragColor = LinearTosRGB(gl_FragColor);\n}"},qi={common:{diffuse:{value:new mn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Xt},uv2Transform:{value:new Xt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Yt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new mn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},maxDistance:{},shadowCameraNear:{},expBias:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadow:{},shadowCameraNear:{},shadowCameraFar:{},expBias:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{},expBias:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},rectAreaLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{},expBias:{}}},rectAreaShadowMap:{value:[]},rectAreaShadowMatrix:{value:[]},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new mn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Xt}},sprite:{diffuse:{value:new mn(16777215)},opacity:{value:1},center:{value:new Yt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Xt}},mask:{depthTexture:{value:null},cameraNearFar:{value:new Yt(.5,.5)},textureMatrix:{value:new rr}},node:{nodeRGB:{value:[]},nodeValue:{value:[]},flipCubeMap:{value:-1},materialIndex:{value:0}},nodeGTAO:{gtaoMap:{value:null}},ssr:{invProjectionMatrix:{value:new rr},ssrSourceBuffer:{value:null},ssrDepthBuffer:{value:null},ssrBackfaceDepthBuffer:{value:null},ssrStride:{value:20},ssrResolution:{value:new Yt},ssrThickness:{value:.01},ssrJitter:{value:1},ssrMaxDistance:{value:100}},planeReflectionProbe:{planeReflTexture:{value:null},planeReflTextureMatrix:{value:new rr},planeReflDir:{value:new wn},planeReflBoundingBoxMin:{value:new wn},planeReflBoundingBoxMax:{value:new wn},planeReflInvModelMatrix:{value:new rr},planeReflFalloff:{value:0}}},Zi={basic:{uniforms:Li([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.fog]),vertexShader:Ki.meshbasic_vert,fragmentShader:Ki.meshbasic_frag},lambert:{uniforms:Li([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.fog,qi.lights,{emissive:{value:new mn(0)}}]),vertexShader:Ki.meshlambert_vert,fragmentShader:Ki.meshlambert_frag},phong:{uniforms:Li([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new mn(0)},specular:{value:new mn(1118481)},shininess:{value:30}}]),vertexShader:Ki.meshphong_vert,fragmentShader:Ki.meshphong_frag},standard:{uniforms:Li([qi.common,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.roughnessmap,qi.metalnessmap,qi.fog,qi.lights,qi.planeReflectionProbe,{emissive:{value:new mn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1},envMapParallaxType:{value:0},envMapParallaxMatrix:{value:new rr},envMapParallaxMatrixInv:{value:new rr}}]),vertexShader:Ki.meshphysical_vert,fragmentShader:Ki.meshphysical_frag},toon:{uniforms:Li([qi.common,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.gradientmap,qi.fog,qi.lights,{emissive:{value:new mn(0)}}]),vertexShader:Ki.meshtoon_vert,fragmentShader:Ki.meshtoon_frag},matcap:{uniforms:Li([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,{matcap:{value:null}}]),vertexShader:Ki.meshmatcap_vert,fragmentShader:Ki.meshmatcap_frag},points:{uniforms:Li([qi.points,qi.fog]),vertexShader:Ki.points_vert,fragmentShader:Ki.points_frag},dashed:{uniforms:Li([qi.common,qi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ki.linedashed_vert,fragmentShader:Ki.linedashed_frag},depth:{uniforms:Li([qi.common,qi.displacementmap,{slopeScaledBias:{value:0}}]),vertexShader:Ki.depth_vert,fragmentShader:Ki.depth_frag},normal:{uniforms:Li([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,{opacity:{value:1}}]),vertexShader:Ki.meshnormal_vert,fragmentShader:Ki.meshnormal_frag},sprite:{uniforms:Li([qi.sprite,qi.fog]),vertexShader:Ki.sprite_vert,fragmentShader:Ki.sprite_frag},background:{uniforms:{uvTransform:{value:new Xt},t2D:{value:null}},vertexShader:Ki.background_vert,fragmentShader:Ki.background_frag},cube:{uniforms:Li([qi.envmap,{opacity:{value:1}}]),vertexShader:Ki.cube_vert,fragmentShader:Ki.cube_frag},equirect:{uniforms:{tEquirect:{value:null},invertU:{value:!1},offsetU:{value:0}},vertexShader:Ki.equirect_vert,fragmentShader:Ki.equirect_frag},distanceRGBA:{uniforms:Li([qi.common,qi.displacementmap,{referencePosition:{value:new wn},nearDistance:{value:1},farDistance:{value:1e3},slopeScaledBias:{value:0}}]),vertexShader:Ki.distanceRGBA_vert,fragmentShader:Ki.distanceRGBA_frag},shadow:{uniforms:Li([qi.lights,qi.fog,{color:{value:new mn(0)},opacity:{value:1}}]),vertexShader:Ki.shadow_vert,fragmentShader:Ki.shadow_frag},mask:{uniforms:Li([qi.common,qi.displacementmap,qi.mask]),vertexShader:Ki.mask_vert,fragmentShader:Ki.mask_frag},equicube:{uniforms:{tEquirect:{value:null},faceIndex:{value:0},invertU:{value:!1},offsetU:{value:0}},vertexShader:Ki.equicube_vert,fragmentShader:Ki.equicube_frag},node:{uniforms:Li([qi.common,qi.displacementmap,qi.envmap,qi.fog,qi.lights,qi.ssr,qi.planeReflectionProbe,qi.node,qi.nodeGTAO,{envMapIntensity:{value:1},envMapParallaxType:{value:0},envMapParallaxMatrix:{value:new rr},envMapParallaxMatrixInv:{value:new rr}}]),vertexShader:Ki.meshnode_vert,fragmentShader:Ki.meshnode_frag},cubeOctahedral:{uniforms:{tCube:{value:null},texelSize:{value:new Yt(.5,.5)}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_cube_octahedral_proj_frag}};function Ji(s,l,n,c,e,r){const u=new mn(0);let d=!0===e?0:1,h,p,f=null,m=0,g=null;function v(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return u},setClearColor:function(e,t=1){u.set(e),d=t,v(u,d)},getClearAlpha:function(){return d},setClearAlpha:function(e){d=e,v(u,d)},dispose:function(){h&&(h.geometry.dispose(),h.material.dispose()),h=void 0,p&&(p.geometry.dispose(),p.material.dispose()),p=void 0},render:function(e,t){let n=!1;var r=t.background&&t.background.isSceneBackground;let i=r?t.background.data:t.background;i&&i.isTexture&&(i=l.get(i));const a=s.xr;var o=a.getSession&&a.getSession();o&&"additive"===o.environmentBlendMode&&(i=null),null===i?v(u,d):i&&i.isColor&&(v(i,1),n=!0),(s.autoClear||n)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),t=!!r&&t.background.useHDR,i&&(i.isCubeTexture||i.isWebGLCubeRenderTarget||i.mapping===D)?(void 0===p&&(p=new Ei(new Ii(1,1,1),new Pi({name:"BackgroundCubeMaterial",uniforms:Ri(Zi.cube.uniforms),vertexShader:Zi.cube.vertexShader,fragmentShader:Zi.cube.fragmentShader,side:Fe,depthTest:!1,depthWrite:!1,fog:!1,useHDR:t})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(e,t,n){var r=n.far;this.matrixWorld.makeScale(r,r,r),this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(p)),i.isWebGLCubeRenderTarget&&(i=i.texture),p.material.uniforms.envMap.value=i,p.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,f===i&&m===i.version&&g===s.toneMapping||(p.material.needsUpdate=!0,f=i,m=i.version,g=s.toneMapping),e.unshift(p,p.geometry,p.material,0,0,null)):i&&i.isTexture&&(void 0===h&&(h=new Ei(new ji(2,2),new Pi({name:"BackgroundMaterial",uniforms:Ri(Zi.background.uniforms),vertexShader:Zi.background.vertexShader,fragmentShader:Zi.background.fragmentShader,side:Ne,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(h)),h.material.uniforms.t2D.value=i,!0===i.matrixAutoUpdate&&i.updateMatrix(),h.material.uniforms.uvTransform.value.copy(i.matrix),f===i&&m===i.version&&g===s.toneMapping||(h.material.needsUpdate=!0,f=i,m=i.version,g=s.toneMapping),e.unshift(h,h.geometry,h.material,0,0,null))}}}function $i(_,x,y,b){const i=_.getParameter(34921),s=b.isWebGL2?null:x.get("OES_vertex_array_object"),l=b.isWebGL2||null!==s,c={},e=h(null);let u=e;function d(e){return b.isWebGL2?_.bindVertexArray(e):s.bindVertexArrayOES(e)}function a(e){return b.isWebGL2?_.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function h(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function M(){const n=u.newAttributes;for(let e=0,t=n.length;e<t;e++)n[e]=0}function C(e){S(e,0)}function S(e,t){const n=u.newAttributes,r=u.enabledAttributes,i=u.attributeDivisors;if(n[e]=1,0===r[e]&&(_.enableVertexAttribArray(e),r[e]=1),i[e]!==t){const a=b.isWebGL2?_:x.get("ANGLE_instanced_arrays");a[b.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),i[e]=t}}function w(){var n=u.newAttributes;const r=u.enabledAttributes;for(let e=0,t=r.length;e<t;e++)r[e]!==n[e]&&(_.disableVertexAttribArray(e),r[e]=0)}function E(e,t,n,r,i,a){!0!==b.isWebGL2||5124!==n&&5125!==n?_.vertexAttribPointer(e,t,n,r,i,a):_.vertexAttribIPointer(e,t,n,i,a)}function o(){t(),u!==e&&(u=e,d(u.object))}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,t,n,r,i){let a=!1;var o;l?(o=function(e,t,n){n=!0===n.wireframe;let r=c[e.id];void 0===r&&(r={},c[e.id]=r);let i=r[t.id];void 0===i&&(i={},r[t.id]=i);let a=i[n];void 0===a&&(a=h(b.isWebGL2?_.createVertexArray():s.createVertexArrayOES()),i[n]=a);return a}(r,n,t),u!==o&&(u=o,d(u.object)),a=function(e,t){var n=u.attributes,r=e.attributes;let i=0;for(const s in r){var a=n[s],o=r[s];if(void 0===a)return!0;if(a.attribute!==o)return!0;if(a.data!==o.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(r,i),a&&function(e,t){const n={},r=e.attributes;let i=0;for(const o in r){var a=r[o];const s={};(s.attribute=a).data&&(s.data=a.data),n[o]=s,i++}u.attributes=n,u.attributesNum=i,u.index=t}(r,i)):(o=!0===t.wireframe,u.geometry===r.id&&u.program===n.id&&u.wireframe===o||(u.geometry=r.id,u.program=n.id,u.wireframe=o,a=!0)),!0===e.isInstancedMesh&&(a=!0),null!==i&&y.update(i,34963),a&&(function(e,t,n,r){if(!1===b.isWebGL2&&(e.isInstancedMesh||r.isInstancedBufferGeometry)&&null===x.get("ANGLE_instanced_arrays"))return;M();var i=r.attributes,a=n.getAttributes(),o=t.defaultAttributeValues;for(const A in a){var s=a[A];if(0<=s.location){let t=i[A];if(void 0===t&&("instanceMatrix"===A&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===A&&e.instanceColor&&(t=e.instanceColor)),void 0!==t){var l=t.normalized,c=t.itemSize,u=y.get(t);if(void 0!==u){var d=u.buffer,h=u.type,p=u.bytesPerElement;if(t.isInterleavedBufferAttribute){var f=t.data,m=f.stride,g=t.offset;if(f&&f.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)S(s.location+e,f.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===r._maxInstanceCount&&(r._maxInstanceCount=f.meshPerAttribute*f.count)}else for(let e=0;e<s.locationSize;e++)C(s.location+e);_.bindBuffer(34962,d);for(let e=0;e<s.locationSize;e++)E(s.location+e,c/s.locationSize,h,l,m*p,(g+c/s.locationSize*e)*p)}else{if(t.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)S(s.location+e,t.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===r._maxInstanceCount&&(r._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<s.locationSize;e++)C(s.location+e);_.bindBuffer(34962,d);for(let e=0;e<s.locationSize;e++)E(s.location+e,c/s.locationSize,h,l,c*p,c/s.locationSize*e*p)}}}else if(void 0!==o){var v=o[A];if(void 0!==v)switch(v.length){case 2:_.vertexAttrib2fv(s.location,v);break;case 3:_.vertexAttrib3fv(s.location,v);break;case 4:_.vertexAttrib4fv(s.location,v);break;default:_.vertexAttrib1fv(s.location,v)}}}}w()}(e,t,n,r),null!==i&&_.bindBuffer(34963,y.get(i).buffer))},reset:o,resetDefaultState:t,dispose:function(){o();for(const e in c){const t=c[e];for(const n in t){const r=t[n];for(const i in r)a(r[i].object),delete r[i];delete t[n]}delete c[e]}},releaseStatesOfGeometry:function(e){if(void 0!==c[e.id]){const t=c[e.id];for(const n in t){const r=t[n];for(const i in r)a(r[i].object),delete r[i];delete t[n]}delete c[e.id]}},releaseStatesOfProgram:function(e){for(const t in c){const n=c[t];if(void 0!==n[e.id]){const r=n[e.id];for(const i in r)a(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:M,enableAttribute:C,disableUnusedAttributes:w}}function ea(a,o,s,e){const l=e.isWebGL2;let c;this.setMode=function(e){c=e},this.render=function(e,t){a.drawArrays(c,e,t),s.update(t,c,1)},this.renderInstances=function(n,r,i){if(0!==i){let e,t;if(l)e=a,t="drawArraysInstanced";else if(e=o.get("ANGLE_instanced_arrays"),t="drawArraysInstancedANGLE",null===e)return void console.error("v3d.WebGLBufferRenderer: using v3d.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,n,r,i),s.update(r,c,i)}}}function ta(t,n,e){let r;function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==e.precision?e.precision:"highp";var s=i(o);s!==o&&(console.warn("v3d.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=a||n.has("WEBGL_draw_buffers"),c=!0===e.logarithmicDepthBuffer,u=t.getParameter(34930),d=t.getParameter(35660),h=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),A=0<d,_=a||n.has("OES_texture_float"),s=A&&_,e=a?t.getParameter(36183):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){return void 0!==r||(r=!0===n.has("EXT_texture_filter_anisotropic")?(e=n.get("EXT_texture_filter_anisotropic"),t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),r;var e},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:A,floatFragmentTextures:_,floatVertexTextures:s,maxSamples:e}}function na(t){const s=this;let c=null,u=0,d=!1,h=!1;const l=new ki,p=new Xt,f={value:null,needsUpdate:!1};function m(){f.value!==c&&(f.value=c,f.needsUpdate=0<u),s.numPlanes=u,s.numIntersection=0}function g(n,e,r,t){var i=null!==n?n.length:0;let a=null;if(0!==i){if(a=f.value,!0!==t||null===a){var t=r+4*i,o=e.matrixWorldInverse;p.getNormalMatrix(o),(null===a||a.length<t)&&(a=new Float32Array(t));for(let e=0,t=r;e!==i;++e,t+=4)l.copy(n[e]).applyMatrix4(o,p),l.normal.toArray(a,t),a[t+3]=l.constant}f.value=a,f.needsUpdate=!0}return s.numPlanes=i,s.numIntersection=0,a}this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,n){var r=0!==e.length||t||0!==u||d;return d=t,c=g(e,n,0),u=e.length,r},this.beginShadows=function(){h=!0,g(null)},this.endShadows=function(){h=!1,m()},this.setState=function(e,n,r){var i=e.clippingPlanes,a=e.clipIntersection,o=e.clipShadows;const s=t.get(e);if(!d||null===i||0===i.length||h&&!o)h?g(null):m();else{var o=h?0:u,l=4*o;let t=s.clippingState||null;f.value=t,t=g(i,n,l,r);for(let e=0;e!==l;++e)t[e]=c[e];s.clippingState=t,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=o}}}function ra(r){let i=new WeakMap;function a(e,t){return t===l?e.mapping=T:t===c&&(e.mapping=I),e}function o(e){const t=e.target;t.removeEventListener("dispose",o);const n=i.get(t);void 0!==n&&(i.delete(t),n.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t=e.mapping;if(t===l||t===c){if(i.has(e))return a(i.get(e).texture,e.mapping);t=e.image;if(t&&0<t.height){const n=new Ui(t.height/2);return n.fromEquirectangularTexture(r,e),i.set(e,n),e.addEventListener("dispose",o),a(n.texture,e.mapping)}return null}}return e},dispose:function(){i=new WeakMap}}}Zi.physical={uniforms:Li([Zi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Yt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new mn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Yt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new mn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new mn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ki.meshphysical_vert,fragmentShader:Ki.meshphysical_frag},Zi.copy={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_copy_frag},Zi.bokeh={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3},depthLeakThreshold:{value:.2}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_bokeh_frag},Zi.fxaa={defines:{FXAA_GLSL_100:1,FXAA_GLSL_130:0,FXAA_QUALITY_PRESET:12,FXAA_GREEN_AS_LUMA:1},uniforms:{tDiffuse:{value:null},resolution:{value:new Yt(1/1024,1/512)}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_fxaa_frag},Zi.grayscale={uniforms:{tDiffuse:{value:null}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_grayscale_frag},Zi.brightness_contrast={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_brightness_contrast_frag},Zi.bloomLumHighPass={uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new mn(0)},defaultOpacity:{type:"f",value:0}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_bloom_lum_high_pass_frag},Zi.blur={defines:{LOG_SPACE:0,OCTAHEDRAL_MAP:0},uniforms:{colorTexture:{value:null},texSize:{value:new Yt(.5,.5)},direction:{value:new Yt(.5,.5)},kernelRadius:{value:1}},customPrepTokens:{MAX_SAMPLE_RADIUS:4},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_blur_frag},Zi.tonemap={defines:{ALPHA_AS_LUMA:0},uniforms:{tDiffuse:{value:null}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_tonemap_frag},Zi.afterimage={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_afterimage_frag};class ia extends Di{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i+=r*this.view.offsetX,a=i+r*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height),this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}ia.prototype.isOrthographicCamera=!0;class aa extends Pi{constructor(e){super(e),this.type="RawShaderMaterial"}}aa.prototype.isRawShaderMaterial=!0;class oa extends Tr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.postprocessing=[],this.worldMaterial=null,this.worldEnvMapProbe=null,"undefined"!=typeof __V3D_DEVTOOLS__&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}dispose(){this.dispatchEvent({type:"dispose"})}}oa.prototype.isScene=!0;let sa=256;const la=[{relSize:1,sigma:0,origin:[0,0]},{relSize:.5,sigma:.025,origin:[0,2/3]},{relSize:.25,sigma:.07,origin:[.5,2/3]},{relSize:1/8,sigma:.18,origin:[.75,2/3]},{relSize:1/16,sigma:.24,origin:[.875,2/3]},{relSize:1/16,sigma:.3,origin:[.875,17/24]},{relSize:1/16,sigma:.36,origin:[.875,.75]},{relSize:1/16,sigma:.42,origin:[.875,19/24]},{relSize:1/16,sigma:.48,origin:[.875,20/24]},{relSize:1/16,sigma:.54,origin:[.875,.875]},{relSize:1/16,sigma:.6,origin:[.875,22/24]}];function ca(e){return la[e].relSize*sa}const ua=20,da=new ia;let ha=null,pa=null,fa=null;const ma=la.map(function(e,t){var n=1/(ca(t)-1),t=-n/2,n=1+n/2,r=[t,t,n,t,n,n,t,t,n,n,t,n];const i=new Float32Array(108),a=new Float32Array(72),o=new Float32Array(36);for(let e=0;e<6;e++){var s=e%3*2/3-1,l=2<e?0:-1;i.set([s,l,0,s+2/3,l,0,s+2/3,1+l,0,s,l,0,s+2/3,1+l,0,s,1+l,0],18*e),a.set(r,12*e);l=[e,e,e,e,e,e];o.set(l,6*e)}const c=new ci;return c.setAttribute("position",new Hr(i,3)),c.setAttribute("uv",new Hr(a,2)),c.setAttribute("faceIndex",new Hr(o,1)),c});let ga=null,va=null,Aa=null;var _a=(1+Math.sqrt(5))/2,xa=1/_a;const ya=[new wn(1,1,1),new wn(-1,1,1),new wn(1,1,-1),new wn(-1,1,-1),new wn(0,_a,xa),new wn(0,_a,-xa),new wn(xa,0,_a),new wn(-xa,0,_a),new wn(_a,xa,0),new wn(-_a,xa,0)];class ba{constructor(e,t){this.flipCubemapX=!0,va=e,Object.defineProperties(this,{maxTileSize:{get:function(){return sa},set:function(e){sa=e}}}),void 0!==t&&(this.maxTileSize=t),ha=function(e,t){const n=new Float32Array(e),r=new wn(0,1,0),i=new aa({defines:{n:e,cubeUV_maxTileSize:nn(t)},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},lodIdx:{value:0},poleAxis:{value:r}},vertexShader:Pa(),fragmentShader:`

            precision highp float;
            precision highp int;

            varying vec3 vOutputDirection;

            uniform sampler2D envMap;
            uniform int samples;
            uniform float weights[n];
            uniform bool latitudinal;
            uniform float dTheta;
            uniform float lodIdx;
            uniform vec3 poleAxis;

            #define ENVMAP_TYPE_CUBE_UV
            #include <cube_uv_reflection_fragment>

            vec3 getSample(float theta, vec3 axis) {

                float cosTheta = cos(theta);
                // Rodrigues' axis-angle rotation
                vec3 sampleDirection = vOutputDirection * cosTheta
                    + cross(axis, vOutputDirection) * sin(theta)
                    + axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);

                return bilinearCubeUV(envMap, sampleDirection, lodIdx);

            }

            void main() {

                vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);

                if (all(equal(axis, vec3(0.0)))) {

                    axis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);

                }

                axis = normalize(axis);

                gl_FragColor = vec4(0.0);
                gl_FragColor.rgb += weights[0] * getSample(0.0, axis);

                for (int i = 1; i < n; i++) {

                    if (i >= samples) {

                        break;

                    }

                    float theta = dTheta * float(i);
                    gl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);
                    gl_FragColor.rgb += weights[i] * getSample(theta, axis);

                }

            }
        `,blending:ie,depthTest:!1,depthWrite:!1});return i.type="SphericalGaussianBlur",i}(ua,this.maxTileSize),Sa(ha)}fromScene(e,t=0,n=.1,r=100){Aa=va.getRenderTarget();var i=Ma();return function(t,e,n,r){const i=new Ni(90,1,e,n),a=[1,1,1,1,-1,1],o=[1,1,-1,-1,-1,1],s=va.outputEncoding,l=va.toneMapping,c=va.toneMappingExposure,u=va.getClearColor(new mn),d=va.getClearAlpha();va.toneMapping=1,va.toneMappingExposure=1,va.outputEncoding=pt,t.scale.z*=-1;let h=t.background;h&&h.isColor&&(h.convertSRGBToLinear(),n=Math.max(h.r,h.g,h.b),n=Math.min(Math.max(Math.ceil(Math.log2(n)),-128),127),h=h.multiplyScalar(Math.pow(2,-n)),n=(n+128)/255,va.setClearColor(h,n),t.background=null);for(let e=0;e<6;e++){var p=e%3;0==p?(i.up.set(0,a[e],0),i.lookAt(o[e],0,0)):1==p?(i.up.set(0,0,a[e]),i.lookAt(0,o[e],0)):(i.up.set(0,a[e],0),i.lookAt(0,0,o[e]));var f=ca(0);Ea(r,p*f,2<e?f:0,f,f),va.setRenderTarget(r),va.render(t,i)}va.toneMapping=l,va.toneMappingExposure=c,va.outputEncoding=s,va.setClearColor(u,d),t.scale.z*=-1}(e,n,r,i),0<t&&Ia(i,0,0,t),Ta(i),Ca(i),i}fromEquirectangular(e){return e.magFilter=Ge,e.minFilter=Ge,e.generateMipmaps=!1,this.fromCubemap(e)}fromCubemap(e){Aa=va.getRenderTarget();var t=Ma(e);return function(e,t,n){const r=new oa;e.isCubeTexture?null==fa&&(fa=Ba()):null==pa&&(pa=La());var i=e.isCubeTexture?fa:pa;r.add(new Ei(ma[0],i));const a=i.uniforms;(a.envMap.value=e).isCubeTexture?a.flipCubemapX.value=n||!1:a.texelSize.value.set(1/e.image.width,1/e.image.height);e=ca(0);Ea(t,0,0,3*e,2*e),va.setRenderTarget(t),va.render(r,da)}(e,t,this.flipCubemapX),Ta(t),Ca(t),t}fromCubeRenderTarget(e,t){t=Ma(e.texture,t);return function(e,t,n){const r=new oa;null==fa&&(fa=Ba());var i=fa;r.add(new Ei(ma[0],i));const a=i.uniforms;a.envMap.value=e.texture,a.flipCubemapX.value=n||!1;n=ca(0);Ea(t,0,0,3*n,2*n),va.setRenderTarget(t),va.render(r,da)}(e,t,this.flipCubemapX),Ta(t),Ca(t),t}compileCubemapShader(){null==fa&&(fa=Ba(),Sa(fa))}compileEquirectangularShader(){null==pa&&(pa=La(),Sa(pa))}dispose(){ha.dispose(),null!=fa&&fa.dispose(),null!=pa&&pa.dispose();for(let e=0;e<ma.length;e++)ma[e].dispose()}}function Ma(e,t){var n={magFilter:Ge,minFilter:Ge,generateMipmaps:!1,type:e?e.type:Xe,format:e?e.format:Ke,encoding:e?e.encoding:pt,depthBuffer:!1,stencilBuffer:!1};Object.assign(n,t);const r=wa(n);return r.depthBuffer=!e,ga=wa(n),r}function Ca(e){ga.dispose(),va.setRenderTarget(Aa),e.scissorTest=!1,e.setSize(e.width,e.height)}function Sa(e){const t=new oa;t.add(new Ei(ma[0],e)),va.compile(t,da)}function wa(e){var t=ca(0);const n=new bn(3*t,3*t,e);return n.texture.mapping=D,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Ea(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Ta(t){var e=va.autoClear;va.autoClear=!1;for(let e=1;e<la.length;e++){var n=la[e].sigma,r=la[e-1].sigma,n=Math.sqrt(n*n-r*r),r=ya[(e-1)%ya.length];Ia(t,e-1,e,n,r)}va.autoClear=e}function Ia(e,t,n,r,i){Ra(e,ga,t,n,r,"latitudinal",i),Ra(ga,e,n,n,r,"longitudinal",i)}function Ra(e,t,n,r,i,a,o){"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const s=new oa;s.add(new Ei(ma[r],ha));const l=ha.uniforms;var c=ca(n)-1;let u=isFinite(i)?Math.PI/(2*c):2*Math.PI/(2*ua-1),d=i/u,h=isFinite(i)?1+Math.floor(3*d):ua;h>ua&&(h=ua,d=(ua-1)/3,u=i/d);const p=[];let f=0;for(let e=0;e<ua;++e){const v=e/d;var m=Math.exp(-v*v/2);p.push(m),0==e?f+=m:e<h&&(f+=2*m)}for(let e=0;e<p.length;e++)p[e]=p[e]/f;l.envMap.value=e.texture,l.samples.value=h,l.weights.value=p,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o),l.dTheta.value=u,l.lodIdx.value=n;const g=ha.defines;g.cubeUV_maxTileSize=nn(ca(0));const[v,A]=(n=r,la[n].origin.map(function(e){return e*sa*3}));r=ca(r);Ea(t,v,A,3*r,2*r),va.setRenderTarget(t),va.render(s,da)}function La(){var e=new Yt(1,1);const t=new aa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e}},vertexShader:Pa(),fragmentShader:`

            precision mediump float;
            precision mediump int;

            varying vec3 vOutputDirection;

            uniform sampler2D envMap;
            uniform vec2 texelSize;

            #define RECIPROCAL_PI 0.31830988618
            #define RECIPROCAL_PI2 0.15915494

            void main() {

                gl_FragColor = vec4(0.0);

                vec3 outputDirection = normalize(vOutputDirection);
                vec2 uv;
                uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
                uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;

                vec2 f = fract(uv / texelSize - 0.5);
                uv -= f * texelSize;
                vec3 tl = texture2D(envMap, uv).rgb;
                uv.x += texelSize.x;
                vec3 tr = texture2D(envMap, uv).rgb;
                uv.y += texelSize.y;
                vec3 br = texture2D(envMap, uv).rgb;
                uv.x -= texelSize.x;
                vec3 bl = texture2D(envMap, uv).rgb;

                vec3 tm = mix(tl, tr, f.x);
                vec3 bm = mix(bl, br, f.x);
                gl_FragColor.rgb = mix(tm, bm, f.y);

            }
        `,blending:ie,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function Ba(){const e=new aa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipCubemapX:{value:!0}},vertexShader:Pa(),fragmentShader:`

            precision mediump float;
            precision mediump int;

            uniform bool flipCubemapX;

            varying vec3 vOutputDirection;

            uniform samplerCube envMap;

            void main() {

                gl_FragColor = textureCube(envMap, vec3(vOutputDirection.x * (flipCubemapX ? -1.0 : 1.0), vOutputDirection.yz));

            }
        `,blending:ie,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function Pa(){return`

        precision mediump float;
        precision mediump int;

        attribute vec3 position;
        attribute vec2 uv;
        attribute float faceIndex;

        varying vec3 vOutputDirection;

        vec3 getDirection(vec2 uv, float face) {

            uv = 2.0 * uv - 1.0;

            vec3 direction = vec3(uv, 1.0);

            if (face == 0.0) {

                direction = direction.zyx;
                direction.z *= -1.0;

            } else if (face == 1.0) {

                direction = direction.xzy;
                direction.z *= -1.0;

            } else if (face == 3.0) {

                direction = direction.zyx;
                direction.x *= -1.0;

            } else if (face == 4.0) {

                direction = direction.xzy;
                direction.y *= -1.0;

            } else if (face == 5.0) {

                direction.xz *= -1.0;

            }

            return direction;

        }

        void main() {

            vOutputDirection = getDirection(uv, faceIndex);
            gl_Position = vec4(position, 1.0);

        }
    `}function Da(i){let a=new WeakMap,o=null;function s(e){const t=e.target;t.removeEventListener("dispose",s);const n=a.get(t);void 0!==n&&(a.delete(t),n.dispose())}return{get:function(t){if(t&&t.isTexture){var e=t.mapping,n=e===l||e===c,r=e===T||e===I;if(n||r){if(t.isRenderTargetTexture&&!0===t.needsPMREMUpdate){t.needsPMREMUpdate=!1;let e=a.get(t);return null===o&&(o=new ba(i)),e=n?o.fromEquirectangular(t,e):o.fromCubemap(t,e),a.set(t,e),e.texture}if(a.has(t))return a.get(t).texture;e=t.image;if(n&&e&&0<e.height||r&&e&&function(t){let n=0;for(let e=0;e<6;e++)void 0!==t[e]&&n++;return 6===n}(e)){null===o&&(o=new ba(i));n=n?o.fromEquirectangular(t):o.fromCubemap(t);return a.set(t,n),t.addEventListener("dispose",s),n.texture}return null}}return t},dispose:function(){a=new WeakMap,null!==o&&(o.dispose(),o=null)}}}function Na(n){const r={};function i(e){if(void 0!==r[e])return r[e];let t;switch(e){case"WEBGL_depth_texture":t=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=n.getExtension(e)}return r[e]=t,t}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){var t=i(e);return null===t&&console.warn("v3d.WebGLRenderer: "+e+" extension not supported."),t}}}function Fa(e,f,r,i){const a={},m=new WeakMap;function o(e){const t=e.target;null!==t.index&&f.remove(t.index);for(const n in t.attributes)f.remove(t.attributes[n]);t.removeEventListener("dispose",o),delete a[t.id];e=m.get(t);e&&(f.remove(e),m.delete(t)),i.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,r.memory.geometries--}function s(e){const n=[];var t=e.index,r=e.attributes.position;let i=0;if(null!==t){var a=t.array;i=t.version;for(let e=0,t=a.length;e<t;e+=3){var o=a[e+0],s=a[e+1],l=a[e+2];n.push(o,s,s,l,l,o)}}else{var c=r.array;i=r.version;for(let e=0,t=c.length/3-1;e<t;e+=3){var u=e+0,d=e+1,h=e+2;n.push(u,d,d,h,h,u)}}const p=new(Kt(n)?Jr:qr)(n,1);p.version=i;c=m.get(e);c&&f.remove(c),m.set(e,p)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",o),a[t.id]=!0,r.memory.geometries++),t},update:function(e){var t=e.attributes;for(const i in t)f.update(t[i],34962);var n=e.morphAttributes;for(const a in n){var r=n[a];for(let e=0,t=r.length;e<t;e++)f.update(r[e],34962)}},getWireframeAttribute:function(e){var t,n=m.get(e);return(!n||null!==(t=e.index)&&n.version<t.version)&&s(e),m.get(e)}}}function Oa(a,o,s,e){const l=e.isWebGL2;let c;let u,d;this.setMode=function(e){c=e},this.setIndex=function(e){u=e.type,d=e.bytesPerElement},this.render=function(e,t){a.drawElements(c,t,u,e*d),s.update(t,c,1)},this.renderInstances=function(n,r,i){if(0!==i){let e,t;if(l)e=a,t="drawElementsInstanced";else if(e=o.get("ANGLE_instanced_arrays"),t="drawElementsInstancedANGLE",null===e)return void console.error("v3d.WebGLIndexedBufferRenderer: using v3d.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,r,u,n*d,i),s.update(r,c,i)}}}function Ua(e){const a={geometries:0,textures:0,textureSpecs:new Map},r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:a,render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(e,t,n){switch(r.calls++,t){case 4:r.triangles+=n*(e/3);break;case 1:r.lines+=n*(e/2);break;case 3:r.lines+=n*(e-1);break;case 2:r.lines+=n*e;break;case 0:r.points+=n*e;break;default:console.error("v3d.WebGLInfo: Unknown draw mode:",t)}},addTextureSpec:function(e){let t,n,r,i;i=e.isWebGLRenderTarget?(t=e.texture.name,n="WebGLRenderTarget",r=e.width,e.height):(t=e.name,n="Texture",r=e.image.width,e.image.height),a.textureSpecs.set(e,{name:t,type:n,width:r,height:i})},removeTextureSpec:function(e){a.textureSpecs.delete(e)}}}class za extends _n{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=Ve,this.minFilter=Ve,this.wrapR=ze,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function Va(e,t){return e[0]-t[0]}function Ga(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ka(e,t){let n=1;t=(t.isInterleavedBufferAttribute?t.data:t).array;t instanceof Int8Array?n=127:t instanceof Int16Array?n=32767:t instanceof Int32Array?n=2147483647:console.error("v3d.WebGLMorphtargets: Unsupported morph attribute data type: ",t),e.divideScalar(n)}function Qa(C,S,n){const w={},E=new Float32Array(12),T=new WeakMap,I=new wn,R=[];for(let e=0;e<12;e++)R[e]=[e,0];return{update:function(e,r,t,i){var a=e.morphTargetInfluences;if(!0===S.isWebGL2){var o=r.morphAttributes.position.length;let e=T.get(r);if(void 0===e||e.count!==o){void 0!==e&&e.texture.dispose();var s=void 0!==r.morphAttributes.normal,l=r.morphAttributes.position,c=r.morphAttributes.normal||[],u=!0==s?2:1;let t=r.attributes.position.count*u,n=1;t>S.maxTextureSize&&(n=Math.ceil(t/S.maxTextureSize),t=S.maxTextureSize);const y=new Float32Array(t*n*4*o),b=new za(y,t,n,o);b.format=Ke,b.type=Ye,b.needsUpdate=!0;var d=4*u;for(let e=0;e<o;e++){var h=l[e],p=c[e],f=t*n*4*e;for(let e=0;e<h.count;e++){I.fromBufferAttribute(h,e),!0===h.normalized&&ka(I,h);var m=e*d;y[f+m]=I.x,y[f+m+1]=I.y,y[f+m+2]=I.z,!(y[f+m+3]=0)==s&&(I.fromBufferAttribute(p,e),!0===p.normalized&&ka(I,p),y[f+m+4]=I.x,y[f+m+5]=I.y,y[f+m+6]=I.z,y[f+m+7]=0)}}e={count:o,texture:b,size:new Yt(t,n)},T.set(r,e)}let t=0;for(let e=0;e<a.length;e++)t+=a[e];u=r.morphTargetsRelative?1:1-t;i.getUniforms().setValue(C,"morphTargetBaseInfluence",u),i.getUniforms().setValue(C,"morphTargetInfluences",a),i.getUniforms().setValue(C,"morphTargetsTexture",e.texture,n),i.getUniforms().setValue(C,"morphTargetsTextureSize",e.size)}else{var g=void 0===a?0:a.length;let t=w[r.id];if(void 0===t||t.length!==g){t=[];for(let e=0;e<g;e++)t[e]=[e,0];w[r.id]=t}for(let e=0;e<g;e++){const M=t[e];M[0]=e,M[1]=a[e]}t.sort(Ga);for(let e=0;e<12;e++)e<g&&t[e][1]?(R[e][0]=t[e][0],R[e][1]=t[e][1]):(R[e][0]=Number.MAX_SAFE_INTEGER,R[e][1]=0);R.sort(Va);var v=r.morphAttributes.position,A=r.morphAttributes.normal;let n=0;for(let e=0;e<12;e++){var _=R[e],x=_[0],_=_[1];x!==Number.MAX_SAFE_INTEGER&&_?(v&&r.getAttribute("morphTarget"+e)!==v[x]&&r.setAttribute("morphTarget"+e,v[x]),A&&r.getAttribute("morphNormal"+e)!==A[x]&&r.setAttribute("morphNormal"+e,A[x]),E[e]=_,n+=_):(v&&!0===r.hasAttribute("morphTarget"+e)&&r.deleteAttribute("morphTarget"+e),A&&!0===r.hasAttribute("morphNormal"+e)&&r.deleteAttribute("morphNormal"+e),E[e]=0)}u=r.morphTargetsRelative?1:1-n;i.getUniforms().setValue(C,"morphTargetBaseInfluence",u),i.getUniforms().setValue(C,"morphTargetInfluences",E)}}}}function Wa(e,r,i,a){let o=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){var t=a.render.frame,n=e.geometry,n=r.get(e,n);return o.get(n)!==t&&(r.update(n),o.set(n,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),n},dispose:function(){o=new WeakMap}}}za.prototype.isDataTexture2DArray=!0;class Ha extends _n{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=Ve,this.minFilter=Ve,this.wrapR=ze,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ha.prototype.isDataTexture3D=!0;const Ya=new _n,Xa=new za,ja=new Ha,Ka=new Oi,qa=[],Za=[],Ja=new Float32Array(16),$a=new Float32Array(9),eo=new Float32Array(4);function to(n,r,i){const e=n[0];if(e<=0||0<e)return n;var t=r*i;let a=qa[t];if(void 0===a&&(a=new Float32Array(t),qa[t]=a),0!==r){e.toArray(a,0);for(let e=1,t=0;e!==r;++e)t+=i,n[e].toArray(a,t)}return a}function no(n,r){if(n.length===r.length){for(let e=0,t=n.length;e<t;e++)if(n[e]!==r[e])return;return 1}}function ro(n,r){for(let e=0,t=r.length;e<t;e++)n[e]=r[e]}function io(t,n){let r=Za[n];void 0===r&&(r=new Int32Array(n),Za[n]=r);for(let e=0;e!==n;++e)r[e]=t.allocateTextureUnit();return r}function ao(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function oo(e,t){const n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):no(n,t)||(e.uniform2fv(this.addr,t),ro(n,t))}function so(e,t){const n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):void 0!==t.r?n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b):no(n,t)||(e.uniform3fv(this.addr,t),ro(n,t))}function lo(e,t){const n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):no(n,t)||(e.uniform4fv(this.addr,t),ro(n,t))}function co(e,t){var n=this.cache,r=t.elements;void 0===r?no(n,t)||(e.uniformMatrix2fv(this.addr,!1,t),ro(n,t)):no(n,r)||(eo.set(r),e.uniformMatrix2fv(this.addr,!1,eo),ro(n,r))}function uo(e,t){var n=this.cache,r=t.elements;void 0===r?no(n,t)||(e.uniformMatrix3fv(this.addr,!1,t),ro(n,t)):no(n,r)||($a.set(r),e.uniformMatrix3fv(this.addr,!1,$a),ro(n,r))}function ho(e,t){var n=this.cache,r=t.elements;void 0===r?no(n,t)||(e.uniformMatrix4fv(this.addr,!1,t),ro(n,t)):no(n,r)||(Ja.set(r),e.uniformMatrix4fv(this.addr,!1,Ja),ro(n,r))}function po(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function fo(e,t){var n=this.cache;no(n,t)||(e.uniform2iv(this.addr,t),ro(n,t))}function mo(e,t){var n=this.cache;no(n,t)||(e.uniform3iv(this.addr,t),ro(n,t))}function go(e,t){var n=this.cache;no(n,t)||(e.uniform4iv(this.addr,t),ro(n,t))}function vo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Ao(e,t){var n=this.cache;no(n,t)||(e.uniform2uiv(this.addr,t),ro(n,t))}function _o(e,t){var n=this.cache;no(n,t)||(e.uniform3uiv(this.addr,t),ro(n,t))}function xo(e,t){var n=this.cache;no(n,t)||(e.uniform4uiv(this.addr,t),ro(n,t))}function yo(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Ya,i)}function bo(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ja,i)}function Mo(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Ka,i)}function Co(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Xa,i)}function So(e,t){e.uniform1fv(this.addr,t)}function wo(e,t){t=to(t,this.size,2);e.uniform2fv(this.addr,t)}function Eo(e,t){t=to(t,this.size,3);e.uniform3fv(this.addr,t)}function To(e,t){t=to(t,this.size,4);e.uniform4fv(this.addr,t)}function Io(e,t){t=to(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function Ro(e,t){t=to(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function Lo(e,t){t=to(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function Bo(e,t){e.uniform1iv(this.addr,t)}function Po(e,t){e.uniform2iv(this.addr,t)}function Do(e,t){e.uniform3iv(this.addr,t)}function No(e,t){e.uniform4iv(this.addr,t)}function Fo(e,t){e.uniform1uiv(this.addr,t)}function Oo(e,t){e.uniform2uiv(this.addr,t)}function Uo(e,t){e.uniform3uiv(this.addr,t)}function zo(e,t){e.uniform4uiv(this.addr,t)}function Vo(e,t,n){var r=t.length,i=io(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||Ya,i[e])}function Go(e,t,n){var r=t.length,i=io(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture3D(t[e]||ja,i[e])}function ko(e,t,n){var r=t.length,i=io(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||Ka,i[e])}function Qo(e,t,n){var r=t.length,i=io(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||Xa,i[e])}function Wo(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ao;case 35664:return oo;case 35665:return so;case 35666:return lo;case 35674:return co;case 35675:return uo;case 35676:return ho;case 5124:case 35670:return po;case 35667:case 35671:return fo;case 35668:case 35672:return mo;case 35669:case 35673:return go;case 5125:return vo;case 36294:return Ao;case 36295:return _o;case 36296:return xo;case 35678:case 36198:case 36298:case 36306:case 35682:return yo;case 35679:case 36299:case 36307:return bo;case 35680:case 36300:case 36308:case 36293:return Mo;case 36289:case 36303:case 36311:case 36292:return Co}}(t.type)}function Ho(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return So;case 35664:return wo;case 35665:return Eo;case 35666:return To;case 35674:return Io;case 35675:return Ro;case 35676:return Lo;case 5124:case 35670:return Bo;case 35667:case 35671:return Po;case 35668:case 35672:return Do;case 35669:case 35673:return No;case 5125:return Fo;case 36294:return Oo;case 36295:return Uo;case 36296:return zo;case 35678:case 36198:case 36298:case 36306:case 35682:return Vo;case 35679:case 36299:case 36307:return Go;case 35680:case 36300:case 36308:case 36293:return ko;case 36289:case 36303:case 36311:case 36292:return Qo}}(t.type)}function Yo(e){this.id=e,this.seq=[],this.map={}}Ho.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ro(t,e)},Yo.prototype.setValue=function(n,r,i){var a=this.seq;for(let e=0,t=a.length;e!==t;++e){const o=a[e];o.setValue(n,r[o.id],i)}};const Xo=/(\w+)(\])?(\[|\.)?/g;function jo(e,t){e.seq.push(t),e.map[t.id]=t}function Ko(t,n){this.seq=[],this.map={};var r=t.getProgramParameter(n,35718);for(let e=0;e<r;++e){var i=t.getActiveUniform(n,e);!function(e,n,r){var i=e.name,a=i.length;for(Xo.lastIndex=0;;){var o=Xo.exec(i),s=Xo.lastIndex;let t=o[1];var l="]"===o[2],o=o[3];if(l&&(t|=0),void 0===o||"["===o&&s+2===a){jo(r,new(void 0===o?Wo:Ho)(t,e,n));break}{let e=r.map[t];void 0===e&&(e=new Yo(t),jo(r,e)),r=e}}}(i,t.getUniformLocation(n,i.name),this)}}function qo(e,t,n){t=e.createShader(t);return e.shaderSource(t,n),e.compileShader(t),t}Ko.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Ko.prototype.setOptional=function(e,t,n){t=t[n];void 0!==t&&this.setValue(e,n,t)},Ko.upload=function(n,r,i,a){for(let e=0,t=r.length;e!==t;++e){const o=r[e],s=i[o.id];!1!==s.needsUpdate&&o.setValue(n,s.value,a)}},Ko.seqWithValue=function(n,r){const i=[];for(let e=0,t=n.length;e!==t;++e){var a=n[e];a.id in r&&i.push(a)}return i};let Zo=0;function Jo(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function $o(e,t){t=function(e){switch(e){case pt:return["Linear","(value)"];case ft:return["sRGB","(value)"];default:return console.warn("v3d.WebGLProgram: Unsupported encoding:",e),["Linear","(value)"]}}(t);return"vec4 "+e+"(vec4 value) { return LinearTo"+t[0]+t[1]+"; }"}function es(e){return""!==e}function ts(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows).replace(/NUM_RECT_AREA_LIGHT_SHADOWS/g,t.numRectAreaLightShadows)}function ns(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function rs(e,t){const n=Object.keys(t);if(n.length){var r=new RegExp(n.join("|"),"g");return e.replace(r,function(e){return t[e]})}return e}function is(e,t){for(const n in t)e=e.replace("#include <"+n+">",t[n]);return e}const as=/^[ \t]*#include +<([\w\d./]+)>/gm;function os(e){return e.replace(as,ss)}function ss(e,t){var n=Ki[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return os(n)}function ls(i){var a;const e=new RegExp("#pragma unroll_loop_start[\\s]+?for \\(int (\\w+) \\= (\\d+)\\; (\\w+) <(=?) (\\w+)\\; (\\w+)\\+\\+\\) \\{"),o=new RegExp("\\{|\\}","g");for(;a=e.exec(i);){let e,n;e=n=o.lastIndex=a.index+a[0].length;let t,r=1;for(;(t=o.exec(i))&&("{"==t[0]?r++:"}"==t[0]&&r--,n=t.index),t&&0<r;);if(0==r){var s=i.substring(a.index,o.lastIndex);const h=i.substring(e,n);var l=new RegExp(`\\[${a[1]}\\]`,"g"),c=new RegExp(`\\(${a[1]}\\)`,"g");let t="";var u=parseInt(a[2]),d=parseInt(a[5])+("="===a[4]?1:0);for(let e=u;e<d;e++)t+="{"+h.replace(l,`[${e}]`).replace(c,`(${e})`)+"}";i=i.replace(s,t)}}return i=i.replace("#pragma unroll_loop_end","")}function cs(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function us(e,t,n,r){const s=e.getContext();var i=n.defines;let a=n.vertexShader,o=n.fragmentShader;var l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Z?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===J?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===ee?t="SHADOWMAP_TYPE_VSM":e.shadowMapType===te?t="SHADOWMAP_TYPE_ESM":e.shadowMapType===ne?t="SHADOWMAP_TYPE_PCF_POISSON_DISK":e.shadowMapType===re&&(t="SHADOWMAP_TYPE_BILINEAR"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case T:case I:t="ENVMAP_TYPE_CUBE";break;case D:case N:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case I:case N:t="ENVMAP_MODE_REFRACTION"}return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),h=n.unitsScaleFactor%1?String(n.unitsScaleFactor):String(n.unitsScaleFactor)+".0";const p=n.isWebGL2?"":function(e){const t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID||e.useSlopeScaledBias?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(es).join("\n")}(n),f=function(e){const t=[];for(const r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(i),m=s.createProgram(),g=this;let v,A,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(v=[f].filter(es).join("\n"),0<v.length&&(v+="\n"),A=[p,f].filter(es).join("\n"),0<A.length&&(A+="\n")):(v=[cs(n),"#define SHADER_NAME "+n.shaderName,e.compatSettings.saturateSpecEnvBlenderApprox?"#define COMPAT_SATURATE_SPEC_ENV_BLENDER_APPROX":"",e.compatSettings.useSpecEnvBlenderApprox?"#define COMPAT_USE_SPEC_ENV_BLENDER_APPROX":"",f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",0<n.morphTargetsCount&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",0<n.morphTargetsCount&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",0<n.morphTargetsCount?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",n.planeReflProbe?"#define USE_PLANE_REFLECTION":"",`
            uniform mat4 modelMatrix;
            uniform mat4 modelViewMatrix;
            uniform mat4 projectionMatrix;
            uniform mat4 viewMatrix;
            uniform mat3 normalMatrix;
            uniform vec3 cameraPosition;
            uniform bool isOrthographic;

            #ifdef USE_INSTANCING
                attribute mat4 instanceMatrix;
            #endif

            #ifdef USE_INSTANCING_COLOR
                attribute vec3 instanceColor;
            #endif

            attribute vec3 position;
            attribute vec3 normal;
            attribute vec2 uv;

            #ifdef USE_TANGENT
                attribute vec4 tangent;
            #endif

            #if defined(USE_COLOR_ALPHA)
                attribute vec4 color;
            #elif defined(USE_COLOR)
                attribute vec3 color;
            #endif

            #if (defined(USE_MORPHTARGETS) && !defined(MORPHTARGETS_TEXTURE))
                #if MORPHTARGETS_COUNT > 0
                    attribute vec3 morphTarget0;
                #endif
                #if MORPHTARGETS_COUNT > 1
                    attribute vec3 morphTarget1;
                #endif
                #if MORPHTARGETS_COUNT > 2
                    attribute vec3 morphTarget2;
                #endif
                #if MORPHTARGETS_COUNT > 3
                    attribute vec3 morphTarget3;
                #endif
                #if MORPHTARGETS_COUNT > 4
                    attribute vec3 morphTarget4;
                #endif
                #if MORPHTARGETS_COUNT > 5
                    attribute vec3 morphTarget5;
                #endif

                #ifdef USE_MORPHNORMALS
                    #if MORPHTARGETS_COUNT > 0
                        attribute vec3 morphNormal0;
                    #endif
                    #if MORPHTARGETS_COUNT > 1
                        attribute vec3 morphNormal1;
                    #endif
                    #if MORPHTARGETS_COUNT > 2
                        attribute vec3 morphNormal2;
                    #endif
                    #if MORPHTARGETS_COUNT > 3
                        attribute vec3 morphNormal3;
                    #endif
                    #if MORPHTARGETS_COUNT > 4
                        attribute vec3 morphNormal4;
                    #endif
                    #if MORPHTARGETS_COUNT > 5
                        attribute vec3 morphNormal5;
                    #endif
                #else
                    #if MORPHTARGETS_COUNT > 6
                        attribute vec3 morphTarget6;
                    #endif
                    #if MORPHTARGETS_COUNT > 7
                        attribute vec3 morphTarget7;
                    #endif
                    #if MORPHTARGETS_COUNT > 8
                        attribute vec3 morphTarget8;
                    #endif
                    #if MORPHTARGETS_COUNT > 9
                        attribute vec3 morphTarget9;
                    #endif
                    #if MORPHTARGETS_COUNT > 10
                        attribute vec3 morphTarget10;
                    #endif
                    #if MORPHTARGETS_COUNT > 11
                        attribute vec3 morphTarget11;
                    #endif
                #endif
            #endif

            #ifdef USE_SKINNING
                attribute vec4 skinIndex;
                attribute vec4 skinWeight;
            #endif
            `].filter(es).join("\n"),A=[p,cs(n),"#define SHADER_NAME "+n.shaderName,f,function(e){switch(e){case"blender":return"#define MT_BLENDER";case"max":return"#define MT_MAX";case"maya":return"#define MT_MAYA";default:return""}}(n.materialProfile),e.compatSettings.saturateSpecEnvBlenderApprox?"#define COMPAT_SATURATE_SPEC_ENV_BLENDER_APPROX":"",e.compatSettings.useSpecEnvBlenderApprox?"#define COMPAT_USE_SPEC_ENV_BLENDER_APPROX":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",0!==n.envMapCubeUVTileSize?"#define cubeUV_maxTileSize "+nn(n.envMapCubeUVTileSize):"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"",n.physicallyCorrectLights?"#define UNITS_SCALE_FACTOR "+h:"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping===Ue||n.useHDR?"":"#define TONE_MAPPING",n.toneMapping===Ue||n.useHDR?"":Ki.tonemapping_pars_fragment,n.toneMapping===Ue||n.useHDR?"":function(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;case 6:n="LogarithmicMax";break;case 7:n="PhysicalMax";break;case 8:n="FilmicBlender";break;default:console.warn("v3d.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"(vec3 color) { return "+n+"ToneMapping(color); }"}("toneMapping",n.toneMapping),n.dithering?"#define DITHERING":"",n.transparent?"":"#define OPAQUE",Ki.encodings_pars_fragment,$o("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",n.distancePacking?"#define DISTANCE_PACKING "+n.distancePacking:"",n.useSlopeScaledBias?"#define USE_SLOPE_SCALED_BIAS":"","#define ESM_DISTANCE_SCALE "+nn(n.esmDistanceScale),n.planeReflProbe?"#define USE_PLANE_REFLECTION":"",n.useGTAO?"#define USE_GTAO":"",e.compatSettings.gtaoDisableBkgFix?"#define GTAO_DISABLE_BKG_FIX":"","\n"].filter(es).join("\n")),n.isMeshNodeMaterial&&(a=is(a,n.nodeChunks),o=is(o,n.nodeChunks)),a=os(a),a=ts(a,n),a=ns(a,n),n.customPrepTokens&&(a=rs(a,n.customPrepTokens)),o=os(o),o=ts(o,n),o=ns(o,n),n.customPrepTokens&&(o=rs(o,n.customPrepTokens)),a=ls(a),o=ls(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,A=["#define varying in",n.glslVersion===yt?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===yt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+A);let x=_+v+a,y=_+A+o;e.debug.disableCompiledShaderCache&&(x+="\nconst float ANTI_CACHE = "+Math.random()+";",y+="\nconst float ANTI_CACHE = "+Math.random()+";");const b=qo(s,35633,x),M=qo(s,35632,y);s.attachShader(m,b),s.attachShader(m,M),void 0!==n.index0AttributeName?s.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m);let C=!0;function S(){if(C=!1,e.debug.checkShaderErrors){var n,r,i=s.getProgramInfoLog(m).trim(),a=s.getShaderInfoLog(b).trim(),o=s.getShaderInfoLog(M).trim();let e=!0,t=!0;!1===s.getProgramParameter(m,35714)?(e=!1,n=Jo(s,b,"vertex"),r=Jo(s,M,"fragment"),console.error("v3d.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(m,35715),"gl.getProgramInfoLog",i,n,r)):""!==i?console.warn("v3d.WebGLProgram: gl.getProgramInfoLog()",i):""!==a&&""!==o||(t=!1),t&&(g.diagnostics={runnable:e,programLog:i,vertexShader:{log:a,prefix:v},fragmentShader:{log:o,prefix:A}})}s.deleteShader(b),s.deleteShader(M)}let w;this.getUniforms=function(){return void 0===w&&(C&&S(),w=new Ko(s,m)),w};let E;return this.getAttributes=function(){return void 0===E&&(C&&S(),E=function(n,r){const i={};var e=n.getProgramParameter(r,35721);for(let t=0;t<e;t++){var a=n.getActiveAttrib(r,t),o=a.name;let e=1;35674===a.type&&(e=2),35675===a.type&&(e=3),35676===a.type&&(e=4),i[o]={type:a.type,location:n.getAttribLocation(r,o),locationSize:e}}return i}(s,m)),E},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=Zo++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=M,this.profile={calcRenderTime:!1,renderTime:0,timerQueries:[],materials:[]},this.getTexUniformCount=function(){return this.getUniforms().seq.reduce(function(e,t){if(t.info)switch(t.info.type){case 35678:case 35679:case 35680:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:e+=t.info.size}return e},0)},this.beginTimerQuery=function(t,n){if(this.profile.calcRenderTime){const r=t.getExtension(n?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query");if(r){let e;n?(e=t.createQuery(),t.beginQuery(r.TIME_ELAPSED_EXT,e)):(e=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,e)),this.profile.timerQueries.push(e)}}},this.endTimerQuery=function(t,n){if(this.profile.calcRenderTime){const o=t.getExtension(n?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query");if(o){n?t.endQuery(o.TIME_ELAPSED_EXT):o.endQueryEXT(o.TIME_ELAPSED_EXT);const s=this.profile.timerQueries;for(let e=s.length-1;0<=e;e--){var r=s[e],i=n?t.getQueryParameter(r,34919):o.getQueryObjectEXT(r,o.QUERY_RESULT_AVAILABLE_EXT),a=t.getParameter(o.GPU_DISJOINT_EXT);i&&!a&&(r=n?t.getQueryParameter(r,34918):o.getQueryObjectEXT(r,o.QUERY_RESULT_EXT),this.profile.renderTime+=r/1e6,s.splice(e,1))}}}},this}let ds=0;class hs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){var t=e.vertexShader,n=e.fragmentShader;const r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){for(const t of this.materialCache.get(e))t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;var n;return!1===t.has(e)&&(n=new ps,t.set(e,n)),t.get(e)}}class ps{constructor(){this.id=ds++,this.usedTimes=0}}function fs(x,y,b,M,C,a,S){const o=new fr,w=new hs,s=[],E=C.isWebGL2,T=C.logarithmicDepthBuffer,I=C.floatVertexTextures,R=C.maxVertexUniforms,L=C.vertexTextures;let B=C.precision;const P={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite",MeshMaskMaterial:"mask",MeshNodeMaterial:"node"};return this.programs=s,{getParameters:function(e,t,n,r,i,a){var o=r.fog,s=i.geometry,l=e.isMeshStandardMaterial?r.environment:null,c=(e.isMeshStandardMaterial||e.isMeshNodeMaterial&&e.envMap&&!e.envMap.isCubeTexture?b:y).get(e.envMap||l),u=P[e.type],d=i.isSkinnedMesh?(v=(A=i).skeleton.bones,I?1024:(A=R,A=Math.floor((A-20)/4),(A=Math.min(A,v.length))<v.length?(console.warn("v3d.WebGLRenderer: Skeleton has "+v.length+" bones. This GPU supports "+A+"."),0):A)):0;null!==e.precision&&(B=C.getMaxPrecision(e.precision),B!==e.precision&&console.warn("v3d.WebGLProgram.getParameters:",e.precision,"not supported, using",B,"instead.")),r=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,l=void 0!==r?r.length:0;let h=0;void 0!==s.morphAttributes.position&&(h=1),void 0!==s.morphAttributes.normal&&(h=2);let p,f,m,g;u?(_=Zi[u],p=_.vertexShader,f=_.fragmentShader):(p=e.vertexShader,f=e.fragmentShader,w.update(e),m=w.getVertexShaderID(e),g=w.getFragmentShaderID(e));var v=x.getRenderTarget(),A=0<e.alphaTest,r=0<e.clearcoat,_=!!c&&(c.mapping===D||c.mapping===N);return{isWebGL2:E,shaderID:u,shaderName:e.type,vertexShader:p,fragmentShader:f,defines:e.defines,customVertexShaderID:m,customFragmentShaderID:g,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:B,instancing:!0===i.isInstancedMesh,instancingColor:!0===i.isInstancedMesh&&null!==i.instanceColor,supportsVertexTextures:L,outputEncoding:null===v?x.outputEncoding:!0===v.isXRRenderTarget?v.texture.encoding:pt,map:!!e.map,matcap:!!e.matcap,envMap:!!c,envMapMode:c&&c.mapping,envMapCubeUV:_,lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===At,tangentSpaceNormalMap:e.normalMapType===vt,decodeVideoTexture:!!e.map&&!0===e.map.isVideoTexture&&e.map.encoding===ft,clearcoat:r,clearcoatMap:r&&!!e.clearcoatMap,clearcoatRoughnessMap:r&&!!e.clearcoatRoughnessMap,clearcoatNormalMap:r&&!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,specularIntensityMap:!!e.specularIntensityMap,specularColorMap:!!e.specularColorMap,transparent:e.transparent,alphaMap:!!e.alphaMap,alphaTest:A,gradientMap:!!e.gradientMap,sheen:0<e.sheen,sheenColorMap:!!e.sheenColorMap,sheenRoughnessMap:!!e.sheenRoughnessMap,transmission:0<e.transmission,transmissionMap:!!e.transmissionMap,thicknessMap:!!e.thicknessMap,combine:e.combine,vertexTangents:!!e.normalMap&&!!s.attributes.tangent,vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&!!s.attributes.color&&4===s.attributes.color.itemSize,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatMap||e.clearcoatRoughnessMap||e.clearcoatNormalMap||e.displacementMap||e.transmissionMap||e.thicknessMap||e.specularIntensityMap||e.specularColorMap||e.sheenColorMap||e.sheenRoughnessMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||0<e.transmission||e.transmissionMap||e.thicknessMap||e.specularIntensityMap||e.specularColorMap||0<e.sheen||e.sheenColorMap||e.sheenRoughnessMap||!e.displacementMap),fog:!!o,useFog:e.fog,fogExp2:o&&o.isFogExp2,flatShading:!!e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:T,skinning:!0===i.isSkinnedMesh&&0<d,maxBones:d,useVertexTexture:I,morphTargets:void 0!==s.morphAttributes.position,morphNormals:void 0!==s.morphAttributes.normal,morphColors:void 0!==s.morphAttributes.color,morphTargetsCount:l,morphTextureStride:h,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:S.numPlanes,numClipIntersection:S.numIntersection,dithering:e.dithering,shadowMapEnabled:x.shadowMap.enabled&&0<n.length,shadowMapType:x.shadowMap.type,toneMapping:e.toneMapped?x.toneMapping:Ue,physicallyCorrectLights:x.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,doubleSided:e.side===Oe,flipSided:e.side===Fe,depthPacking:void 0!==e.depthPacking&&e.depthPacking,envMapCubeUVTileSize:_&&void 0!==c.image?c.image.width/3:0,distancePacking:void 0!==e.distancePacking&&e.distancePacking,useSlopeScaledBias:void 0!==e.useSlopeScaledBias&&e.useSlopeScaledBias,esmDistanceScale:x.shadowMap.esmDistanceScale,numRectAreaLightShadows:t.rectAreaShadowMap.length,planeReflProbe:!!a,materialName:e.name,materialProfile:e.profile,unitsScaleFactor:x.unitsScaleFactor,useHDR:!!e.useHDR,customPrepTokens:e.customPrepTokens,isMeshNodeMaterial:e.isMeshNodeMaterial,nodeChunks:e.nodeChunks,nodeChunksHash:e.nodeChunksHash,useGTAO:e.isMeshNodeMaterial&&e.canUseGTAO()&&x.canUseGTAO(),index0AttributeName:e.index0AttributeName,extensionDerivatives:e.extensions&&e.extensions.derivatives,extensionFragDepth:e.extensions&&e.extensions.fragDepth,extensionDrawBuffers:e.extensions&&e.extensions.drawBuffers,extensionShaderTextureLOD:e.extensions&&e.extensions.shaderTextureLOD,rendererExtensionFragDepth:E||M.has("EXT_frag_depth"),rendererExtensionDrawBuffers:E||M.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:E||M.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(e){const t=[];if(e.shaderID?t.push(e.shaderID):(t.push(e.customVertexShaderID),t.push(e.customFragmentShaderID)),void 0!==e.defines)for(const i in e.defines)t.push(i),t.push(e.defines[i]);if(void 0!==e.customPrepTokens)for(const a in e.customPrepTokens)t.push(a),t.push(e.customPrepTokens[a]);var n,r;return!1===e.isRawShaderMaterial&&(n=t,r=e,n.push(r.precision),n.push(r.outputEncoding),n.push(r.envMapMode),n.push(r.combine),n.push(r.vertexUvs),n.push(r.fogExp2),n.push(r.sizeAttenuation),n.push(r.maxBones),n.push(r.morphTargetsCount),n.push(r.morphAttributeCount),n.push(r.numDirLights),n.push(r.numPointLights),n.push(r.numSpotLights),n.push(r.numHemiLights),n.push(r.numRectAreaLights),n.push(r.numDirLightShadows),n.push(r.numPointLightShadows),n.push(r.numSpotLightShadows),n.push(r.shadowMapType),n.push(r.toneMapping),n.push(r.numClippingPlanes),n.push(r.numClipIntersection),n.push(r.unitsScaleFactor),n.push(r.esmDistanceScale),n.push(r.numRectAreaLightShadows),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0);t.supportsVertexTextures&&o.enable(1);t.instancing&&o.enable(2);t.instancingColor&&o.enable(3);t.map&&o.enable(4);t.matcap&&o.enable(5);t.envMap&&o.enable(6);t.envMapCubeUV&&o.enable(7);t.lightMap&&o.enable(8);t.aoMap&&o.enable(9);t.emissiveMap&&o.enable(10);t.bumpMap&&o.enable(11);t.normalMap&&o.enable(12);t.objectSpaceNormalMap&&o.enable(13);t.tangentSpaceNormalMap&&o.enable(14);t.clearcoat&&o.enable(15);t.clearcoatMap&&o.enable(16);t.clearcoatRoughnessMap&&o.enable(17);t.clearcoatNormalMap&&o.enable(18);t.displacementMap&&o.enable(19);t.specularMap&&o.enable(20);t.roughnessMap&&o.enable(21);t.metalnessMap&&o.enable(22);t.gradientMap&&o.enable(23);t.alphaMap&&o.enable(24);t.alphaTest&&o.enable(25);t.vertexColors&&o.enable(26);t.vertexAlphas&&o.enable(27);t.vertexUvs&&o.enable(28);t.vertexTangents&&o.enable(29);t.uvsVertexOnly&&o.enable(30);t.fog&&o.enable(31);e.push(o.mask),o.disableAll(),t.useFog&&o.enable(0);t.flatShading&&o.enable(1);t.logarithmicDepthBuffer&&o.enable(2);t.skinning&&o.enable(3);t.useVertexTexture&&o.enable(4);t.morphTargets&&o.enable(5);t.morphNormals&&o.enable(6);t.premultipliedAlpha&&o.enable(7);t.shadowMapEnabled&&o.enable(8);t.physicallyCorrectLights&&o.enable(9);t.doubleSided&&o.enable(10);t.flipSided&&o.enable(11);t.depthPacking&&o.enable(12);t.dithering&&o.enable(13);t.specularIntensityMap&&o.enable(14);t.specularColorMap&&o.enable(15);t.transmission&&o.enable(16);t.transmissionMap&&o.enable(17);t.thicknessMap&&o.enable(18);t.sheen&&o.enable(19);t.sheenColorMap&&o.enable(20);t.sheenRoughnessMap&&o.enable(21);t.decodeVideoTexture&&o.enable(22);t.transparent&&o.enable(23);e.push(o.mask),o.disableAll(),t.distancePacking&&o.enable(0);t.useSlopeScaledBias&&o.enable(1);t.useGTAO&&o.enable(2);t.useHDR&&o.enable(3);t.planeReflProbe&&o.enable(4);e.push(o.mask)}(t,e),t.push(x.outputEncoding)),t.push(e.customProgramCacheKey),void 0!==e.nodeChunksHash&&t.push(e.nodeChunksHash),t.join()},getUniforms:function(e){var t=P[e.type];let n;return n=t?(t=Zi[t],Bi.clone(t.uniforms)):e.uniforms,n},acquireProgram:function(e,n){let r;for(let e=0,t=s.length;e<t;e++){var i=s[e];if(i.cacheKey===n){r=i,++r.usedTimes;break}}void 0===r&&(r=new us(x,n,e,a),s.push(r));const t=r.profile.materials;return e.materialName&&t.indexOf(e.materialName)<0&&t.push(e.materialName),r},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=s.indexOf(e),s[t]=s[s.length-1],s.pop(),e.destroy())},releaseShaderCache:function(e){w.remove(e)},programs:s,dispose:function(){w.dispose()}}}function ms(){let r=new WeakMap;return{get:function(e){let t=r.get(e);return void 0===t&&(t={},r.set(e,t)),t},remove:function(e){r.delete(e)},update:function(e,t,n){r.get(e)[t]=n},dispose:function(){r=new WeakMap}}}function gs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function vs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function As(){const s=[];let l=0;const o=[],c=[],u=[];function d(e,t,n,r,i,a){let o=s[l];return void 0===o?(o={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:i,group:a},s[l]=o):(o.id=e.id,o.object=e,o.geometry=t,o.material=n,o.groupOrder=r,o.renderOrder=e.renderOrder,o.z=i,o.group=a),l++,o}return{opaque:o,transmissive:c,transparent:u,init:function(){l=0,o.length=0,c.length=0,u.length=0},push:function(e,t,n,r,i,a){a=d(e,t,n,r,i,a),(0<n.transmission?c:!0===n.transparent?u:o).push(a)},unshift:function(e,t,n,r,i,a){a=d(e,t,n,r,i,a),(0<n.transmission?c:!0===n.transparent?u:o).unshift(a)},finish:function(){for(let e=l,t=s.length;e<t;e++){const n=s[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.group=null}},sort:function(e,t){1<o.length&&o.sort(e||gs),1<c.length&&c.sort(t||vs),1<u.length&&u.sort(t||vs)}}}function _s(){let r=new WeakMap;return{get:function(e,t){let n;return!1===r.has(e)?(n=new As,r.set(e,[n])):t>=r.get(e).length?(n=new As,r.get(e).push(n)):n=r.get(e)[t],n},dispose:function(){r=new WeakMap}}}function xs(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new wn,color:new mn};break;case"SpotLight":t={position:new wn,direction:new wn,color:new mn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new wn,color:new mn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new wn,skyColor:new mn,groundColor:new mn};break;case"RectAreaLight":t={color:new mn,position:new wn,halfWidth:new wn,halfHeight:new wn}}return n[e.id]=t,t}}}let ys=0;function bs(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ms(P,D){const N=new xs,F=function(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yt,position:new wn,shadowCameraNear:1,maxDistance:0,expBias:1};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yt,shadow:0,shadowCameraNear:1,shadowCameraFar:1e3,expBias:1};break;case"PointLight":case"RectAreaLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yt,shadowCameraNear:1,shadowCameraFar:1e3,expBias:1}}return n[e.id]=t,t}}}(),O={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numRectAreaShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],rectAreaShadow:[],rectAreaShadowMap:[],rectAreaShadowMatrix:[]};for(let e=0;e<9;e++)O.probe.push(new wn);const A=new wn,_=new rr,x=new rr;return{setup:function(n,e){let r=0,i=0,a=0;for(let e=0;e<9;e++)O.probe[e].set(0,0,0);let o=0,s=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0;n.sort(bs);var m=!0!==e?Math.PI:1;for(let e=0,t=n.length;e<t;e++){var g=n[e],v=g.color,A=g.intensity,_=g.distance,x=g.shadow&&g.shadow.map?g.shadow.map.texture:null;if(g.isAmbientLight)r+=v.r*A*m,i+=v.g*A*m,a+=v.b*A*m;else if(g.isLightProbe)for(let e=0;e<9;e++)O.probe[e].addScaledVector(g.sh.coefficients[e],A);else if(g.isDirectionalLight){const M=N.get(g);if(M.color.copy(g.color).multiplyScalar(g.intensity*m),g.castShadow){var y=g.shadow;const C=F.get(g);C.shadowBias=y.bias,C.shadowNormalBias=y.normalBias,C.shadowRadius=y.radius,C.shadowMapSize=y.mapSize,O.directionalShadow[o]=C,O.directionalShadowMap[o]=x,O.directionalShadowMatrix[o]=g.shadow.matrix,C.shadowCameraNear=y.camera.near,C.expBias=y.expBias,d++}O.directional[o]=M,o++}else if(g.isSpotLight){const S=N.get(g);if(S.position.setFromMatrixPosition(g.matrixWorld),S.color.copy(v).multiplyScalar(A*m),S.distance=_,S.coneCos=Math.cos(g.angle),S.penumbraCos=Math.cos(g.angle*(1-g.penumbra)),S.decay=g.decay,g.castShadow){const w=g.shadow,E=F.get(g);E.shadowBias=w.bias,E.shadowNormalBias=w.normalBias,E.shadowRadius=w.radius,E.shadowMapSize=w.mapSize,O.spotShadow[l]=E,O.spotShadowMap[l]=x,O.spotShadowMatrix[l]=g.shadow.matrix,E.shadow=g.castShadow?w.calcUseOmniMaps(g.angle)?2:1:0,E.shadowCameraNear=w.camera.near,E.shadowCameraFar=w.camera.far,E.expBias=w.expBias,p++}O.spot[l]=S,l++}else if(g.isRectAreaLight){const T=N.get(g);if(T.color.copy(v).multiplyScalar(A),T.halfWidth.set(.5*g.width,0,0),T.halfHeight.set(0,.5*g.height,0),g.castShadow){var b=g.shadow;const I=F.get(g);I.shadowBias=b.bias,I.shadowNormalBias=b.normalBias,I.shadowRadius=b.radius,I.shadowMapSize=b.mapSize,I.shadowCameraNear=b.camera.near,I.shadowCameraFar=b.camera.far,I.expBias=b.expBias,O.rectAreaShadow[c]=I,O.rectAreaShadowMap[c]=x,O.rectAreaShadowMatrix[c]=g.shadow.matrix,f++}O.rectArea[c]=T,c++}else if(g.isPointLight){const R=N.get(g);if(R.color.copy(g.color).multiplyScalar(g.intensity*m),R.distance=g.distance,R.decay=g.decay,g.castShadow){b=g.shadow;const L=F.get(g);L.shadowBias=b.bias,L.shadowNormalBias=b.normalBias,L.shadowRadius=b.radius,L.shadowMapSize=b.mapSize,L.shadowCameraNear=b.camera.near,L.shadowCameraFar=b.camera.far,L.expBias=b.expBias,O.pointShadow[s]=L,O.pointShadowMap[s]=x,O.pointShadowMatrix[s]=g.shadow.matrix,h++}O.point[s]=R,s++}else if(g.isHemisphereLight){const B=N.get(g);B.skyColor.copy(g.color).multiplyScalar(A*m),B.groundColor.copy(g.groundColor).multiplyScalar(A*m),O.hemi[u]=B,u++}}0<c&&(D.isWebGL2||!0===P.has("OES_texture_float_linear")?(O.rectAreaLTC1=qi.LTC_FLOAT_1,O.rectAreaLTC2=qi.LTC_FLOAT_2):!0===P.has("OES_texture_half_float_linear")?(O.rectAreaLTC1=qi.LTC_HALF_1,O.rectAreaLTC2=qi.LTC_HALF_2):console.error("v3d.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),O.ambient[0]=r,O.ambient[1]=i,O.ambient[2]=a;const t=O.hash;t.directionalLength===o&&t.pointLength===s&&t.spotLength===l&&t.rectAreaLength===c&&t.hemiLength===u&&t.numDirectionalShadows===d&&t.numPointShadows===h&&t.numSpotShadows===p&&t.numRectAreaShadows===f||(O.directional.length=o,O.spot.length=l,O.rectArea.length=c,O.point.length=s,O.hemi.length=u,O.directionalShadow.length=d,O.directionalShadowMap.length=d,O.pointShadow.length=h,O.pointShadowMap.length=h,O.spotShadow.length=p,O.spotShadowMap.length=p,O.directionalShadowMatrix.length=d,O.pointShadowMatrix.length=h,O.spotShadowMatrix.length=p,t.directionalLength=o,t.pointLength=s,t.spotLength=l,t.rectAreaLength=c,t.hemiLength=u,t.numDirectionalShadows=d,t.numPointShadows=h,t.numSpotShadows=p,O.rectAreaShadow.length=f,O.rectAreaShadowMap.length=f,O.rectAreaShadowMatrix.length=f,t.numRectAreaShadows=f,O.version=ys++)},setupView:function(n,r){let i=0,a=0,o=0,s=0,l=0;var c=r.matrixWorldInverse;for(let e=0,t=n.length;e<t;e++){var u=n[e];if(u.isDirectionalLight){const h=O.directional[i];if(h.direction.setFromMatrixPosition(u.matrixWorld),A.setFromMatrixPosition(u.target.matrixWorld),h.direction.sub(A),h.direction.transformDirection(c),u.castShadow){var d=u.shadow;const p=F.get(u);p.position.setFromMatrixPosition(u.matrixWorld),p.position.applyMatrix4(c),p.maxDistance=d.isDirectionalLightShadowCSM?d.maxDistance:r.far}i++}else if(u.isSpotLight){const f=O.spot[o];f.position.setFromMatrixPosition(u.matrixWorld),f.position.applyMatrix4(c),f.direction.setFromMatrixPosition(u.matrixWorld),A.setFromMatrixPosition(u.target.matrixWorld),f.direction.sub(A),f.direction.transformDirection(c),o++}else if(u.isRectAreaLight){const m=O.rectArea[s];m.position.setFromMatrixPosition(u.matrixWorld),m.position.applyMatrix4(c),x.identity(),_.copy(u.matrixWorld),_.premultiply(c),x.extractRotation(_),m.halfWidth.set(.5*u.width,0,0),m.halfHeight.set(0,.5*u.height,0),m.halfWidth.applyMatrix4(x),m.halfHeight.applyMatrix4(x),s++}else if(u.isPointLight){const g=O.point[a];g.position.setFromMatrixPosition(u.matrixWorld),g.position.applyMatrix4(c),a++}else if(u.isHemisphereLight){const v=O.hemi[l];v.direction.setFromMatrixPosition(u.matrixWorld),v.direction.transformDirection(c),v.direction.normalize(),l++}}},state:O}}function Cs(e,t){const n=new Ms(e,t),r=[],i=[],a=[],o=[];return{init:function(){r.length=0,i.length=0,a.length=0,o.length=0},state:{lightsArray:r,shadowsArray:i,envMapProbeArray:a,planeReflProbeArray:o,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)},pushEnvMapProbe:function(e){a.push(e)},sortEnvMapProbes:function(){a.sort((e,t)=>e.influenceDistance-t.influenceDistance)},pushPlaneReflProbe:function(e){o.push(e)}}}function Ss(r,i){let a=new WeakMap;return{get:function(e,t=0){let n;return!1===a.has(e)?(n=new Cs(r,i),a.set(e,[n])):t>=a.get(e).length?(n=new Cs(r,i),a.get(e).push(n)):n=a.get(e)[t],n},dispose:function(){a=new WeakMap}}}class ws extends Gr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.useSlopeScaledBias=!1,this.slopeScaledBias=0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.useSlopeScaledBias=e.useSlopeScaledBias,this.slopeScaledBias=e.slopeScaledBias,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}ws.prototype.isMeshDepthMaterial=!0;class Es extends Gr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new wn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.defines={DISTANCE_SCALE:"1.0"},this.distancePacking=mt,this.useSlopeScaledBias=!1,this.slopeScaledBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.distancePacking=e.distancePacking,this.useSlopeScaledBias=e.useSlopeScaledBias,this.slopeScaledBias=e.slopeScaledBias,this}}Es.prototype.isMeshDistanceMaterial=!0;const Ts="void main() {\ngl_Position = vec4(position, 1.0);\n}",Is="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\nconst float samples = float(VSM_SAMPLES);\nfloat mean = 0.0;\nfloat squared_mean = 0.0;\nfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / (samples - 1.0);\nfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\nfor (float i = 0.0; i < samples; i++) {\nfloat uvOffset = uvStart + i * uvStride;\n#ifdef HORIZONTAL_PASS\nvec2 distribution = unpackRGBATo2Half(texture2D(shadow_pass, (gl_FragCoord.xy + vec2(uvOffset, 0.0) * radius) / resolution));\nmean += distribution.x;\nsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n#else\nfloat depth = unpackRGBAToDepth(texture2D(shadow_pass, (gl_FragCoord.xy + vec2(0.0, uvOffset) * radius) / resolution));\nmean += depth;\nsquared_mean += depth * depth;\n#endif\n}\nmean = mean / samples;\nsquared_mean = squared_mean / samples;\nfloat std_dev = sqrt(squared_mean - mean * mean);\ngl_FragColor = pack2HalfToRGBA(vec2(mean, std_dev));\n}",Rs=new rr,Ls=new wn,Bs=new wn;class Ps{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Yt(512,512),this.map=null,this.mapPass=null,this.matrix=new rr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Hi,this._frameExtents=new Yt(1,1),this._viewportCount=1,this._viewports=[new yn(0,0,1,1)],this.expBias=1,this.slopeScaledBias=0,this._additionalMap2D=null,this._additionalMapCube=null}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Ls.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ls),Bs.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Bs),t.updateMatrixWorld(),Rs.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rs),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose(),null!==this._additionalMap2D&&this._additionalMap2D.dispose(),null!==this._additionalMapCube&&this._additionalMapCube.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this.expBias=e.expBias,this.slopeScaledBias=e.slopeScaledBias,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}Ps.prototype.isLightShadow=!0;const Ds=Math.PI/4,Ns=new rr,Fs=new wn,Os=new wn;class Us extends Ps{constructor(){super(new Ni(50,1,.5,500)),this.focus=1,this.useOmniMaps=!1,this.useMinFov90=!1,this._frameExtentsOmni=new Yt(4,2),this._viewportCountOmni=6,this._viewportsOmni=[new yn(2,1,1,1),new yn(0,1,1,1),new yn(3,1,1,1),new yn(1,1,1,1),new yn(3,0,1,1),new yn(1,0,1,1)],this._cubeDirections=[new wn(1,0,0),new wn(-1,0,0),new wn(0,0,1),new wn(0,0,-1),new wn(0,1,0),new wn(0,-1,0)],this._cubeUps=[new wn(0,1,0),new wn(0,1,0),new wn(0,1,0),new wn(0,1,0),new wn(0,0,1),new wn(0,0,-1)]}updateMatrices(e,t=0){if(this.useOmniMaps){const i=this.camera,a=this.matrix;Fs.setFromMatrixPosition(e.matrixWorld),i.position.copy(Fs),Os.copy(i.position),Os.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Os),i.updateMatrixWorld(),a.makeTranslation(-Fs.x,-Fs.y,-Fs.z),Ns.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ns)}else{const o=this.camera;var n=2*Tt*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,t=e.distance||o.far;n===o.fov&&r===o.aspect&&t===o.far||(o.fov=n,o.aspect=r,o.far=t,o.updateProjectionMatrix()),super.updateMatrices(e)}}getViewportCount(){return this.useOmniMaps?this._viewportCountOmni:super.getViewportCount()}getViewport(e){return this.useOmniMaps?this._viewportsOmni[e]:super.getViewport(e)}getFrameExtents(){return this.useOmniMaps?this._frameExtentsOmni:super.getFrameExtents()}calcUseOmniMaps(e){return e>Ds?this.useOmniMaps=!0:this.useOmniMaps=!1,this.useOmniMaps}copy(e){return super.copy(e),this.focus=e.focus,this.useOmniMaps=e.useOmniMaps,this.useMinFov90=e.useMinFov90,this}}Us.prototype.isSpotLightShadow=!0;const zs=.8,Vs=.2,Gs=.8,ks=50;function Qs(f,m,e){let g=new Hi;const p=new Yt,v=new Yt,A=new yn,d=new ws({depthPacking:i}),h=new Es,_={},x=e.maxTextureSize,y=e.isWebGL2,b={0:Fe,1:Ne,2:Oe},M=new Pi({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Yt},radius:{value:4}},vertexShader:Ts,fragmentShader:Is}),C=M.clone();C.defines.HORIZONTAL_PASS=1;const t=new ci;t.setAttribute("position",new Hr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const S=new Ei(t,M),w=new rr,c=new rr,E=new Yt(x,x),T=new wn,I=new wn,R=new wn,L=[new wn(1,0,0),new wn(-1,0,0),new wn(0,1,0),new wn(0,-1,0),new wn(0,0,1),new wn(0,0,-1)],B=[new wn(0,1,0),new wn(0,1,0),new wn(0,0,1),new wn(0,0,-1),new wn(0,1,0),new wn(0,1,0)],P=new jn,u=[new wn,new wn,new wn,new wn,new wn,new wn,new wn,new wn],D=new Ei(new ji(1,1,1,1));D.name="esmFarPlane",D.castShadow=!0,D.material.shadowSide=Ne;const N=0,F=1,O=0,U=1,z=new ia(-1,1,1,-1,0,10),V=new Ei(new ji(2,2)),G=new Pi({type:"ShadowCubeOctahedral",defines:Object.assign({},Zi.cubeOctahedral.defines),uniforms:Bi.clone(Zi.cubeOctahedral.uniforms),vertexShader:Zi.cubeOctahedral.vertexShader,fragmentShader:Zi.cubeOctahedral.fragmentShader}),l={},k={},Q=this;function W(n,e,r,t,i,a,o,s,l){let c=null;var u=s||o===te?n.customDistanceMaterial:n.customDepthMaterial;if(c=void 0!==u?u:s||o===te?h:d,f.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&0<r.alphaTest){n=c.uuid,u=r.uuid;let e=_[n];void 0===e&&(e={},_[n]=e);let t=e[u];void 0===t&&(t=c.clone(),e[u]=t),c=t}switch(c.visible=r.visible,c.wireframe=r.wireframe,o===ee?c.side=null!==r.shadowSide?r.shadowSide:r.side:c.side=null!==r.shadowSide?r.shadowSide:b[r.side],c.alphaMap=r.alphaMap,c.alphaTest=r.alphaTest,c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.displacementMap=r.displacementMap,c.displacementScale=r.displacementScale,c.displacementBias=r.displacementBias,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!s&&o!==te||!0!==c.isMeshDistanceMaterial||(c.referencePosition.copy(l),c.nearDistance=i,c.farDistance=a,c.distancePacking=o===te?gt:mt),o===te&&(c.defines.DISTANCE_SCALE=nn(Q.esmDistanceScale)),o){case q:case re:case Z:case J:case ne:c.useSlopeScaledBias=!0,c.slopeScaledBias=t.shadow.slopeScaledBias;break;case te:c.useSlopeScaledBias=!0,c.slopeScaledBias=.5}return c}function H(n,r,i,a,o,s){if(!1!==n.visible){var e=r.ignoreShadowLayers||n.layers.test(r.layers);if(e&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===ee)&&(!n.frustumCulled||g.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var l=m.update(n),c=n.material;if(Array.isArray(c)){var u=l.groups;for(let e=0,t=u.length;e<t;e++){var d=u[e],h=c[d.materialIndex];h&&h.visible&&(h=W(n,0,h,a,i.near,i.far,o,s,I),f.renderBufferDirect(i,null,l,h,n,d))}}else c.visible&&(e=W(n,0,c,a,i.near,i.far,o,s,I),f.renderBufferDirect(i,null,l,e,n,null))}var p=n.children;for(let e=0,t=p.length;e<t;e++)H(p[e],r,i,a,o,s)}}function Y(t,n,r,i){const a=r.shadow,e=a.camera;I.setFromMatrixPosition(r.matrixWorld),p.copy(a.mapSize);var o=a.getFrameExtents();p.multiply(o),v.copy(a.mapSize),(p.x>x||p.y>x)&&(p.x>x&&(v.x=Math.floor(x/o.x),p.x=v.x*o.x,a.mapSize.x=v.x),p.y>x&&(v.y=Math.floor(x/o.y),p.y=v.y*o.y,a.mapSize.y=v.y)),r.isSpotLight&&a.map&&a.map.width/a.map.height!=2&&(o=a.map,a.map=a._additionalMap2D,a._additionalMap2D=o);var s=r.isPointLight||r.isRectAreaLight||r.isSpotLight&&a.useOmniMaps;s?r.isSpotLight&&(e.fov=90,e.updateProjectionMatrix()):r.isDirectionalLight?(r.shadow.isDirectionalLightShadowCSM&&(l=j(n,a,p,P),e.left=l.center.x-l.radius,e.right=l.center.x+l.radius,e.top=l.center.y+l.radius,e.bottom=l.center.y-l.radius,e.near=-l.center.z-l.radius,e.far=-l.center.z+l.radius,e.updateProjectionMatrix()),l=r.getWorldDirection(R),I.addScaledVector(l,e.near)):r.isSpotLight&&a.useMinFov90&&(e.fov=90,e.updateProjectionMatrix()),null!==a.map||s||i!==ee||(c={minFilter:Ge,magFilter:Ge,format:Ke},a.map=new bn(p.x,p.y,c),a.map.texture.name=r.name+".shadowMap",a.mapPass=new bn(p.x,p.y,c),e.updateProjectionMatrix()),null===a.map&&(u={minFilter:Ve,magFilter:Ve,format:Ke},a.map=new bn(p.x,p.y,u),a.map.texture.name=r.name+".shadowMap",e.updateProjectionMatrix()),f.state.buffers.color.setClear(1,1,1,1),f.setRenderTarget(a.map),f.clear();var l,c,u,d=a.getViewportCount();for(let e=0;e<d;e++){var h=a.getViewport(e);A.set(v.x*h.x,v.y*h.y,v.x*h.z,v.y*h.w),f.state.viewport(A),a.updateMatrices(r,e),g=a.getFrustum(),H(t,n,a.camera,r,i,s)}s||i!==ee||(l=a,c=n,u=m.update(S),M.uniforms.shadow_pass.value=l.map.texture,M.uniforms.resolution.value=l.mapSize,M.uniforms.radius.value=l.radius,f.setRenderTarget(l.mapPass),f.clear(),f.renderBufferDirect(c,null,u,M,S,null),C.uniforms.shadow_pass.value=l.mapPass.texture,C.uniforms.resolution.value=l.mapSize,C.uniforms.radius.value=l.radius,f.setRenderTarget(l.map),f.clear(),f.renderBufferDirect(c,null,u,C,S,null))}function X(e,t,n,r,i,a,o){const s=V.material=(o===O?function(e){if(!(e in l)){const t=l[e]=new Pi({type:"ShadowBlur",defines:Object.assign({},Zi.blur.defines,{LOG_SPACE:1,OCTAHEDRAL_MAP:1}),uniforms:Bi.clone(Zi.blur.uniforms),customPrepTokens:Object.assign({},Zi.blur.customPrepTokens),vertexShader:Zi.blur.vertexShader,fragmentShader:Zi.blur.fragmentShader});t.customPrepTokens.MAX_SAMPLE_RADIUS=e}return l[e]}:function(e){if(!(e in k)){const t=k[e]=new Pi({type:"ShadowBlur",defines:Object.assign({},Zi.blur.defines,{LOG_SPACE:1}),uniforms:Bi.clone(Zi.blur.uniforms),customPrepTokens:Object.assign({},Zi.blur.customPrepTokens),vertexShader:Zi.blur.vertexShader,fragmentShader:Zi.blur.fragmentShader});t.customPrepTokens.MAX_SAMPLE_RADIUS=e}return k[e]})(r);s.uniforms.direction.value.set(+(a===N),+(a===F)),s.uniforms.colorTexture.value=t.texture,s.uniforms.texSize.value.set(t.width,t.height),s.uniforms.kernelRadius.value=i,s.uniformsNeedUpdate=!0,e.setRenderTarget(n),e.clear(),e.updateGeometry(V),e.renderBufferDirect(z,!1,V.geometry,s,V,null)}function j(t,e,n,r){var i=Rt(e.maxDistance,t.near,t.far)/t.far;for(let e=0;e<u.length;e++){const l=u[e];var a=1&e;l.set(e>>2&1,e>>1&1,a).multiplyScalar(2).subScalar(1).applyMatrix4(t.projectionMatrixInverse),1==a&&l.multiplyScalar(i)}r.setFromPoints(u),c.multiplyMatrices(e.camera.matrixWorldInverse,t.matrixWorld);const o=r.center.applyMatrix4(c);var s=r.radius*=c.getMaxScaleOnAxis(),e=n.x/2/s,s=n.y/2/s;return o.x=Math.round(o.x*e)/e,o.y=Math.round(o.y*s)/s,r}function K(e,t,n,r){let i,a,o,s,l,c;t.isPerspectiveCamera?(i=a=0,o=-.999*t.far,s=l=2*-o*Math.tan(Dt(t.fov)/2),c=1):t.isOrthographicCamera&&(i=(t.right+t.left)/2,a=(t.top+t.bottom)/2,o=-.999*t.far,s=t.right-t.left,l=t.top-t.bottom,c=1),t.add(D),D.scale.set(s,l,c),D.position.set(i,a,o),D.updateMatrixWorld(),H(D,e,t,n,r,!0)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Z,this.esmDistanceScale=1,this.render=function(n,r,i){if(!1!==Q.enabled&&(!1!==Q.autoUpdate||!1!==Q.needsUpdate)&&0!==n.length){var e=f.getRenderTarget(),t=f.getActiveCubeFace(),a=f.getActiveMipmapLevel();const s=f.state;s.setBlending(ie),s.buffers.color.setClear(1,1,1,1),s.buffers.depth.setTest(!0),s.setScissorTest(!1);for(let e=0,t=n.length;e<t;e++){var o=n[e];const l=o.shadow;if(void 0!==l){if(!1!==l.autoUpdate||!1!==l.needsUpdate){if(o.isSpotLight&&l.calcUseOmniMaps(o.angle),o.isPointLight||o.isRectAreaLight||o.isSpotLight&&l.useOmniMaps)switch(Q.type){case q:case re:case Z:case J:case ne:Y(r,i,o,Q.type);break;case te:!function(t,n,r,i){const a=r.shadow,o=a.camera,e=a.matrix,s=r.isPointLight||r.isRectAreaLight?2:1,l=p.copy(a.mapSize).multiplyScalar(s).min(E).multiplyScalar(1/s);null===a._additionalMapCube&&(a._additionalMapCube=new Ui(l.x,{minFilter:Ge,magFilter:Ge,format:y?Je:Ke,type:Xe}),a._additionalMapCube.texture.name=r.name+".shadowMap.tmpCube");null===a._additionalMap2D&&(a._additionalMap2D=new bn(l.x*s,l.y*s,{minFilter:Ge,magFilter:Ge,format:y?Je:Ke,type:Xe}),a._additionalMap2D.texture.name=r.name+".shadowMap.tmp2D");null===a.map&&(a.map=new bn(l.x*s,l.y*s,{minFilter:Ge,magFilter:Ge,format:y?Je:Ke,type:Xe}),a.map.texture.name=r.name+".shadowMap");I.setFromMatrixPosition(r.matrixWorld),o.position.copy(I),r.isSpotLight&&(o.fov=90,o.updateProjectionMatrix());e.makeTranslation(-I.x,-I.y,-I.z);for(let e=0;e<6;e++)T.copy(o.position),T.add(L[e]),o.up.copy(B[e]),2!==e&&3!==e&&o.up.multiplyScalar(-1),o.lookAt(T),o.updateMatrixWorld(),w.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),g.setFromProjectionMatrix(w),f.setRenderTarget(a._additionalMapCube,e),f.clearDepth(),K(n,o,r,i),H(t,n,o,r,i,!0);var c=Math.max(a.radius*s,.001),u=function(e){return Math.ceil(Vs*e)}(c);(function(e,t,n){const r=V.material=G;r.uniforms.tCube.value=t.texture,r.uniforms.texelSize.value.set(1/n.width,1/n.height),r.uniformsNeedUpdate=!0,e.setRenderTarget(n),e.clear(),e.updateGeometry(V),e.renderBufferDirect(z,!1,V.geometry,r,V,null)})(f,a._additionalMapCube,a.map),X(f,a.map,a._additionalMap2D,u,c,F,O),X(f,a._additionalMap2D,a.map,u,c,N,O)}(r,i,o,Q.type);break;default:continue}else{if(!o.isSpotLight&&!o.isDirectionalLight)continue;switch(Q.type){case q:case re:case Z:case J:case ne:case ee:Y(r,i,o,Q.type);break;case te:!function(e,t,n,r){const i=n.shadow,a=i.camera,o=i.matrix,s=p.copy(i.mapSize).min(E);null===i._additionalMap2D&&(i._additionalMap2D=new bn(s.x,s.y,{minFilter:Ge,magFilter:Ge,format:y?Je:Ke,type:Xe}),i._additionalMap2D.texture.name=n.name+".shadowMap.tmp2D");null===i.map&&(i.map=new bn(s.x,s.y,{minFilter:Ge,magFilter:Ge,format:y?Je:Ke,type:Xe}),i.map.texture.name=n.name+".shadowMap");{var l;I.setFromMatrixPosition(n.matrixWorld),a.position.copy(I),T.setFromMatrixPosition(n.target.matrixWorld),a.lookAt(T),a.updateMatrixWorld(),n.isDirectionalLight?(n.shadow.isDirectionalLightShadowCSM&&(l=j(t,i,s,P),a.left=l.center.x-l.radius,a.right=l.center.x+l.radius,a.top=l.center.y+l.radius,a.bottom=l.center.y-l.radius,a.near=-l.center.z-l.radius,a.far=-l.center.z+l.radius,a.updateProjectionMatrix()),l=n.getWorldDirection(R),I.addScaledVector(l,a.near)):n.isSpotLight&&i.useMinFov90&&(a.fov=90,a.updateProjectionMatrix())}o.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),o.multiply(a.projectionMatrix),o.multiply(a.matrixWorldInverse),w.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),g.setFromProjectionMatrix(w),f.setRenderTarget(i.map),f.clearDepth(),K(t,a,n,r),H(e,t,a,n,r,!1);let c;c=n.isDirectionalLight&&n.shadow.isDirectionalLightShadowCSM?function(e,t){return ks*e/t}(i.radius,(a.right-a.left)/2):n.isSpotLight?i.radius*Gs:i.radius;c=Math.max(c,.001);n=function(e){return Math.ceil(zs*e)}(c);X(f,i.map,i._additionalMap2D,n,c,N,U),X(f,i._additionalMap2D,i.map,n,c,F,U)}(r,i,o,Q.type);break;default:continue}}l.needsUpdate=!1}}else console.warn("v3d.WebGLShadowMap:",o,"has no shadow.")}Q.needsUpdate=!1,f.setRenderTarget(e,t,a)}}}function Ws(u,i,a){const n=a.isWebGL2;const r=new function(){let t=!1;const a=new yn;let n=null;const o=new yn(0,0,0,0);return{setMask:function(e){n===e||t||(u.colorMask(e,e,e,e),n=e)},setLocked:function(e){t=e},setClear:function(e,t,n,r,i){!0===i&&(e*=r,t*=r,n*=r),a.set(e,t,n,r),!1===o.equals(a)&&(u.clearColor(e,t,n,r),o.copy(a))},reset:function(){t=!1,n=null,o.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){(e?U:z)(2929)},setMask:function(e){n===e||t||(u.depthMask(e),n=e)},setFunc:function(e){if(r!==e){if(e)switch(e){case we:u.depthFunc(512);break;case Ee:u.depthFunc(519);break;case Te:u.depthFunc(513);break;case Ie:u.depthFunc(515);break;case Re:u.depthFunc(514);break;case Le:u.depthFunc(518);break;case Be:u.depthFunc(516);break;case Pe:u.depthFunc(517);break;default:u.depthFunc(515)}else u.depthFunc(515);r=e}},setLocked:function(e){t=e},setClear:function(e){i!==e&&(u.clearDepth(e),i=e)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?U:z)(2960)},setMask:function(e){n===e||t||(u.stencilMask(e),n=e)},setFunc:function(e,t,n){r===e&&i===t&&a===n||(u.stencilFunc(e,t,n),r=e,i=t,a=n)},setOp:function(e,t,n){o===e&&s===t&&l===n||(u.stencilOp(e,t,n),o=e,s=t,l=n)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(u.clearStencil(e),c=e)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}};let t={},l={},c=new WeakMap,d=[],h=null,p=!1,f=null,m=null,g=null,v=null,A=null,_=null,x=null,y=!1,b=null,M=null,C=null,S=null,w=null;const E=u.getParameter(35661);let T=!1,e=0;const I=u.getParameter(7938);-1!==I.indexOf("WebGL")?(e=parseFloat(/^WebGL (\d)/.exec(I)[1]),T=1<=e):-1!==I.indexOf("OpenGL ES")&&(e=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),T=2<=e);let R=null,L={};var B=u.getParameter(3088),P=u.getParameter(2978);const D=(new yn).fromArray(B),N=(new yn).fromArray(P);function F(e,t,n){var r=new Uint8Array(4),i=u.createTexture();u.bindTexture(e,i),u.texParameteri(e,10241,9728),u.texParameteri(e,10240,9728);for(let e=0;e<n;e++)u.texImage2D(t+e,0,6408,1,1,0,6408,5121,r);return i}const O={};function U(e){!0!==t[e]&&(u.enable(e),t[e]=!0)}function z(e){!1!==t[e]&&(u.disable(e),t[e]=!1)}O[3553]=F(3553,3553,1),O[34067]=F(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),s.setClear(0),U(2929),o.setFunc(Ie),Q(!1),W(j),U(2884),k(ie);const V={[ue]:32774,[de]:32778,[he]:32779};n?(V[pe]=32775,V[fe]=32776):null!==(P=i.get("EXT_blend_minmax"))&&(V[pe]=P.MIN_EXT,V[fe]=P.MAX_EXT);const G={[me]:0,[ge]:1,[ve]:768,[_e]:770,[Se]:776,[Me]:774,[ye]:772,[Ae]:769,[xe]:771,[Ce]:775,[be]:773};function k(e,t,n,r,i,a,o,s){if(e!==ie){if(!1===p&&(U(3042),p=!0),e===ce)i=i||t,a=a||n,o=o||r,t===m&&i===A||(u.blendEquationSeparate(V[t],V[i]),m=t,A=i),n===g&&r===v&&a===_&&o===x||(u.blendFuncSeparate(G[n],G[r],G[a],G[o]),g=n,v=r,_=a,x=o),f=e,y=null;else if(e!==f||s!==y){if(m===ue&&A===ue||(u.blendEquation(32774),m=ue,A=ue),s)switch(e){case ae:u.blendFuncSeparate(1,771,1,771);break;case oe:u.blendFunc(1,1);break;case se:u.blendFuncSeparate(0,769,0,1);break;case le:u.blendFuncSeparate(0,768,0,770);break;default:console.error("v3d.WebGLState: Invalid blending: ",e)}else switch(e){case ae:u.blendFuncSeparate(770,771,1,771);break;case oe:u.blendFunc(770,1);break;case se:u.blendFuncSeparate(0,769,0,1);break;case le:u.blendFunc(0,768);break;default:console.error("v3d.WebGLState: Invalid blending: ",e)}g=null,v=null,_=null,x=null,f=e,y=s}}else!0===p&&(z(3042),p=!1)}function Q(e){b!==e&&(e?u.frontFace(2304):u.frontFace(2305),b=e)}function W(e){e!==X?(U(2884),e!==M&&(e===j?u.cullFace(1029):e===K?u.cullFace(1028):u.cullFace(1032))):z(2884),M=e}function H(e,t,n){e?(U(32823),S===t&&w===n||(u.polygonOffset(t,n),S=t,w=n)):z(32823)}function Y(e){void 0===e&&(e=33984+E-1),R!==e&&(u.activeTexture(e),R=e)}return{buffers:{color:r,depth:o,stencil:s},enable:U,disable:z,bindFramebuffer:function(e,t){return l[e]!==t&&(u.bindFramebuffer(e,t),l[e]=t,n&&(36009===e&&(l[36160]=t),36160===e&&(l[36009]=t)),!0)},drawBuffers:function(n,e){let r=d,t=!1;if(n)if(r=c.get(e),void 0===r&&(r=[],c.set(e,r)),n.isWebGLMultipleRenderTargets){n=n.texture;if(r.length!==n.length||36064!==r[0]){for(let e=0,t=n.length;e<t;e++)r[e]=36064+e;r.length=n.length,t=!0}}else 36064!==r[0]&&(r[0]=36064,t=!0);else 1029!==r[0]&&(r[0]=1029,t=!0);t&&(a.isWebGL2?u.drawBuffers(r):i.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(e){return h!==e&&(u.useProgram(e),h=e,!0)},setBlending:k,setMaterial:function(e,t){(e.side===Oe?z:U)(2884);let n=e.side===Fe;t&&(n=!n),Q(n),e.blending===ae&&!1===e.transparent?k(ie):k(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),r.setMask(e.colorWrite),t=e.stencilWrite,s.setTest(t),t&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),H(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?U:z)(32926)},setFlipSided:Q,setCullFace:W,setLineWidth:function(e){e!==C&&(T&&u.lineWidth(e),C=e)},setPolygonOffset:H,setScissorTest:function(e){(e?U:z)(3089)},activeTexture:Y,bindTexture:function(e,t){null===R&&Y();let n=L[R];void 0===n&&(n={type:void 0,texture:void 0},L[R]=n),n.type===e&&n.texture===t||(u.bindTexture(e,t||O[e]),n.type=e,n.texture=t)},unbindTexture:function(){const e=L[R];void 0!==e&&void 0!==e.type&&(u.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{u.compressedTexImage2D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},texImage2D:function(){try{u.texImage2D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},texImage3D:function(){try{u.texImage3D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},texStorage2D:function(){try{u.texStorage2D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},texStorage3D:function(){try{u.texStorage3D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},texSubImage2D:function(){try{u.texSubImage2D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},texSubImage3D:function(){try{u.texSubImage3D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},compressedTexSubImage2D:function(){try{u.compressedTexSubImage2D.apply(u,arguments)}catch(e){console.error("v3d.WebGLState:",e)}},scissor:function(e){!1===D.equals(e)&&(u.scissor(e.x,e.y,e.z,e.w),D.copy(e))},viewport:function(e){!1===N.equals(e)&&(u.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){u.disable(3042),u.disable(2884),u.disable(2929),u.disable(32823),u.disable(3089),u.disable(2960),u.disable(32926),u.blendEquation(32774),u.blendFunc(1,0),u.blendFuncSeparate(1,0,1,0),u.colorMask(!0,!0,!0,!0),u.clearColor(0,0,0,0),u.depthMask(!0),u.depthFunc(513),u.clearDepth(1),u.stencilMask(4294967295),u.stencilFunc(519,0,4294967295),u.stencilOp(7680,7680,7680),u.clearStencil(0),u.cullFace(1029),u.frontFace(2305),u.polygonOffset(0,0),u.activeTexture(33984),u.bindFramebuffer(36160,null),!0===n&&(u.bindFramebuffer(36009,null),u.bindFramebuffer(36008,null)),u.useProgram(null),u.lineWidth(1),u.scissor(0,0,u.canvas.width,u.canvas.height),u.viewport(0,0,u.canvas.width,u.canvas.height),t={},R=null,L={},l={},c=new WeakMap,d=[],h=null,p=!1,f=null,m=null,g=null,v=null,A=null,_=null,x=null,y=!1,b=null,M=null,C=null,S=null,w=null,D.set(0,0,u.canvas.width,u.canvas.height),N.set(0,0,u.canvas.width,u.canvas.height),r.reset(),o.reset(),s.reset()}}}function Hs(v,o,A,m,g,_,x){const y=g.isWebGL2,t=g.maxTextures,b=g.maxCubemapSize,p=g.maxTextureSize,n=g.maxSamples;const l=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):void 0,a=new WeakMap;let c,r=!1;try{r="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function u(e,t){return r?new OffscreenCanvas(e,t):Jt("canvas")}function M(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const a=t?Ut:Math.floor;r=a(i*e.width),t=a(i*e.height);void 0===c&&(c=u(r,t));const o=n?u(r,t):c;o.width=r,o.height=t;const s=o.getContext("2d");return s.drawImage(e,0,0,r,t),console.warn("v3d.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+t+")."),o}return"data"in e&&console.warn("v3d.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function C(e){return Ft(e.width)&&Ft(e.height)}function S(e,t){return e.generateMipmaps&&t&&e.minFilter!==Ve&&e.minFilter!==Ge}function w(e,t,n,r){v.generateMipmap(e);const i=m.get(t);i.__maxMipLevel=Math.log2(Math.max(n,r))}function E(e,t,n,r,i=!1){if(!1===y)return t;if(null!==e){if(void 0!==v[e])return v[e];console.warn("v3d.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let a=t;return 6403===t&&(5126===n&&(a=33326),5131===n&&(a=33325),5121===n&&(a=33321)),33319===t&&(5126===n&&(a=33328),5131===n&&(a=33327),5121===n&&(a=33323)),6408===t&&(5126===n&&(a=34836),5131===n&&(a=34842),5121===n&&(a=r===ft&&!1===i?35907:32856),32819===n&&(a=32854),32820===n&&(a=32855)),33325!==a&&33326!==a&&33327!==a&&33328!==a&&34842!==a&&34836!==a||o.get("EXT_color_buffer_float"),a}function T(e,t,n){return!0===S(e,n)||e.isFramebufferTexture&&e.minFilter!==Ve&&e.minFilter!==Ge?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&0<e.mipmaps.length?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function i(e){return e===Ve||e===W||e===H?9728:9729}function s(e){const t=e.target;var n;t.removeEventListener("dispose",s),n=t,void 0!==(e=m.get(n)).__webglInit&&(v.deleteTexture(e.__webglTexture),m.remove(n)),t.isVideoTexture&&a.delete(t),x.memory.textures--,x.removeTextureSpec(t)}function I(e){const t=e.target;t.removeEventListener("dispose",I),function(e){var n=e.texture,t=m.get(e),r=m.get(n);if(e){if(void 0!==r.__webglTexture&&(v.deleteTexture(r.__webglTexture),x.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)v.deleteFramebuffer(t.__webglFramebuffer[e]),t.__webglDepthbuffer&&v.deleteRenderbuffer(t.__webglDepthbuffer[e]);else v.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&v.deleteRenderbuffer(t.__webglDepthbuffer),t.__webglMultisampledFramebuffer&&v.deleteFramebuffer(t.__webglMultisampledFramebuffer),t.__webglColorRenderbuffer&&v.deleteRenderbuffer(t.__webglColorRenderbuffer),t.__webglDepthRenderbuffer&&v.deleteRenderbuffer(t.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,t=n.length;e<t;e++){var i=m.get(n[e]);i.__webglTexture&&(v.deleteTexture(i.__webglTexture),x.memory.textures--),m.remove(n[e])}m.remove(n),m.remove(e)}}(t),x.removeTextureSpec(t)}let d=0;function h(e,t){var n,r=m.get(e);if(e.isVideoTexture&&(i=e,n=x.render.frame,a.get(i)!==n&&(a.set(i,n),i.update())),0<e.version&&r.__version!==e.version){var i=e.image;if(void 0===i)console.warn("v3d.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void D(r,e,t);console.warn("v3d.WebGLRenderer: Texture marked for update but image is incomplete")}}A.activeTexture(33984+t),A.bindTexture(3553,r.__webglTexture)}function f(e,t){var n=m.get(e);0<e.version&&n.__version!==e.version?function(t,r,i){if(6===r.image.length){P(t,r),A.activeTexture(33984+i),A.bindTexture(34067,t.__webglTexture),v.pixelStorei(37440,r.flipY),v.pixelStorei(37441,r.premultiplyAlpha),v.pixelStorei(3317,r.unpackAlignment),v.pixelStorei(37443,0);var a=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),o=r.image[0]&&r.image[0].isDataTexture;const g=[];for(let e=0;e<6;e++)g[e]=a||o?o?r.image[e].image:r.image[e]:M(r.image[e],!1,!0,b),g[e]=z(r,g[e]);var s=g[0],l=C(s)||y,c=_.convert(r.format,r.encoding),u=_.convert(r.type),d=E(r.internalFormat,c,u,r.encoding),h=y&&!0!==r.isVideoTexture,i=void 0===t.__version;let e=T(r,s,l);B(34067,r,l);let n;if(a){h&&i&&A.texStorage2D(34067,e,d,s.width,s.height);for(let t=0;t<6;t++){n=g[t].mipmaps;for(let e=0;e<n.length;e++){var p=n[e];r.format!==Ke?null!==c?h?A.compressedTexSubImage2D(34069+t,e,0,0,p.width,p.height,c,p.data):A.compressedTexImage2D(34069+t,e,d,p.width,p.height,0,p.data):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):h?A.texSubImage2D(34069+t,e,0,0,p.width,p.height,c,u,p.data):A.texImage2D(34069+t,e,d,p.width,p.height,0,c,u,p.data)}}t.__maxMipLevel=n.length-1}else{n=r.mipmaps,h&&i&&(0<n.length&&e++,A.texStorage2D(34067,e,d,g[0].width,g[0].height));for(let t=0;t<6;t++)if(o){h?A.texSubImage2D(34069+t,0,0,0,g[t].width,g[t].height,c,u,g[t].data):A.texImage2D(34069+t,0,d,g[t].width,g[t].height,0,c,u,g[t].data);for(let e=0;e<n.length;e++){var f=n[e].image[t].image;h?A.texSubImage2D(34069+t,e+1,0,0,f.width,f.height,c,u,f.data):A.texImage2D(34069+t,e+1,d,f.width,f.height,0,c,u,f.data)}}else{h?A.texSubImage2D(34069+t,0,0,0,c,u,g[t]):A.texImage2D(34069+t,0,d,c,u,g[t]);for(let e=0;e<n.length;e++){var m=n[e];h?A.texSubImage2D(34069+t,e+1,0,0,c,u,m.image[t]):A.texImage2D(34069+t,e+1,d,c,u,m.image[t])}}t.__maxMipLevel=n.length}S(r,l)&&w(34067,r,s.width,s.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}}(n,e,t):(A.activeTexture(33984+t),A.bindTexture(34067,n.__webglTexture))}const R={[k]:10497,[ze]:33071,[Q]:33648},L={[Ve]:9728,[W]:9984,[H]:9986,[Ge]:9729,[Y]:9985,[ke]:9987};function B(e,t,n){n?(v.texParameteri(e,10242,R[t.wrapS]),v.texParameteri(e,10243,R[t.wrapT]),32879!==e&&35866!==e||v.texParameteri(e,32882,R[t.wrapR]),v.texParameteri(e,10240,L[t.magFilter]),v.texParameteri(e,10241,L[t.minFilter])):(v.texParameteri(e,10242,33071),v.texParameteri(e,10243,33071),32879!==e&&35866!==e||v.texParameteri(e,32882,33071),t.wrapS===ze&&t.wrapT===ze||console.warn("v3d.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to v3d.ClampToEdgeWrapping."),v.texParameteri(e,10240,i(t.magFilter)),v.texParameteri(e,10241,i(t.minFilter)),t.minFilter!==Ve&&t.minFilter!==Ge&&console.warn("v3d.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to v3d.NearestFilter or v3d.LinearFilter.")),!0===o.has("EXT_texture_filter_anisotropic")&&(n=o.get("EXT_texture_filter_anisotropic"),t.type===Ye&&!1===o.has("OES_texture_float_linear")||!1===y&&t.type===Xe&&!1===o.has("OES_texture_half_float_linear")||(1<t.anisotropy||m.get(t).__currentAnisotropy)&&(v.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,g.getMaxAnisotropy())),m.get(t).__currentAnisotropy=t.anisotropy))}function P(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",s),e.__webglTexture=v.createTexture(),x.memory.textures++,x.addTextureSpec(t))}function D(e,n,t){let r=3553;n.isDataTexture2DArray&&(r=35866),n.isDataTexture3D&&(r=32879),P(e,n),A.activeTexture(33984+t),A.bindTexture(r,e.__webglTexture),v.pixelStorei(37440,n.flipY),v.pixelStorei(37441,n.premultiplyAlpha),v.pixelStorei(3317,n.unpackAlignment),v.pixelStorei(37443,0);var i,a=(h=n,!y&&(h.wrapS!==ze||h.wrapT!==ze||h.minFilter!==Ve&&h.minFilter!==Ge)&&!1===C(n.image)),t=C(i=z(n,i=M(n.image,a,!1,p)))||y,o=_.convert(n.format,n.encoding);let s=_.convert(n.type),l=E(n.internalFormat,o,s,n.encoding,n.isVideoTexture);B(r,n,t);let c;var u=n.mipmaps,d=y&&!0!==n.isVideoTexture,h=void 0===e.__version,a=T(n,i,t);if(n.isDepthTexture)l=6402,y?l=n.type===Ye?36012:n.type===He?33190:n.type===je?35056:33189:n.type===Ye&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===qe&&6402===l&&n.type!==We&&n.type!==He&&(console.warn("v3d.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=We,s=_.convert(n.type)),n.format===Ze&&6402===l&&(l=34041,n.type!==je&&(console.warn("v3d.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=je,s=_.convert(n.type))),d&&h?A.texStorage2D(3553,1,l,i.width,i.height):A.texImage2D(3553,0,l,i.width,i.height,0,o,s,null);else if(n.isDataTexture)if(0<u.length&&t){d&&h&&A.texStorage2D(3553,a,l,u[0].width,u[0].height);for(let e=0,t=u.length;e<t;e++)c=u[e],d?A.texSubImage2D(3553,0,0,0,c.width,c.height,o,s,c.data):A.texImage2D(3553,e,l,c.width,c.height,0,o,s,c.data);n.generateMipmaps=!1,e.__maxMipLevel=u.length-1}else d?(h&&A.texStorage2D(3553,a,l,i.width,i.height),A.texSubImage2D(3553,0,0,0,i.width,i.height,o,s,i.data)):A.texImage2D(3553,0,l,i.width,i.height,0,o,s,i.data);else if(n.isCompressedTexture){d&&h&&A.texStorage2D(3553,a,l,u[0].width,u[0].height);for(let e=0,t=u.length;e<t;e++)c=u[e],n.format!==Ke?null!==o?d?A.compressedTexSubImage2D(3553,e,0,0,c.width,c.height,o,c.data):A.compressedTexImage2D(3553,e,l,c.width,c.height,0,c.data):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):d?A.texSubImage2D(3553,e,0,0,c.width,c.height,o,s,c.data):A.texImage2D(3553,e,l,c.width,c.height,0,o,s,c.data);e.__maxMipLevel=u.length-1}else if(n.isDataTexture2DArray)d?(h&&A.texStorage3D(35866,a,l,i.width,i.height,i.depth),A.texSubImage3D(35866,0,0,0,0,i.width,i.height,i.depth,o,s,i.data)):A.texImage3D(35866,0,l,i.width,i.height,i.depth,0,o,s,i.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)d?(h&&A.texStorage3D(32879,a,l,i.width,i.height,i.depth),A.texSubImage3D(32879,0,0,0,0,i.width,i.height,i.depth,o,s,i.data)):A.texImage3D(32879,0,l,i.width,i.height,i.depth,0,o,s,i.data),e.__maxMipLevel=0;else if(n.isFramebufferTexture)d&&h?A.texStorage2D(3553,a,l,i.width,i.height):A.texImage2D(3553,0,l,i.width,i.height,0,o,s,null),e.__maxMipLevel=0;else if(0<u.length&&t){d&&h&&A.texStorage2D(3553,a,l,u[0].width,u[0].height);for(let e=0,t=u.length;e<t;e++)c=u[e],d?A.texSubImage2D(3553,e,0,0,o,s,c):A.texImage2D(3553,e,l,o,s,c);n.generateMipmaps=!1,e.__maxMipLevel=u.length-1}else d?(h&&A.texStorage2D(3553,a,l,i.width,i.height),A.texSubImage2D(3553,0,0,0,o,s,i)):A.texImage2D(3553,0,l,o,s,i),e.__maxMipLevel=0;S(n,t)&&w(r,n,i.width,i.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function N(e,t,n,r,i){var a=_.convert(n.format,n.encoding),o=_.convert(n.type),s=E(n.internalFormat,a,o,n.encoding);m.get(t).__hasExternalTextures||(32879===i||35866===i?A.texImage3D(i,0,s,t.width,t.height,t.depth,0,a,o,null):A.texImage2D(i,0,s,t.width,t.height,0,a,o,null)),A.bindFramebuffer(36160,e),t.useRenderToTexture?l.framebufferTexture2DMultisampleEXT(36160,r,i,m.get(n).__webglTexture,0,U(t)):v.framebufferTexture2D(36160,r,i,m.get(n).__webglTexture,0),A.bindFramebuffer(36160,null)}function F(t,n,r){if(v.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let e=33189;r||n.useRenderToTexture?((i=n.depthTexture)&&i.isDepthTexture&&(i.type===Ye?e=36012:i.type===He&&(e=33190)),i=U(n),n.useRenderToTexture?l.renderbufferStorageMultisampleEXT(36161,i,e,n.width,n.height):v.renderbufferStorageMultisample(36161,i,e,n.width,n.height)):v.renderbufferStorage(36161,e,n.width,n.height),v.framebufferRenderbuffer(36160,36096,36161,t)}else{var e,i;n.depthBuffer&&n.stencilBuffer?(e=U(n),r&&n.useRenderbuffer?v.renderbufferStorageMultisample(36161,e,35056,n.width,n.height):n.useRenderToTexture?l.renderbufferStorageMultisampleEXT(36161,e,35056,n.width,n.height):v.renderbufferStorage(36161,34041,n.width,n.height),v.framebufferRenderbuffer(36160,33306,36161,t)):(i=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,e=_.convert(i.format,i.encoding),t=_.convert(i.type),t=E(i.internalFormat,e,t,i.encoding),i=U(n),r&&n.useRenderbuffer?v.renderbufferStorageMultisample(36161,i,t,n.width,n.height):n.useRenderToTexture?l.renderbufferStorageMultisampleEXT(36161,i,t,n.width,n.height):v.renderbufferStorage(36161,t,n.width,n.height))}v.bindRenderbuffer(36161,null)}function O(t){const n=m.get(t);var e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(e)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(A.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of v3d.DepthTexture");m.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),h(t.depthTexture,0);var n=m.get(t.depthTexture).__webglTexture,e=U(t);if(t.depthTexture.format===qe)t.useRenderToTexture?l.framebufferTexture2DMultisampleEXT(36160,36096,3553,n,0,e):v.framebufferTexture2D(36160,36096,3553,n,0);else{if(t.depthTexture.format!==Ze)throw new Error("Unknown depthTexture format");t.useRenderToTexture?l.framebufferTexture2DMultisampleEXT(36160,33306,3553,n,0,e):v.framebufferTexture2D(36160,33306,3553,n,0)}}(n.__webglFramebuffer,t)}else if(e){n.__webglDepthbuffer=[];for(let e=0;e<6;e++)A.bindFramebuffer(36160,n.__webglFramebuffer[e]),n.__webglDepthbuffer[e]=v.createRenderbuffer(),F(n.__webglDepthbuffer[e],t,!1)}else A.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=v.createRenderbuffer(),F(n.__webglDepthbuffer,t,!1);A.bindFramebuffer(36160,null)}function U(e){return y&&(e.useRenderbuffer||e.useRenderToTexture)?Math.min(n,e.samples):0}function z(e,t){var n=e.encoding,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===bt||n!==pt&&(n===ft?!1===y?!0===o.has("EXT_sRGB")&&r===Ke?(e.format=bt,e.minFilter=Ge,e.generateMipmaps=!1):t=vn.sRGBToLinear(t):r===Ke&&i===Qe||console.warn("v3d.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("v3d.WebGLTextures: Unsupported texture encoding:",n)),t}let V=!1,G=!1;this.allocateTextureUnit=function(){var e=d;return e>=t&&console.warn("v3d.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+t),d+=1,e},this.resetTextureUnits=function(){d=0},this.setTexture2D=h,this.setTexture2DArray=function(e,t){var n=m.get(e);0<e.version&&n.__version!==e.version?D(n,e,t):(A.activeTexture(33984+t),A.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){var n=m.get(e);0<e.version&&n.__version!==e.version?D(n,e,t):(A.activeTexture(33984+t),A.bindTexture(32879,n.__webglTexture))},this.setTextureCube=f,this.rebindTextures=function(e,t,n){var r=m.get(e);void 0!==t&&N(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&O(e)},this.setupRenderTarget=function(n){var t=n.texture;const r=m.get(n),i=m.get(t);n.addEventListener("dispose",I),!0!==n.isWebGLMultipleRenderTargets&&(void 0===i.__webglTexture&&(i.__webglTexture=v.createTexture()),i.__version=t.version,x.memory.textures++),x.addTextureSpec(n);var e,a,o=!0===n.isWebGLCubeRenderTarget,s=!0===n.isWebGLMultipleRenderTargets,l=t.isDataTexture3D||t.isDataTexture2DArray,c=C(n)||y;if(o){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=v.createFramebuffer()}else if(r.__webglFramebuffer=v.createFramebuffer(),s)if(g.drawBuffers){var u=n.texture;for(let e=0,t=u.length;e<t;e++){const f=m.get(u[e]);void 0===f.__webglTexture&&(f.__webglTexture=v.createTexture(),x.memory.textures++)}}else console.warn("v3d.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else n.useRenderbuffer&&(y?(r.__webglMultisampledFramebuffer=v.createFramebuffer(),r.__webglColorRenderbuffer=v.createRenderbuffer(),v.bindRenderbuffer(36161,r.__webglColorRenderbuffer),e=_.convert(t.format),a=_.convert(t.type),e=E(t.internalFormat,e,a,t.encoding),a=U(n),v.renderbufferStorageMultisample(36161,a,e,n.width,n.height),A.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),v.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),v.bindRenderbuffer(36161,null),n.depthBuffer&&(r.__webglDepthRenderbuffer=v.createRenderbuffer(),F(r.__webglDepthRenderbuffer,n,!0)),A.bindFramebuffer(36160,null)):console.warn("v3d.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(o){A.bindTexture(34067,i.__webglTexture),B(34067,t,c);for(let e=0;e<6;e++)N(r.__webglFramebuffer[e],n,t,36064,34069+e);S(t,c)&&w(34067,t,n.width,n.height),A.unbindTexture()}else if(s){var d=n.texture;for(let e=0,t=d.length;e<t;e++){var h=d[e],p=m.get(h);A.bindTexture(3553,p.__webglTexture),B(3553,h,c),N(r.__webglFramebuffer,n,h,36064+e,3553),S(h,c)&&w(3553,h,n.width,n.height)}A.unbindTexture()}else{let e=3553;l&&(y?(l=t.isDataTexture3D,e=l?32879:35866):console.warn("v3d.DataTexture3D and v3d.DataTexture2DArray only supported with WebGL2.")),A.bindTexture(e,i.__webglTexture),B(e,t,c),N(r.__webglFramebuffer,n,t,36064,e),S(t,c)&&w(e,t,n.width,n.height),A.unbindTexture()}n.depthBuffer&&O(n)},this.updateRenderTargetMipmap=function(n){var r=C(n)||y,i=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let e=0,t=i.length;e<t;e++){var a,o,s=i[e];S(s,r)&&(a=n.isWebGLCubeRenderTarget?34067:3553,o=m.get(s).__webglTexture,A.bindTexture(a,o),w(a,s,n.width,n.height),A.unbindTexture())}},this.updateMultisampleRenderTarget=function(t){if(t.useRenderbuffer)if(y){var n=t.width,r=t.height;let e=16384;var i=t.stencilBuffer?33306:36096;t.depthBuffer,t.ignoreDepthForMultisampleCopy||(t.depthBuffer&&(e|=256),t.stencilBuffer&&(e|=1024));var a=m.get(t);A.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),A.bindFramebuffer(36009,a.__webglFramebuffer),t.ignoreDepthForMultisampleCopy&&(v.invalidateFramebuffer(36008,[i]),v.invalidateFramebuffer(36009,[i])),v.blitFramebuffer(0,0,n,r,0,0,n,r,e,9728),A.bindFramebuffer(36008,null),A.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("v3d.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=N,this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===V&&(console.warn("v3d.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),V=!0),e=e.texture),h(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===G&&(console.warn("v3d.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),G=!0),e=e.texture),f(e,t)}}function Ys(e,r,t){const i=t.isWebGL2;return{convert:function(e,t=null){let n;if(e===Qe)return 5121;if(e===d)return 32819;if(e===h)return 32820;if(e===a)return 5120;if(e===s)return 5122;if(e===We)return 5123;if(e===u)return 5124;if(e===He)return 5125;if(e===Ye)return 5126;if(e===Xe)return i?5131:(n=r.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===p)return 6406;if(e===Ke)return 6408;if(e===m)return 6409;if(e===g)return 6410;if(e===qe)return 6402;if(e===Ze)return 34041;if(e===Je)return 6403;if(e===f)return console.warn("v3d.WebGLRenderer: v3d.RGBFormat has been removed. Use v3d.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(e===bt)return n=r.get("EXT_sRGB"),null!==n?n.SRGB_ALPHA_EXT:null;if(e===v)return 36244;if(e===A)return 33319;if(e===_)return 33320;if(e===x)return 36249;if(e===y||e===b||e===M||e===C)if(t===ft){if(n=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===n)return null;if(e===y)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===b)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===M)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===C)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(n=r.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===y)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===b)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===M)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===C)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===S||e===w||e===E||e===R){if(n=r.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===S)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===w)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===E)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===R)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===L)return n=r.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if(e===B||e===P){if(n=r.get("WEBGL_compressed_texture_etc"),null===n)return null;if(e===B)return t===ft?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(e===P)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(e===F||e===O||e===U||e===z||e===V||e===G||e===$e||e===et||e===tt||e===nt||e===rt||e===it||e===at||e===ot){if(n=r.get("WEBGL_compressed_texture_astc"),null===n)return null;if(e===F)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===O)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===U)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===z)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===V)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===G)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===$e)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===et)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===tt)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===nt)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===rt)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===it)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===at)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===ot)return t===ft?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===st){if(n=r.get("EXT_texture_compression_bptc"),null===n)return null;if(e===st)return t===ft?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}return e===je?i?34042:(n=r.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Xs extends Ni{constructor(e=[]){super(),this.cameras=e}}Xs.prototype.isArrayCamera=!0;class js extends Tr{constructor(){super(),this.type="Group"}getWorldDirection(e){this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}}js.prototype.isGroup=!0;const Ks={type:"move"};class qs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new js,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(e){return null===this._targetRay&&(this._targetRay=new js,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new wn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new wn,this._targetRay.name="XR_CONTROLLER_"+String(e)),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new js,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new wn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new wn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ks))),l&&e.hand){a=!0;for(const h of e.hand.values()){var c=t.getJointPose(h,n);if(void 0===l.joints[h.jointName]){const f=new js;f.matrixAutoUpdate=!1,f.visible=!1,l.joints[h.jointName]=f,l.add(f)}const p=l.joints[h.jointName];null!==c&&(p.matrix.fromArray(c.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=c.radius),p.visible=null!==c}const d=l.joints["index-finger-tip"];var u=l.joints["thumb-tip"],u=d.position.distanceTo(u.position);l.inputState.pinching&&.025<u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}}class Zs extends _n{constructor(e,t,n,r,i,a,o,s,l,c){if((c=void 0!==c?c:qe)!==qe&&c!==Ze)throw new Error("DepthTexture format must be either v3d.DepthFormat or v3d.DepthStencilFormat");super(null,r,i,a,o,s,c,n=void 0===(n=void 0===n&&c===qe?We:n)&&c===Ze?je:n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:Ve,this.minFilter=void 0!==s?s:Ve,this.flipY=!1,this.generateMipmaps=!1}}Zs.prototype.isDepthTexture=!0;class Js{constructor(e,t,n=0,r=1/0){this.ray=new nr(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new fr,this.params={Mesh:{omitGeometry:!1},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{},checkVisibility:!0},this.layers.enable(3),this.layers.enable(4),this.layers.enable(5),this.layers.enable(6),this.layers.enable(7)}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("v3d.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return el(e,this,n,t,this.params.checkVisibility),n.sort($s),n}intersectObjects(n,r=!0,i=[]){for(let e=0,t=n.length;e<t;e++)el(n[e],this,i,r,this.params.checkVisibility);return i.sort($s),i}}function $s(e,t){return e.distance-t.distance}function el(e,n,r,t,i){if(!(i&&(!1===e.visible||e.isMesh&&e.isMaterialGeneratedMesh&&e.parent&&!e.parent.visible)||(e.layers.test(n.layers)&&e.raycast(n,r),!0!==t))){var a=e.children;for(let e=0,t=a.length;e<t;e++)el(a[e],n,r,!0,i)}}class tl extends t{constructor(u,i){super();const d=this;let h=null,a=1,t=null,n="local-floor";const o=u.extensions.has("WEBGL_multisampled_render_to_texture");let p=null,f=null,m=null,g=null,s,v=null;const l=i.getContextAttributes();let c=null,A=null;const _=[],x=new Map,y=new Ni;y.layers.enable(1),y.viewport=new yn;const b=new Ni;b.layers.enable(2),b.viewport=new yn;const M=[y,b],C=new Xs;C.layers.enable(1),C.layers.enable(2);let S=null,w=null,r=null,E=null,T=null,I=null;const R=new wn,L=new wn,B=new Sn;function P(e){const t=x.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function D(){x.forEach(function(e,t){e.disconnect(t)}),x.clear(),S=null,w=null,u.setRenderTarget(c),g=null,m=null,f=null,h=null,A=null,E=null,V.stop(),d.isPresenting=!1,d.dispatchEvent({type:"sessionend"})}function N(t){var n=h.inputSources;for(let e=0;e<_.length;e++)x.set(n[e],_[e]);for(let e=0;e<t.removed.length;e++){var r=t.removed[e];const a=x.get(r);a&&(a.dispatchEvent({type:"disconnected",data:r}),x.delete(r))}for(let e=0;e<t.added.length;e++){var i=t.added[e];const o=x.get(i);o&&o.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new qs,_[e]=t),t.getTargetRaySpace(e)},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new qs,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new qs,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===d.isPresenting&&console.warn("v3d.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){n=e,!0===d.isPresenting&&console.warn("v3d.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){if(r){r.clone().invert().decompose(R,B,L);var e=new XRRigidTransform({x:R.x,y:R.y,z:R.z},{x:B.x,y:B.y,z:B.z,w:B.w});return t.getOffsetReferenceSpace(e)}return t},this.getBaseLayer=function(){return null!==m?m:g},this.getBinding=function(){return f},this.getFrame=function(){return v},this.getSession=function(){return h},this.setSession=async function(e){if(h=e,null!==h){if(c=u.getRenderTarget(),h.addEventListener("select",P),h.addEventListener("selectstart",P),h.addEventListener("selectend",P),h.addEventListener("squeeze",P),h.addEventListener("squeezestart",P),h.addEventListener("squeezeend",P),h.addEventListener("end",D),h.addEventListener("inputsourceschange",N),!0!==l.xrCompatible&&await i.makeXRCompatible(),void 0===h.renderState.layers||!1===u.capabilities.isWebGL2){var r={antialias:void 0!==h.renderState.layers||l.antialias,alpha:l.alpha,depth:l.depth,stencil:l.stencil,framebufferScaleFactor:a};g=new XRWebGLLayer(h,i,r),h.updateRenderState({baseLayer:g}),A=new bn(g.framebufferWidth,g.framebufferHeight,{format:Ke,type:Qe,encoding:u.outputEncoding})}else{s=l.antialias;let e=null,t=null,n=null;l.depth&&(n=l.stencil?35056:33190,e=l.stencil?Ze:qe,t=l.stencil?je:We);r={colorFormat:u.outputEncoding===ft?35907:32856,depthFormat:n,scaleFactor:a};f=new XRWebGLBinding(h,i),m=f.createProjectionLayer(r),h.updateRenderState({layers:[m]}),A=s?new Cn(m.textureWidth,m.textureHeight,{format:Ke,type:Qe,depthTexture:new Zs(m.textureWidth,m.textureHeight,t,void 0,void 0,void 0,void 0,void 0,void 0,e),stencilBuffer:l.stencil,ignoreDepth:m.ignoreDepthValues,useRenderToTexture:o,encoding:u.outputEncoding}):new bn(m.textureWidth,m.textureHeight,{format:Ke,type:Qe,depthTexture:new Zs(m.textureWidth,m.textureHeight,t,void 0,void 0,void 0,void 0,void 0,void 0,e),stencilBuffer:l.stencil,ignoreDepth:m.ignoreDepthValues,encoding:u.outputEncoding})}A.isXRRenderTarget=!0,this.setFoveation(1),t=await h.requestReferenceSpace(n),V.setContext(h),V.start(),d.isPresenting=!0,d.dispatchEvent({type:"sessionstart"})}};const F=new wn,O=new wn;function U(e,t){r=null===t?(e.matrixWorld.copy(e.matrix),null):(e.matrixWorld.copy(e.matrix),t.matrixWorld),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null!==h){C.near=b.near=y.near=e.near,C.far=b.far=y.far=e.far,S===C.near&&w===C.far||(h.updateRenderState({depthNear:C.near,depthFar:C.far}),S=C.near,w=C.far);var t=e.parent,n=C.cameras;U(C,t);for(let e=0;e<n.length;e++)U(n[e],t);C.matrixWorld.decompose(C.position,C.quaternion,C.scale),e.matrixWorld.copy(C.matrixWorld),null===t?e.matrix.copy(e.matrixWorld):(e.matrix.copy(t.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){F.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);var r=F.distanceTo(O),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],n=(a[8]+1)/a[0],i=o*u,a=o*n,u=(n=r/(n-u))*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(u),e.translateZ(n),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),o+=n,n=s+n,e.projectionMatrix.makePerspective(i-u,r-u+a,l*s/n*o,c*s/n*o,o,n)}(C,y,b):C.projectionMatrix.copy(y.projectionMatrix),C.projectionMatrixInverse.copy(C.projectionMatrix).invert()}},this.getCamera=function(){return C},this.getFoveation=function(){return null!==m?m.fixedFoveation:null!==g?g.fixedFoveation:void 0},this.setFoveation=function(e){null!==m&&(m.fixedFoveation=e),null!==g&&void 0!==g.fixedFoveation&&(g.fixedFoveation=e)};let z=null;const V=new Yi;V.setAnimationLoop(function(e,t){var n=d.getReferenceSpace();if(p=t.getViewerPose(n),v=t,null!==p){var r=p.views;null!==g&&(u.setRenderTargetFramebuffer(A,g.framebuffer),u.setRenderTarget(A));let n=!1;r.length!==C.cameras.length&&(C.cameras.length=0,n=!0);for(let t=0;t<r.length;t++){var i,a=r[t];let e=null;null!==g?e=g.getViewport(a):(i=f.getViewSubImage(m,a),e=i.viewport,0===t&&(u.setRenderTargetTextures(A,i.colorTexture,m.ignoreDepthValues?void 0:i.depthStencilTexture),u.setRenderTarget(A)));const l=M[t];l.matrix.fromArray(a.transform.matrix),l.projectionMatrix.fromArray(a.projectionMatrix),l.viewport.set(e.x,e.y,e.width,e.height),0===t&&C.matrix.copy(l.matrix),!0===n&&C.cameras.push(l)}}var o=h.inputSources;for(let e=0;e<_.length;e++){const c=_[e];var s=o[e];c.update(s,t,n),function(e){if(E){const t=e.getHitTestResults(E);if(t.length){e=t[0].getPose(d.getReferenceSpace()),e=(new rr).fromArray(e.transform.matrix);const n=new wn;n.setFromMatrixPosition(e),T(n)}else I()}}(t)}z&&z(e,t),v=null}),this.setAnimationLoop=function(e){z=e},this.dispose=function(){},this.arHitTest=function(e,t,n,r){h&&XRSession.prototype.requestHitTestSource&&(T=n||function(){},I=r||function(){},this.raycaster=this.raycaster||new Js,this.raycaster.setFromCamera({x:e,y:t},M[0]),t=this.raycaster.ray,new XRRay(t.origin,t.direction),h.requestReferenceSpace("viewer").then(function(e){e={space:e};h.requestHitTestSource(e).then(function(e){E=e})}))}}}function nl(l){function c(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);var n=l.get(t).envMap;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=t.reflectivity,e.ior.value=t.ior,e.refractionRatio.value=t.refractionRatio,void 0!==(n=l.get(n).__maxMipLevel)&&(e.maxMipLevel.value=n)),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);let r;t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap?r=t.emissiveMap:t.clearcoatMap?r=t.clearcoatMap:t.clearcoatNormalMap?r=t.clearcoatNormalMap:t.clearcoatRoughnessMap?r=t.clearcoatRoughnessMap:t.specularIntensityMap?r=t.specularIntensityMap:t.specularColorMap?r=t.specularColorMap:t.transmissionMap?r=t.transmissionMap:t.thicknessMap?r=t.thicknessMap:t.sheenColorMap?r=t.sheenColorMap:t.sheenRoughnessMap&&(r=t.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix));let i;t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function u(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Fe&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Fe&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),l.get(t).envMap&&(e.envMapIntensity.value=t.envMapIntensity,e.envMapParallaxType.value=t.envMapParallaxType,e.envMapParallaxMatrix.value.copy(t.envMapParallaxMatrix),e.envMapParallaxMatrixInv.value.copy(t.envMapParallaxMatrixInv))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,n,r,i){var a,o,s;t.ssrParams&&(o=t,(a=e).invProjectionMatrix.value=o.ssrParams.invProjectionMatrix,a.ssrSourceBuffer.value=o.ssrParams.sourceBuffer.texture,a.ssrDepthBuffer.value=o.ssrParams.depthBuffer.texture,a.ssrBackfaceDepthBuffer.value=o.ssrParams.backfaceDepthBuffer.texture,a.ssrResolution.value.set(o.ssrParams.sourceBuffer.width,o.ssrParams.sourceBuffer.height),a.ssrStride.value=o.ssrParams.stride,a.ssrThickness.value=o.ssrParams.thickness,a.ssrMaxDistance.value=o.ssrParams.maxDistance,a.ssrJitter.value=o.ssrParams.jitter),t.isMeshBasicMaterial?c(e,t):t.isMeshLambertMaterial?(c(e,t),o=e,(s=t).emissiveMap&&(o.emissiveMap.value=s.emissiveMap)):t.isMeshToonMaterial?(c(e,t),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Fe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Fe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshPhongMaterial?(c(e,t),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Fe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Fe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshStandardMaterial?(c(e,t),t.isMeshPhysicalMaterial?function(e,t,n){u(e,t),e.ior.value=t.ior,0<t.sheen&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));0<t.clearcoat&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===Fe&&e.clearcoatNormalScale.value.negate()));0<t.transmission&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,t,i):u(e,t)):t.isMeshMatcapMaterial?(c(e,t),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Fe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Fe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshDepthMaterial?(c(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.slopeScaledBias.value=t.slopeScaledBias}(e,t)):t.isMeshDistanceMaterial?(c(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance,e.slopeScaledBias.value=t.slopeScaledBias}(e,t)):t.isMeshNormalMaterial?(c(e,t),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Fe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Fe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isLineBasicMaterial?(s=t,(i=e).diffuse.value.copy(s.color),i.opacity.value=s.opacity,t.isLineDashedMaterial&&(i=t,(s=e).dashSize.value=i.dashSize,s.totalSize.value=i.dashSize+i.gapSize,s.scale.value=i.scale)):t.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,t,n,r):t.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isMeshMaskMaterial?(c(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);t.cameraNearFar&&(e.cameraNearFar.value=t.cameraNearFar);e.depthTexture.value=t.depthTexture,t.textureMatrix&&(e.textureMatrix.value=t.textureMatrix)}(e,t)):t.isMeshNodeMaterial?function(e,t){0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);var n=l.get(t).envMap;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&n.isRenderTargetTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,void 0!==(n=l.get(n).__maxMipLevel)&&(e.maxMipLevel.value=n),e.envMapIntensity.value=t.envMapIntensity,e.envMapParallaxType.value=t.envMapParallaxType,e.envMapParallaxMatrix.value.copy(t.envMapParallaxMatrix),e.envMapParallaxMatrixInv.value.copy(t.envMapParallaxMatrixInv));t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.materialIndex.value=t.materialIndex}(e,t):t.isMeshLineMaterial?function(e,t){e.lineWidth.value=t.lineWidth,e.sizeAttenuation.value=t.sizeAttenuation,e.color.value=t.color,e.opacity.value=t.opacity,e.useMap.value=t.useMap,t.map&&(e.map.value=t.map);e.useAlphaMap.value=t.useAlphaMap,t.alphaMap&&(e.alphaMap.value=t.alphaMap);e.visibility.value=t.visibility,e.alphaTest.value=t.alphaTest,e.repeat.value=t.repeat}(e,t):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)},refreshGTAOUniforms:function(e,t){e.gtaoMap.value=t},refreshPlaneReflProbeUniforms:function(e,t){e.planeReflTexture.value=t.renderTarget.texture,e.planeReflTextureMatrix.value.copy(t.textureMatrix),e.planeReflDir.value.copy(t.normal),e.planeReflBoundingBoxMin.value.copy(t.boundingBox.min),e.planeReflBoundingBoxMax.value.copy(t.boundingBox.max),e.planeReflInvModelMatrix.value.copy(t.matrixWorldInverse),e.planeReflFalloff.value=t.falloff}}}const rl={checkWebGL:function(){try{const e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},checkWebGL2:function(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},checkWorkers:function(){return!!window.Worker},checkFileAPI:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob},genWebGLErrorMessage:function(){const e=document.createElement("div");return e.setAttribute("class","v3d-webgl-error"),e.innerHTML=(window.WebGLRenderingContext?["Ouch! Your graphics card does not support WebGL.<br/>",'Find out how to fix it <a href="https://www.soft8soft.com/webgl-supported-browsers-and-troubleshooting/" target="_top" class="v3d-webgl-error-link">here</a>.']:["Ouch! Your browser does not support WebGL.<br/>",'Find out how to fix it <a href="https://www.soft8soft.com/webgl-supported-browsers-and-troubleshooting/" target="_top" class="v3d-webgl-error-link">here</a>.']).join("\n"),e},showWebGLErrorMessage:function(e){(e=e||document.body).appendChild(rl.genWebGLErrorMessage());const t=document.getElementById("v3d_preloader_container");t&&(t.style.visibility="hidden")},checkIOS:function(){return(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)&&!window.MSStream},checkAndroid:function(){return!!navigator.userAgent.match(/Android/i)},checkSafari:function(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)},checkFloatTex:function(e,t){const n=e.getContext();return!(!e.capabilities.isWebGL2||!n.getExtension("EXT_color_buffer_float")||t&&!n.getExtension("OES_texture_float_linear"))||!(e.capabilities.isWebGL2||!n.getExtension("OES_texture_float")||t&&!n.getExtension("OES_texture_float_linear"))},checkHalfFloatTex:function(e,t){const n=e.getContext();return!(!e.capabilities.isWebGL2||!n.getExtension("EXT_color_buffer_float"))||!(e.capabilities.isWebGL2||!n.getExtension("OES_texture_half_float")||t&&!n.getExtension("OES_texture_half_float_linear"))},checkHalfFloatReadPixels:function(e){const t=e.getContext();e=e.capabilities;return!/Firefox/.test(navigator.userAgent)&&!!(t.getExtension("EXT_color_buffer_half_float")||e.isWebGL2&&t.getExtension("EXT_color_buffer_float"))},checkFloatReadPixels:function(e){const t=e.getContext();return!!(e.capabilities.isWebGL2||t.getExtension("OES_texture_float")||t.getExtension("WEBGL_color_buffer_float"))},checkDepthTex:function(e){const t=e.getContext();return!(!e.capabilities.isWebGL2&&!t.getExtension("WEBGL_depth_texture"))},getGPUVendor:function(e){const t=e?e.getContext():document.createElement("canvas").getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl");e=t.getExtension("WEBGL_debug_renderer_info");return null!=e?t.getParameter(e.UNMASKED_VENDOR_WEBGL):""},getGPUModel:function(e){const t=e?e.getContext():document.createElement("canvas").getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl");e=t.getExtension("WEBGL_debug_renderer_info");return null!=e?t.getParameter(e.UNMASKED_RENDERER_WEBGL):""},checkWebXR:function(e,t,n){"xr"in navigator&&navigator.xr.isSessionSupported?navigator.xr.isSessionSupported(e).then(function(e){(e?t:n)()}).catch(n):n()},checkNativeWebXR:function(){return!1},checkCardboard:function(){return!1},checkSwiftShader:function(e){return"Google SwiftShader"==this.getGPUModel(e)},checkWebAudio:function(){return void 0!==(window.AudioContext||window.webkitAudioContext)},isSafariWithMultisamplingBug:function(){if(!this.checkSafari())return!1;const e=navigator.userAgent;return e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)}};function il(e={}){const i=void 0!==e.canvas?e.canvas:function(){const e=Jt("canvas");return e.style.display="block",e}(),t=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let m=null,D=null;const d=[],h=[];this.domElement=i,this.debug={checkShaderErrors:!0,disableCompiledShaderCache:!1},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=pt,this.physicallyCorrectLights=!1,this.unitsScaleFactor=1,this.toneMapping=1,this.toneMappingExposure=1,this.gtaoMap=null,this.gtaoMapEnabled=!1,this.compatSettings={useSpecEnvBlenderApprox:!0,saturateSpecEnvBlenderApprox:!1,gtaoDisableBkgFix:!1};const N=this;let p=!1,f=0,g=0,F=null,O=-1,U=null;const z=new yn,v=new yn;let A=null,V=i.width,G=i.height,k=1,_=null,x=null;const y=new yn(0,0,V,G),b=new yn(0,0,V,G);let M=!1;const C=new Hi;let Q=!1,W=!1,H=null;const S=new rr,Y=new wn,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},j=new rr,K=new rr,q=new Yt,Z=new rr;function w(){return null===F?k:1}let J=t;function E(t,n){for(let e=0;e<t.length;e++){var r=t[e],r=i.getContext(r,n);if(null!==r)return r}return null}try{var T={alpha:!0,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,xrCompatible:!rl.checkSafari(),failIfMajorPerformanceCaveat:u};if("setAttribute"in i&&i.setAttribute("data-engine","Verge3D "+De),i.addEventListener("webglcontextlost",xe,!1),i.addEventListener("webglcontextrestored",ye,!1),null===J){const Pe=["webgl2","webgl","experimental-webgl"];if(!0===N.isWebGL1Renderer&&Pe.shift(),J=E(Pe,T),null===J)throw E(Pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");var I="undefined"!=typeof WebGL2RenderingContext&&J instanceof WebGL2RenderingContext;console.log("Verge3D "+De+" "+tn()+" ("+(3483952072==zt(Ct)?"Trial":"License")+", "+(I?"WebGL 2.0":"WebGL 1.0")+")")}void 0===J.getShaderPrecisionFormat&&(J.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("v3d.WebGLRenderer: "+e.message),e}let R,$,ee,L,te,ne,re,ie,B,P,ae,oe,se,le,ce,ue,de,he,pe,fe,me,ge,ve;function Ae(){R=new Na(J),$=new ta(J,R,e),R.init($),ge=new Ys(J,R,$),ee=new Ws(J,R,$),L=new Ua(J),te=new ms,ne=new Hs(J,R,ee,te,$,ge,L),re=new ra(N),ie=new Da(N),B=new Xi(J,$),ve=new $i(J,R,B,$),P=new Fa(J,B,L,ve),ae=new Wa(J,P,B,L),pe=new Qa(J,$,ne),ue=new na(te),oe=new fs(N,re,ie,R,$,ve,ue),se=new nl(te),le=new _s(te),ce=new Ss(R,$),he=new Ji(N,re,ee,ae,n,s),de=new Qs(N,ae,$),fe=new ea(J,R,L,$),me=new Oa(J,R,L,$),L.programs=oe.programs,N.capabilities=$,N.extensions=R,N.properties=te,N.renderLists=le,N.shadowMap=de,N.state=ee,N.info=L}Ae();const _e=new tl(N,J);function xe(e){e.preventDefault(),console.log("v3d.WebGLRenderer: Context Lost."),p=!0}function ye(){console.log("v3d.WebGLRenderer: Context Restored."),p=!1;var e=L.autoReset,t=de.enabled,n=de.autoUpdate,r=de.needsUpdate,i=de.type;Ae(),L.autoReset=e,de.enabled=t,de.autoUpdate=n,de.needsUpdate=r,de.type=i}function be(e){const t=e.target;t.removeEventListener("dispose",be),function(e){const t=te.get(e).programs;void 0!==t&&(t.forEach(function(e){oe.releaseProgram(e)}),e.isShaderMaterial&&oe.releaseShaderCache(e))}(e=t),te.remove(e)}this.xr=_e,this.getContext=function(){return J},this.getContextAttributes=function(){return J.getContextAttributes()},this.forceContextLoss=function(){const e=R.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=R.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(e){void 0!==e&&(k=e,this.setSize(V,G,!1))},this.getSize=function(e){return e.set(V,G)},this.setSize=function(e,t,n){_e.isPresenting?console.warn("v3d.WebGLRenderer: Can't change size while VR device is presenting."):(V=e,G=t,i.width=Math.floor(e*k),i.height=Math.floor(t*k),!1!==n&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(V*k,G*k).floor()},this.setDrawingBufferSize=function(e,t,n){V=e,G=t,k=n,i.width=Math.floor(e*n),i.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(z)},this.getViewport=function(e){return e.copy(y)},this.setViewport=function(e,t,n,r){e.isVector4?y.set(e.x,e.y,e.z,e.w):y.set(e,t,n,r),ee.viewport(z.copy(y).multiplyScalar(k).floor())},this.getScissor=function(e){return e.copy(b)},this.setScissor=function(e,t,n,r){e.isVector4?b.set(e.x,e.y,e.z,e.w):b.set(e,t,n,r),ee.scissor(v.copy(b).multiplyScalar(k).floor())},this.getScissorTest=function(){return M},this.setScissorTest=function(e){ee.setScissorTest(M=e)},this.setOpaqueSort=function(e){_=e},this.setTransparentSort=function(e){x=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(e,t,n){let r=0;void 0!==e&&!e||(r|=16384),void 0!==t&&!t||(r|=256),void 0!==n&&!n||(r|=1024),J.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",xe,!1),i.removeEventListener("webglcontextrestored",ye,!1),this.disposeGTAO(),this.disposeInternalCaches(),_e.dispose(),_e.removeEventListener("sessionstart",Ce),_e.removeEventListener("sessionend",Se),H&&(H.dispose(),H=null),we.stop()},this.canUseGTAO=function(){return this.gtaoMap&&this.gtaoMapEnabled},this.disposeGTAO=function(){var e;null!=(e=this.gtaoMap)&&e.dispose(),this.gtaoMap=null},this.disposeInternalCaches=function(){le.dispose(),ce.dispose(),te.dispose(),re.dispose(),ie.dispose(),ae.dispose(),ve.dispose(),oe.dispose(),he.dispose(),B.dispose()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=X);var o=i.isMesh&&i.matrixWorld.determinant()<0;const s=function(e,t,n,r,i){!0!==t.isScene&&(t=X);ne.resetTextureUnits();var a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===F?N.outputEncoding:!0===F.isXRRenderTarget?F.texture.encoding:pt;{var l,c;r.envMapAutoAssign&&(r.isMeshStandardMaterial||r.isMeshPhysicalMaterial||r.isMeshNodeMaterial)&&((l=D.state.envMapProbeArray.find(e=>{return null===e.influenceGroup?e.intersectsMesh(i):i.groupNames.includes(e.influenceGroup)^e.influenceGroupInv})||t.worldEnvMapProbe)&&(r.envMap=(null==(c=l.renderTarget)?void 0:c.texture)||null,c=l.parallaxDistance,r.envMapParallaxMatrix.copy(l.matrixWorldInverse).premultiply(Z.makeScale(1/c,1/c,1/c)),r.envMapParallaxMatrixInv.copy(l.matrixWorld).multiply(Z.makeScale(c,c,c)),r.envMapParallaxType=l.parallaxType))}const u=(r.isMeshStandardMaterial||r.isMeshNodeMaterial&&r.envMap&&!r.envMap.isCubeTexture?ie:re).get(r.envMap||o),d=!0===r.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,h=!!r.normalMap&&!!n.attributes.tangent,p=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,m=n.morphAttributes.position?n.morphAttributes.position.length:0,g=r.toneMapped?N.toneMapping:Ue,v=r.side===Fe,A=te.get(r),_=D.state.lights;!0===Q&&(!0!==W&&e===U||(x=e===U&&r.id===O,ue.setState(r,e,x)));var o=Be(i,r,D),x=r.isMeshNodeMaterial&&r.canUseGTAO()&&N.canUseGTAO();let y=!1,b=!1;if(r.version===A.__version)(!A.needsLights||A.lightsStateVersion===_.state.version)&&A.outputEncoding===s&&(!i.isInstancedMesh||!1!==A.instancing)&&(i.isInstancedMesh||!0!==A.instancing)&&(!i.isSkinnedMesh||!1!==A.skinning)&&(i.isSkinnedMesh||!0!==A.skinning)?A.envMap!==u?(y=!0,b=!0):(r.fog&&A.fog!==a||void 0!==A.numClippingPlanes&&(A.numClippingPlanes!==ue.numPlanes||A.numIntersection!==ue.numIntersection)||A.vertexAlphas!==d||A.vertexTangents!==h||A.morphTargets!==p||A.morphNormals!==f||A.toneMapping!==g||!0===$.isWebGL2&&A.morphTargetsCount!==m||A.planeReflProbe!==o||r.isMeshNormalMaterial&&A.flipSided!==v||A.useGTAO!==x)&&(y=!0):y=!0;else if(y=!0,A.__version=r.version,r.nodeRGBArr)for(let e=0;e<r.nodeRGB.length;e++){const I=r.nodeRGB[e];I.toArray(r.nodeRGBArr,4*e)}let M=A.currentProgram;!0===y&&(M=Ie(r,t,i,D));let C=!1,S=!1,w=!1;const E=M.getUniforms(),T=A.uniforms;ee.useProgram(M.program)&&(C=!0,S=!0,w=!0);r.id!==O&&(O=r.id,S=!0);b&&(S=!0);if(C||U!==e){if(E.setValue(J,"projectionMatrix",e.projectionMatrix),$.logarithmicDepthBuffer&&E.setValue(J,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),U!==e&&(U=e,S=!0,w=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.isMeshNodeMaterial||r.envMap){const R=E.map.cameraPosition;void 0!==R&&R.setValue(J,Y.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isMeshNodeMaterial)&&E.setValue(J,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isMeshNodeMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&E.setValue(J,"viewMatrix",e.matrixWorldInverse),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshNodeMaterial||r.isMeshStandardMaterial||r.isMeshPhysicalMaterial||r.isShadowMaterial)&&E.setValue(J,"invViewMatrix",e.matrixWorld)}if(i.isSkinnedMesh){E.setOptional(J,i,"bindMatrix"),E.setOptional(J,i,"bindMatrixInverse");const L=i.skeleton;L&&($.floatVertexTextures?(null===L.boneTexture&&L.computeBoneTexture(),E.setValue(J,"boneTexture",L.boneTexture,ne),E.setValue(J,"boneTextureSize",L.boneTextureSize)):E.setOptional(J,L,"boneMatrices"))}!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||pe.update(i,n,r,M);!S&&A.receiveShadow===i.receiveShadow||(A.receiveShadow=i.receiveShadow,E.setValue(J,"receiveShadow",i.receiveShadow));if(r.needsBoundingBox){const B=i.geometry;B&&(null===B.boundingBox&&B.computeBoundingBox(),E.setValue(J,"boundingBoxMin",B.boundingBox.min),E.setValue(J,"boundingBoxMax",B.boundingBox.max))}if(S){if(E.setValue(J,"toneMappingExposure",N.toneMappingExposure),6==N.toneMapping?(E.setValue(J,"toneMappingBrightness",N.toneMappingBrightness),E.setValue(J,"toneMappingContrast",N.toneMappingContrast),E.setValue(J,"toneMappingMidTones",N.toneMappingMidTones),E.setValue(J,"toneMappingPhysicalScale",N.toneMappingPhysicalScale),E.setValue(J,"toneMappingChromaticAdaptation",N.toneMappingChromaticAdaptation),E.setValue(J,"toneMappingWhiteColor",N.toneMappingWhiteColor),E.setValue(J,"toneMappingColorDifferentiation",N.toneMappingColorDifferentiation),E.setValue(J,"toneMappingExteriorDaylight",N.toneMappingExteriorDaylight)):7==N.toneMapping&&(E.setValue(J,"toneMappingResolution",q.set(V,G)),E.setValue(J,"toneMappingWhiteBalance",N.toneMappingWhiteBalance),E.setValue(J,"toneMappingHighlights",N.toneMappingHighlights),E.setValue(J,"toneMappingMidTones",N.toneMappingMidTones),E.setValue(J,"toneMappingShadows",N.toneMappingShadows),E.setValue(J,"toneMappingSaturation",N.toneMappingSaturation),E.setValue(J,"toneMappingPhysicalScale",N.toneMappingPhysicalScale),E.setValue(J,"toneMappingAperture",N.toneMappingAperture),E.setValue(J,"toneMappingShutter",N.toneMappingShutter),E.setValue(J,"toneMappingISO",N.toneMappingISO),E.setValue(J,"toneMappingVignetting",N.toneMappingVignetting)),A.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t,e.rectAreaLightShadows.needsUpdate=t}(T,w),a&&r.fog&&se.refreshFogUniforms(T,a),A.useGTAO&&(n=null!=(a=null==(n=F)?void 0:n.width)?a:V,a=null!=(a=null==(a=F)?void 0:a.height)?a:G,E.setValue(J,"currResolution",q.set(n,a)),se.refreshGTAOUniforms(T,N.gtaoMap)),se.refreshMaterialUniforms(T,r,k,G,H),o&&se.refreshPlaneReflProbeUniforms(T,o),r.isMeshNodeMaterial)for(const P in r.nodeTextures)E.setValue(J,P,r.nodeTextures[P],ne);r.isMeshLineMaterial&&E.setValue(J,"resolution",q.set(V,G)),Ko.upload(J,Re(A),T,ne)}r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ko.upload(J,Re(A),T,ne),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&E.setValue(J,"center",i.center);r.isMeshNodeMaterial&&(j.copy(i.matrixWorld).invert(),E.setValue(J,"invModelMatrix",j),E.setValue(J,"viewWidthHeight",q.set(z.z-z.x,z.w-z.y)),r.nodeTexCoordObject.forEach(function(e,t){const n=null===e?j:K.copy(e.matrixWorld).invert();n.toArray(r.nodeTexCoordObjectArr,16*t)}),r.nodeTexCoordObjectArr&&E.setValue(J,"nodeTexCoordObjectMatrices",r.nodeTexCoordObjectArr),E.setValue(J,"objectIndex",i.objectIndex),E.setValue(J,"objectColor",i.objectColor),E.setValue(J,"objectRandom",zt(i.uuid)/Math.pow(2,32)));return E.setValue(J,"modelViewMatrix",i.modelViewMatrix),E.setValue(J,"normalMatrix",i.normalMatrix),E.setValue(J,"modelMatrix",i.matrixWorld),M}(e,t,n,r,i);ee.setMaterial(r,o);let l=n.index;var c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u=1;!0===r.wireframe&&(l=P.getWireframeAttribute(n),u=2),ve.setup(i,r,s,n,l);let d=fe;null!==l&&(h=B.get(l),d=me,d.setIndex(h));var e=(null!==l?l:c).count,t=n.drawRange.start*u,o=n.drawRange.count*u,h=null!==a?a.start*u:0,c=null!==a?a.count*u:1/0,a=Math.max(t,h),c=Math.min(e,t+o,h+c)-1,c=Math.max(0,c-a+1);if(0!==c){if(i.isMesh)!0===r.wireframe?(ee.setLineWidth(r.wireframeLinewidth*w()),d.setMode(1)):d.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),ee.setLineWidth(e*w()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);s.beginTimerQuery(J,$.isWebGL2),i.isInstancedMesh?d.renderInstances(a,c,i.count):n.isInstancedBufferGeometry?(n=Math.min(n.instanceCount,n._maxInstanceCount),d.renderInstances(a,c,n)):d.render(a,c),s.endTimerQuery(J,$.isWebGL2)}},this._compilePrepareRenderState=function(e,t,n){n.init(),e.traverse(e=>{e.isLight?(n.pushLight(e),e.castShadow&&n.pushShadow(e)):e.isCubeReflectionProbe?n.pushEnvMapProbe(e):e.isPlaneReflectionProbe&&n.pushPlaneReflProbe(e)}),n.setupLights(N.physicallyCorrectLights),n.sortEnvMapProbes();let r=null;return null!==e.worldEnvMapProbe&&null!==e.worldEnvMapProbe.renderTarget&&(r=e.worldEnvMapProbe.renderTarget.texture),e.traverse(t=>{if(t.material){const e=Array.isArray(t.material)?t.material:[t.material];e.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial||e.isMeshNodeMaterial)&&(t.material.envMap=r,t.material.needsUpdate=!0)})}}),n},this.compile=function(i,e){this.gtaoMapEnabled=!0;const a=ce.get(i,h.length);this._compilePrepareRenderState(i,e,a);const o={};i.traverse(function(t){var n=t.material;if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++){var r=n[e];r.uuid in o==!1&&(Ie(r,i,t,a),o[r.uuid]=!0)}else n.uuid in o==!1&&(Ie(n,i,t,a),o[n.uuid]=!0)}),this.gtaoMapEnabled=!1},this.compileAsync=function(n,e,o){const s=new Cs(R,$);this._compilePrepareRenderState(n,e,s);const r=[];if(n.traverse(function(t){if(t.material){const e=Array.isArray(t.material)?t.material:[t.material];e.forEach(function(e){r.push({scene:n,obj:t,mat:e})})}}),0===r.length)o(1);else{const l=R.get("KHR_parallel_shader_compile"),c=(null===l?1:2)*r.length;let i=0,a=0;const u={};if(ln(r,function(e,t,n){N.gtaoMapEnabled=!0;var r=Ie(e.mat,e.scene,e.obj,s);N.gtaoMapEnabled=!1,l&&((e=r.id)in u||(u[e]={program:r,weight:0}),u[e].weight++),o&&(i++,o((i+a)/c))},16),l){const d=setInterval(function(){let e=0;for(var t in u){t=u[t];(void 0===t.program.program||J.getProgramParameter(t.program.program,l.COMPLETION_STATUS_KHR))&&(e+=t.weight)}a=Math.max(a,e),o&&o((i+a)/c),a===r.length&&clearInterval(d)},16)}}};let Me=null;function Ce(){we.stop()}function Se(){we.start()}const we=new Yi;function Ee(e,t,n,r){var i=e.opaque,a=e.transmissive,e=e.transparent;D.setupLightsView(n),0<a.length&&function(e,t,n){if(null===H){const a=!0===o&&!0===$.isWebGL2?Cn:bn;H=new a(1024,1024,{generateMipmaps:!0,type:null!==ge.convert(Xe)?Xe:Qe,minFilter:ke,magFilter:Ve,wrapS:ze,wrapT:ze,useRenderToTexture:R.has("WEBGL_multisampled_render_to_texture")})}var r=N.getRenderTarget();N.setRenderTarget(H),N.clear();var i=N.toneMapping;N.toneMapping=Ue,Te(e,t,n),N.toneMapping=i,ne.updateMultisampleRenderTarget(H),ne.updateRenderTargetMipmap(H),N.setRenderTarget(r)}(i,t,n),r&&ee.viewport(z.copy(r)),0<i.length&&Te(i,t,n),0<a.length&&Te(a,t,n),0<e.length&&Te(e,t,n)}function Te(n,r,i){var a=!0===r.isScene?r.overrideMaterial:null;for(let e=0,t=n.length;e<t;e++){var o=n[e];const c=o.object;var s=o.geometry,l=null===a?o.material:a,o=o.group;c.layers.test(i.layers)&&function(e,t,n,r,i,a){e.onBeforeRender(N,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(N,t,n,r,e,a),!0===i.transparent&&i.side===Oe?(i.side=Fe,i.needsUpdate=!0,N.renderBufferDirect(n,t,r,i,e,a),i.side=Ne,i.needsUpdate=!0,N.renderBufferDirect(n,t,r,i,e,a),i.side=Oe):N.renderBufferDirect(n,t,r,i,e,a);e.onAfterRender(N,t,n,r,i,a)}(c,r,i,s,l,o)}}function Ie(e,t,n,r){!0!==t.isScene&&(t=X);const i=te.get(e);var a=r.state.lights,o=r.state.shadowsArray,s=a.state.version,r=Be(n,e,r);i.planeReflProbe=r;const l=oe.getParameters(e,a.state,o,t,n,r);r=oe.getProgramCacheKey(l);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial||e.isMeshNodeMaterial&&e.envMap&&!e.envMap.isCubeTexture?ie:re).get(e.envMap||i.environment),i.useGTAO=e.isMeshNodeMaterial&&e.canUseGTAO()&&N.canUseGTAO(),void 0===c&&(e.addEventListener("dispose",be),c=new Map,i.programs=c);let u=c.get(r);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===s)return Le(e,l),u}else l.uniforms=oe.getUniforms(e),e.onBuild(n,l,N),e.onBeforeCompile(l,N),u=oe.acquireProgram(l,r),c.set(r,u),i.uniforms=l.uniforms;const d=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||e.defines.WORLD_NODES||(d.clippingPlanes=ue.uniform),Le(e,l),i.needsLights=(r=e).isMeshLambertMaterial||r.isMeshToonMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.isShadowMaterial||r.isShaderMaterial&&!0===r.lights||r.isMeshNodeMaterial,i.lightsStateVersion=s,i.needsLights&&(d.ambientLightColor.value=a.state.ambient,d.lightProbe.value=a.state.probe,d.directionalLights.value=a.state.directional,d.directionalLightShadows.value=a.state.directionalShadow,d.spotLights.value=a.state.spot,d.spotLightShadows.value=a.state.spotShadow,d.rectAreaLights.value=a.state.rectArea,d.ltc_1.value=a.state.rectAreaLTC1,d.ltc_2.value=a.state.rectAreaLTC2,d.pointLights.value=a.state.point,d.pointLightShadows.value=a.state.pointShadow,d.hemisphereLights.value=a.state.hemi,d.directionalShadowMap.value=a.state.directionalShadowMap,d.directionalShadowMatrix.value=a.state.directionalShadowMatrix,d.spotShadowMap.value=a.state.spotShadowMap,d.spotShadowMatrix.value=a.state.spotShadowMatrix,d.pointShadowMap.value=a.state.pointShadowMap,d.pointShadowMatrix.value=a.state.pointShadowMatrix,d.rectAreaLightShadows.value=a.state.rectAreaShadow,d.rectAreaShadowMap.value=a.state.rectAreaShadowMap,d.rectAreaShadowMatrix.value=a.state.rectAreaShadowMatrix),e.nodeValue&&(d.nodeValue.value=e.nodeValue),e.nodeRGBArr&&(d.nodeRGB.value=e.nodeRGBArr),i.currentProgram=u,i.uniformsList=null,u}function Re(e){var t;return null===e.uniformsList&&(t=e.currentProgram.getUniforms(),e.uniformsList=Ko.seqWithValue(t.seq,e.uniforms)),e.uniformsList}function Le(e,t){const n=te.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}function Be(t,e,n){return(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial||e.isMeshNodeMaterial)&&n.state.planeReflProbeArray.find(e=>e.intersectsMesh(t))||null}we.setAnimationLoop(function(e){Me&&Me(e)}),"undefined"!=typeof window&&we.setContext(window),this.setAnimationLoop=function(e){Me=e,_e.setAnimationLoop(e),null===e?we.stop():we.start()},_e.addEventListener("sessionstart",Ce),_e.addEventListener("sessionend",Se),this.render=function(n,e){if(void 0===e||!0===e.isCamera){if(!0!==p){!0===n.autoUpdate&&n.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(e),e=_e.getCamera()),!0===n.isScene&&n.onBeforeRender(N,n,e,F),D=ce.get(n,h.length),D.init(),h.push(D),S.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),C.setFromProjectionMatrix(S),W=this.localClippingEnabled,Q=ue.init(this.clippingPlanes,W,e),m=le.get(n,d.length),m.init(),d.push(m),function n(r,i,a,o){r.isAnnotationControl&&r.update(i);let s=!1;if(r.visible&&(s=r.layers.test(i.layers),s))if(r.isGroup)a=r.renderOrder;else if(r.isLOD)!0===r.autoUpdate&&r.update(i);else if(r.isLight)D.pushLight(r),r.castShadow&&D.pushShadow(r);else if(r.isCubeReflectionProbe)D.pushEnvMapProbe(r);else if(r.isPlaneReflectionProbe)D.pushPlaneReflProbe(r);else if(r.isSprite){if(!r.frustumCulled||C.intersectsSprite(r)){o&&Y.setFromMatrixPosition(r.matrixWorld).applyMatrix4(S);const e=ae.update(r),t=r.material;m.push(r,e,t,a,Y.z,null)}}else if(r.isImmediateRenderObject)o&&Y.setFromMatrixPosition(r.matrixWorld).applyMatrix4(S),m.push(r,null,r.material,a,Y.z,null);else if((r.isMesh||r.isLine||r.isPoints)&&(r.isSkinnedMesh&&r.skeleton.frame!==L.render.frame&&(r.skeleton.update(),r.skeleton.frame=L.render.frame),!r.frustumCulled||C.intersectsObject(r))){o&&Y.setFromMatrixPosition(r.matrixWorld).applyMatrix4(S);const c=ae.update(r),u=r.material;if(Array.isArray(u)){const d=c.groups;for(let e=0,t=d.length;e<t;e++){const h=d[e],p=u[h.materialIndex];p&&p.visible&&m.push(r,c,p,a,Y.z,h)}}else u.visible&&m.push(r,c,u,a,Y.z,null)}if(r.disableChildRendering)return;const l=r.children;for(let e=0,t=l.length;e<t;e++){const f=l[e];!s&&f.isMesh&&f.isMaterialGeneratedMesh||n(f,i,a,o)}}(n,e,0,N.sortObjects),m.finish(),!0===N.sortObjects&&m.sort(_,x),!0===Q&&ue.beginShadows();var t=D.state.shadowsArray;if(de.render(t,n,e),!0===Q&&ue.endShadows(),!0===this.info.autoReset&&this.info.reset(),he.render(m,n),D.setupLights(N.physicallyCorrectLights),D.sortEnvMapProbes(),e.isArrayCamera){var r=e.cameras;for(let e=0,t=r.length;e<t;e++){var i=r[e];Ee(m,n,i,i.viewport)}}else Ee(m,n,e);null!==F&&(ne.updateMultisampleRenderTarget(F),ne.updateRenderTargetMipmap(F)),!0===n.isScene&&n.onAfterRender(N,n,e),ee.buffers.depth.setTest(!0),ee.buffers.depth.setMask(!0),ee.buffers.color.setMask(!0),ee.setPolygonOffset(!1),ve.resetDefaultState(),O=-1,U=null,h.pop(),D=0<h.length?h[h.length-1]:null,d.pop(),m=0<d.length?d[d.length-1]:null}}else console.error("v3d.WebGLRenderer.render: camera is not an instance of v3d.Camera.")},this.getActiveCubeFace=function(){return f},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function(e,t,n){te.get(e.texture).__webglTexture=t,te.get(e.depthTexture).__webglTexture=n;const r=te.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||e.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),e.useRenderToTexture=!1,e.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(e,t){const n=te.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){F=e,f=t,g=n;let r=!0;var i,a;e&&(void 0!==(i=te.get(e)).__useDefaultFramebuffer?(ee.bindFramebuffer(36160,null),r=!1):void 0===i.__webglFramebuffer?ne.setupRenderTarget(e):i.__hasExternalTextures&&ne.rebindTextures(e,te.get(e.texture).__webglTexture,te.get(e.depthTexture).__webglTexture));let o=null,s=!1,l=!1;A=e?(((a=e.texture).isDataTexture3D||a.isDataTexture2DArray)&&(l=!0),a=te.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget?(o=a[t],s=!0):o=e.useRenderbuffer?te.get(e).__webglMultisampledFramebuffer:a,z.copy(e.viewport),v.copy(e.scissor),e.scissorTest):(z.copy(y).multiplyScalar(k).floor(),v.copy(b).multiplyScalar(k).floor(),M),ee.bindFramebuffer(36160,o)&&$.drawBuffers&&r&&ee.drawBuffers(e,o),ee.viewport(z),ee.scissor(v),ee.setScissorTest(A),s?(a=te.get(e.texture),J.framebufferTexture2D(36160,36064,34069+t,a.__webglTexture,n)):l&&(e=te.get(e.texture),t=t||0,J.framebufferTextureLayer(36160,36064,e.__webglTexture,n||0,t)),O=-1},this.readRenderTargetPixels=function(t,n,r,i,a,o,s){if(t&&t.isWebGLRenderTarget){let e=te.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(e=e[s]),e){ee.bindFramebuffer(36160,e);try{var l=t.texture,c=l.format,u=l.type;if(c!==Ke&&ge.convert(c)!==J.getParameter(35739))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var d=u===Xe&&(R.has("EXT_color_buffer_half_float")||$.isWebGL2&&R.has("EXT_color_buffer_float"));if(!(u===Qe||ge.convert(u)===J.getParameter(35738)||u===Ye&&($.isWebGL2||R.has("OES_texture_float")||R.has("WEBGL_color_buffer_float"))||d))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===J.checkFramebufferStatus(36160)?0<=n&&n<=t.width-i&&0<=r&&r<=t.height-a&&J.readPixels(n,r,i,a,ge.convert(c),ge.convert(u),o):console.error("v3d.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==F?te.get(F).__webglFramebuffer:null;ee.bindFramebuffer(36160,e)}}}else console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not v3d.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n=0){var r,i;!0===t.isFramebufferTexture?(i=Math.pow(2,-n),r=Math.floor(t.image.width*i),i=Math.floor(t.image.height*i),ne.setTexture2D(t,0),J.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,i),ee.unbindTexture()):console.error("v3d.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.")},this.copyTextureToTexture=function(e,t,n,r=0){var i=t.image.width,a=t.image.height,o=ge.convert(n.format),s=ge.convert(n.type);ne.setTexture2D(n,0),J.pixelStorei(37440,n.flipY),J.pixelStorei(37441,n.premultiplyAlpha),J.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?J.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?J.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):J.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&J.generateMipmap(3553),ee.unbindTexture()},this.copyTextureToTexture3D=function(t,n,r,i,a=0){if(N.isWebGL1Renderer)console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var o=t.max.x-t.min.x+1,s=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,c=ge.convert(i.format),u=ge.convert(i.type);let e;if(i.isDataTexture3D)ne.setTexture3D(i,0),e=32879;else{if(!i.isDataTexture2DArray)return void console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: only supports v3d.DataTexture3D and v3d.DataTexture2DArray.");ne.setTexture2DArray(i,0),e=35866}J.pixelStorei(37440,i.flipY),J.pixelStorei(37441,i.premultiplyAlpha),J.pixelStorei(3317,i.unpackAlignment);var d=J.getParameter(3314),h=J.getParameter(32878),p=J.getParameter(3316),f=J.getParameter(3315),m=J.getParameter(32877),g=r.isCompressedTexture?r.mipmaps[0]:r.image;J.pixelStorei(3314,g.width),J.pixelStorei(32878,g.height),J.pixelStorei(3316,t.min.x),J.pixelStorei(3315,t.min.y),J.pixelStorei(32877,t.min.z),r.isDataTexture||r.isDataTexture3D?J.texSubImage3D(e,a,n.x,n.y,n.z,o,s,l,c,u,g.data):r.isCompressedTexture?(console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),J.compressedTexSubImage3D(e,a,n.x,n.y,n.z,o,s,l,c,g.data)):J.texSubImage3D(e,a,n.x,n.y,n.z,o,s,l,c,u,g),J.pixelStorei(3314,d),J.pixelStorei(32878,h),J.pixelStorei(3316,p),J.pixelStorei(3315,f),J.pixelStorei(32877,m),0===a&&i.generateMipmaps&&J.generateMipmap(e),ee.unbindTexture()}},this.initTexture=function(e){ne.setTexture2D(e,0),ee.unbindTexture()},this.resetState=function(){f=0,g=0,F=null,ee.reset(),ve.reset()},"undefined"!=typeof __V3D_DEVTOOLS__&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this})),this.updateGeometry=function(e){return ae.update(e)}}il.prototype.isWebGLRenderer=!0;class al extends il{}class ol{constructor(e,t=25e-5){this.name="",this.color=new mn(e),this.density=t}clone(){return new ol(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ol.prototype.isFogExp2=al.prototype.isWebGL1Renderer=!0;class sl{constructor(e,t=1,n=1e3){this.name="",this.color=new mn(e),this.near=t,this.far=n}clone(){return new sl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}sl.prototype.isFog=!0;class ll{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=r,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=It()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(n,r,i){n*=this.stride,i*=r.stride;for(let e=0,t=this.stride;e<t;e++)this.array[n+e]=r.array[i+e];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=It()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);e=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]);const t=new this.constructor(e,this.stride);return t.setUsage(this.usage),t}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=It()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ll.prototype.isInterleavedBuffer=!0;const cl=new wn;class ul{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(n){for(let e=0,t=this.data.count;e<t;e++)cl.x=this.getX(e),cl.y=this.getY(e),cl.z=this.getZ(e),cl.applyMatrix4(n),this.setXYZ(e,cl.x,cl.y,cl.z);return this}applyNormalMatrix(n){for(let e=0,t=this.count;e<t;e++)cl.x=this.getX(e),cl.y=this.getY(e),cl.z=this.getZ(e),cl.applyNormalMatrix(n),this.setXYZ(e,cl.x,cl.y,cl.z);return this}transformDirection(n){for(let e=0,t=this.count;e<t;e++)cl.x=this.getX(e),cl.y=this.getY(e),cl.z=this.getZ(e),cl.transformDirection(n),this.setXYZ(e,cl.x,cl.y,cl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ul(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("v3d.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const n=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)n.push(this.data.array[t+e])}return new Hr(new this.array.constructor(n),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("v3d.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const n=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)n.push(this.data.array[t+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}}}ul.prototype.isInterleavedBufferAttribute=!0;class dl extends Gr{constructor(e){super(),this.type="SpriteMaterial",this.color=new mn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}dl.prototype.isSpriteMaterial=!0;let hl;const pl=new wn,fl=new wn,ml=new wn,gl=new Yt,vl=new Yt,Al=new rr,_l=new wn,xl=new wn,yl=new wn,bl=new Yt,Ml=new Yt,Cl=new Yt;class Sl extends Tr{constructor(e){var t;super(),this.type="Sprite",void 0===hl&&(hl=new ci,t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ll(t,5),hl.setIndex([0,1,2,0,2,3]),hl.setAttribute("position",new ul(t,3,0,!1)),hl.setAttribute("uv",new ul(t,2,3,!1))),this.geometry=hl,this.material=void 0!==e?e:new dl,this.center=new Yt(.5,.5)}raycast(e,t){null===e.camera&&console.error('v3d.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fl.setFromMatrixScale(this.matrixWorld),Al.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ml.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&fl.multiplyScalar(-ml.z);var n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));n=this.center;wl(_l.set(-.5,-.5,0),ml,n,fl,r,i),wl(xl.set(.5,-.5,0),ml,n,fl,r,i),wl(yl.set(.5,.5,0),ml,n,fl,r,i),bl.set(0,0),Ml.set(1,0),Cl.set(1,1),null===e.ray.intersectTriangle(_l,xl,yl,!1,pl)&&(wl(xl.set(-.5,.5,0),ml,n,fl,r,i),Ml.set(0,1),null===e.ray.intersectTriangle(_l,yl,xl,!1,pl))||((n=e.ray.origin.distanceTo(pl))<e.near||n>e.far||t.push({distance:n,point:pl.clone(),uv:zr.getUV(pl,_l,xl,yl,bl,Ml,Cl,new Yt),face:null,object:this}))}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function wl(e,t,n,r,i,a){gl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(vl.x=a*gl.x-i*gl.y,vl.y=i*gl.x+a*gl.y):vl.copy(gl),e.copy(t),e.x+=vl.x,e.y+=vl.y,e.applyMatrix4(Al)}Sl.prototype.isSprite=!0;const El=new wn,Tl=new wn;class Il extends Tr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);var n=e.levels;for(let e=0,t=n.length;e<t;e++){const r=n[e];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){var r=this.levels;if(0<r.length){let e,t;for(e=1,t=r.length;e<t&&!(n<r[e].distance);e++);return r[e-1].object}return null}raycast(e,t){var n;0<this.levels.length&&(El.setFromMatrixPosition(this.matrixWorld),n=e.ray.origin.distanceTo(El),this.getObjectForDistance(n).raycast(e,t))}update(n){const r=this.levels;if(1<r.length){El.setFromMatrixPosition(n.matrixWorld),Tl.setFromMatrixPosition(this.matrixWorld);var i=El.distanceTo(Tl)/n.zoom;r[0].object.visible=!0;let e,t;for(e=1,t=r.length;e<t&&i>=r[e].distance;e++)r[e-1].object.visible=!1,r[e].object.visible=!0;for(this._currentLevel=e-1;e<t;e++)r[e].object.visible=!1}}toJSON(e){const n=super.toJSON(e);!1===this.autoUpdate&&(n.object.autoUpdate=!1),n.object.levels=[];var r=this.levels;for(let e=0,t=r.length;e<t;e++){var i=r[e];n.object.levels.push({object:i.object.uuid,distance:i.distance})}return n}}const Rl=new wn,Ll=new yn,Bl=new yn,Pl=new wn,Dl=new rr;class Nl extends Ei{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new rr,this.bindMatrixInverse=new rr,this.normalizeSkinWeights()}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new yn,r=this.geometry.attributes.skinWeight;for(let e=0,t=r.count;e<t;e++){n.x=r.getX(e),n.y=r.getY(e),n.z=r.getZ(e),n.w=r.getW(e);var i=1/n.manhattanLength();i!=1/0?n.multiplyScalar(i):n.set(1,0,0,0),r.setXYZW(e,n.x,n.y,n.z,n.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("v3d.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){var n=this.skeleton,r=this.geometry;Ll.fromBufferAttribute(r.attributes.skinIndex,e),Bl.fromBufferAttribute(r.attributes.skinWeight,e),Rl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){var i,a=Bl.getComponent(e);0!==a&&(i=Ll.getComponent(e),Dl.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Pl.copy(Rl).applyMatrix4(Dl),a))}return t.applyMatrix4(this.bindMatrixInverse)}}Nl.prototype.isSkinnedMesh=!0;class Fl extends Tr{constructor(){super(),this.type="Bone"}}Fl.prototype.isBone=!0;class Ol extends _n{constructor(e=null,t=1,n=1,r,i,a,o,s,l=Ve,c=Ve,u,d){super(null,a,o,s,l,c,r,i,u,d),this.image={data:e,width:t,height:n},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ol.prototype.isDataTexture=!0;const Ul=new rr,zl=new rr;class Vl{constructor(e=[],t=[]){this.uuid=It(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("v3d.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new rr)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){const n=new rr;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){var n=this.bones,r=this.boneInverses,i=this.boneMatrices;const e=this.boneTexture;for(let e=0,t=n.length;e<t;e++){var a=n[e]?n[e].matrixWorld:zl;Ul.multiplyMatrices(a,r[e]),Ul.toArray(i,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new Vl(this.bones,this.boneInverses)}computeBoneTexture(){var e=Ot(e=Math.sqrt(4*this.bones.length));e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Ol(t,e,e,Ke,Ye);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(n){for(let e=0,t=this.bones.length;e<t;e++){var r=this.bones[e];if(r.name===n)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,r){this.uuid=n.uuid;for(let t=0,e=n.bones.length;t<e;t++){var i=n.bones[t];let e=r[i];void 0===e&&(console.warn("v3d.Skeleton: No bone found with UUID:",i),e=new Fl),this.bones.push(e),this.boneInverses.push((new rr).fromArray(n.boneInverses[t]))}return this.init(),this}toJSON(){const n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;var r=this.bones,i=this.boneInverses;for(let e=0,t=r.length;e<t;e++){var a=r[e];n.bones.push(a.uuid);const o=i[e];n.boneInverses.push(o.toArray())}return n}}class Gl extends Hr{constructor(e,t,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("v3d.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Gl.prototype.isInstancedBufferAttribute=!0;const kl=new rr,Ql=new rr,Wl=[],Hl=new Ei;class Yl extends Ei{constructor(e,t,n){super(e,t),this.instanceMatrix=new Gl(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,r){var t=this.matrixWorld,i=this.count;if(Hl.geometry=this.geometry,Hl.material=this.material,void 0!==Hl.material)for(let n=0;n<i;n++){this.getMatrixAt(n,kl),Ql.multiplyMatrices(t,kl),Hl.matrixWorld=Ql,Hl.raycast(e,Wl);for(let e=0,t=Wl.length;e<t;e++){const a=Wl[e];a.instanceId=n,a.object=this,r.push(a)}Wl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Gl(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Yl.prototype.isInstancedMesh=!0;class Xl extends Gr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new mn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Xl.prototype.isLineBasicMaterial=!0;const jl=new wn,Kl=new wn,ql=new rr,Zl=new nr,Jl=new jn;class $l extends Tr{constructor(e=new ci,t=new Xl){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var n=e.attributes.position;const r=[0];for(let e=1,t=n.count;e<t;e++)jl.fromBufferAttribute(n,e-1),Kl.fromBufferAttribute(n,e),r[e]=r[e-1],r[e]+=jl.distanceTo(Kl);e.setAttribute("lineDistance",new ei(r,1))}else console.warn("v3d.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("v3d.Line.computeLineDistances() no longer supports v3d.Geometry. Use v3d.BufferGeometry instead.");return this}raycast(n,r){const e=this.geometry;var t=this.matrixWorld,i=n.params.Line.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),Jl.copy(e.boundingSphere),Jl.applyMatrix4(t),Jl.radius+=i,!1!==n.ray.intersectsSphere(Jl)){ql.copy(t).invert(),Zl.copy(n.ray).applyMatrix4(ql);var i=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=i*i;const h=new wn,p=new wn,f=new wn,m=new wn;var s=this.isLineSegments?2:1;if(e.isBufferGeometry){const g=e.index;var l,c=e.attributes.position;if(null!==g)for(let e=Math.max(0,a.start),t=Math.min(g.count,a.start+a.count)-1;e<t;e+=s){var u=g.getX(e),d=g.getX(e+1);h.fromBufferAttribute(c,u),p.fromBufferAttribute(c,d),o<Zl.distanceSqToSegment(h,p,m,f)||(m.applyMatrix4(this.matrixWorld),(d=n.ray.origin.distanceTo(m))<n.near||d>n.far||r.push({distance:d,point:f.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else for(let e=Math.max(0,a.start),t=Math.min(c.count,a.start+a.count)-1;e<t;e+=s)h.fromBufferAttribute(c,e),p.fromBufferAttribute(c,e+1),o<Zl.distanceSqToSegment(h,p,m,f)||(m.applyMatrix4(this.matrixWorld),(l=n.ray.origin.distanceTo(m))<n.near||l>n.far||r.push({distance:l,point:f.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else e.isGeometry&&console.error("v3d.Line.raycast() no longer supports v3d.Geometry. Use v3d.BufferGeometry instead.")}}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(0<n.length){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("v3d.Line.updateMorphTargets() does not support v3d.Geometry. Use v3d.BufferGeometry instead.")}}}$l.prototype.isLine=!0;const ec=new wn,tc=new wn;class nc extends $l{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var n=e.attributes.position;const r=[];for(let e=0,t=n.count;e<t;e+=2)ec.fromBufferAttribute(n,e),tc.fromBufferAttribute(n,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+ec.distanceTo(tc);e.setAttribute("lineDistance",new ei(r,1))}else console.warn("v3d.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("v3d.LineSegments.computeLineDistances() no longer supports v3d.Geometry. Use v3d.BufferGeometry instead.");return this}}nc.prototype.isLineSegments=!0;class rc extends $l{constructor(e,t){super(e,t),this.type="LineLoop"}}rc.prototype.isLineLoop=!0;class ic extends Gr{constructor(e){super(),this.type="PointsMaterial",this.color=new mn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}ic.prototype.isPointsMaterial=!0;const ac=new rr,oc=new nr,sc=new jn,lc=new wn;class cc extends Tr{constructor(e=new ci,t=new ic){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(n,r){const e=this.geometry;var i=this.matrixWorld,t=n.params.Points.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),sc.copy(e.boundingSphere),sc.applyMatrix4(i),sc.radius+=t,!1!==n.ray.intersectsSphere(sc)){ac.copy(i).invert(),oc.copy(n.ray).applyMatrix4(ac);var t=t/((this.scale.x+this.scale.y+this.scale.z)/3),o=t*t;if(e.isBufferGeometry){const c=e.index;var s=e.attributes.position;if(null!==c)for(let e=Math.max(0,a.start),t=Math.min(c.count,a.start+a.count);e<t;e++){var l=c.getX(e);lc.fromBufferAttribute(s,l),uc(lc,l,o,i,n,r,this)}else for(let e=Math.max(0,a.start),t=Math.min(s.count,a.start+a.count);e<t;e++)lc.fromBufferAttribute(s,e),uc(lc,e,o,i,n,r,this)}else console.error("v3d.Points.raycast() no longer supports v3d.Geometry. Use v3d.BufferGeometry instead.")}}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(0<n.length){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("v3d.Points.updateMorphTargets() does not support v3d.Geometry. Use v3d.BufferGeometry instead.")}}}function uc(e,t,n,r,i,a,o){var s=oc.distanceSqToPoint(e);if(s<n){const l=new wn;oc.closestPointToPoint(e,l),l.applyMatrix4(r);r=i.ray.origin.distanceTo(l);r<i.near||r>i.far||a.push({distance:r,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}cc.prototype.isPoints=!0;class dc extends _n{constructor(t,e,n,r,i,a,o,s,l){super(t,e,n,r,i,a,o,s,l),this.minFilter=void 0!==a?a:Ge,this.magFilter=void 0!==i?i:Ge,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}dc.prototype.isVideoTexture=!0;class hc extends _n{constructor(e,t,n){super({width:e,height:t}),this.format=n,this.magFilter=Ve,this.minFilter=Ve,this.generateMipmaps=!1,this.needsUpdate=!0}}hc.prototype.isFramebufferTexture=!0;class pc extends _n{constructor(e,t,n,r,i,a,o,s,l,c,u,d){super(null,a,o,s,l,c,r,i,u,d),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}pc.prototype.isCompressedTexture=!0;class fc extends _n{constructor(e,t,n,r,i,a,o,s,l){super(e,t,n,r,i,a,o,s,l),this.needsUpdate=!0}}fc.prototype.isCanvasTexture=!0;class mc extends ci{constructor(n=1,r=8,i=0,a=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:r,thetaStart:i,thetaLength:a},r=Math.max(3,r);const t=[],o=[],s=[],l=[],c=new wn,u=new Yt;o.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=r;e++,t+=3){var d=i+e/r*a;c.x=n*Math.cos(d),c.y=n*Math.sin(d),o.push(c.x,c.y,c.z),s.push(0,0,1),u.x=(o[t]/n+1)/2,u.y=(o[t+1]/n+1)/2,l.push(u.x,u.y)}for(let e=1;e<=r;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new ei(o,3)),this.setAttribute("normal",new ei(s,3)),this.setAttribute("uv",new ei(l,2))}static fromJSON(e){return new mc(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class gc extends ci{constructor(m=1,g=1,v=1,A=8,_=1,e=!1,x=0,y=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:m,radiusBottom:g,height:v,radialSegments:A,heightSegments:_,openEnded:e,thetaStart:x,thetaLength:y};const b=this;A=Math.floor(A),_=Math.floor(_);const M=[],C=[],S=[],w=[];let E=0;const T=[],I=v/2;let R=0;function t(t){var n=E;const r=new Yt,i=new wn;let a=0;var o=!0===t?m:g,s=!0===t?1:-1;for(let e=1;e<=A;e++)C.push(0,I*s,0),S.push(0,s,0),w.push(.5,.5),E++;var l=E;for(let e=0;e<=A;e++){var c=e/A*y+x,u=Math.cos(c),c=Math.sin(c);i.x=o*c,i.y=I*s,i.z=o*u,C.push(i.x,i.y,i.z),S.push(0,s,0),r.x=.5*u+.5,r.y=.5*c*s+.5,w.push(r.x,r.y),E++}for(let e=0;e<A;e++){var d=n+e,h=l+e;!0===t?M.push(h,h+1,d):M.push(h+1,h,d),a+=3}b.addGroup(R,a,!0===t?1:2),R+=a}!function(){const t=new wn,n=new wn;let r=0;var i=(g-m)/v;for(let e=0;e<=_;e++){const f=[];var a=e/_,o=a*(g-m)+m;for(let e=0;e<=A;e++){var s=e/A,l=s*y+x,c=Math.sin(l),l=Math.cos(l);n.x=o*c,n.y=-a*v+I,n.z=o*l,C.push(n.x,n.y,n.z),t.set(c,i,l).normalize(),S.push(t.x,t.y,t.z),w.push(s,1-a),f.push(E++)}T.push(f)}for(let t=0;t<A;t++)for(let e=0;e<_;e++){var u=T[e][t],d=T[e+1][t],h=T[e+1][t+1],p=T[e][t+1];M.push(u,d,p),M.push(d,h,p),r+=6}b.addGroup(R,r,0),R+=r}(),!1===e&&(0<m&&t(!0),0<g&&t(!1)),this.setIndex(M),this.setAttribute("position",new ei(C,3)),this.setAttribute("normal",new ei(S,3)),this.setAttribute("uv",new ei(w,2))}static fromJSON(e){return new gc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vc extends gc{constructor(e=1,t=1,n=8,r=1,i=!1,a=0,o=2*Math.PI){super(0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}static fromJSON(e){return new vc(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ac extends ci{constructor(n=[],a=[],e=1,t=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:a,radius:e,detail:t};const u=[],d=[];function h(e){u.push(e.x,e.y,e.z)}function o(e,t){e*=3;t.x=n[0+e],t.y=n[1+e],t.z=n[2+e]}function p(e,t,n,r){r<0&&1===e.x&&(d[t]=e.x-1),0===n.x&&0===n.z&&(d[t]=r/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}!function(t){var n=new wn,r=new wn,i=new wn;for(let e=0;e<a.length;e+=3)o(a[e+0],n),o(a[e+1],r),o(a[e+2],i),function(e,n,r,t){const i=t+1,a=[];for(let t=0;t<=i;t++){a[t]=[];const c=e.clone().lerp(r,t/i);var o=n.clone().lerp(r,t/i),s=i-t;for(let e=0;e<=s;e++)0===e&&t===i?a[t][e]=c:a[t][e]=c.clone().lerp(o,e/s)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){var l=Math.floor(e/2);e%2==0?(h(a[t][l+1]),h(a[t+1][l]),h(a[t][l])):(h(a[t][l+1]),h(a[t+1][l+1]),h(a[t+1][l]))}}(n,r,i,t)}(t),function(t){const n=new wn;for(let e=0;e<u.length;e+=3)n.x=u[e+0],n.y=u[e+1],n.z=u[e+2],n.normalize().multiplyScalar(t),u[e+0]=n.x,u[e+1]=n.y,u[e+2]=n.z}(e),function(){const t=new wn;for(let e=0;e<u.length;e+=3){t.x=u[e+0],t.y=u[e+1],t.z=u[e+2];var n=f(t)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(t)/Math.PI+.5;d.push(n,1-r)}(function(){const n=new wn,r=new wn,i=new wn,a=new wn,o=new Yt,s=new Yt,l=new Yt;for(let e=0,t=0;e<u.length;e+=9,t+=6){n.set(u[e+0],u[e+1],u[e+2]),r.set(u[e+3],u[e+4],u[e+5]),i.set(u[e+6],u[e+7],u[e+8]),o.set(d[t+0],d[t+1]),s.set(d[t+2],d[t+3]),l.set(d[t+4],d[t+5]),a.copy(n).add(r).add(i).divideScalar(3);var c=f(a);p(o,t+0,n,c),p(s,t+2,r,c),p(l,t+4,i,c)}})(),function(){for(let e=0;e<d.length;e+=6){var t=d[e+0],n=d[e+2],r=d[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);.9<i&&a<.1&&(t<.2&&(d[e+0]+=1),n<.2&&(d[e+2]+=1),r<.2&&(d[e+4]+=1))}}()}(),this.setAttribute("position",new ei(u,3)),this.setAttribute("normal",new ei(u.slice(),3)),this.setAttribute("uv",new ei(d,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Ac(e.vertices,e.indices,e.radius,e.details)}}class _c extends Ac{constructor(e=1,t=0){var n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _c(e.radius,e.detail)}}const xc=new wn,yc=new wn,bc=new wn,Mc=new zr;class Cc extends ci{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){var n=Math.pow(10,4),r=Math.cos(Et*t);const m=e.getIndex();var i=e.getAttribute("position"),a=(m||i).count;const g=[0,0,0];var o,s,l=["a","b","c"];const v=new Array(3),A={},_=[];for(let e=0;e<a;e+=3){m?(g[0]=m.getX(e),g[1]=m.getX(e+1),g[2]=m.getX(e+2)):(g[0]=e,g[1]=e+1,g[2]=e+2);const{a:x,b:y,c:b}=Mc;if(x.fromBufferAttribute(i,g[0]),y.fromBufferAttribute(i,g[1]),b.fromBufferAttribute(i,g[2]),Mc.getNormal(bc),v[0]=`${Math.round(x.x*n)},${Math.round(x.y*n)},`+Math.round(x.z*n),v[1]=`${Math.round(y.x*n)},${Math.round(y.y*n)},`+Math.round(y.z*n),v[2]=`${Math.round(b.x*n)},${Math.round(b.y*n)},`+Math.round(b.z*n),v[0]!==v[1]&&v[1]!==v[2]&&v[2]!==v[0])for(let e=0;e<3;e++){var c=(e+1)%3,u=v[e],d=v[c],h=Mc[l[e]],p=Mc[l[c]],f=u+"_"+d,u=d+"_"+u;u in A&&A[u]?(bc.dot(A[u].normal)<=r&&(_.push(h.x,h.y,h.z),_.push(p.x,p.y,p.z)),A[u]=null):f in A||(A[f]={index0:g[e],index1:g[c],normal:bc.clone()})}}for(const M in A)A[M]&&({index0:o,index1:s}=A[M],xc.fromBufferAttribute(i,o),yc.fromBufferAttribute(i,s),_.push(xc.x,xc.y,xc.z),_.push(yc.x,yc.y,yc.z));this.setAttribute("position",new ei(_,3))}}}class Sc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("v3d.Curve: .getPoint() not implemented."),null}getPointAt(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)}getPoints(t=5){const n=[];for(let e=0;e<=t;e++)n.push(this.getPoint(e/t));return n}getSpacedPoints(t=5){const n=[];for(let e=0;e<=t;e++)n.push(this.getPointAt(e/t));return n}getLength(){var e=this.getLengths();return e[e.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let r,i=this.getPoint(0),a=0;n.push(0);for(let e=1;e<=t;e++)r=this.getPoint(e/t),a+=r.distanceTo(i),n.push(a),i=r;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){var n=this.getLengths();let r=0;var i=n.length;let a;a=t||e*n[i-1];let o=0,s=i-1,l;for(;o<=s;)if(r=Math.floor(o+(s-o)/2),(l=n[r]-a)<0)o=r+1;else{if(!(0<l)){s=r;break}s=r-1}if(r=s,n[r]===a)return r/(i-1);t=n[r],e=n[r+1],t=(a-t)/(e-t);return(r+t)/(i-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),1<r&&(r=1);var i=this.getPoint(n),e=this.getPoint(r);const a=t||new(i.isVector2?Yt:wn);return a.copy(e).sub(i).normalize(),a}getTangentAt(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)}computeFrenetFrames(n,e){const t=new wn,r=[],i=[],a=[],o=new wn,s=new rr;for(let e=0;e<=n;e++){var l=e/n;r[e]=this.getTangentAt(l,new wn)}i[0]=new wn,a[0]=new wn;let c=Number.MAX_VALUE;var u,d=Math.abs(r[0].x),h=Math.abs(r[0].y),p=Math.abs(r[0].z);d<=c&&(c=d,t.set(1,0,0)),h<=c&&(c=h,t.set(0,1,0)),p<=c&&t.set(0,0,1),o.crossVectors(r[0],t).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(let e=1;e<=n;e++)i[e]=i[e-1].clone(),a[e]=a[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON&&(o.normalize(),u=Math.acos(Rt(r[e-1].dot(r[e]),-1,1)),i[e].applyMatrix4(s.makeRotationAxis(o,u))),a[e].crossVectors(r[e],i[e]);if(!0===e){let t=Math.acos(Rt(i[0].dot(i[n]),-1,1));t/=n,0<r[0].dot(o.crossVectors(i[0],i[n]))&&(t=-t);for(let e=1;e<=n;e++)i[e].applyMatrix4(s.makeRotationAxis(r[e],t*e)),a[e].crossVectors(r[e],i[e])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class wc extends Sc{constructor(e=0,t=0,n=1,r=1,i=0,a=2*Math.PI,o=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t){const n=t||new Yt;var r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;for(var a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);return 0!==this.aRotation&&(t=Math.cos(this.aRotation),a=Math.sin(this.aRotation),e=s-this.aX,o=l-this.aY,s=e*t-o*a+this.aX,l=e*a+o*t+this.aY),n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}wc.prototype.isEllipseCurve=!0;class Ec extends wc{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.type="ArcCurve"}}function Tc(){let i=0,a=0,o=0,s=0;function l(e,t,n,r){i=e,a=n,o=-3*e+3*t-2*n-r,s=2*e-2*t+n+r}return{initCatmullRom:function(e,t,n,r,i){l(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,a,o){i=(t-e)/i-(n-e)/(i+a)+(n-t)/a,o=(n-t)/a-(r-t)/(a+o)+(r-n)/o;l(t,n,i*=a,o*=a)},calc:function(e){var t=e*e,n=t*e;return i+a*e+o*t+s*n}}}Ec.prototype.isArcCurve=!0;const Ic=new wn,Rc=new Tc,Lc=new Tc,Bc=new Tc;class Pc extends Sc{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,r=new wn){const t=r;var n=this.points,r=n.length,e=(r-(this.closed?0:1))*e;let i=Math.floor(e),a=e-i;this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/r)+1)*r:0===a&&i===r-1&&(i=r-2,a=1);let o,s;o=this.closed||0<i?n[(i-1)%r]:(Ic.subVectors(n[0],n[1]).add(n[0]),Ic);const l=n[i%r],c=n[(i+1)%r];if(s=this.closed||i+2<r?n[(i+2)%r]:(Ic.subVectors(n[r-1],n[r-2]).add(n[r-1]),Ic),"centripetal"===this.curveType||"chordal"===this.curveType){r="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(l),r),t=Math.pow(l.distanceToSquared(c),r),n=Math.pow(c.distanceToSquared(s),r);t<1e-4&&(t=1),e<1e-4&&(e=t),n<1e-4&&(n=t),Rc.initNonuniformCatmullRom(o.x,l.x,c.x,s.x,e,t,n),Lc.initNonuniformCatmullRom(o.y,l.y,c.y,s.y,e,t,n),Bc.initNonuniformCatmullRom(o.z,l.z,c.z,s.z,e,t,n)}else"catmullrom"===this.curveType&&(Rc.initCatmullRom(o.x,l.x,c.x,s.x,this.tension),Lc.initCatmullRom(o.y,l.y,c.y,s.y,this.tension),Bc.initCatmullRom(o.z,l.z,c.z,s.z,this.tension));return t.set(Rc.calc(a),Lc.calc(a),Bc.calc(a)),t}copy(n){super.copy(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){const r=n.points[e];this.points.push(r.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let e=0,t=this.points.length;e<t;e++){const r=this.points[e];n.points.push(r.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var r=n.points[e];this.points.push((new wn).fromArray(r))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function Dc(e,t,n,r,i){var a=.5*(r-t),t=.5*(i-n),i=e*e;return(2*n-2*r+a+t)*(e*i)+(-3*n+3*r-2*a-t)*i+a*e+n}function Nc(e,t,n,r){return(i=1-(i=e))*i*t+2*(1-e)*e*n+e*e*r;var i}function Fc(e,t,n,r,i){return(a=1-(a=e))*a*a*t+3*(t=1-e)*t*e*n+3*(1-e)*e*e*r+e*e*e*i;var a}class Oc extends Sc{constructor(e=new Yt,t=new Yt,n=new Yt,r=new Yt){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Yt){const n=t;var r=this.v0,i=this.v1,a=this.v2,t=this.v3;return n.set(Fc(e,r.x,i.x,a.x,t.x),Fc(e,r.y,i.y,a.y,t.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Oc.prototype.isCubicBezierCurve=Pc.prototype.isCatmullRomCurve3=!0;class Uc extends Sc{constructor(e=new wn,t=new wn,n=new wn,r=new wn){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new wn){const n=t;var r=this.v0,i=this.v1,a=this.v2,t=this.v3;return n.set(Fc(e,r.x,i.x,a.x,t.x),Fc(e,r.y,i.y,a.y,t.y),Fc(e,r.z,i.z,a.z,t.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class zc extends Sc{constructor(e=new Yt,t=new Yt){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Yt){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Yt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}zc.prototype.isLineCurve=Uc.prototype.isCubicBezierCurve3=!0;class Vc extends Sc{constructor(e=new wn,t=new wn){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new wn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Gc extends Sc{constructor(e=new Yt,t=new Yt,n=new Yt){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Yt){const n=t;var r=this.v0,i=this.v1,t=this.v2;return n.set(Nc(e,r.x,i.x,t.x),Nc(e,r.y,i.y,t.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Gc.prototype.isQuadraticBezierCurve=!0;class kc extends Sc{constructor(e=new wn,t=new wn,n=new wn){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new wn){const n=t;var r=this.v0,i=this.v1,t=this.v2;return n.set(Nc(e,r.x,i.x,t.x),Nc(e,r.y,i.y,t.y),Nc(e,r.z,i.z,t.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}kc.prototype.isQuadraticBezierCurve3=!0;class Qc extends Sc{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Yt){const n=t;var r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,t=r[0===a?a:a-1],e=r[a],i=r[a>r.length-2?r.length-1:a+1],a=r[a>r.length-3?r.length-1:a+2];return n.set(Dc(o,t.x,e.x,i.x,a.x),Dc(o,t.y,e.y,i.y,a.y)),n}copy(n){super.copy(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){const r=n.points[e];this.points.push(r.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let e=0,t=this.points.length;e<t;e++){const r=this.points[e];n.points.push(r.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var r=n.points[e];this.points.push((new Yt).fromArray(r))}return this}}Qc.prototype.isSplineCurve=!0;var Wc=Object.freeze({__proto__:null,ArcCurve:Ec,CatmullRomCurve3:Pc,CubicBezierCurve:Oc,CubicBezierCurve3:Uc,EllipseCurve:wc,LineCurve:zc,LineCurve3:Vc,QuadraticBezierCurve:Gc,QuadraticBezierCurve3:kc,SplineCurve:Qc});class Hc extends Sc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zc(t,e))}getPoint(e,t){var n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){var a=r[i]-n;const s=this.curves[i];var o=s.getLength();return s.getPointAt(0===o?0:1-a/o,t)}i++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let r=0;for(let e=0,t=this.curves.length;e<t;e++)r+=this.curves[e].getLength(),n.push(r);return this.cacheLengths=n,n}getSpacedPoints(t=40){const n=[];for(let e=0;e<=t;e++)n.push(this.getPoint(e/t));return this.autoClose&&n.push(n[0]),n}getPoints(n=12){const r=[];let i;for(let e=0,t=this.curves;e<t.length;e++){const l=t[e];var a=l&&l.isEllipseCurve?2*n:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?n*l.points.length:n,o=l.getPoints(a);for(let e=0;e<o.length;e++){var s=o[e];i&&i.equals(s)||(r.push(s),i=s)}}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}copy(n){super.copy(n),this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){const r=n.curves[e];this.curves.push(r.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let e=0,t=this.curves.length;e<t;e++){const r=this.curves[e];n.curves.push(r.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){var r=n.curves[e];this.curves.push((new Wc[r.type]).fromJSON(r))}return this}}class Yc extends Hc{constructor(e){super(),this.type="Path",this.currentPoint=new Yt,e&&this.setFromPoints(e)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let e=1,t=n.length;e<t;e++)this.lineTo(n[e].x,n[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var n=new zc(this.currentPoint.clone(),new Yt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){t=new Gc(this.currentPoint.clone(),new Yt(e,t),new Yt(n,r));return this.curves.push(t),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){r=new Oc(this.currentPoint.clone(),new Yt(e,t),new Yt(n,r),new Yt(i,a));return this.curves.push(r),this.currentPoint.set(i,a),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new Qc(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,a,o,s),this}absellipse(e,t,n,r,i,a,o,s){const l=new wc(e,t,n,r,i,a,o,s);if(0<this.curves.length){const c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);s=l.getPoint(1);return this.currentPoint.copy(s),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Xc extends Yc{constructor(e){super(e),this.uuid=It(),this.type="Shape",this.holes=[]}getPointsHoles(n){const r=[];for(let e=0,t=this.holes.length;e<t;e++)r[e]=this.holes[e].getPoints(n);return r}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(n){super.copy(n),this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){const r=n.holes[e];this.holes.push(r.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let e=0,t=this.holes.length;e<t;e++){const r=this.holes[e];n.holes.push(r.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){var r=n.holes[e];this.holes.push((new Yc).fromJSON(r))}return this}}const jc={triangulate:function(t,e,n=2){var r=e&&e.length,i=r?e[0]*n:t.length;let a=Kc(t,0,i,n,!0);var o=[];if(!a||a.next===a.prev)return o;let s,l,c,u,d,h,p;if(r&&(a=function(e,t,n,r){const i=[];let a,o,s,l,c;for(a=0,o=t.length;a<o;a++)s=t[a]*r,l=a<o-1?t[a+1]*r:e.length,c=Kc(e,s,l,r,!1),c===c.next&&(c.steiner=!0),i.push(function(e){let t=e,n=e;for(;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next,t!==e;);return n}(c));for(i.sort(Jc),a=0;a<i.length;a++)!function(e,t){(t=function(e,t){let n=t;var r=e.x,i=e.y;let a=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a){if((a=s)===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}}while(n=n.next,n!==t);if(!o)return null;if(r===a)return o;var l=o,c=o.x,u=o.y;let d=1/0,h;n=o;for(;r>=n.x&&n.x>=c&&r!==n.x&&eu(i<u?r:a,i,c,u,i<u?a:r,i,n.x,n.y)&&(h=Math.abs(i-n.y)/(r-n.x),ou(n,e)&&(h<d||h===d&&(n.x>o.x||n.x===o.x&&function(e,t){return tu(e.prev,e,t.prev)<0&&tu(t.next,e,e.next)<0}(o,n)))&&(o=n,d=h)),n=n.next,n!==l;);return o}(e,t))&&(e=su(t,e),qc(t,t.next),qc(e,e.next))}(i[a],n),n=qc(n,n.next);return n}(t,e,a,n)),t.length>80*n){s=c=t[0],l=u=t[1];for(let e=n;e<i;e+=n)d=t[e],h=t[e+1],d<s&&(s=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);p=Math.max(c-s,u-l),p=0!==p?1/p:0}return Zc(a,o,n,s,l,p),o}};function Kc(e,t,n,r,i){let a,o;if(i===0<function(n,r,i,a){let o=0;for(let e=r,t=i-a;e<i;e+=a)o+=(n[t]-n[e])*(n[e+1]+n[t+1]),t=e;return o}(e,t,n,r))for(a=t;a<n;a+=r)o=lu(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=lu(a,e[a],e[a+1],o);return o&&nu(o,o.next)&&(cu(o),o=o.next),o}function qc(e,t){if(!e)return e;t=t||e;let n=e,r;do{if(r=!1,n.steiner||!nu(n,n.next)&&0!==tu(n.prev,n,n.next))n=n.next;else{if(cu(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Zc(r,i,a,o,s,l,c){if(r){!c&&l&&function(e,t,n,r){let i=e;for(;null===i.z&&(i.z=$c(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;0<s||0<l&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}}while(a.nextZ=null,c*=2,1<o)}(i)}(r,o,s,l);let e=r,t,n;for(;r.prev!==r.next;)if(t=r.prev,n=r.next,l?function(e,t,n,r){var i=e.prev,a=e,o=e.next;if(0<=tu(i,a,o))return!1;var s=(i.x<a.x?i.x<o.x?i:o:a.x<o.x?a:o).x,l=(i.y<a.y?i.y<o.y?i:o:a.y<o.y?a:o).y,c=(i.x>a.x?i.x>o.x?i:o:a.x>o.x?a:o).x,u=(i.y>a.y?i.y>o.y?i:o:a.y>o.y?a:o).y,d=$c(s,l,t,n,r),h=$c(c,u,t,n,r);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=d&&f&&f.z<=h;){if(p!==e.prev&&p!==e.next&&eu(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&0<=tu(p.prev,p,p.next))return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&eu(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=tu(f.prev,f,f.next))return!1;f=f.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&eu(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&0<=tu(p.prev,p,p.next))return!1;p=p.prevZ}for(;f&&f.z<=h;){if(f!==e.prev&&f!==e.next&&eu(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=tu(f.prev,f,f.next))return!1;f=f.nextZ}return!0}(r,o,s,l):function(e){var t=e.prev,n=e,r=e.next;if(0<=tu(t,n,r))return!1;let i=e.next.next;for(;i!==e.prev;){if(eu(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=tu(i.prev,i,i.next))return!1;i=i.next}return!0}(r))i.push(t.i/a),i.push(r.i/a),i.push(n.i/a),cu(r),r=n.next,e=n.next;else if((r=n)===e){c?1===c?Zc(r=function(e,t,n){let r=e;do{var i=r.prev,a=r.next.next;!nu(i,a)&&ru(i,r,r.next,a)&&ou(i,a)&&ou(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),cu(r),cu(r.next),r=e=a),r=r.next}while(r!==e);return qc(r)}(qc(r),i,a),i,a,o,s,l,2):2===c&&function(e,t,n,r,i,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ru(n,n.next,e,t))return!0}while(n=n.next,n!==e);return!1}(e,t)&&(ou(e,t)&&ou(t,e)&&function(e,t){let n=e,r=!1;var i=(e.x+t.x)/2,a=(e.y+t.y)/2;for(;n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(e,t)&&(tu(e.prev,e,t.prev)||tu(e,t.prev,t))||nu(e,t)&&0<tu(e.prev,e,e.next)&&0<tu(t.prev,t,t.next))}(o,e)){var s=su(o,e);return o=qc(o,o.next),s=qc(s,s.next),Zc(o,t,n,r,i,a),Zc(s,t,n,r,i,a)}e=e.next}}while(o=o.next,o!==e)}(r,i,a,o,s,l):Zc(qc(r),i,a,o,s,l,1);break}}}function Jc(e,t){return e.x-t.x}function $c(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function eu(e,t,n,r,i,a,o,s){return 0<=(i-o)*(t-s)-(e-o)*(a-s)&&0<=(e-o)*(r-s)-(n-o)*(t-s)&&0<=(n-o)*(a-s)-(i-o)*(r-s)}function tu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function nu(e,t){return e.x===t.x&&e.y===t.y}function ru(e,t,n,r){var i=au(tu(e,t,n)),a=au(tu(e,t,r)),o=au(tu(n,r,e)),s=au(tu(n,r,t));return i!==a&&o!==s||(0===i&&iu(e,n,t)||(0===a&&iu(e,r,t)||(0===o&&iu(n,e,r)||!(0!==s||!iu(n,t,r)))))}function iu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function au(e){return 0<e?1:e<0?-1:0}function ou(e,t){return tu(e.prev,e,e.next)<0?0<=tu(e,t,e.next)&&0<=tu(e,e.prev,t):tu(e,t,e.prev)<0||tu(e,e.next,t)<0}function su(e,t){const n=new uu(e.i,e.x,e.y),r=new uu(t.i,t.x,t.y),i=e.next,a=t.prev;return(e.next=t).prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function lu(e,t,n,r){const i=new uu(e,t,n);return r?(i.next=r.next,(i.prev=r).next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function cu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function uu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class du{static area(n){var r=n.length;let i=0;for(let e=r-1,t=0;t<r;e=t++)i+=n[e].x*n[t].y-n[t].x*n[e].y;return.5*i}static isClockWise(e){return du.area(e)<0}static triangulateShape(e,t){var n=[];const r=[],i=[];hu(e),pu(n,e);let a=e.length;t.forEach(hu);for(let e=0;e<t.length;e++)r.push(a),a+=t[e].length,pu(n,t[e]);const o=jc.triangulate(n,r);for(let e=0;e<o.length;e+=3)i.push(o.slice(e,e+3));return i}}function hu(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function pu(t,n){for(let e=0;e<n.length;e++)t.push(n[e].x),t.push(n[e].y)}class fu extends ci{constructor(n=new Xc([new Yt(.5,.5),new Yt(-.5,.5),new Yt(-.5,-.5),new Yt(.5,-.5)]),J={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:J},n=Array.isArray(n)?n:[n];const $=this,ee=[],te=[];for(let e=0,t=n.length;e<t;e++)!function(e){const r=[],t=void 0!==J.curveSegments?J.curveSegments:12,s=void 0!==J.steps?J.steps:1;let n=void 0!==J.depth?J.depth:1,o=void 0===J.bevelEnabled||J.bevelEnabled,i=void 0!==J.bevelThickness?J.bevelThickness:.2,a=void 0!==J.bevelSize?J.bevelSize:i-.1,l=void 0!==J.bevelOffset?J.bevelOffset:0,c=void 0!==J.bevelSegments?J.bevelSegments:3;const u=J.extrudePath,d=void 0!==J.UVGenerator?J.UVGenerator:mu;void 0!==J.amount&&(console.warn("v3d.ExtrudeBufferGeometry: amount has been renamed to depth."),n=J.amount);let h,p=!1,f,m,g,v;u&&(h=u.getSpacedPoints(s),p=!0,o=!1,f=u.computeFrenetFrames(s,!1),m=new wn,g=new wn,v=new wn);o||(c=0,i=0,a=0,l=0);e=e.extractPoints(t);let A=e.shape;const _=e.holes,x=!du.isClockWise(A);if(x){A=A.reverse();for(let e=0,t=_.length;e<t;e++){const Z=_[e];du.isClockWise(Z)&&(_[e]=Z.reverse())}}const y=du.triangulateShape(A,_),b=A;for(let e=0,t=_.length;e<t;e++){var M=_[e];A=A.concat(M)}function C(e,t,n){return t||console.error("v3d.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const S=A.length,w=y.length;function E(e,t,n){let r,i,a;var o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s;if(Math.abs(o*c-s*l)>Number.EPSILON){var d=Math.sqrt(u),h=Math.sqrt(l*l+c*c),p=t.x-s/d,d=t.y+o/d,h=((n.x-c/h-p)*c-(n.y+l/h-d)*l)/(o*c-s*l);r=p+o*h-e.x,i=d+s*h-e.y;e=r*r+i*i;if(e<=2)return new Yt(r,i);a=Math.sqrt(e/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),a=e?(r=-s,i=o,Math.sqrt(u)):(r=o,i=s,Math.sqrt(u/2))}return new Yt(r/a,i/a)}const T=[];for(let e=0,t=b.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),T[e]=E(b[e],b[n],b[r]);const I=[];let R,L=T.concat();for(let e=0,t=_.length;e<t;e++){var B=_[e];R=[];for(let e=0,t=B.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),R[e]=E(B[e],B[n],B[r]);I.push(R),L=L.concat(R)}for(let e=0;e<c;e++){var P=e/c,D=i*Math.cos(P*Math.PI/2);const U=a*Math.sin(P*Math.PI/2)+l;for(let e=0,t=b.length;e<t;e++){var N=C(b[e],T[e],U);X(N.x,N.y,-D)}for(let e=0,t=_.length;e<t;e++){var F=_[e];R=I[e];for(let e=0,t=F.length;e<t;e++){var O=C(F[e],R[e],U);X(O.x,O.y,-D)}}}const U=a+l;for(let e=0;e<S;e++){var z=o?C(A[e],L[e],U):A[e];p?(g.copy(f.normals[0]).multiplyScalar(z.x),m.copy(f.binormals[0]).multiplyScalar(z.y),v.copy(h[0]).add(g).add(m),X(v.x,v.y,v.z)):X(z.x,z.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<S;e++){var V=o?C(A[e],L[e],U):A[e];p?(g.copy(f.normals[t]).multiplyScalar(V.x),m.copy(f.binormals[t]).multiplyScalar(V.y),v.copy(h[t]).add(g).add(m),X(v.x,v.y,v.z)):X(V.x,V.y,n/s*t)}for(let e=c-1;0<=e;e--){var G=e/c,k=i*Math.cos(G*Math.PI/2);const U=a*Math.sin(G*Math.PI/2)+l;for(let e=0,t=b.length;e<t;e++){var Q=C(b[e],T[e],U);X(Q.x,Q.y,n+k)}for(let e=0,t=_.length;e<t;e++){var W=_[e];R=I[e];for(let e=0,t=W.length;e<t;e++){var H=C(W[e],R[e],U);p?X(H.x,H.y+h[s-1].y,h[s-1].x+k):X(H.x,H.y,n+k)}}}function Y(e,r){let t=e.length;for(;0<=--t;){var i=t;let n=t-1;n<0&&(n=e.length-1);for(let e=0,t=s+2*c;e<t;e++){var a=S*e,o=S*(e+1);!function(e,t,n,r){K(e),K(t),K(r),K(t),K(n),K(r);r=ee.length/3,r=d.generateSideWallUV($,ee,r-6,r-3,r-2,r-1);q(r[0]),q(r[1]),q(r[3]),q(r[1]),q(r[2]),q(r[3])}(r+i+a,r+n+a,r+n+o,r+i+o)}}}function X(e,t,n){r.push(e),r.push(t),r.push(n)}function j(e,t,n){K(e),K(t),K(n);n=ee.length/3,n=d.generateTopUV($,ee,n-3,n-2,n-1);q(n[0]),q(n[1]),q(n[2])}function K(e){ee.push(r[3*e+0]),ee.push(r[3*e+1]),ee.push(r[3*e+2])}function q(e){te.push(e.x),te.push(e.y)}(function(){var e,t=ee.length/3;if(o){let t=0*S;for(let e=0;e<w;e++){var n=y[e];j(n[2]+t,n[1]+t,n[0]+t)}e=s+2*c,t=S*e;for(let e=0;e<w;e++){var r=y[e];j(r[0]+t,r[1]+t,r[2]+t)}}else{for(let e=0;e<w;e++){var i=y[e];j(i[2],i[1],i[0])}for(let e=0;e<w;e++){var a=y[e];j(a[0]+S*s,a[1]+S*s,a[2]+S*s)}}$.addGroup(t,ee.length/3-t,0)})(),function(){var e=ee.length/3;let n=0;Y(b,n),n+=b.length;for(let e=0,t=_.length;e<t;e++){var r=_[e];Y(r,n),n+=r.length}$.addGroup(e,ee.length/3-e,1)}()}(n[e]);this.setAttribute("position",new ei(ee,3)),this.setAttribute("uv",new ei(te,2)),this.computeVertexNormals()}toJSON(){var e=super.toJSON();return function(n,e,r){if(r.shapes=[],Array.isArray(n))for(let e=0,t=n.length;e<t;e++){var i=n[e];r.shapes.push(i.uuid)}else r.shapes.push(n.uuid);void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON());return r}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(n,r){const i=[];for(let e=0,t=n.shapes.length;e<t;e++){var a=r[n.shapes[e]];i.push(a)}var e=n.options.extrudePath;return void 0!==e&&(n.options.extrudePath=(new Wc[e.type]).fromJSON(e)),new fu(i,n.options)}}const mu={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],n=t[3*r+1],r=t[3*i],i=t[3*i+1];return[new Yt(a,o),new Yt(s,n),new Yt(r,i)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],d=t[3*r+2],h=t[3*i],p=t[3*i+1],n=t[3*i+2],r=t[3*a],i=t[3*a+1],a=t[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new Yt(o,1-l),new Yt(c,1-d),new Yt(h,1-n),new Yt(r,1-a)]:[new Yt(s,1-l),new Yt(u,1-d),new Yt(p,1-n),new Yt(i,1-a)]}};class gu extends Ac{constructor(e=1,t=0){var n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new gu(e.radius,e.detail)}}class vu extends ci{constructor(n=[new Yt(0,.5),new Yt(.5,0),new Yt(0,-.5)],r=12,e=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:n,segments:r,phiStart:e,phiLength:i},r=Math.floor(r),i=Rt(i,0,2*Math.PI);const a=[],o=[],s=[],l=[],c=[];var u=1/r;const d=new wn,h=new Yt,t=new wn,p=new wn,f=new wn;let m=0,g=0;for(let e=0;e<=n.length-1;e++)switch(e){case 0:m=n[e+1].x-n[e].x,g=n[e+1].y-n[e].y,t.x=+g,t.y=-m,t.z=0*g,f.copy(t),t.normalize(),l.push(t.x,t.y,t.z);break;case n.length-1:l.push(f.x,f.y,f.z);break;default:m=n[e+1].x-n[e].x,g=n[e+1].y-n[e].y,t.x=+g,t.y=-m,t.z=0*g,p.copy(t),t.x+=f.x,t.y+=f.y,t.z+=f.z,t.normalize(),l.push(t.x,t.y,t.z),f.copy(p)}for(let t=0;t<=r;t++){var v=e+t*u*i,A=Math.sin(v),_=Math.cos(v);for(let e=0;e<=n.length-1;e++){d.x=n[e].x*A,d.y=n[e].y,d.z=n[e].x*_,o.push(d.x,d.y,d.z),h.x=t/r,h.y=e/(n.length-1),s.push(h.x,h.y);var x=l[3*e+0]*A,y=l[3*e+1],b=l[3*e+0]*_;c.push(x,y,b)}}for(let t=0;t<r;t++)for(let e=0;e<n.length-1;e++){var M=e+t*n.length,C=M+n.length,S=M+n.length+1,w=M+1;a.push(M,C,w),a.push(S,w,C)}this.setIndex(a),this.setAttribute("position",new ei(o,3)),this.setAttribute("uv",new ei(s,2)),this.setAttribute("normal",new ei(c,3))}static fromJSON(e){return new vu(e.points,e.segments,e.phiStart,e.phiLength)}}class Au extends Ac{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Au(e.radius,e.detail)}}class _u extends ci{constructor(e=.5,t=1,n=8,r=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n);const o=[],s=[],l=[],c=[];let u=e;var d=(t-e)/(r=Math.max(1,r));const h=new wn,p=new Yt;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){var f=i+e/n*a;h.x=u*Math.cos(f),h.y=u*Math.sin(f),s.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,c.push(p.x,p.y)}u+=d}for(let e=0;e<r;e++){var m=e*(n+1);for(let e=0;e<n;e++){var g=e+m,v=g+n+1,A=g+n+2,_=g+1;o.push(g,v,_),o.push(v,A,_)}}this.setIndex(o),this.setAttribute("position",new ei(s,3)),this.setAttribute("normal",new ei(l,3)),this.setAttribute("uv",new ei(c,2))}static fromJSON(e){return new _u(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class xu extends ci{constructor(t=new Xc([new Yt(0,.5),new Yt(-.5,-.5),new Yt(.5,-.5)]),h=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:h};const p=[],f=[],m=[],g=[];let n=0,v=0;if(!1===Array.isArray(t))r(t);else for(let e=0;e<t.length;e++)r(t[e]),this.addGroup(n,v,e),n+=v,v=0;function r(e){var n=f.length/3,e=e.extractPoints(h);let r=e.shape;const i=e.holes;!1===du.isClockWise(r)&&(r=r.reverse());for(let e=0,t=i.length;e<t;e++){const d=i[e];!0===du.isClockWise(d)&&(i[e]=d.reverse())}var a=du.triangulateShape(r,i);for(let e=0,t=i.length;e<t;e++){var o=i[e];r=r.concat(o)}for(let e=0,t=r.length;e<t;e++){var s=r[e];f.push(s.x,s.y,0),m.push(0,0,1),g.push(s.x,s.y)}for(let e=0,t=a.length;e<t;e++){var l=a[e],c=l[0]+n,u=l[1]+n,l=l[2]+n;p.push(c,u,l),v+=3}}this.setIndex(p),this.setAttribute("position",new ei(f,3)),this.setAttribute("normal",new ei(m,3)),this.setAttribute("uv",new ei(g,2))}toJSON(){var e=super.toJSON();return function(n,r){if(r.shapes=[],Array.isArray(n))for(let e=0,t=n.length;e<t;e++){var i=n[e];r.shapes.push(i.uuid)}else r.shapes.push(n.uuid);return r}(this.parameters.shapes,e)}static fromJSON(n,r){const i=[];for(let e=0,t=n.shapes.length;e<t;e++){var a=r[n.shapes[e]];i.push(a)}return new xu(i,n.curveSegments)}}class yu extends ci{constructor(n=1,r=32,i=16,a=0,o=2*Math.PI,s=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:r,heightSegments:i,phiStart:a,phiLength:o,thetaStart:s,thetaLength:l},r=Math.max(3,Math.floor(r)),i=Math.max(2,Math.floor(i));var c=Math.min(s+l,Math.PI);let u=0;const d=[],h=new wn,p=new wn,f=[],m=[],g=[],v=[];for(let e=0;e<=i;e++){const C=[];var A=e/i;let t=0;0==e&&0==s?t=.5/r:e==i&&c==Math.PI&&(t=-.5/r);for(let e=0;e<=r;e++){var _=e/r;h.x=-n*Math.cos(a+_*o)*Math.sin(s+A*l),h.y=n*Math.cos(s+A*l),h.z=n*Math.sin(a+_*o)*Math.sin(s+A*l),m.push(h.x,h.y,h.z),p.copy(h).normalize(),g.push(p.x,p.y,p.z),v.push(_+t,1-A),C.push(u++)}d.push(C)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){var x=d[t][e+1],y=d[t][e],b=d[t+1][e],M=d[t+1][e+1];(0!==t||0<s)&&f.push(x,y,M),(t!==i-1||c<Math.PI)&&f.push(y,b,M)}this.setIndex(f),this.setAttribute("position",new ei(m,3)),this.setAttribute("normal",new ei(g,3)),this.setAttribute("uv",new ei(v,2))}static fromJSON(e){return new yu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class bu extends Ac{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bu(e.radius,e.detail)}}class Mu extends ci{constructor(n=1,r=.4,i=8,a=6,o=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:r,radialSegments:i,tubularSegments:a,arc:o},i=Math.floor(i),a=Math.floor(a);const s=[],l=[],c=[],u=[],d=new wn,h=new wn,p=new wn;for(let t=0;t<=i;t++)for(let e=0;e<=a;e++){var f=e/a*o,m=t/i*Math.PI*2;h.x=(n+r*Math.cos(m))*Math.cos(f),h.y=(n+r*Math.cos(m))*Math.sin(f),h.z=r*Math.sin(m),l.push(h.x,h.y,h.z),d.x=n*Math.cos(f),d.y=n*Math.sin(f),p.subVectors(h,d).normalize(),c.push(p.x,p.y,p.z),u.push(e/a),u.push(t/i)}for(let t=1;t<=i;t++)for(let e=1;e<=a;e++){var g=(a+1)*t+e-1,v=(a+1)*(t-1)+e-1,A=(a+1)*(t-1)+e,_=(a+1)*t+e;s.push(g,v,_),s.push(v,A,_)}this.setIndex(s),this.setAttribute("position",new ei(l,3)),this.setAttribute("normal",new ei(c,3)),this.setAttribute("uv",new ei(u,2))}static fromJSON(e){return new Mu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Cu extends ci{constructor(e=1,n=.4,r=64,i=8,a=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:a,q:o},r=Math.floor(r),i=Math.floor(i);const s=[],l=[],c=[],u=[],d=new wn,h=new wn;var p=new wn,f=new wn;const m=new wn,g=new wn,v=new wn;for(let t=0;t<=r;++t){var A=t/r*a*Math.PI*2;S(A,a,o,e,p),S(.01+A,a,o,e,f),g.subVectors(f,p),v.addVectors(f,p),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(let e=0;e<=i;++e){var _=e/i*Math.PI*2,x=-n*Math.cos(_),_=n*Math.sin(_);d.x=p.x+(x*v.x+_*m.x),d.y=p.y+(x*v.y+_*m.y),d.z=p.z+(x*v.z+_*m.z),l.push(d.x,d.y,d.z),h.subVectors(d,p).normalize(),c.push(h.x,h.y,h.z),u.push(t/r),u.push(e/i)}}for(let t=1;t<=r;t++)for(let e=1;e<=i;e++){var y=(i+1)*(t-1)+(e-1),b=(i+1)*t+(e-1),M=(i+1)*t+e,C=(i+1)*(t-1)+e;s.push(y,b,C),s.push(b,M,C)}function S(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e),t=n/t*e,e=Math.cos(t);i.x=r*(2+e)*.5*a,i.y=r*(2+e)*o*.5,i.z=r*Math.sin(t)*.5}this.setIndex(s),this.setAttribute("position",new ei(l,3)),this.setAttribute("normal",new ei(c,3)),this.setAttribute("uv",new ei(u,2))}static fromJSON(e){return new Cu(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Su extends ci{constructor(a=new kc(new wn(-1,-1,0),new wn(-1,1,0),new wn(1,1,0)),o=64,s=1,l=8,e=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:o,radius:s,radialSegments:l,closed:e};const c=a.computeFrenetFrames(o,e);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const u=new wn,d=new wn,n=new Yt;let h=new wn;const p=[],f=[],r=[],m=[];function t(e){h=a.getPointAt(e/o,h);var t=c.normals[e],n=c.binormals[e];for(let e=0;e<=l;e++){var r=e/l*Math.PI*2,i=Math.sin(r),r=-Math.cos(r);d.x=r*t.x+i*n.x,d.y=r*t.y+i*n.y,d.z=r*t.z+i*n.z,d.normalize(),f.push(d.x,d.y,d.z),u.x=h.x+s*d.x,u.y=h.y+s*d.y,u.z=h.z+s*d.z,p.push(u.x,u.y,u.z)}}!function(){for(let e=0;e<o;e++)t(e);t(!1===e?o:0),function(){for(let t=0;t<=o;t++)for(let e=0;e<=l;e++)n.x=t/o,n.y=e/l,r.push(n.x,n.y)}(),function(){for(let t=1;t<=o;t++)for(let e=1;e<=l;e++){var n=(l+1)*(t-1)+(e-1),r=(l+1)*t+(e-1),i=(l+1)*t+e,a=(l+1)*(t-1)+e;m.push(n,r,a),m.push(r,i,a)}}()}(),this.setIndex(m),this.setAttribute("position",new ei(p,3)),this.setAttribute("normal",new ei(f,3)),this.setAttribute("uv",new ei(r,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Su((new Wc[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class wu extends ci{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const d=[];var r=new Set;const h=new wn,p=new wn;if(null!==e.index){var i=e.attributes.position;const f=e.index;let n=e.groups;0===n.length&&(n=[{start:0,count:f.count,materialIndex:0}]);for(let e=0,t=n.length;e<t;++e){var a=n[e],o=a.start;for(let t=o,e=o+a.count;t<e;t+=3)for(let e=0;e<3;e++){var s=f.getX(t+e),l=f.getX(t+(e+1)%3);h.fromBufferAttribute(i,s),p.fromBufferAttribute(i,l),!0===Eu(h,p,r)&&(d.push(h.x,h.y,h.z),d.push(p.x,p.y,p.z))}}}else{var n=e.attributes.position;for(let t=0,e=n.count/3;t<e;t++)for(let e=0;e<3;e++){var c=3*t+e,u=3*t+(e+1)%3;h.fromBufferAttribute(n,c),p.fromBufferAttribute(n,u),!0===Eu(h,p,r)&&(d.push(h.x,h.y,h.z),d.push(p.x,p.y,p.z))}}this.setAttribute("position",new ei(d,3))}}}function Eu(e,t,n){var r=`${e.x},${e.y},${e.z}-${t.x},${t.y},`+t.z,e=`${t.x},${t.y},${t.z}-${e.x},${e.y},`+e.z;return!0!==n.has(r)&&!0!==n.has(e)&&(n.add(r,e),!0)}class Tu extends fu{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("v3d.TextGeometry: font parameter is not an instance of v3d.Font."),new ci;void 0===t.alignX&&(t.alignX="left"),void 0===t.alignY&&(t.alignY="topBaseline"),void 0===t.lineHeight&&(t.lineHeight=-1),void 0===t.scaledEmSize&&(t.scaledEmSize=!1);var r=n.generateShapes(e,t.size,t.alignX,t.alignY,t.lineHeight,t.scaledEmSize);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t),this.type="TextGeometry",this.parameters={text:e,parameters:t}}cloneWithText(e){var t=this.parameters.parameters;return new Tu(e,{font:t.font,size:t.size,height:t.height,curveSegments:t.curveSegments,bevelEnabled:t.bevelEnabled,bevelThickness:t.bevelThickness,bevelSize:t.bevelSize,alignX:t.alignX,alignY:t.alignY,lineHeight:t.lineHeight,scaledEmSize:t.scaledEmSize})}}class Iu extends Tu{constructor(e,t){super(e,t),function(e,t,n,r,i){e.computeBoundingBox();var a=r.split(/\r\n|\r|\n/).length,o=e.boundingBox.max.x-e.boundingBox.min.x,s=e.boundingBox.max.y-e.boundingBox.min.y,l=s/(a+a-1);let c,u;switch(t){case"left":c=0;break;case"center":c=-.5*o;break;case"right":c=-o;break;default:u=0}var d=l*Math.abs(i.data.descender)/i.data.ascender;switch(n){case"topBaseline":u=0;break;case"top":u=-l;break;case"center":u=1<a?.5*s-l:-.5*l+.5*d;break;case"bottom":u=s-l+d;break;case"bottomBaseline":u=1<a?s-l-d:0;break;default:u=0}(0<Math.abs(c)||0<Math.abs(u))&&e.translate(c,u,0)}(this,t.alignX||"left",t.alignY||"bottom",e,t.font),this.type="BlenderTextGeometry"}cloneWithText(e){var t=this.parameters.parameters;return new Iu(e,{font:t.font,size:t.size,height:t.height,curveSegments:t.curveSegments,bevelEnabled:t.bevelEnabled,bevelThickness:t.bevelThickness,bevelSize:t.bevelSize,alignX:t.alignX,alignY:t.alignY})}}class Ru extends ci{constructor(e=50,n=10,t=!0,i=!0,a=!0,o=!0,s=!0){var l=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],c=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),n=Math.max(2,Math.floor(n));var u=3.15*(s?1:1.3)/2,d=e/u,e=t?(8*n-4)*n:0;e+=i?(16*n-4)*n:0,e+=a?40*n*n:0;const h=new Uint32Array(3*e);e=t?4:0;e+=i?8:0,e+=a?20:0,e*=(n+1)*(n+1);const p=new Float32Array(3*e),f=new Float32Array(3*e),m=new Float32Array(2*e),g=new rr;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);const v=[],A=[],_=[],x=[],y=[],b=[],M=[],C=[],S=[],w=new wn;let E,T,I,R,L=0,B=0;const P=new wn,D=new rr,N=new rr,F=new yn,O=new yn,U=new yn,z=new yn,V=new wn,G=new wn,k=g.clone();k.transpose();var Q=(e,t,n)=>!(p[3*e]===p[3*t]&&p[3*e+1]===p[3*t+1]&&p[3*e+2]===p[3*t+2]||p[3*e]===p[3*n]&&p[3*e+1]===p[3*n+1]&&p[3*e+2]===p[3*n+2]||p[3*t]===p[3*n]&&p[3*t+1]===p[3*n+1]&&p[3*t+2]===p[3*n+2]);for(let e=0;e<3;e++)b[e]=new rr;var W=t?32:28,H=n+1;let Y=0,X=0,j=0,K=0,q=0;for(let r=a?0:20;r<W;r++)if(i||r<20||28<=r){for(let n=0;n<3;n++){for(let t=0;t<4;t++)for(let e=0;e<4;e++)v[4*e+t]=c[3*l[16*r+4*t+e]+n],o&&20<=r&&r<28&&2!==n&&(v[4*e+t]*=1.077),s||2!==n||(v[4*e+t]*=1.3);D.set(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15]),N.multiplyMatrices(D,g),b[n].multiplyMatrices(k,N)}for(let e=0;e<=n;e++){var Z=e/n;for(let e=0;e<=n;e++){var J=e/n;for(R=4,T=I=1;R--;)A[R]=T,_[R]=I,T*=Z,I*=J,3===R?(x[R]=y[R]=0,L=B=1):(x[R]=L*(3-R),y[R]=B*(3-R),L*=Z,B*=J);F.fromArray(A),O.fromArray(_),U.fromArray(x),z.fromArray(y);for(let e=0;e<3;e++)E=F.clone(),E.applyMatrix4(b[e]),M[e]=E.dot(O),E=U.clone(),E.applyMatrix4(b[e]),C[e]=E.dot(O),E=F.clone(),E.applyMatrix4(b[e]),S[e]=E.dot(z);V.fromArray(C),G.fromArray(S),w.crossVectors(G,V),w.normalize(),0===M[0]&&0===M[1]?P.set(0,M[2]>u?1:-1,0):P.set(w.x,w.z,-w.y),p[X++]=d*M[0],p[X++]=d*(M[2]-u),p[X++]=-d*M[1],f[j++]=P.x,f[j++]=P.y,f[j++]=P.z,m[K++]=1-J,m[K++]=1-Z}}for(let t=0;t<n;t++)for(let e=0;e<n;e++){var $=Y*H*H+t*H+e,ee=$+1,te=ee+H,ne=$+H;Q($,ee,te)&&(h[q++]=$,h[q++]=ee,h[q++]=te),Q($,te,ne)&&(h[q++]=$,h[q++]=te,h[q++]=ne)}Y++}this.setIndex(new Hr(h,1)),this.setAttribute("position",new Hr(p,3)),this.setAttribute("normal",new Hr(f,3)),this.setAttribute("uv",new Hr(m,2)),this.computeBoundingSphere()}}var Lu=Object.freeze({__proto__:null,BoxGeometry:Ii,BoxBufferGeometry:Ii,CircleGeometry:mc,CircleBufferGeometry:mc,ConeGeometry:vc,ConeBufferGeometry:vc,CylinderGeometry:gc,CylinderBufferGeometry:gc,DodecahedronGeometry:_c,DodecahedronBufferGeometry:_c,EdgesGeometry:Cc,ExtrudeGeometry:fu,ExtrudeBufferGeometry:fu,IcosahedronGeometry:gu,IcosahedronBufferGeometry:gu,LatheGeometry:vu,LatheBufferGeometry:vu,OctahedronGeometry:Au,OctahedronBufferGeometry:Au,PlaneGeometry:ji,PlaneBufferGeometry:ji,PolyhedronGeometry:Ac,PolyhedronBufferGeometry:Ac,RingGeometry:_u,RingBufferGeometry:_u,ShapeGeometry:xu,ShapeBufferGeometry:xu,SphereGeometry:yu,SphereBufferGeometry:yu,TetrahedronGeometry:bu,TetrahedronBufferGeometry:bu,TorusGeometry:Mu,TorusBufferGeometry:Mu,TorusKnotGeometry:Cu,TorusKnotBufferGeometry:Cu,TubeGeometry:Su,TubeBufferGeometry:Su,WireframeGeometry:wu,BlenderTextGeometry:Iu,BlenderTextBufferGeometry:Iu,TeapotGeometry:Ru,TeapotBufferGeometry:Ru,TextGeometry:Tu,TextBufferGeometry:Tu});class Bu extends Gr{constructor(e){super(),this.type="ShadowMaterial",this.color=new mn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Bu.prototype.isShadowMaterial=!0;class Pu extends Gr{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new mn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.envMapParallaxType=0,this.envMapParallaxMatrix=new rr,this.envMapParallaxMatrixInv=new rr,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.envMapParallaxType=e.envMapParallaxType,this.envMapParallaxMatrix.copy(e.envMapParallaxMatrix),this.envMapParallaxMatrixInv.copy(e.envMapParallaxMatrixInv),this}}Pu.prototype.isMeshStandardMaterial=!0;class Du extends Pu{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Yt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Rt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new mn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new mn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new mn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){0<this._sheen!=0<e&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){0<this._clearcoat!=0<e&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){0<this._transmission!=0<e&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}Du.prototype.isMeshPhysicalMaterial=!0;class Nu extends Gr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new mn(16777215),this.specular=new mn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Nu.prototype.isMeshPhongMaterial=!0;class Fu extends Gr{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new mn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Fu.prototype.isMeshToonMaterial=!0;class Ou extends Gr{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Ou.prototype.isMeshNormalMaterial=!0;class Uu extends Gr{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new mn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Uu.prototype.isMeshLambertMaterial=!0;class zu extends Gr{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new mn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}class Vu extends Xl{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Vu.prototype.isLineDashedMaterial=zu.prototype.isMeshMatcapMaterial=!0;class Gu extends Gr{constructor(e){super(),this.type="MeshMaskMaterial",this.side=Oe,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.cameraNearFar=null,this.depthTexture=null,this.textureMatrix=null,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,e.cameraNearFar&&(this.cameraNearFar=e.cameraNearFar.clone()),e.textureMatrix&&(this.textureMatrix=e.textureMatrix.clone()),e.depthTexture&&(this.depthTexture=e.depthTexture),this}}Gu.prototype.isMeshMaskMaterial=!0;class ku{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){var n=this.parameterPositions;let r=this._cachedIndex,i=n[r],a=n[r-1];e:{t:{let e;n:{r:if(!(t<i)){for(var o=r+2;;){if(void 0===i){if(t<a)break r;return r=n.length,this._cachedIndex=r,this.afterEnd_(r-1,t,a)}if(r===o)break;if(a=i,i=n[++r],t<i)break t}e=n.length;break n}if(t>=a)break e;var s=n[1];t<s&&(r=2,a=s);for(var l=r-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(r===l)break;if(i=a,a=n[--r-1],t>=a)break t}e=r,r=0}for(;r<e;){var c=r+e>>>1;t<n[c]?e=c:r=1+c}if(i=n[r],a=n[r-1],void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return r=n.length,this._cachedIndex=r,this.afterEnd_(r-1,a,t)}this._cachedIndex=r,this.intervalChanged_(r,a,i)}return this.interpolate_(r,a,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}ku.prototype.beforeStart_=ku.prototype.copySampleValue_,ku.prototype.afterEnd_=ku.prototype.copySampleValue_;class Qu extends ku{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}var Wu={};!function(l){l.less=function(e,t,n){return n(e,t)<0},l.exchange=function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r};l.StackNode=function(e){this.value=e,this.next=null};var e=function(){this.N=0,this.first=null};e.prototype.push=function(e){this.first=this._push(this.first,e)},e.prototype._push=function(e,t){if(null==e)return this.N++,new l.StackNode(t);var n=e;return this.N++,(e=new l.StackNode(t)).next=n,e},e.prototype.pop=function(){if(null!=this.first){var e=this.first,t=e.value;return this.first=e.next,this.N--,t}},e.prototype.size=function(){return this.N},e.prototype.isEmpty=function(){return 0==this.N},e.prototype.peep=function(){if(null!=this.first)return this.first.value},e.prototype.toArray=function(){for(var e=[],t=this.first;null!=t;)e.push(t.value),t=t.next;return e},l.Stack=e;l.QueueNode=function(e){this.value=e,this.next=null};e=function(){this.first=null,this.last=null,this.N=0};e.prototype.enqueue=function(e){var t=this.last;this.last=new l.QueueNode(e),null!=t&&(t.next=this.last),null==this.first&&(this.first=this.last),this.N++},e.prototype.dequeue=function(){if(null!=this.first){var e=this.first,t=e.value;return this.first=e.next,null==this.first&&(this.last=null),this.N--,t}},e.prototype.size=function(){return this.N},e.prototype.isEmpty=function(){return 0==this.N},e.prototype.toArray=function(){for(var e=[],t=this.first;null!=t;)e.push(t.value),t=t.next;return e},l.Queue=e;l.LinkMapNode=function(e){this.value=e,this.prev=null,this.next=null};e=function(){this.first=null,this.last=null,this.map={}};e.prototype.push=function(e,t){this.map[t]=e,null===this.first?this.first=e:(this.last.next=e).prev=this.last,this.last=e},e.prototype.removeNodeByKey=function(e){var t=this.map[e],n=t.prev,t=t.next;null!==n&&null!==t?(n.next=t).prev=n:null===n&&null!==t?(this.first=t).prev=null:null!==n&&null===t?(this.last=n).next=null:(this.first=null,this.last=null),delete this.map[e]},l.LinkMap=e;e=function(e){this.V=e,this.adjList=[],this.nodeInfo=[],this.edges={};for(var t=0;t<e;++t)this.adjList.push([]),this.nodeInfo.push({})};e.prototype.addNewEdge=function(e,t){this.adjList[e].push(t),this.adjList[t].push(e);var n=t<e?t+"_"+e:e+"_"+t;this.edges[n]=new l.Edge(e,t,0)},e.prototype.adj=function(e){return this.adjList[e]},e.prototype.node=function(e){return this.nodeInfo[e]},e.prototype.len=function(){return this.V},e.prototype.edge=function(e,t){t=t<e?t+"_"+e:e+"_"+t;return t in this.edges?this.edges[t]:null},l.Graph=e;function u(e){this.V=e,this.adjList=[],this.nodeInfo=[],this.edges={};for(var t=0;t<e;++t)this.adjList.push([]),this.nodeInfo.push({})}u.prototype.removeAll=function(){this.V=0,this.adjList=[],this.nodeInfo=[],this.edges={}},u.prototype.addNode=function(e){e=e||{},this.V++,this.adjList.push([]),this.nodeInfo.push(e)},u.prototype.addNewEdge=function(e,t){this.adjList[e].push(t);var n=e+"_"+t,t=new l.Edge(e,t,0);return this.edges[n]=t},u.prototype.addEdge=function(e){var t=e.v,n=e.w;this.adjList[t].push(n),this.edges[t+"_"+n]=e},u.prototype.removeEdge=function(e,t){for(var n=this.adjList[e],r=0;r<n.length;r++)n[r]==t&&(n.splice(r,1),r--);e=e+"_"+t;e in this.edges&&delete this.edges[e]},u.prototype.edge=function(e,t){t=e+"_"+t;return t in this.edges?this.edges[t]:null},u.prototype.adj=function(e){return this.adjList[e]},u.prototype.node=function(e){return this.nodeInfo[e]},u.prototype.nodeIndex=function(e){for(var t=0;t<this.V;++t)if(this.nodeInfo[t]==e)return t;return-1},u.prototype.reverse=function(){for(var e=new u(this.V),t=0;t<this.V;++t)for(var n=this.adjList[t],r=0;r<n.length;++r){var i=n[r];e.addNewEdge(i,t)}return e},u.prototype.len=function(){return this.V},u.prototype.findInEdges=function(e){for(var t=[],n=0;n<this.V;n++)for(var r=this.adjList[n],i=0;i<r.length;i++)r[i]==e&&t.push(this.edge(n,e));return t},u.prototype.findOutEdges=function(e){for(var t=[],n=this.adjList[e],r=0;r<n.length;r++)t.push(this.edge(e,n[r]));return t},u.prototype.disconnect=function(e,t){this.adjList[e].splice(0);for(var n=0;n<this.V;n++){for(var r=this.adjList[n],i=0;i<r.length;i++)r[i]==e&&(r.splice(i,1),i--);var a=n+"_"+e;a in this.edges&&delete this.edges[a],(a=e+"_"+n)in this.edges&&delete this.edges[a]}if(t){for(var o=new u(this.V-1),n=0;n<this.V;n++)if(n!=e)for(r=this.adjList[n],i=0;i<r.length;i++){var s=r[i],l=e<n?n-1:n,c=e<s?s-1:s,s=this.edge(n,s).copy();s.v=l,s.w=c,o.addEdge(s)}this.V--,this.adjList=o.adjList,this.nodeInfo.splice(e,1),this.edges=o.edges}},u.prototype.insert=function(e,t,n){for(var r=this.V,i=e.V,a=0;a<i;a++){this.adjList.push([]),this.nodeInfo.push(function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}(e.nodeInfo[a]));for(var o=e.adjList[a],s=0;s<o.length;s++){var l=o[s];(c=e.edge(a,l).copy()).v+=r,c.w+=r,this.addEdge(c)}}this.V+=i;for(s=0;s<t.length;s++)(c=t[s].copy()).w+=r,this.addEdge(c);for(var c,s=0;s<n.length;s++)(c=n[s].copy()).v+=r,this.addEdge(c)},u.prototype.vis=function(e){e=e||function(e,t){return String(e)};for(var t="digraph G {",n=0;n<this.V;n++){t+=n+' [label="'+e(n,this.nodeInfo[n])+'"];';for(var r=this.adjList[n],i=0;i<r.length;i++)t+=n+" -> "+r[i]+";"}t+="}",console.log(t)},l.DiGraph=u;function n(e,t,n){this.v=e,this.w=t,this.weight=n}n.prototype.either=function(){return this.v},n.prototype.other=function(e){return e==this.v?this.w:this.v},n.prototype.from=function(){return this.v},n.prototype.to=function(){return this.w},n.prototype.copy=function(){var e,t=new n(0,0,0);for(e in this)this.hasOwnProperty(e)&&(t[e]=this[e]);return t},l.Edge=n;e=function(e,t){this.s=t;var n=e.V;this.marked=[],this.edgeTo=[];for(var r=0;r<n;++r)this.marked.push(!1),this.edgeTo.push(-1);this.dfs(e,t)};e.prototype.dfs=function(e,t){this.marked[t]=!0;for(var n=e.adj(t),r=0;r<n.length;++r){var i=n[r];this.marked[i]||(this.edgeTo[i]=t,this.dfs(e,i))}},e.prototype.hasPathTo=function(e){return this.marked[e]},e.prototype.pathTo=function(e){var t=new l.Stack;if(e==this.s)return[e];for(var n=e;n!=this.s;n=this.edgeTo[n])t.push(n);return t.push(this.s),t.toArray()},l.DepthFirstSearch=e;e=function(e,t){var n=e.V;this.s=t;var r=new l.Queue;r.enqueue(t),this.marked=[],this.edgeTo=[];for(var i=0;i<n;++i)this.marked.push(!1),this.edgeTo.push(-1);for(;!r.isEmpty();){i=r.dequeue();this.marked[i]=!0;for(var a=e.adj(i),o=0;o<a.length;++o){var s=a[o];this.marked[s]||(this.edgeTo[s]=i,r.enqueue(s))}}};e.prototype.hasPathTo=function(e){return this.marked[e]},e.prototype.pathTo=function(e){var t=new l.Stack;if(e==this.s)return[e];for(var n=e;n!=this.s;n=this.edgeTo[n])t.push(n);return t.push(this.s),t.toArray()},l.BreadthFirstSearch=e;e=function(e){this.postOrder=new l.Stack,this.marked=[];for(var t=e.V,n=0;n<t;++n)this.marked.push(!1);for(n=0;n<t;++n)this.marked[n]||this.dfs(e,n)};e.prototype.dfs=function(e,t){this.marked[t]=!0;for(var n=e.adj(t),r=0;r<n.length;++r){var i=n[r];this.marked[i]||this.dfs(e,i)}this.postOrder.push(t)},e.prototype.order=function(){return this.postOrder.toArray()},l.TopologicalSort=e}(Wu);var Hu=[[-1.117001,-.1867262,-11.13505,12.59865,-.03937339,1.167571,.007100686,3.592678,.6083296,-1.152006,-.1926669,6.152049,-4.770802,-.08704701,.7483626,.03372718,4.464592,.4036546,-1.072371,-.2696632,.2816168,1.820571,-.3742666,2.080607,-.07675295,-2.835366,1.129329,-1.109935,-.1532764,1.198787,-.9015183,.005173015,.5749178,.1075633,4.387949,.2650413,-1.052297,-.2229452,1.952347,.5727205,-4.88507,1.984016,-.1106197,-.4898361,.8907873,-1.070108,-.1600465,1.593886,-4479251e-11,-3.306541,.9390193,.09513168,2.343583,.5335404,-1.113253,-.16996,-10.38822,11.37513,-.04040911,1.037455,.04991792,4.801919,.630271,-1.135747,-.1678594,4.970755,-4.43023,-.06657408,.3636161,.1558009,6.01337,.3959601,-1.095892,-.2732595,.7666496,1.350731,-.4401401,2.470135,-.1707929,-3.260793,1.170337,-1.073668,-.02603929,-.1944589,.4575207,.6878164,-.139077,.3690299,7.885781,.1877694,-1.070091,-.2798957,2.338478,-2.647221,-7.387808,2.32921,-.1644639,-2.00371,.9874527,-1.06712,-.1418866,1.25409,6.053048,-2.918892,.5322812,.1613053,3.018161,.527409,-1.129483,-.1890619,-9.065101,9.659923,-.03607819,.8314359,.08181661,4.768868,.6339777,-1.14642,-.1883579,3.309173,-3.127882,-.06938176,.3987113,.1400581,6.283042,.5267076,-1.128348,-.2641305,1.223176,.05514952,-.3490649,1.997784,-.04123709,-2.251251,.9483466,-1.02582,.0140469,-1.187406,2.7299,.5877588,-.276114,.4602633,8.305125,.3945001,-1.083957,-.2606679,2.207108,-7.202803,-5.968103,2.129455,-.07789512,-1.137688,.8871769,-1.062465,-.1512189,1.042881,14.27839,-4.242214,.40381,.199778,2.814449,.5803196,-1.175099,-.2410789,-11.08587,11.33404,-.018193,.6772942,.09605043,4.231166,.6239972,-1.224207,-.2883527,3.002206,-2.649612,-.04795418,.4984398,.03251434,4.851611,.6551019,-1.136955,-.2423048,1.058823,-.2489236,-.2462179,1.93314,.09106828,-.1905869,.8171065,-1.014535,-.0082625,-1.448017,2.295788,.3510334,-1.477418,.5432449,5.762796,.4908751,-1.070666,-.237978,1.844589,-5.442448,-4.012768,2.945275,.009854725,.08455959,.814503,-1.071525,-.1777132,.807659,9.925865,-3.324623,-.6367437,.2844581,2.248384,.6544022,-1.218818,-.2952382,-13.45975,13.47153,-.006814585,.5079068,.119723,3.776949,.5836961,-1.409868,-.511433,2.776539,-2.039001,-.02673769,.4145288,.0007829342,2.275883,.6629691,-1.069151,-.09434247,.7293972,-1.222473,-.1533461,2.160357,.04626837,3.852415,.859357,-1.021306,-.1149551,-1.108414,4.178343,.4013665,-2.222814,.6929462,1.392652,.4401662,-1.074251,-.2224002,1.372356,-8.858704,-3.92266,3.020018,-.01458724,1.511186,.8288064,-1.062048,-.1526582,.4921067,14.85522,-3.229936,-.8426604,.3916243,2.678994,.6689264,-1.257023,-.33647,-15.27795,15.04223,.002717715,.302991,.1636851,3.561663,.5283161,-1.635124,-.7329993,3.523939,-2.566337,-.01902543,.5505483,-.06242176,1.065992,.6654236,-.9295823,.04845834,-.299299,-.2001327,-.08019339,1.807806,.09020277,5.095372,.8639936,-1.09374,-.2148608,-.521624,2.119777,.09506454,-1.831439,.6961204,.1102084,.4384319,-1.044181,-.1849257,.9071246,-4.648901,-2.279385,2.356502,-.04169147,1.932557,.829655,-1.061451,-.1458745,.2952267,8.967214,-3.726228,-.5022316,.5684877,3.102347,.6658443,-1.332391,-.4127769,-9.328643,9.046194,.003457775,.3377425,.1530909,3.301209,.4997917,-1.932002,-.9947777,-2.042329,3.58694,-.05642182,.8130478,-.08195988,.1118294,.5617231,-.8707374,.1286999,1.820054,-4.674706,.003317471,.5919018,.1975278,6.686519,.9631727,-1.070378,-.3030579,-.9041938,6.200201,.1232207,-.3650628,.5029403,-2.903162,.3811408,-1.063035,-.1637545,.5853072,-7.889906,-1.200641,1.035018,.1192093,3.267054,.8416151,-1.053655,-.1562286,.2423683,11.28575,-4.363262,-.0731416,.5642088,2.514023,.6670457,-1.366112,-.4718287,-7.876222,7.7469,-.009182309,.4716076,.08320252,3.165603,.5392334,-2.468204,-1.33634,-5.386723,7.072672,-.08329266,.8636876,-.01978177,-.1326218,.2979222,-.9653522,-.02373416,1.81025,-6.467262,.1410706,-.4753717,.3003095,6.551163,1.151083,-.8943186,-.2487152,-.230896,8.512648,.1298402,1.034705,.2303509,-3.924095,.2982717,-1.146999,-.2318784,.08992419,-9.933614,-.886092,-.03071656,.2852012,3.046199,.8599001,-1.032399,-.1645145,.2683599,13.27701,-4.40767,.07709869,.4951727,1.957277,.6630943,-1.46907,-.6135092,-6.506263,6.661315,-.03835383,.7150413,.007784318,2.820577,.6756784,-2.501583,-1.247404,-15.23462,16.33191,-.01204803,.5896471,-.02002023,1.144647,.06177874,-2.438672,-1.127291,5.731172,-10.2135,.0616561,-.7752641,.4708254,4.176847,1.200881,-.1513427,.09792731,-1.612349,9.814289,.05188921,1.716403,-.07039255,-2.815115,.3291874,-1.318511,-.3650554,.4221268,-9.294529,-.0439752,-.8100625,.3742719,1.834166,.822345,-1.016009,-.1820264,.1278426,11.82696,-4.801528,.4947899,.4660378,1.601254,.6702359,-1.84131,-.9781779,-4.610903,4.824662,-.05100806,.6463776,-6377724e-12,2.216875,.861853,-2.376373,-1.108657,-14.89799,15.46458,.04091025,.0976178,-.01048958,2.165834,-.1609171,-4.710318,-2.261963,6.947327,-10.34828,-.1325542,.7508674,.2247553,2.873142,1.2971,.216375,-.1944345,-2.43786,10.11314,.44505,.3111492,.2751323,-1.627906,.2531213,-1.258794,-.3524641,.8425444,-10.85313,-1.154381,-.4638014,-.002781115,.4344498,.8507091,-1.018938,-.1804153,-.06354054,15.7315,-4.386999,.6211115,.5294648,1.580749,.6586655,-1.116416,-.1917524,-10.68233,12.22221,-.03668978,1.054022,.01592132,3.180583,.562737,-1.132341,-.1671286,5.976499,-4.227366,-.09542489,.8664938,.008351793,4.876068,.4492779,-1.087635,-.3173679,.4314407,1.100555,-.4410057,1.677253,-.03005925,-4.201249,1.070902,-1.083031,-.08847705,1.291773,.4546776,.3091894,.726176,.04203659,5.990615,.3704756,-1.057899,-.2246706,2.329563,-1.219656,-5.33526,.8545378,-.03906209,-.9025499,.7797348,-1.073305,-.1522553,1.767063,1.90428,-3.101673,.3995856,.02905192,2.563977,.5753067,-1.113674,-.1759694,-9.754125,10.87391,-.03841093,.9524272,.05680219,4.227034,.6029571,-1.126496,-.1680281,5.332352,-4.575579,-.06761755,.3295335,.1194896,5.570901,.4536185,-1.103074,-.2681801,.06571479,2.396522,-.455128,2.466331,-.1232022,-3.023201,1.086379,-1.053299,-.02697173,.8379121,-.9681458,.5890692,-.4872027,.2936929,7.510139,.3079122,-1.079553,-.2710448,2.462379,-.3713554,-8.534512,1.828242,-.1686398,-1.96134,.8941077,-1.069741,-.1396394,1.657868,3.236313,-2.706344,-.2948122,.1314816,2.868457,.5413403,-1.131649,-.1954455,-7.751595,8.685861,-.04910871,.8992952,.04710143,4.254818,.6821116,-1.156689,-.1884324,3.163519,-3.091522,-.06613927,-.02575883,.1640065,6.073643,.4453468,-1.079224,-.2621389,.9446437,1.448479,-.3969384,2.626638,-.08101186,-3.016355,1.076295,-1.080832,.01033057,-.3500156,-.03281419,.5655512,-1.156742,.453471,8.774122,.2772869,-1.051202,-.2679975,2.719109,-2.190316,-6.878798,2.250481,-.2030252,-2.026527,.9701096,-1.089849,-.1598589,1.564748,6.869187,-3.05367,-.6110435,.1644472,2.370452,.551177,-1.171419,-.2429746,-8.991334,9.571216,-.02772861,.6688262,.07683478,3.785611,.6347635,-1.228554,-.2917562,2.753986,-2.49178,-.04663434,.3118303,.07546506,4.463096,.5955071,-1.093124,-.2447767,.9097406,.5448296,-.2957824,2.024167,-.0005152333,-1.069081,.9369565,-1.056994,.01569507,-.8217491,1.870818,.706193,-1.483928,.5978206,6.864902,.3673332,-1.054871,-.2758129,2.712807,-5.95011,-6.554039,2.447523,-.1895171,-1.454292,.9131738,-1.100218,-.1746241,1.438505,11.15481,-3.266076,-.8837357,.19701,1.991595,.5907821,-1.207267,-.291361,-11.03767,11.40724,-.014168,.5564047,.08476262,3.371255,.6221335,-1.429698,-.5374218,2.837524,-2.221936,-.02422337,.09313758,.0719025,1.869022,.5609035,-1.002274,-.0697281,.4031308,-.3932997,-.1521923,2.390646,-.0689399,2.999661,1.017843,-1.081168,-.1178666,-.496808,3.919299,.6046866,-2.440615,.7891538,2.140835,.274047,-1.050727,-.2307688,2.276396,-9.454407,-5.505176,2.99262,-.2450942,.6078372,.9606765,-1.103752,-.1810202,1.375044,15.89095,-3.438954,-1.265669,.2475172,1.680768,.5978056,-1.244324,-.3378542,-11.11001,11.37784,-.007896794,.4808023,.09249904,3.025816,.5880239,-1.593165,-.7027621,2.220896,-1.437709,-.01534738,.06286958,.06644555,1.091727,.547008,-.9136506,.01344874,.7772636,-1.209396,-.1408978,2.433718,-.1041938,3.791244,1.037916,-1.134968,-.1803315,-.9267335,4.57667,.6851928,-2.805,.8687208,1.161483,.2571688,-1.017037,-.2053943,2.36164,-9.887818,-5.122889,3.287088,-.2594102,.8578927,.959234,-1.118723,-.1934942,1.226023,16.7414,-3.277335,-1.629809,.2765232,1.637713,.6113963,-1.314779,-.4119915,-12.4115,12.41578,.002344284,.2980837,.1414613,2.781731,.4998556,-1.926199,-1.020038,2.5692,-1.081159,-.02266833,.3588668,.008750078,-.2452171,.4796758,-.7780002,.1850647,.04445456,-2.409297,-.07816346,1.54679,-.02807227,5.998176,1.132396,-1.179326,-.357833,-.2392933,6.467883,.5904596,-1.869975,.8045839,-2.498121,.1610633,-1.009956,-.1311896,1.726577,-12.19356,-3.466239,2.343602,-.2252205,2.573681,1.027109,-1.11246,-.2063093,1.233051,20.58946,-4.578074,-1.145643,.3160192,1.420159,.5860212,-1.371689,-.4914196,-10.7661,11.07405,-.01485077,.5936218,.03685482,2.599968,.6002204,-2.436997,-1.377939,.02130141,1.079593,-.01796232,-.03933248,.1610711,-.6901181,.1206416,-.8743368,.0733137,.8734259,-3.743126,-.03151167,1.297596,-.07634926,6.532873,1.435737,-.9810197,-.3521634,-.2855205,7.134674,.6839748,-1.394841,.6952036,-4.633104,-.02173401,-1.122958,-.1691536,1.38236,-11.02913,-2.608171,1.865111,-.1345154,3.112342,1.094134,-1.075586,-.2077415,1.171477,17.9327,-4.656858,-1.036839,.3338295,1.042793,.5739374,-1.465871,-.6364486,-8.833718,9.34365,-.032236,.7552848,-3121341e-12,2.249164,.8094662,-2.448924,-1.270878,-4.823703,5.853058,-.02149127,.03581132,-.001230276,.4892553,-.1597657,-2.419809,-1.071337,1.575648,-4.98358,.009545185,.5032615,.4186266,4.634147,1.433517,-.1383278,-.02797095,-.1943067,6.679623,.411828,-.2744289,-.02118722,-4.337025,.1505072,-1.341872,-.2518572,1.027009,-6.527103,-1.081271,1.015465,.2845789,2.470371,.927812,-1.04064,-.2367454,1.100744,8.827253,-4.560794,-.7287017,.2842503,.6336593,.6327335,-1.877993,-1.025135,-4.311037,4.715016,-.04711631,.6335844,-7665398e-12,1.788017,.9001409,-2.28154,-1.137668,-10.36869,11.36254,.01961739,-.09836174,-.006734567,1.320918,-.2400807,-4.904054,-2.315781,5.735999,-8.626257,-.1255643,1.545446,.139686,2.972897,1.429934,.4077067,-.1833688,-2.450939,9.119433,.4505361,-1.340828,.397369,-1.78537,.09628711,-1.296052,-.3250526,1.813294,-10.31485,-1.38869,1.239733,-.08989196,-.3389637,.963956,-1.062181,-.2423444,.7577592,15.66938,-4.462264,-.574281,.3262259,.9461672,.6232887],[-1.127942,-.1905548,-12.52356,13.75799,-.03624732,1.055453,.01385036,4.17697,.5928345,-1.15526,-.1778135,6.216056,-5.254116,-.08787445,.8434621,.04025734,6.195322,.3111856,-1.125624,-.3217593,.5043919,1.686284,-.3536071,1.476321,-.07899019,-4.522531,1.271691,-1.081801,-.1033234,.999555,.007482946,-.06776018,1.463141,.09492021,5.612723,.1298846,-1.07532,-.2402711,2.141284,-1.203359,-4.945188,1.437221,-.0809675,-1.028378,1.004164,-1.073337,-.1516517,1.639379,2.304669,-3.214244,1.286245,.05613957,2.480902,.4999363,-1.128399,-.1857793,-10.89863,11.72984,-.03768099,.9439285,.04869335,4.845114,.6119211,-1.114002,-.139928,4.9638,-4.6855,-.07780879,.4049736,.1586297,7.770264,.3449006,-1.185472,-.3403543,.6588322,1.133713,-.4118674,2.061191,-.1882768,-4.372586,1.22353,-1.002272,.02000703,.07073269,1.485075,.5005589,.4301494,.3626541,7.921098,.1574766,-1.121006,-.3007777,2.242051,-4.571561,-7.761071,2.053404,-.1524018,-1.886162,1.018208,-1.058864,-.1358673,1.389667,8.633409,-3.437249,.7295429,.15147,2.842513,.5014325,-1.144464,-.2043799,-10.20188,10.71247,-.03256693,.7860205,.06872719,4.824771,.6259836,-1.170104,-.2118626,4.391405,-4.1989,-.07111559,.3890442,.1024831,6.282535,.5365688,-1.129171,-.255288,.2238298,.7314295,-.356273,1.881931,-.03078716,-1.03912,.9096301,-1.042294,.004450203,-.5116033,2.627589,.6098996,-.1264638,.4325281,7.080503,.4583646,-1.082293,-.2723056,2.065076,-8.143133,-7.892212,2.142231,-.0710624,-1.122398,.8338505,-1.071715,-.1426568,1.095351,17.29783,-3.851931,.4360514,.211444,2.970832,.5944389,-1.195909,-.2590449,-11.91037,12.07947,-.01589842,.6297846,.09054772,4.285959,.5933752,-1.245763,-.3316637,4.29366,-3.694011,-.04699947,.4843684,.02130425,4.097549,.6530809,-1.148742,-.1902509,-.2393233,-.2441254,-.2610918,1.846988,.03532866,2.660106,.8358294,-1.01608,-.0744496,-.5053436,4.388855,.6054987,-1.2083,.5817215,2.54357,.4726568,-1.072027,-.210144,1.518378,-10.60119,-6.016546,2.649475,-.05166992,1.571269,.8344622,-1.072365,-.1511201,.747801,19.00732,-3.950387,-.3473907,.3797211,2.782949,.6296808,-1.239423,-.3136289,-13.511,13.49468,-.007070423,.5012315,.1106008,3.803619,.5577948,-1.452524,-.5676944,2.993153,-2.277288,-.02168954,.305672,.01152338,1.852697,.6427228,-1.061421,-.04590521,.6057022,-1.096835,-.1504952,2.344921,-.05491832,5.268322,.9082253,-1.042373,-.1769498,-1.075388,3.831712,.315414,-2.416458,.7909032,-.01492892,.3854049,-1.064159,-.1892684,1.438685,-8.166362,-3.616364,3.275206,-.1203825,2.039491,.8688057,-1.07012,-.1569508,.412476,13.99683,-3.547085,-1.046326,.4973825,2.791231,.6503286,-1.283579,-.3609518,-13.35397,13.15248,-.0004431938,.3769526,.1429824,3.573613,.4998696,-1.657952,-.7627948,1.958222,-.7949816,-.02882837,.5356149,-.05191946,.8869955,.626332,-.95276,.06494189,.5361303,-2.12959,-.0925863,1.604776,.0506777,6.376055,.9138052,-1.080827,-.252312,-.7154262,4.120085,.1878228,-1.492158,.6881655,-1.446611,.4040631,-1.054075,-.1665498,.9191052,-6.636943,-1.894826,2.10781,-.03680499,2.655452,.841384,-1.061127,-.1448849,.2667493,10.34103,-4.285769,-.3874504,.5998752,3.132426,.6652753,-1.347345,-.4287832,-9.305553,9.133813,-.003173527,.3977564,.115142,3.320564,.4998134,-1.927296,-.9901372,-2.593499,4.087421,-.05833993,.8158929,-.04681279,.2423716,.4938052,-.9470092,.07325237,2.064735,-5.16754,-.01313751,.4832169,.1126295,6.970522,1.035022,-1.022557,-.2762616,-.9375748,6.696739,.2200765,-.1133253,.5492505,-3.109391,.3321914,-1.087444,-.1836263,.6225024,-8.576765,-1.107637,.7859427,.09910909,3.112938,.8596261,-1.051544,-.1546262,.2371731,12.00502,-4.527291,.07268862,.5571478,2.532873,.6662,-1.375576,-.4840019,-8.12129,8.05814,-.01445661,.5123314,.05813321,3.203219,.5442318,-2.325221,-1.241463,-7.06343,8.741369,-.0782995,.8844273,-.03471106,.1740583,.2814079,-1.2287,-.2013412,2.949042,-7.371945,.1071753,-.249197,.2265223,6.391504,1.172389,-.7601786,-.1680631,-.7584444,8.541356,.08222291,.6729633,.3206615,-3.70094,.2710054,-1.191166,-.2672347,.2927498,-9.713613,-.4783721,.2352803,.2161949,2.691481,.8745447,-1.030135,-.1653301,.2263443,12.96157,-4.650644,.007055709,.5091975,2.00037,.6603839,-1.508018,-.6460933,-6.402745,6.545995,-.0375032,.6921803,.003309819,2.797527,.6978446,-2.333308,-1.167837,-17.46787,18.6863,-.008948229,.5621946,-.03402626,1.217943,.01149865,-2.665953,-1.226307,7.169725,-11.59434,.0358342,-.3074378,.3412248,4.422122,1.283791,-.09705116,.08312991,-2.160462,10.28235,.03543357,1.032049,.105831,-2.972898,.2418628,-1.329617,-.3699557,.5560117,-9.730113,.09938865,-.3071488,.2510691,1.777111,.8705142,-1.019387,-.1893247,.1194079,12.39436,-4.799224,.2940213,.4841268,1.529724,.6582615,-1.896737,-1.005442,-6.411032,6.54822,-.03227596,.5717262,-8115192e-12,2.296704,.9000749,-2.411116,-1.225587,-17.53629,18.29393,.01247555,.2364616,-.005114637,1.603778,-.2224156,-4.707121,-2.074977,7.9423,-11.32407,-.05415654,.5446811,.1032493,4.010235,1.369802,.1010482,-.4013305,-2.674579,9.779409,.1782506,.7053045,.4200002,-2.400671,.1953165,-1.243526,-.3391255,.8848882,-9.789025,-.3997324,-.9546227,-.1044017,.6010593,.8714462,-1.014633,-.1730009,-.07738934,13.90903,-4.847307,1.076059,.5685743,1.572992,.6561432,-1.122998,-.1881183,-10.30709,11.58932,-.04079495,.9603774,.03079436,4.009235,.5060745,-1.13479,-.1539688,5.478405,-4.21727,-.1043858,.7165008,.01524765,6.473623,.4207882,-1.134957,-.3513318,.7393837,1.354415,-.4764078,1.690441,-.0549264,-5.563523,1.145743,-1.058344,-.05758503,1.16823,.3269824,.1795193,.7849011,.07441853,6.904804,.281879,-1.075194,-.2355813,2.463685,-1.536505,-7.505771,.9619712,-.06465851,-1.355492,.8489847,-1.07903,-.1465328,1.773838,2.310131,-3.136065,.3507952,.04435014,2.819225,.5689008,-1.125833,-.1870849,-9.555833,10.59713,-.04225402,.9164663,.04338796,4.40098,.6056119,-1.12744,-.1551891,4.755621,-4.408806,-.07851763,.2268284,.146007,7.048003,.3525997,-1.143788,-.3170178,.5480669,2.04183,-.4532139,2.302233,-.1887419,-4.489221,1.250967,-1.032849,.007376031,.5666073,-.2312203,.4862894,-.1748294,.357287,8.380522,.1302333,-1.093728,-.2786977,2.641272,-1.507494,-8.731243,1.684055,-.2023377,-2.176398,1.013249,-1.076578,-.1456205,1.693935,2.945003,-2.822673,-.2520033,.1517034,2.649109,.5179094,-1.146417,-.2119353,-7.187525,8.058599,-.05256438,.8375733,.03887093,4.222111,.6695347,-1.173674,-.2067025,2.899359,-2.804918,-.08473899,.003944225,.1340641,6.160887,.4527141,-1.090098,-.2599633,.9180856,1.09271,-.4215019,2.42766,-.09277667,-2.123523,1.058159,-1.08446,.008056181,-.245351,.6619567,.4668118,-.9526719,.4648454,8.001572,.3054194,-1.053728,-.2765784,2.792388,-3.489517,-8.150535,2.195757,-.2017234,-2.128017,.9326589,-1.099348,-.1593939,1.568292,7.247853,-2.933,-.5890481,.172444,2.433484,.5736558,-1.185983,-.2581184,-7.761056,8.317053,-.03351773,.6676667,.05941733,3.820727,.6324032,-1.268591,-.3398067,2.348503,-2.023779,-.05368458,.1083282,.08402858,3.910254,.5577481,-1.071353,-.1992459,.7878387,.1974702,-.3033058,2.335298,-.08205259,.7954454,.9972312,-1.089513,-.03104364,-.5995746,2.330281,.6581939,-1.821467,.6679973,5.090195,.3125161,-1.040214,-.2570934,2.660489,-6.506045,-7.053586,2.763153,-.2433632,-.7648176,.9452937,-1.116052,-.1831993,1.457694,11.63608,-3.216426,-1.045594,.2285002,1.817407,.5810396,-1.230134,-.3136264,-8.909301,9.145006,-.01055387,.4467317,.1016826,3.342964,.563384,-1.442907,-.5593147,2.156447,-1.241657,-.0351213,.3050274,.01797175,1.742358,.5977153,-1.027627,-.06481539,.4351975,-1.051677,-.2030672,1.942684,-.03615993,4.050266,.9801624,-1.08211,-.1578209,-.3397511,4.163851,.6650368,-1.84173,.7062544,.6789881,.3172623,-1.047447,-.197756,2.183364,-8.805249,-5.483962,2.551309,-.177964,1.519501,.9212536,-1.111853,-.1935736,1.394408,13.92405,-3.46543,-1.068432,.2388671,1.455336,.6233425,-1.262238,-.3546341,-10.08703,10.20084,-.001852187,.353758,.1239199,3.056093,.5132052,-1.61381,-.7355585,2.760123,-1.685253,-.02517552,.2914258,.004743448,.8689596,.5674192,-.9462336,.02950767,-.2613816,-.7398653,-.1315558,1.901042,-.06447844,4.969341,1.027342,-1.111481,-.2194054,-.09004538,3.983442,.4871278,-1.965315,.7956121,-.2363225,.2718037,-1.036397,-.1827106,1.964747,-8.870759,-4.208011,2.461215,-.2158905,1.561676,.9436866,-1.113769,-.1947819,1.30072,15.16476,-4.088732,-1.069384,.2836434,1.671451,.6229612,-1.328069,-.4244047,-8.41704,8.552244,-.006813504,.4127422,.09619897,2.854227,.505988,-1.927552,-1.02529,.9529576,.425595,-.03738779,.2584586,.04911004,-.2640913,.4138626,-.8488094,.1435988,.6356807,-2.895732,-.08473961,1.701305,-.1323908,6.499338,1.210928,-1.128313,-.3397048,-.404314,6.265097,.5482395,-2.057614,.8884087,-2.943879,.09760301,-1.039764,-.1494772,1.781915,-11.53012,-3.379232,2.517231,-.2764393,2.588849,1.05212,-1.108447,-.2012251,1.19864,19.25331,-4.423892,-1.257122,.339569,1.48122,.5880175,-1.374185,-.4967434,-7.401318,7.724021,-.02345723,.5979653,.02436346,2.65897,.6014891,-2.310933,-1.29029,-1.301909,2.557806,-.03744449,.08982861,.1090613,-.4398363,.1184329,-1.12473,-.0992183,1.366902,-4.172489,-.05078016,1.393597,-.09323843,6.452721,1.435913,-.8468477,-.2744819,-.43472,6.713362,.6127133,-1.685634,.7360941,-4.535502,-.02920866,-1.165242,-.2008697,1.438778,-10.08936,-2.214771,2.102909,-.1763085,2.859075,1.09347,-1.074614,-.2066374,1.131891,16.30063,-4.801441,-1.11259,.3595785,1.122227,.579461,-1.521515,-.6835604,-5.571044,6.028774,-.04253715,.6875746,-5279456e-12,2.18015,.8487705,-2.240415,-1.171166,-7.182771,8.417068,-.01932866,.1101887,-.01098862,.6242195,-.2393875,-2.712354,-1.19883,3.1802,-6.76813,-.002563386,.7984607,.2764376,4.695358,1.557045,-.03655172,-.02142321,-.913812,7.932786,.3516542,-.7994343,.1786761,-4.208399,.01820576,-1.36861,-.2656212,1.249397,-8.317818,-.8962772,1.423249,.1478381,2.19166,1.007748,-1.041753,-.2453366,1.061102,11.30172,-4.739312,-.9223334,.2982776,.6162931,.6080302,-1.989159,-1.09516,-2.91555,3.275339,-.05735765,.5742174,-7683288e-12,1.7634,.9001342,-2.07002,-1.086338,-10.95898,12.0696,.03780123,-.01774699,-.0005881348,1.333819,-.2605423,-5.249653,-2.38304,6.160406,-9.097138,-.1955319,1.651785,.0006016463,3.021824,1.493574,.4685432,-.2358662,-2.666433,9.685763,.5804928,-1.521875,.5668989,-1.548136,.01688642,-1.296891,-.3449031,1.928548,-11.6756,-1.627615,1.355603,-.1929074,-.6568952,1.009774,-1.067288,-.2410392,.7147961,17.8384,-4.374399,-.6588777,.3329831,1.012066,.6118645],[-1.310023,-.4407658,-36.4034,36.83292,-.008124762,.5297961,.01188633,3.13832,.5134778,-1.4241,-.5501606,-17.5351,18.22769,-.01539272,.6366826,.002661996,2.659915,.4071138,-1.103436,-.1884105,6.425322,-6.910579,-.02019861,.3553271,-.01589061,5.345985,.8790218,-1.1862,-.4307514,-3.957947,5.979352,-.05348869,1.736117,.03491346,-2.692261,.5610506,-1.006038,-.1305995,4.473513,-3.806719,.1419407,-.02148238,-.05081185,3.735362,.535828,-1.078507,-.1633754,-3.812368,4.3817,.02988122,1.754224,.1472376,3.722798,.4999157,-1.333582,-.4649908,-33.59528,34.04375,-.009384242,.5587511,.00572631,3.073145,.5425529,-1.562624,-.7107068,-14.7817,15.59839,-.01462375,.5050133,.02516017,1.604696,.2902403,-.8930158,.04068077,1.373481,-2.342752,-.02098058,.6248686,-.05258363,7.058214,1.150373,-1.262823,-.4818353,889261e-9,1.92312,-.04979718,1.040693,.1558103,-2.85248,.2420691,-.9968383,-.1200648,1.324342,-.9430889,.1931098,.4436916,-.07320456,4.215931,.7898019,-1.078185,-.1718192,-1.720191,2.358918,.02765637,1.260245,.2021941,3.395483,.5173628,-1.353023,-.4813523,-31.0492,31.40156,-.009510741,.554203,.008135471,3.136646,.5215989,-1.624704,-.7990201,-21.67125,22.46341,-.01163533,.5415746,.02618378,1.139214,.3444357,-.798361,.1417476,9.914841,-10.81503,-.01218845,.3411392,-.06137698,7.445848,1.18008,-1.266679,-.4288977,-5.818701,6.986437,-.08180711,1.397403,.2016916,-1.275731,.2592773,-1.009707,-.1537754,3.496378,-3.013726,.242115,-.2831925,.03003395,3.702862,.774632,-1.075646,-.1768747,-1.347762,1.989004,.01375836,1.76481,.1330018,3.230864,.662621,-1.375269,-.5103569,-34.42661,34.78703,-.008460009,.5408643,.004813323,3.016078,.5062069,-1.821679,-.9766461,-19.26488,19.97912,-.009822567,.3649556,.04316092,.893019,.4166527,-.6633542,.1997841,2.395592,-3.117175,-.01080884,.8983814,-.1375825,6.673463,1.115663,-1.30324,-.3612712,.08292959,.3381364,-.06078648,.3229247,.3680987,.7046755,.3144924,-.9952598,-.2039076,.4026851,.2686684,.1640712,.5186341,-.0120552,2.659613,.8030394,-1.098579,-.2151992,.6558198,-74369e-8,-.001421817,1.073701,.1886875,2.536857,.6673923,-1.457986,-.5906842,-38.12464,38.38539,-.006024357,.4741484,.01209223,2.818432,.5012433,-1.835728,-1.003405,-6.848129,7.601943,-.01277375,.4785598,.03366853,1.097701,.4636635,-.8491348,.009466365,-2.685226,2.00406,-.01168708,.6752316,-.1543371,5.674759,1.039534,-1.083379,-.150679,.7328236,-.5095568,-.08609153,.444882,.4174662,1.481556,.3942551,-1.117089,-.3337605,.2502281,.4036323,.2673899,.2829817,.0224245,2.043207,.7706902,-1.071648,-.21262,.6069466,-.00145629,-.551596,1.046755,.1985021,2.290245,.6876058,-1.483903,-.6309647,-43.80213,44.10537,-.005712161,.5195992,.002028428,2.687114,.5098321,-2.053976,-1.141473,.5109183,.08060391,-.01033983,.4066532,.04869627,1.161722,.4039525,-.6348185,.07651292,-10.31327,10.07598,-.02083688,.7359516,-.2029459,5.013257,1.077649,-1.22863,-.1650496,.04077157,-.7189167,-.0509222,.2959814,.5111496,2.540433,.361533,-1.041883,-.3278413,-.06691911,1.307364,.2166663,.3000595,-.003157136,1.389208,.7999026,-1.103556,-.2443602,.4705347,-.0009296482,-.530992,.9654511,.2142587,2.244723,.6839976,-1.555684,-.6962113,-46.47983,46.7427,-.005034895,.475509,-9.502561e-7,2.626569,.5056194,-1.998288,-1.12472,-1.629586,2.187993,-.008284384,.3845258,.0572624,1.185644,.4255812,-1.03257,-.251385,-3.721112,3.506967,-.02186561,.9436049,-.2451412,4.725724,1.039256,-.8597532,.09073332,-2.553741,1.993237,-.04390891,-.2046928,.5515623,1.909127,.3948212,-1.210482,-.4477622,-.2267805,1.219488,.1336186,.6866897,.02808997,1.600403,.7816409,-1.078168,-.2699261,.2537282,.3820684,-.4425103,.5298235,.2185217,1.728679,.6882743,-1.697968,-.8391488,-57.90105,58.1412,-.00340476,.426514,-1796301e-12,2.368442,.5324429,-2.141552,-1.17223,16.77872,-16.4147,-.005732425,.2002199,.06841834,1.485338,.3215763,-1.442946,-.7264245,-9.503706,9.650462,-.02120995,1.419263,-.2893098,3.860731,1.120857,-.5696752,.3411279,-.2931035,-.6512552,-.1068437,-1.085661,.6107549,1.459503,.3210336,-1.313839,-.5921371,-.2332222,1.648196,.2492787,1.381033,-.01993392,.981256,.8316329,-1.087464,-.3195534,.2902095,.3383709,-.8798482,.01494668,.2529703,1.452644,.669387,-2.068582,-1.118605,-50.81598,50.97486,-.003280669,.4067371,-2544951e-12,2.179497,.5778017,-1.744693,-.8537207,22.34361,-22.08318,-.005932616,.1035049,.05742772,1.97788,.2124846,-3.287515,-2.140268,-12.49566,12.40091,-.02409349,1.397821,-.2371627,2.771192,1.170496,.5502311,1.04663,2.193517,-2.2204,-.1064394,-1.017926,.4795457,1.030644,.3177516,-1.719734,-.9536198,-.6586821,1.386361,-.02513065,1.187011,.06542539,.5296055,.808266,-1.0057,-.3028096,.04470957,1.00776,-.8119016,.03153338,.2311321,1.182208,.6824758,-2.728867,-1.580388,-30.79627,30.92586,-.004197673,.3154759,-3897675e-12,1.920567,.6664791,-1.322495,-.7249275,14.7766,-14.68154,-.009044857,.05624314,.06498392,2.047389,.0636754,-6.102376,-3.473018,-9.926071,9.637797,-.01097909,1.103498,-.2424521,2.520748,1.24026,1.351796,1.018588,2.009081,-1.333394,-.1979125,-.3318292,.4476624,.9095235,.2955611,-1.774467,-1.07988,-.0808468,.2577697,-.1149295,.4975303,.002931611,-.3803171,.8002794,-.9898401,-.2542513,-.07530911,1.870355,-1.521918,.2405164,.2964615,1.3348,.6789053,-1.27973,-.4290674,-42.77972,43.43305,-.006541826,.4945086,.01425338,2.685244,.5011313,-1.449506,-.5766374,-16.88496,17.81118,-.01121649,.354502,.02287338,1.904281,.4936998,-1.02198,-.1897574,2.482462,-2.941725,-.01570448,.7532578,-.042568,5.23966,.4983116,-1.162608,-.3428049,3.974358,-1.527935,-.03919201,.8758593,.07291363,-3.455257,.8007426,-.9929985,-.08712006,-.7397313,1.348372,.09511685,.3233584,-.07549148,5.806452,.4990042,-1.084996,-.1739767,.1580475,.908818,.06871433,.5933079,.1188921,3.074079,.4999327,-1.317009,-.4661946,-42.55347,43.12782,-.005727235,.4285447,.02189854,2.60831,.51907,-1.469236,-.6282139,-12.41404,13.48765,-.0120477,.5070285,-.0007280216,1.491533,.3635064,-.9713808,-.08138038,.3709854,-1.041174,-.01814075,.506086,-.02053756,6.161431,1.093736,-1.159057,-.3698074,2.711209,-.6006479,-.04896926,.9273957,.1137712,-3.496828,.2867109,-1.011601,-.0820189,.2105725,.459752,.1478925,.213894,-.0566067,6.057755,.7859121,-1.07802,-.181158,.1646622,.8348426,.1149064,.4985738,.1376605,2.746607,.4999626,-1.325672,-.4769313,-41.11215,41.68293,-.006274997,.4649469,.01119411,2.631267,.5234546,-1.619391,-.8000253,-15.34098,16.32706,-.01012023,.4242255,.02931597,.8925807,.3314765,-.7356979,.1368406,2.972579,-3.535359,-.01318948,.460762,-.07182778,6.2541,1.236299,-1.316217,-.4194427,.03489902,1.289849,-.0475596,1.138222,.1975992,-.8991542,.2290572,-.9502188,-.1172703,1.405202,-.3061919,.1058772,-.3760592,-.01983179,3.562353,.7895959,-1.100117,-.1900567,.492503,.5250225,.1576804,1.042701,.07330743,2.796064,.6749783,-1.354183,-.5130625,-42.19268,42.71772,-.005365373,.4136743,.01235172,2.520122,.5187269,-1.741434,-.9589761,-8.230339,9.296799,-.009600162,.4994969,.02955452,.3667099,.3526999,-.6917347,.2154887,-.8760264,.2334121,-.01909621,.4748033,-.1138514,6.51536,1.225097,-1.293189,-.42187,1.620952,-.7858597,-.0376941,.6636786,.3364945,-.5341017,.2128347,-.9735521,-.1325495,1.007517,.2598258,.06762169,.001421018,-.06915987,3.185897,.8641956,-1.0948,-.1962062,.5755591,.2906259,.2625748,.7644049,.1347492,2.677126,.646546,-1.393063,-.5578338,-41.85249,42.33504,-.00543564,.4743765,.007422477,2.442801,.5211707,-1.939487,-1.128509,-8.974257,9.978383,-.007965597,.294883,.04436763,.2839868,.3440424,-.6011562,.2354877,-3.07982,2.585094,-.02002701,.7793909,-.1598414,5.834678,1.202856,-1.315676,-.3903446,1.7019,-1.304609,-.01045121,.2747707,.4143967,.3197102,.263758,-.9618628,-.1625841,1.187138,.1497802,-5590954e-12,.03178475,-.04153145,2.496096,.8195082,-1.111554,-.2365546,.7831875,.2018684,.2074369,.7395978,.122573,1.876478,.6821167,-1.427879,-.5994879,-35.31016,35.81581,-.006431497,.4554192,.0007348731,2.334619,.5233377,-1.998177,-1.206633,-21.4651,22.42237,-.005857596,.2755663,.06384795,.1358244,.3328437,-.644063,.2058571,2.155499,-2.587968,-.01840023,.8826555,-.2222452,5.847073,1.228387,-1.229071,-.3360441,-.3429599,.6179469,.00202961,.08899319,.5041624,.1882964,.225204,-1.022905,-.2101621,1.915689,-.6498794,-.03463651,.08954605,-.06797854,2.417705,.8568618,-1.082538,-.2007723,.4731009,.4077267,.1324289,.651488,.1702912,2.309383,.6600895,-1.472139,-.6499815,-34.28465,34.69659,-.005747023,.4174167,.001688597,2.323046,.5395191,-2.161176,-1.353089,-22.26827,23.29138,-.005583808,.2364793,.06096656,.001944666,.2861624,-.6593044,.1393558,4.698373,-5.193883,-.0199839,1.095635,-.2391254,5.598103,1.236193,-1.195717,-.2972715,.04648953,.3024588,.005003313,-.3754741,.5247265,-.1381312,.2493896,-1.020139,-.2253524,.3548437,.7030485,-.02107076,.4581395,-.03243757,2.453259,.8323623,-1.09877,-.243578,.8761614,.1941613,-.1990692,.3761139,.1657412,1.590503,.6741417,-1.648007,-.8205121,-44.35106,44.79801,-.004181353,.385483,-1842385e-12,2.000281,.5518363,-2.140986,-1.282239,-3.979213,4.672459,-.005008582,.242192,.06253602,.6612713,.2555851,-1.300502,-.5137898,.5179821,-.4032341,-.02066785,1.087929,-.2615309,4.225887,1.229237,-.696334,.0924106,.06936356,-.3588571,-.05461843,-.5616643,.5484166,-.04776267,.2414935,-1.233179,-.4325498,.6479813,.8368356,.2458875,.6464752,-.02897097,1.561773,.8518598,-1.051023,-.253369,1.004294,.3028083,-1.520108,.1607013,.1619975,1.131094,.6706655,-1.948249,-1.097383,-44.53697,44.94902,-.003579939,.3491605,-2500253e-12,1.740442,.6188022,-2.154253,-1.209559,4.144894,-3.562411,-.005638843,.1067169,.07594858,1.00528,.1072543,-2.513259,-1.507208,-1.602979,1.404154,-.00556075,1.24049,-.2852117,3.485252,1.349321,-.07832214,.3655626,.3856288,.6867894,-.1609523,-.6704306,.5357301,-.6457935,.1479503,-1.354784,-.5454375,.8797469,-1.466514,.713442,.5934903,-.02911178,.8643737,.9030724,-1.048324,-.2738736,.8783074,3.246188,-4.435369,.1251791,.1783486,1.064657,.6522878,-2.770408,-1.618911,-25.04031,25.31674,-.004239279,.3241013,-3764484e-12,1.586843,.7035906,-1.9135,-1.144014,-10.80587,11.53677,-.01003197,.1577515,.05217789,1.225278,.005172771,-5.293208,-2.876463,2.087053,-3.201552,.003892964,.532393,-.2034512,2.61776,1.273597,.906034,.3773409,-.6399945,3.213979,-.09112172,.6494055,.395328,.5047796,.2998695,-1.482179,-.677831,1.161775,-3.004872,.4774797,-.4969248,-.003512074,-1.30719,.7927378,-.9863181,-.1803364,.5810824,4.58057,-3.863454,.5328174,.2272821,1.771114,.6791814]],Yu=[[1.560219,1.417388,1.206927,10.91949,5.931416,7.304788,1.533049,1.560532,.3685059,13.5504,5.543711,7.792189,1.471043,1.746088,-.9299697,17.20362,5.473384,8.336416,1.355991,2.109348,-3.295855,22.64843,5.454607,9.304656,1.244963,2.547533,-5.841485,27.56879,5.576104,10.43287,1.175532,2.784634,-7.212225,29.75347,6.47298,10.92331,1.082973,3.118094,-8.934293,31.86879,8.473885,11.74019,.96925,3.349574,-10.0381,31.47654,13.38931,12.72547,.8547044,3.151538,-9.095567,25.54995,22.73219,14.10398,.758034,2.311153,-5.170814,12.29669,36.86529,15.98882,1.664273,1.574468,1.422078,9.768247,14.47338,16.44988,1.638295,1.719586,.5786675,12.39846,14.15419,17.28605,1.572623,1.921559,-.7714802,16.09246,14.20954,18.25908,1.468395,2.21197,-2.845869,20.75027,15.24822,19.37622,1.355047,2.556469,-4.96092,24.60237,16.4836,20.65648,1.291642,2.742036,-6.061967,26.02002,18.19144,21.16712,1.194565,2.97212,-7.295779,26.91805,21.2488,22.01819,1.083631,3.047021,-7.766096,24.96261,27.44264,22.91875,.9707994,2.736459,-6.308284,17.6086,37.76291,23.9215,.8574294,1.865155,-2.364707,4.337793,50.92831,25.23432],[1.632341,1.39523,1.375634,12.38193,5.921102,7.766508,1.597115,1.554617,.3932382,15.05284,5.725234,8.158155,1.522034,1.844545,-1.322862,19.18382,5.440769,8.837119,1.403048,2.290852,-4.013792,24.851,5.521888,9.845547,1.286364,2.774498,-6.648221,29.64151,5.923777,10.97075,1.213544,3.040195,-8.092676,31.86082,6.789782,11.58899,1.122622,3.347465,-9.649016,33.43824,9.347715,12.31374,1.007356,3.543858,-10.5352,32.39842,14.83962,13.31718,.8956642,3.2787,-9.254933,25.57923,24.89677,14.76166,.7985143,2.340404,-4.928274,11.41787,39.61501,16.82448,1.745162,1.639467,1.342721,11.66033,14.90124,17.74031,1.708439,1.819144,.2834399,14.48066,14.59214,18.58679,1.63172,2.094799,-1.378825,18.43198,14.63173,19.62881,1.516536,2.438729,-3.624121,22.98621,15.99782,20.70027,1.405863,2.785191,-5.705236,26.45121,17.6833,21.91903,1.344052,2.951807,-6.683851,27.44271,19.85706,22.29452,1.245827,3.182923,-7.82296,27.91395,23.27254,23.1591,1.132305,3.202593,-8.008429,25.21093,30.00014,24.05306,1.02033,2.820556,-6.238704,17.09276,40.77916,25.09949,.903157,1.863917,-1.955738,3.032665,54.3429,26.4178],[1.168084,2.156455,-3.980314,19.89302,13.28335,14.35621,1.135488,2.294701,-4.585886,20.90208,13.4784,14.67658,1.107408,2.382765,-5.112357,21.47823,14.93128,14.60882,1.054193,2.592891,-6.115,22.68967,16.35672,15.18999,1.006946,2.70542,-6.69893,22.9183,18.34324,15.70651,.9794044,2.74244,-6.805283,22.25271,20.50797,15.6313,.9413577,2.722009,-6.760707,20.98242,23.42588,16.05011,.8917923,2.59278,-6.152635,17.74141,28.58324,16.5791,.8288391,2.153434,-4.118327,10.78118,36.8171,17.38139,.7623528,1.418187,-.8845235,.7590129,46.29859,19.21657,1.352858,2.048862,-2.053393,14.05874,30.45344,30.4443,1.330497,2.126497,-2.466296,14.67559,30.90738,30.69707,1.286344,2.200436,-2.877228,14.92701,32.36288,30.77223,1.234428,2.289628,-3.404699,14.99436,34.6839,30.84842,1.17866,2.306071,-3.549159,14.11006,37.54188,30.7973,1.151366,2.333005,-3.728627,13.63374,39.05894,30.92599,1.101593,2.299422,-3.565787,11.96745,41.88472,31.02755,1.038322,2.083539,-2.649585,8.037389,47.00869,30.65948,.9596146,1.67147,-.8751538,1.679772,53.45784,30.5452,.8640731,.9858301,1.854956,-6.798097,59.36468,31.10255]],Xu=function(e,t,n,r,i){return Hu[e][540*t+54*(n-1)+9*r+i]},ju=function(e,t,n,r){return Yu[e][60*t+6*(n-1)+r]};function Ku(e,r,i,a,o){return Zu(e).reduce(function(e,t,n){return e+t*Xu(r,i,a,n,o)},0)}function qu(e,r,i,a){return Zu(e).reduce(function(e,t,n){return e+t*ju(r,i,a,n)},0)}function Zu(e){e=Math.pow(2*e/Math.PI,1/3);return[Math.pow(1-e,5),5*Math.pow(1-e,4)*e,10*Math.pow(1-e,3)*Math.pow(e,2),10*Math.pow(1-e,2)*Math.pow(e,3),5*(1-e)*Math.pow(e,4),Math.pow(e,5)]}var Ju=function(e,t,n,r){for(var i=new Array(9),a=Math.trunc(e),o=e-a,s=0;s<9;s++){var l=Ku(n,r,0,a,s),c=Ku(n,r,1,a,s);i[s]=(1-t)*(1-o)*l+t*(1-o)*c,10!=a&&(l=Ku(n,r,0,a+1,s),c=Ku(n,r,1,a+1,s),i[s]+=(1-t)*o*l+t*o*c)}return i},$u=function(e,t,n,r){var i=Math.trunc(e),a=e-i,e=(1-t)*(1-a)*qu(n,r,0,i)+t*(1-a)*qu(n,r,1,i);return 10!=i&&(e+=(1-t)*a*qu(n,r,0,i+1)+t*a*qu(n,r,1,i+1)),e};class ed extends ku{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==o;++e)i[e]=a[l+e]*u+a[s+e]*c;return i}}var td=[[.1787,-1.463,-.3554,.4275,-.0227,5.3251,.1206,-2.5771,-.067,.3703],[-.0193,-.2592,-.0665,8e-4,-4e-4,.2125,-.0641,-.8989,-.0033,.0452],[-.0167,-.2608,-.095,.0092,-.0079,.2102,-.0441,-1.6537,-.0109,.0529]],nd=[[4.0453,-4.971,-.2155,2.4192],[.00166,-.00375,.00209,0,-.02903,.06377,-.03202,.00394,.11693,-.21196,.06052,.25886],[.00275,-.0061,.00317,0,-.04214,.0897,-.04153,.00516,.15346,-.26756,.0667,.26688]],rd=function(e,t,n){return td[e][2*t+n]},id=function(e){return nd[e]};function ad(e,t,n){return(1+e[0]*Math.exp(e[1]/Math.cos(t)))*(1+e[2]*Math.exp(e[3]*n)+e[4]*Math.pow(Math.cos(n),2))}var od={getDistParams:function(e,t){for(var n=new Array(5),r=0;r<5;r++)n[r]=rd(t,r,0)*e+rd(t,r,1);return n},getZenithParams:function(e,t,n){switch(n){case 0:var r=id(n),i=new yn(r[0],r[1],r[2],r[3]),a=Math.tan((4/9-e/120)*(Math.PI-2*t)),o=new yn(e*a,a,e,1);return.06*i.dot(o)/ad(this.getDistParams(e,n),0,t);case 1:case 2:var r=id(n),s=Math.pow(t,2),l=Math.pow(t,3),a=r[0]*l+r[1]*s+r[2]*t+r[3],o=r[4]*l+r[5]*s+r[6]*t+r[7],r=r[8]*l+r[9]*s+r[10]*t+r[11],i=new wn(a,o,r);return new wn(Math.pow(e,2),e,1).dot(i)/ad(this.getDistParams(e,n),0,t)}},getSunIlluminance:function(e,t){var n=[0,0,0];if(e[1]<0)return n;for(var r,i=[.605,.54,.445],a=[12.25,7.5,.3],o=.04608*t-.04586,s=1/(e[1]+.15*Math.pow(93.885-Math.acos(e[1])*(180/Math.PI),-1.253)),l=[1.05513096,.993359745,.903543472],c=0;c<3;c++){var u=Math.exp(.008735*-s*Math.pow(i[c],-4.08)),d=Math.exp(-s*o*Math.pow(i[c],-1.3)),h=Math.exp(.0035*-a[c]*s);n[c]=128e3*l[c]/(.212671*(r=l[c])+.71516*r+.072169*r),n[c]*=u*d*h}return n},getSunIntegral:function(e,t,n,r){var i=e,e=t,t=n;function a(e){return e*e}n=1-cos(i),e=((a(Math.PI)-2*a(i-e))*cos(i)-a(Math.PI)*cos(e))/(2*(i-e+Math.PI)*(-i+e+Math.PI)),t=t*((.0892351-.00247875*a(t))*sin(t)+cube(t)+24*t+.029745*t*cos(t))/a(a(t)+36);return 2*Math.PI*(n+e+r*t)}};class sd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Rt(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}var ld=256,cd=512,ud={LAMBERT_AR:2,STANDARD_SURFACE_AR:24,BEVEL_BL:1,BSDF_DIFFUSE_BL:2,BSDF_GLASS_BL:3,BSDF_GLOSSY_BL:2,BSDF_PRINCIPLED_BL:22,"BSDF_PRINCIPLED_<3.0_BL":20,"BSDF_PRINCIPLED_<2.91.0_BL":19,BSDF_REFRACTION_BL:3,BSDF_TRANSLUCENT_BL:1,BUMP_BL:5,"BUMP_<2.81_BL":3,EEVEE_SPECULAR_BL:5,FRESNEL_BL:1,LAYER_WEIGHT_BL:1,SAMPLER_INFO_MY:0,LAMBERT_MY:5,BLINN_MY:5,PHONG_MY:5,PHONG_E_MY:5};class dd extends Gr{constructor(e){super();var t,n,ae=this;function A(e,t){for(var n=e.node(t),r=(n.originData.type,0);r<n.originData.inputs.length;r++)v(e,t,n.originData,r)}function v(e,t,n,r,i){if(!de(e,t,r)){var a=n.inputs[r],o={name:n.name+" "+(i=i||"Input "+r),type:"",inputs:[],outputs:[]};switch(ye(a)){case"float":o.type="VALUE"+n.type.slice(-3),o.outputs.push(a);break;case"vec3":o.type="RGB"+n.type.slice(-3);var s=a.slice();s.push(1),o.outputs.push(s);break;case"vec4":o.type="RGB"+n.type.slice(-3),o.outputs.push(a);break;default:throw new Error("Unsupported group input")}e.addNode({originData:o});t=new Wu.Edge(e.len()-1,t,0);return t.connections=[],t.connections.push({from:0,to:r}),e.addEdge(t),1}}function y(e,t){for(var n=0;n<e.len();n++)if(e.node(n).originData.type==t)return n;return-1}function oe(e,t){Array.isArray(t)||(t=[t]);for(var n=0,r=0;r<e.len();r++)for(var i=e.node(r),a=0;a<t.length;a++){var o=t[a];i.originData.type==o&&n++}return n}function b(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];if(i.from()==t&&i.to()==n)return i}return null}function _(e){return!(!x(e)&&"FALLOFF_MX"!=e)}function x(e){return"BITMAP_ENV_MX"==e||"REFLECT_REFRACT_MX"==e}function se(e,t){switch(e){case"BITMAP_ENV_MX":return 5==t;case"FALLOFF_MX":return 2==t;case"MATERIAL_MX":return 8==t;case"PHYSICAL_MX":return 21==t||22==t;case"REFLECT_REFRACT_MX":return 0==t;default:return!1}}function M(e){return-1<e.type.indexOf("uniform")}function C(e){return-1<e.type.indexOf("varying")}function le(e,t){return t=$t(t)?t:"color",ae.nodeVCAliases[e]||t}function ce(e,t,n,r){r=new Ol(e,t,1,n,r,_n.DEFAULT_MAPPING,ze,ze,Ge,Ge);return r.needsUpdate=!0,r}function ue(e){return!0===e.isVideoTexture&&e.encoding===ft?"1":"0"}function r(e){for(var t=0,n=0,r=0,i=0,a=0;a<e.len();a++){var o=(q=(K=e.node(a)).originData).type;K.attributes=[],K.params=[],K.inputFactors=[],K.inputs=[],K.outputs=[],$t(q.inputFactors)&&(K.inputFactors=q.inputFactors.slice(0));for(var s,l=0;l<q.outputs.length;l++){var c=q.outputs[l],c=q.outputTypes?q.outputTypes[l]:ye(c);K.outputs.push({name:o.toLowerCase()+"_out"+l+"_n"+a,type:c,clamp:!1,normalize:!1})}switch("OUTPUT_MATERIAL_BL"!=o&&"OUTPUT_WORLD_BL"!=o&&"OUTPUT_MX"!=o&&"OUTPUT_MY"!=o&&"SHADING_ENGINE_MY"!=o&&("SKYDOME_LIGHT_AR"!=o||$t(q.texture))||K.outputs.push({name:"outgoingLight",type:"",clamp:!1,normalize:!1}),o){case"ATAN_AR":K.params.push(Ae(q.units));break;case"CLAMP_AR":K.params.push(Ae(q.mode));break;case"COLOR_CONVERT_AR":K.params.push(Ae(q.from)),K.params.push(Ae(q.to));break;case"COLOR_TO_FLOAT_AR":K.params.push(Ae(q.mode));break;case"CHECKERBOARD_AR":var u=_e(j=q.uvIndex?"uv"+String(q.uvIndex+1):"uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u);break;case"COMPOSITE_AR":K.params.push(Ae(q.operation)),K.params.push(Ae(q.alphaOperation));break;case"FACING_RATIO_AR":K.params.push(Ae("normal"));break;case"COLOR_TO_FLOAT_AR":K.params.push(Ae(q.mode));break;case"COMPARE_AR":K.params.push(Ae(q.test));break;case"FACING_RATIO_AR":K.params.push(Ae("normal"));break;case"FLOAT_TO_INT_AR":K.params.push(Ae(q.mode));break;case"IMAGE_AR":var d=me(o,q.texture);K.params.push(d),K.params.push(Ae(ue(ae.nodeTextures[d.name])));break;case"LAMBERT_AR":K.params.push(Ae("geometryNormal"));break;case"LENGTH_AR":K.params.push(Ae(q.mode));break;case"MAP_TO_MTL_AR":K.params.push(ve(q.opaqueEnabled));break;case"MIX_SHADER_AR":K.params.push(Ae(q.mode));break;case"NORMAL_MAP_AR":var u=_e(j="tangent",4);K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u);break;case"RGB_TO_FLOAT_AR":case"RGB_TO_VECTOR_AR":case"RGBA_TO_FLOAT_AR":case"RGB_TO_VECTOR_AR":K.params.push(Ae(q.mode));break;case"SHADOW_MATTE_AR":K.params.push(Ae("normal"));break;case"SHUFFLE_AR":K.params.push(Ae(q.channelR)),K.params.push(Ae(q.channelG)),K.params.push(Ae(q.channelB)),K.params.push(Ae(q.channelA));break;case"SKYDOME_LIGHT_AR":$t(q.texture)&&(d=me(o,q.texture),K.params.push(d),K.params.push(Ae(ue(ae.nodeTextures[d.name]))),K.params.push(Ae("normal")));break;case"STANDARD_SURFACE_AR":K.params.push(Ae("geometryNormal"));var h=void 0===q.thinWalled||q.thinWalled;K.params.push(ve(h)),(0<q.inputs[15]||de(e,a,15))&&(ae.defines.USE_CLEARCOAT=""),(0<q.inputs[18]||de(e,a,18))&&(ae.defines.USE_SHEEN=""),K.inputFactors.length=0;break;case"TRIGO_AR":K.params.push(Ae(q.function)),K.params.push(Ae(q.units));break;case"TWO_SIDED_AR":K.params.push(Ae("FRONT_FACING_VALUE"));break;case"VECTOR_TO_RGB_AR":K.params.push(Ae(q.mode));break;case"ATTRIBUTE_BL":(j=le(q.colorLayer,""))?(u=_e(j,4),K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u)):K.params.push(Ae("vec4(0.0, 0.0, 0.0, 1.0)"));break;case"BSDF_DIFFUSE_BL":case"BSDF_GLASS_BL":case"BSDF_GLOSSY_BL":K.params.push(Ae("geometryNormal"));break;case"BSDF_PRINCIPLED_BL":K.params.push(Ae("geometryNormal")),q.inputs.length<=23?((0<q.inputs[12]||de(e,a,12))&&(ae.defines.USE_CLEARCOAT=""),(0<q.inputs[10]||de(e,a,10))&&(ae.defines.USE_SHEEN="")):((0<q.inputs[14]||de(e,a,14))&&(ae.defines.USE_CLEARCOAT=""),(0<q.inputs[12]||de(e,a,12))&&(ae.defines.USE_SHEEN=""));break;case"BSDF_REFRACTION_BL":K.params.push(Ae("geometryNormal")),K.params.push(Ae("BSDF_REFRACTION_"+q.distribution));break;case"BUMP_BL":K.params.push(fe(q.invert));break;case"CAMERA_BL":K.params.push(Ae("vViewPosition")),0<oe(e,"OUTPUT_MATERIAL_BL")||0<oe(e,"OUTPUT_WORLD_BL")?K.params.push(ve(!0)):K.params.push(ve(!1));break;case"CURVE_RGB_BL":case"CURVE_VEC_BL":R=ae.useFloatTex?(I=new Float32Array(1024),1):(I=new Uint8Array(1024),255);for(var p,f,m,g,v=q.curveData.length/ld,l=0;l<ld;l++)g=3<v?(p=R*q.curveData[v*l],f=R*q.curveData[v*l+1],m=R*q.curveData[v*l+2],R*q.curveData[v*l+3]):(p=R*(q.curveData[v*l]/2+.5),f=R*(q.curveData[v*l+1]/2+.5),m=R*(q.curveData[v*l+2]/2+.5),R),I[4*l]=Rt(p,0,R),I[4*l+1]=Rt(f,0,R),I[4*l+2]=Rt(m,0,R),I[4*l+3]=Rt(g,0,R);var A=ce(I,ld,Ke,ae.useFloatTex?Ye:Qe),_=dd.nodeTexUniName(o,t);ae.nodeTextures[_]=A,K.params.push(me(o,t)),t++;break;case"EEVEE_SPECULAR_BL":K.params.push(Ae("geometryNormal")),(0<q.inputs[6]||de(e,a,6))&&(ae.defines.USE_CLEARCOAT="");break;case"FRESNEL_BL":case"LAYER_WEIGHT_BL":K.params.push(Ae("vViewPosition"));break;case"GRADIENT_RAMP_MX":R=ae.useFloatTex?(I=new Float32Array(2048),1):(I=new Uint8Array(2048),255);for(l=0;l<cd;l++)p=R*q.gradientData[3*l],f=R*q.gradientData[3*l+1],m=R*q.gradientData[3*l+2],g=1,I[4*l]=Rt(p,0,R),I[4*l+1]=Rt(f,0,R),I[4*l+2]=Rt(m,0,R),I[4*l+3]=Rt(g,0,R);A=ce(I,cd,Ke,ae.useFloatTex?Ye:Qe),_=dd.nodeTexUniName(o,t);ae.nodeTextures[_]=A,K.params.push(me(o,t)),t++,K.params.push(Ae(Me("int",q.gradientType)));var u=_e(j=q.uvIndex?"uv"+String(q.uvIndex+1):"uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u),K.params.push(Ae("geometryNormal")),K.params.push(Ae("vViewPosition")),-1<["SPHERICAL_ENVIRONMENT","CYLINDRICAL_ENVIRONMENT","SHRINK_WRAP_ENVIRONMENT","SCREEN"].indexOf(q.mapping)?K.params.push(Ae("MAPPING_EXPLICIT_MAP_CHANNEL")):K.params.push(Ae("MAPPING_"+q.mapping)),K.params.push(Ae("AXIS_"+q.axis));var x=Me("ivec2",[xe(q.clampToEdgeNoExtend[0]),xe(q.clampToEdgeNoExtend[1])]);K.params.push(Ae(x));break;case"MAPPING_BL":if(q.rotation){var y=new rr,b=new pr;switch(b.set(q.rotation[0],q.rotation[1],q.rotation[2],"ZYX"),y.makeRotationFromEuler(b),y.scale((new wn).fromArray(q.scale)),q.vectorType){case"TEXTURE":y.setPosition((new wn).fromArray(q.translation)),y.invert();break;case"POINT":y.setPosition((new wn).fromArray(q.translation));break;case"VECTOR":break;case"NORMAL":K.outputs[0].normalize=!0,y.invert(),y.transpose();break;default:throw new Error("v3d.MeshNodeMaterial: Unknown MAPPING vector type")}K.params.push(fe(y.toArray())),K.params.push(fe(q.min)),K.params.push(fe(q.max)),K.params.push(fe(q.useMin)),K.params.push(fe(q.useMax))}else K.params.push(Ae("NODE_MAPPING_"+q.vectorType));break;case"MAP_RANGE_BL":$t(q.interpolationType)?K.params.push(Ae("NODE_MAP_RANGE_INTERP_"+q.interpolationType)):K.params.push(Ae("NODE_MAP_RANGE_INTERP_LINEAR")),K.params.push(ve(q.clamp));break;case"NEW_GEOMETRY_BL":K.params.push(Ae("FRONT_FACING_VALUE")),K.params.push(Ae("vViewPosition")),K.params.push(Ae("normal")),he(e,a,2)&&(ae.needsBoundingBox=!0);break;case"NORMAL_MAP_BL":var u=_e(j="tangent",4);K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u),K.params.push(Ae("vNormal"));break;case"TANGENT_BL":"RADIAL"===q.directionType?(K.params.push(Ae("TANGENT_AXIS_"+q.axis)),K.params.push(Ae("vViewPosition")),K.params.push(Ae("normal")),ae.needsBoundingBox=!0):"UV_MAP"===q.directionType&&(u=_e(j="tangent",4),K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u));break;case"TEX_BRICK_BL":K.params.push(Ae(Me("float",q.offset))),K.params.push(Ae(Me("int",q.offsetFrequency))),K.params.push(Ae(Me("float",q.squash))),K.params.push(Ae(Me("int",q.squashFrequency)));break;case"TEX_COORD_BL":K.params.push(Ae(`nodeTexCoordObjectMatrices[${r}]`)),K.params.push(Ae("vViewPosition")),K.params.push(Ae("normal"));u=_e(j="uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u),he(e,a,0)&&(ae.needsBoundingBox=!0),ae.nodeTexCoordObject.push(null),ae.nodeTexCoordObjectMap[q.name]=r,r++;break;case"TEX_ENVIRONMENT_BL":case"TEX_ENVIRONMENT_MX":case"TEX_IMAGE_BL":var M,C=me(o,q.texture);K.params.push(C),K.params.push(Ae(ue(ae.nodeTextures[C.name]))),"TEX_ENVIRONMENT_BL"==o?(M=q.projection,K.params.push(Ae("TEX_PROJ_"+M))):"TEX_IMAGE_BL"==o&&(K.params.push(Ae("normal")),M=q.projection,K.params.push(Ae("TEX_PROJ_"+M)),K.params.push(fe(q.projectionBlend)),K.params.push(ve(q.clampToEdgeNoExtend)));break;case"TEX_GRADIENT_BL":K.params.push(Ae("TEX_GRAD_"+q.gradientType));break;case"TEX_NOISE_BL":var b=$t(q.falloffFactor)?q.falloffFactor:0,S=$t(q.dispersionFactor)?q.dispersionFactor:1;K.params.push(Ae(Me("float",b))),K.params.push(Ae(Me("float",S)));break;case"TEX_SKY_BL":var w=(new wn).fromArray(q.sunDirection).angleTo(new wn(0,0,1));"PREETHAM"==q.skyType?(G=od.getDistParams(q.turbidity,0).concat([0,0,0,0]),k=od.getDistParams(q.turbidity,1).concat([0,0,0,0]),Q=od.getDistParams(q.turbidity,2).concat([0,0,0,0]),W=od.getZenithParams(q.turbidity,w,0),H=od.getZenithParams(q.turbidity,w,1),Y=od.getZenithParams(q.turbidity,w,2)):"HOSEK_WILKIE"==q.skyType?(P=Math.max(Math.PI/2-w,0),G=Ju(q.turbidity,q.groundAlbedo,P,0),k=Ju(q.turbidity,q.groundAlbedo,P,1),Q=Ju(q.turbidity,q.groundAlbedo,P,2),W=$u(q.turbidity,q.groundAlbedo,P,0),H=$u(q.turbidity,q.groundAlbedo,P,1),Y=$u(q.turbidity,q.groundAlbedo,P,2)):(G=k=Q=new Array(9).fill(0),W=H=Y=0),K.params.push(Ae("TEX_SKY_"+q.skyType)),K.params.push(fe([G[0],k[0],Q[0]])),K.params.push(fe([G[1],k[1],Q[1]])),K.params.push(fe([G[2],k[2],Q[2]])),K.params.push(fe([G[3],k[3],Q[3]])),K.params.push(fe([G[4],k[4],Q[4]])),K.params.push(fe([G[5],k[5],Q[5]])),K.params.push(fe([G[6],k[6],Q[6]])),K.params.push(fe([G[7],k[7],Q[7]])),K.params.push(fe([G[8],k[8],Q[8]])),K.params.push(fe([W,H,Y])),K.params.push(fe(q.sunDirection));break;case"TEX_VORONOI_BL":void 0!==q.coloring&&K.params.push(Ae("COLORING_"+q.coloring)),K.params.push(Ae("DISTANCE_"+q.distance)),K.params.push(Ae("FEATURE_"+q.feature));break;case"TEX_WAVE_BL":K.params.push(Ae("TEX_WAVE_TYPE_"+q.waveType)),K.params.push(Ae("TEX_WAVE_PROFILE_"+q.waveProfile)),void 0===q.bandsDirection&&(q.bandsDirection="DIAGONAL"),void 0===q.ringsDirection&&(q.ringsDirection="SPHERICAL"),K.params.push(Ae("TEX_WAVE_BANDS_DIR_"+q.bandsDirection)),K.params.push(Ae("TEX_WAVE_RINGS_DIR_"+q.ringsDirection));break;case"MATH_BL":K.outputs[0].clamp=q.useClamp;break;case"MIX_RGB_BL":switch(K.originData.blendType){case"HUE":case"SATURATION":case"VALUE":case"COLOR":ae.defines.HSV_NODES=""}K.outputs[0].clamp=q.useClamp;break;case"MIX_SHADER_BL":for(var E=-1,l=1;l<3;l++){var T=pe(e,a,l);T&&"BSDF_TRANSPARENT_BL"==T.originData.type&&(E=l-1)}K.params.push(Ae(String(E)));break;case"NORMAL_BL":K.params.push(fe(q.outputs[0]));break;case"RGB_BL":case"RGB_MX":C=(new yn).fromArray(q.outputs[0]);ae.nodeRGB.push(C),ae.nodeRGBMap[q.name]=n,K.params.push(Ae("nodeRGB["+n+"]")),n++;break;case"UVMAP_BL":u=_e(j=(D=q.uvLayer,ae.nodeUVAliases[D]||"uv"),2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u);break;case"VALUE_BL":case"VALUE_MX":case"ANIM_CURVE_TA_MY":case"ANIM_CURVE_TU_MY":case"VALUE":C=q.outputs[0];ae.nodeValue[i]=C,ae.nodeValueMap[q.name]=i,K.params.push(Ae("nodeValue["+i+"]")),i++;break;case"VALTORGB_BL":var I,R,L=new("STEP"==(V=q.curve).interpolation?Qu:ed)(new Float32Array(V.input),new Float32Array(V.output),4);R=ae.useFloatTex?(I=new Float32Array(1024),1):(I=new Uint8Array(1024),255);for(l=0;l<ld;l++){var B=L.evaluate(l/255);I[4*l]=R*B[0],I[4*l+1]=R*B[1],I[4*l+2]=R*B[2],I[4*l+3]=R*B[3]}A=ce(I,ld,Ke,ae.useFloatTex?Ye:Qe);"STEP"==V.interpolation&&(A.minFilter=Ve,A.magFilter=Ve);_=dd.nodeTexUniName(o,t);ae.nodeTextures[_]=A,K.params.push(me(o,t)),t++;break;case"VECTOR_ROTATE_BL":void 0===q.rotationType&&(q.rotationType="AXIS_ANGLE"),void 0===q.invert&&(q.invert=!1),K.params.push(Ae(Me("float",q.invert?-1:1)));break;case"VECT_TRANSFORM_BL":var S=q.vectorType,P=q.convertFrom,D=q.convertTo;"NORMAL"==S&&(K.outputs[0].normalize=!0);var N="";P==D?N="VEC_TRANS_NONE":(N="VEC_TRANS_"+P[0]+"_"+D[0],"VECTOR"!=S&&"NORMAL"!=S||(N+="_DIR")),K.params.push(Ae(N)),0<oe(e,"OUTPUT_MATERIAL_BL")||0<oe(e,"OUTPUT_WORLD_BL")?K.params.push(ve(!0)):K.params.push(ve(!1));break;case"VERTEX_COLOR_BL":(j=le(q.colorLayer,""))?(u=_e(j,4),K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u)):K.params.push(Ae("vec4(0.0, 0.0, 0.0, 1.0)"));break;case"BITMAP_MX":case"BITMAP_ENV_MX":case"REFLECT_REFRACT_MX":var d=me(o,q.texture);K.params.push(d),"BITMAP_MX"==o?(u=_e(j=q.uvIndex?"uv"+String(q.uvIndex+1):"uv",2),K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u),K.params.push(Ae("MAPPING_"+q.mapping)),K.params.push(Ae("AXIS_"+q.axis)),x=Me("ivec2",[xe(q.clampToEdgeNoExtend[0]),xe(q.clampToEdgeNoExtend[1])]),K.params.push(Ae(x))):(K.params.push(Ae(q.reflectMode)),K.params.push(fe(q.IOR))),K.params.push(Ae(ue(ae.nodeTextures[d.name]))),"BITMAP_MX"!=o&&"BITMAP_ENV_MX"!=o||(K.params.push(ve(q.alphaAsMono)),K.params.push(ve(q.alphaAsRGB)),K.outputs.push({name:o.toLowerCase()+"_out1_n"+a,type:"float",clamp:!1,normalize:!1}));break;case"BLEND_MX":K.params.push(ve(q.useCurve)),K.params.push(fe(q.curveLower)),K.params.push(fe(q.curveUpper));break;case"BUMP_MX":d=me("BITMAP_MX",q.texture);K.params.push(d),K.params.push(Ae("-vViewPosition")),K.params.push(Ae("normal"));u=_e(j=q.uvIndex?"uv"+String(q.uvIndex+1):"uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u);break;case"COLOR_CORRECTION_MX":N=Me("ivec4",[q.rewireR,q.rewireG,q.rewireB,q.rewireA]);K.params.push(Ae(N));break;case"COMPOSITE_LAYER_MX":K.params.push(Ae(Me("int",q.blendMode)));var F=de(e,a,1)?q.opacity:0;K.params.push(fe(F));break;case"COLOR_MAP_MX":K.params.push(ve(q.reverseGamma));break;case"FALLOFF_MX":K.params.push(Ae("-vViewPosition")),K.params.push(fe(q.IOR));break;case"MASK_MX":K.params.push(ve(q.maskInverted));break;case"MATERIAL_MX":K.params.push(fe(q.inputFactors[9])),K.params.push(fe(q.inputFactors[10])),q.inputFactors[9]=1,q.inputFactors[10]=1,K.params.push(ve(q.selfIllumColorOn));break;case"MATTE_SHADOW_MX":K.params.push(Ae("normal")),K.params.push(ve(q.receiveShadows)),K.params.push(fe(q.shadowBrightness)),K.params.push(fe(q.color));break;case"NOISE_MX":2==q.coordType?(u=_e(j=q.uvIndex?"uv"+String(q.uvIndex+1):"uv",2),K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u)):K.params.push(Ae("vViewPosition")),K.params.push(ge(q.noiseType)),K.params.push(ge(q.coordType));break;case"NORMAL_BUMP_MX":u=_e(j="tangent",4);K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u),K.params.push(Ae("normal"));F="ivec2("+xe(q.flip[0])+","+xe(q.flip[1])+")";K.params.push(Ae(F));break;case"OUTPUT_MAP_MX":if(K.params.push(ve(q.invert)),K.params.push(ve(q.clamp)),K.params.push(ve(q.alphaFromRGB)),q.colorMap){R=ae.useFloatTex?(s=q.colorMap,I=new Float32Array(1024),1):(s=en(q.colorMap.slice(),0,1),I=new Uint8Array(1024),255);for(v=s.length/ld,l=0;l<ld;l++)I[4*l]=R*s[v*l],3==v?(I[4*l+1]=R*s[v*l+1],I[4*l+2]=R*s[v*l+2]):(I[4*l+1]=I[4*l],I[4*l+2]=I[4*l]),I[4*l+3]=R;A=ce(I,ld,Ke,ae.useFloatTex?Ye:Qe),_=dd.nodeTexUniName(o,t);ae.nodeTextures[_]=A,K.params.push(me(o,t)),t++}break;case"PHYSICAL_MX":K.params.push(Ae("geometryNormal")),K.params.push(fe(q.emitLuminance));var O=void 0===q.brdfMode||q.brdfMode,U=void 0===q.brdfLow?0:q.brdfLow,z=void 0===q.brdfHigh?0:q.brdfHigh,V=void 0===q.brdfCurve?0:q.brdfCurve;K.params.push(ve(!O)),K.params.push(Ae(Me("float",U))),K.params.push(Ae(Me("float",z))),K.params.push(Ae(Me("float",V))),K.params.push(ve($t(q.roughnessInv)&&q.roughnessInv)),K.params.push(ve($t(q.transRoughnessLock)&&q.transRoughnessLock)),K.params.push(ve($t(q.transRoughnessInv)&&q.transRoughnessInv)),K.params.push(ve($t(q.thinWalled)&&q.thinWalled)),(0<q.inputs[18]||de(e,a,18))&&(ae.defines.USE_CLEARCOAT="");break;case"PHY_SUN_SKY_ENV_MX":O=15*q.haze+2,U=new sd,w=Math.PI/2-q.sunPolarAngle,z=Math.PI-q.sunAzimuthAngle;U.phi=w,U.theta=z;var U=(new wn).setFromSpherical(U).toArray(),G=od.getDistParams(O,0),k=od.getDistParams(O,1),Q=od.getDistParams(O,2),W=od.getZenithParams(O,w,0),H=od.getZenithParams(O,w,1),Y=od.getZenithParams(O,w,2);W/=.06,W*=1e3,K.params.push(fe([G[0],k[0],Q[0]])),K.params.push(fe([G[1],k[1],Q[1]])),K.params.push(fe([G[2],k[2],Q[2]])),K.params.push(fe([G[3],k[3],Q[3]])),K.params.push(fe([G[4],k[4],Q[4]])),K.params.push(fe([W,H,Y]));O=od.getSunIlluminance(U,O);K.params.push(fe(U)),K.params.push(fe(O)),K.params.push(fe([0,0,0]));O=1500/Math.PI;K.params.push(fe(q.globalIntensity/O)),K.params.push(fe(q.groundColor));break;case"REFLECT_REFRACT_COLOR_MX":C=q.outputs[0];K.params.push(fe(C));break;case"VERTEX_COLOR_MX":u=_e(j="color",3);K.attributes.push({name:j,type:"attribute vec3"}),K.params.push(u);break;case"BLINN_MY":K.params.push(Ae("geometryNormal"));break;case"BUMP_2D_MY":K.params.push(Ae("vNormal")),0<q.bumpInterp&&(u=_e(j="tangent",4),K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u));break;case"CHANNELS_MY":K.params.push(Ae(q.channelR)),K.params.push(Ae(q.channelG)),K.params.push(Ae(q.channelB)),K.params.push(Ae(q.channelA));break;case"COLOR_COMPOSITE_MY":K.params.push(Ae(q.operation));break;case"COLOR_CORRECT_MY":K.params.push(ve(q.colClamp)),K.params.push(fe(q.colClampMin)),K.params.push(fe(q.colClampMax)),K.params.push(ve(q.alphaClamp)),K.params.push(fe(q.alphaClampMin)),K.params.push(fe(q.alphaClampMax)),K.params.push(ve(q.unpremultiplyInput)),K.params.push(ve(q.premultiplyResult));break;case"COLOR_LOGIC_MY":K.params.push(Ae(q.operation));break;case"COLOR_MASK_MY":K.params.push(ve(q.maskAlphaIsLuminance));break;case"COLOR_MATH_MY":K.params.push(Ae(q.operation));break;case"COMPOSE_MATRIX_MY":K.params.push(ve(q.useEulerRotation)),K.params.push(Ae(q.inputRotateOrder));break;case"CONDITION_MY":K.params.push(Ae(q.operation));break;case"FILE_MY":case"ENV_SPHERE_MY":C=me("FILE_MY",q.texture);K.params.push(C),K.params.push(Ae(ue(ae.nodeTextures[C.name]))),"ENV_SPHERE_MY"==o?K.params.push(Ae("normal")):(X=!1===q.fileHasAlpha,K.params.push(ve(X&&he(e,a,0))));break;case"FLOAT_COMPOSITE_MY":case"FLOAT_LOGIC_MY":case"FLOAT_MATH_MY":K.params.push(Ae(q.operation));break;case"LAMBERT_MY":K.params.push(Ae("geometryNormal"));break;case"MULTIPLY_DIVIDE_MY":K.params.push(Ae(q.operation));break;case"PHONG_MY":case"PHONG_E_MY":K.params.push(Ae("geometryNormal"));break;case"PLACE_2D_TEXTURE_MY":u=_e(j=q.uvIndex?"uv"+String(q.uvIndex+1):"uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u);break;case"RAMP_MY":R=ae.useFloatTex?(I=new Float32Array(2048),1):(I=new Uint8Array(2048),255);for(l=0;l<cd;l++)p=R*q.rampData[3*l],f=R*q.rampData[3*l+1],m=R*q.rampData[3*l+2],g=1,I[4*l]=Rt(p,0,R),I[4*l+1]=Rt(f,0,R),I[4*l+2]=Rt(m,0,R),I[4*l+3]=Rt(g,0,R);(A=ce(I,cd,Ke,ae.useFloatTex?Ye:Qe)).wrapS=q.wrapS,A.wrapT=q.wrapT;_=dd.nodeTexUniName(o,t);ae.nodeTextures[_]=A,K.params.push(me(o,t)),t++,K.params.push(Ae(Me("int",q.rampType)));break;case"SAMPLER_INFO_MY":K.params.push(Ae("FRONT_FACING_VALUE"));u=_e(j="tangent",4);K.attributes.push({name:j,type:"attribute vec4"}),K.params.push(u);u=_e(j="uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u);break;case"UNIT_CONVERSION_MY":K.params.push(fe(q.conversionFactor));break;case"VECTOR_PRODUCT_MY":K.params.push(Ae(q.operation)),K.params.push(ve(q.normalizeOutput));break;case"INCIDENT":K.params.push(Ae("vViewPosition"));break;case"NORMAL":K.params.push(Ae("normal"));break;case"OSL_NODE":$t(q.texture)&&(d=me(o,q.texture),K.params.push(d));var X=q.globalVariables||[];-1<X.indexOf("P")&&K.params.push(Ae("oslGetP(vViewPosition)")),-1<X.indexOf("I")&&K.params.push(Ae("oslGetI(vViewPosition)")),-1<X.indexOf("N")&&K.params.push(Ae("oslGetN(normal)")),(-1<X.indexOf("u")||-1<X.indexOf("v"))&&(K.attributes.push({name:j="uv",type:"attribute vec2"}),-1<X.indexOf("u")&&K.params.push(_e(j+"_u",1,j+".x")),-1<X.indexOf("v")&&K.params.push(_e(j+"_v",1,"1.0 - "+j+".y")));break;case"POSITION":K.params.push(Ae("vViewPosition"));break;case"RGB_ALPHA":C=(new yn).fromArray(q.outputs[0].concat([q.outputs[1]]));ae.nodeRGB.push(C),ae.nodeRGBMap[q.name]=n,K.params.push(Ae("nodeRGB["+n+"]")),n++;break;case"U_FLOAT":var j,u=_e(j="uv",2);K.attributes.push({name:j,type:"attribute vec2"}),K.params.push(u)}}for(a=0;a<e.len();a++)for(var K,q,o=(q=(K=e.node(a)).originData).type,l=0;l<q.inputs.length;l++){var Z=q.inputs[l],J=q.inputTypes?q.inputTypes[l]:ye(Z),$=[],ee=[];!function(e,t,n,r,i,a){for(var o in e.edges){var s=e.edges[o];if(s.to()==t)for(var l=e.node(s.from()),c=0;c<s.connections.length;c++){var u,d=s.connections[c];d.to==n&&("BITMAP_MX"!=(u=l.originData.type)&&"BITMAP_ENV_MX"!=u||"float"!=ye(r)?i.push(l.outputs[d.from]):i.push(l.outputs[d.from+1]),d.channelMatrix&&a.push(d.channelMatrix))}}}(e,a,l,Z,$,ee);var te,ne,re,ie=se(o,l);$.length?(te=K.inputFactors.length?K.inputFactors[l]:1,ne=ie?"normal":Me(J,Z),ee.length?(re=$.map(function(e){return e.name}),K.inputs.push({code:function(e,t,n,r,i){for(var a=[],o=be(n),s=be(r),l=0;l<s;l++){for(var c=1==s?i:i+"["+l+"]",u=0;u<e.length;u++)for(var d=e[u],h=t[u],p=0;p<o;p++)h[p][l]&&(c=1==o?d:d+"["+p+"]");a.push(c)}return r+"("+a.join(",")+")"}(re,ee,$[0].type,J,ne)})):1==$.length?K.inputs.push({code:function(e,t,n,r,i){var a;t==n?a=e:"float"==t&&"vec3"==n?a="vec3("+[e,e,e].join(",")+")":"float"==t&&"vec4"==n?a="vec4("+[e,e,e,e].join(",")+")":"vec3"==t&&"float"==n||"vec4"==t&&"float"==n?a="("+[e+"[0]",e+"[1]",e+"[2]"].join("+")+")/3.0":"vec3"==t&&"vec4"==n?a="vec4("+e+", 1.0)":"vec4"==t&&"vec3"==n?a="vec3("+[e+"[0]",e+"[1]",e+"[2]"].join(",")+")":"float"==t&&"int"==n?a="int("+e+")":"int"==t&&"float"==n||"bool"==t&&"float"==n?a="float("+e+")":console.error("MeshNodeMaterial: Missing type conversion: "+t+" -> "+n);(i<1||1!=i&&"normal"==r)&&(a="mix("+r+","+a+","+Ce(i)+")","normal"==r&&(a="normalize("+a+")"));return a}($[0].name,$[0].type,J,ne,te)}):console.error("MeshNodeMaterial: wrong node connections")):ie?K.inputs.push({code:"normal"}):K.inputs.push({code:Me(J,Z)})}}function de(e,t,n){for(var r=e.findInEdges(t),i=0;i<r.length;i++)for(var a=r[i],o=0;o<a.connections.length;o++)if(a.connections[o].to==n)return 1}function he(e,t,n){for(var r in e.edges){var i=e.edges[r];if(i.from()==t)for(var a=0;a<i.connections.length;a++)if(i.connections[a].from==n)return!0}return!1}function pe(e,t,n){for(var r in e.edges){var i=e.edges[r];if(i.to()==t)for(var a=e.node(i.from()),o=0;o<i.connections.length;o++)if(i.connections[o].to==n)return a}return null}function fe(e){return{name:"",type:ye(e),value:e}}function me(e,t){e=dd.nodeTexUniName(e,t);return{name:e,type:ae.nodeTextures[e].isCubeTexture?"uniform samplerCube":"uniform sampler2D",value:t}}function ge(e){return{name:"",type:"int",value:e}}function ve(e){return Ae(e?"true":"false")}function Ae(e){return{name:e,type:"",value:null}}function _e(e,t,n){return n=n||e,{name:"_vary_par_"+e,type:"varying "+i(t),value:null,attrBindName:n}}function xe(e){return e?1:0}function ye(e){return"number"==typeof e?"float":"boolean"==typeof e?"bool":i(e.length)}function i(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";case 9:return"mat3";case 16:return"mat4"}}function be(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16}}function Me(e,t){switch(e){case"float":return Ce(t);case"bool":case"int":return String(t);default:for(var n=[],r=0;r<t.length;r++)n.push(Ce(t[r]));return e+"("+n.join(",")+")"}}function Ce(e){return e%1?String(e):String(e)+".0"}this.type="MeshNodeMaterial",this.defines={LIGHT_PATH_IS_CAM_RAY:1,WORLD_NODES:0,NORMAL_OUTPUT:0},this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.extensions={derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.profile="blender",this.nodeTextures={},this.nodeRGB=[],this.nodeRGBMap={},this.nodeRGBArr=null,this.nodeTexCoordObject=[],this.nodeTexCoordObjectMap={},this.nodeTexCoordObjectArr=null,this.nodeValue=null,this.nodeValueMap={},this.needsBoundingBox=!1,this.useFloatTex=!1,this.nodeGraph=null,this.additionalNodeGraphs={},this.nodeChunks={},this.nodeChunksHash=0,this.nodeVCAliases={},this.nodeUVAliases={},this.color=new mn(16777215),this.envMap=null,this.envMapIntensity=1,this.envMapParallaxType=0,this.envMapParallaxMatrix=new rr,this.envMapParallaxMatrixInv=new rr,this.reflectivity=.5,this.materialIndex=0,$t(e)&&this.setValues(e),this.nodeGraph||(this.nodeGraph=(t=new Wu.DiGraph(1),n=ae.color,t.node(0).originData={name:"ShadelessOutput",type:"OUTPUT_MATERIAL_BL",inputs:[[n.r,n.g,n.b,1],[0,0,0,0],[0,0,0]],outputs:[],is_active_output:!0},t)),this.updateNodeGraph=function(){ae.nodeRGB=[],ae.nodeRGBMap={},ae.nodeTexCoordObject=[],ae.nodeTexCoordObjectMap={},ae.nodeValueMap={},ae.needsBoundingBox=!1,ae.nodeChunks={};var e=ae.nodeGraph;ae.nodeRGBArr=new Float32Array(4*oe(e,["RGB_BL","RGB_MX","RGB_ALPHA"])),ae.nodeTexCoordObjectArr=new Float32Array(16*oe(e,"TEX_COORD_BL")),ae.nodeValue=new Float32Array(oe(e,["VALUE_BL","VALUE_MX","ANIM_CURVE_TA_MY","ANIM_CURVE_TU_MY","VALUE"])),r(e),function(e){var t=[],n=[],r=[],i=[],a=new Wu.TopologicalSort(e).order();ae.defines.NODE_RGB_NUM=ae.nodeRGB.length,ae.defines.NODE_VALUE_NUM=ae.nodeValue.length,ae.defines.NODE_TEX_COORD_NUM=ae.nodeTexCoordObject.length;for(var o=0;o<a.length;o++){var s,l=(f=e.node(a[o])).originData.type;ae.defines["NODE_"+l]="","OSL_NODE"==l&&(ae.defines.USE_OSL=""),(d="OSL_NODE"!=l?(s="node_"+l.toLowerCase()+"_vert",Ki[s]):f.originData.vertCode)&&t.indexOf(d)<0&&t.push(d),(h="OSL_NODE"!=l?(s="node_"+l.toLowerCase()+"_frag",Ki[s]):f.originData.fragCode)&&r.indexOf(h)<0&&r.push(h);for(var c=0;c<f.attributes.length;c++){var u=f.attributes[c],d=u.type+" "+u.name+";";"uv"!=u.name&&t.indexOf(d)<0&&t.push(d)}for(var h,p,c=0;c<f.params.length;c++)M(g=f.params[c])?(h=g.type+" "+g.name+";",r.indexOf(h)<0&&r.push(h)):C(g)&&(p=g.type+" "+g.name+";",t.indexOf(p)<0&&t.push(p),p=g.type+" "+g.name+";",r.indexOf(p)<0&&r.push(p))}for(var f,o=0;o<a.length;o++){if("CHECKERBOARD_AR"==(l=(f=e.node(a[o])).originData.type)||"IMAGE_AR"==l||"TWO_SIDED_AR"==l||"ATTRIBUTE_BL"==l||"NEW_GEOMETRY_BL"==l||"NORMAL_MAP_BL"==l||"TANGENT_BL"==l||"TEX_COORD_BL"==l||"UVMAP_BL"==l||"VERTEX_COLOR_BL"==l||"BITMAP_MX"==l||"NOISE_MX"==l||"NORMAL_BUMP_MX"==l||"BUMP_MX"==l||"VERTEX_COLOR_MX"==l||"GRADIENT_RAMP_MX"==l||"BUMP_2D_MY"==l||"PLACE_2D_TEXTURE_MY"==l||"SAMPLER_INFO_MY"==l||"OSL_NODE"==l||"U_FLOAT"==l)for(var m,c=0;c<f.params.length;c++)C(g=f.params[c])&&(m=g.name+"="+g.attrBindName+";",n.indexOf(m)<0&&n.push(m));for(c=0;c<f.outputs.length;c++)(x=f.outputs[c]).type&&i.push(x.type+" "+x.name+";");for(var g,v=[],c=0;c<f.params.length;c++)!(g=f.params[c]).type||M(g)||C(g)?v.push(g.name):v.push(Me(g.type,g.value));for(c=0;c<f.inputs.length;c++){var A=f.inputs[c];v.push(A.code)}for(var _,c=0;c<f.outputs.length;c++){var x=f.outputs[c];v.push(x.name)}switch("OSL_NODE"!=l?(_="node_"+l.toLowerCase(),(l.endsWith("_AR")||l.endsWith("_BL")||l.endsWith("_MX")||l.endsWith("_MY"))&&(_=_.slice(0,-3))):_=f.originData.shaderName,l){case"MATH_BL":case"VECT_MATH_BL":_+="_"+f.originData.operation.toLowerCase();break;case"VECTOR_ROTATE_BL":_+="_"+f.originData.rotationType.toLowerCase();break;case"MIX_RGB_BL":_+="_"+f.originData.blendType.toLowerCase()}i.push(_+"("+v.join(",")+");");for(c=0;c<f.outputs.length;c++){var y=(x=f.outputs[c]).name;x.clamp&&(l=x.type,i.push(y+"=clamp("+y+","+l+"(0.0),"+l+"(1.0));")),x.normalize&&i.push(y+"=normalize("+y+");")}}ae.nodeChunks.node_pars_vertex=t.join("\n"),ae.nodeChunks.node_vertex=n.join("\n"),ae.nodeChunks.node_pars_fragment=r.join("\n"),ae.nodeChunks.node_fragment=i.join("\n"),ae.nodeChunksHash=zt(JSON.stringify(ae.nodeChunks))}(e)},function(e){for(var t=0;t<e.len();t++){var n=e.node(t),r=n.originData.type;if("GROUP_BL"==r){var i=n.originData.nodeGraph,n=ae.additionalNodeGraphs[i];if(A(e,t),n.len()<=2){for(var a=e.findInEdges(t),o=e.findOutEdges(t),s=Math.min(a.length,o.length),l=0;l<s;l++){var c=a[l],u=o[l];(v=new Wu.Edge(c.from(),u.to(),0)).connections=[];for(var d=Math.min(c.connections.length,u.connections.length),h=0;h<d;h++){var p=c.connections[h],f=u.connections[h],m={from:p.from,to:f.to};v.connections.push(m)}e.addEdge(v)}e.disconnect(t,!0),t=-1}else{i=function(e,t,n){var r={inputs:[],outputs:[],removedNodes:[]};r.removedNodes.push(n);var i=y(t,"GROUP_INPUT_BL");if(-1<i){r.removedNodes.push(i+e.len());for(var a=e.findInEdges(n),o=t.findOutEdges(i),s=0;s<a.length;s++)for(var l=a[s],c=0;c<o.length;c++)for(var u=o[c],d=0;d<l.connections.length;d++)for(var h=l.connections[d],p=0;p<u.connections.length;p++){var f=u.connections[p];h.to==f.from&&((_=b(r.inputs,l.from(),u.to()))||((_=new Wu.Edge(l.from(),u.to(),0)).connections=[],r.inputs.push(_)),x={from:h.from,to:f.to},_.connections.push(x))}}i=y(t,"GROUP_OUTPUT_BL");r.removedNodes.push(i+e.len());for(var m=e.findOutEdges(n),g=t.findInEdges(i),s=0;s<m.length;s++)for(var v=m[s],c=0;c<g.length;c++)for(var A=g[c],d=0;d<v.connections.length;d++)for(h=v.connections[d],p=0;p<A.connections.length;p++){var _,x,f=A.connections[p];h.from==f.to&&((_=b(r.outputs,A.from(),v.to()))||((_=new Wu.Edge(A.from(),v.to(),0)).connections=[],r.outputs.push(_)),x={from:f.from,to:h.to},_.connections.push(x))}return r}(e,n,t);e.insert(n,i.inputs,i.outputs);for(var g=i.removedNodes.sort(function(e,t){return t-e}),l=0;l<g.length;l++)e.disconnect(g[l],!0);t=-1}}else if("REROUTE_BL"!=r){if("OSL_OUTPUT_SELECTOR_MX"==r){for(a=e.findInEdges(t),o=e.findOutEdges(t),p=(c=a[0]).connections[0],l=0;l<o.length;l++){u=o[l];(v=new Wu.Edge(c.from(),u.to(),0)).connections=[];for(h=0;h<u.connections.length;h++){f=u.connections[h],m={from:p.from,to:f.to};v.connections.push(m)}e.addEdge(v)}e.disconnect(t,!0),t=-1}}else{e.findInEdges(t).length<1&&A(e,t);for(var a=e.findInEdges(t),o=e.findOutEdges(t),p=(c=a[0]).connections[0],l=0;l<o.length;l++){var v,u=o[l];(v=new Wu.Edge(c.from(),u.to(),0)).connections=[];for(var h=0;h<u.connections.length;h++){var f=u.connections[h],m={from:p.from,to:f.to};v.connections.push(m)}e.addEdge(v)}e.disconnect(t,!0),t=-1}}}(ae.nodeGraph),function(e){for(var t=0;t<e.len();t++){"TEX_IMAGE_BL"!=(d=(g=e.node(t).originData).type)||de(e,t,0)||(e.addNode({originData:{name:"UVMapGenerated",type:"UVMAP_BL",uvLayer:"",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,0)),"TEX_BRICK_BL"!=d&&"TEX_CHECKER_BL"!=d&&"TEX_GRADIENT_BL"!=d&&"TEX_NOISE_BL"!=d&&"TEX_WAVE_BL"!=d&&"TEX_VORONOI_BL"!=d&&"TEX_SKY_BL"!=d||de(e,t,0)||(e.addNode({originData:{name:"TexCoordGenerated",type:"TEX_COORD_BL",inputs:[],outputs:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}}),hd(e,e.len()-1,0,t,0)),"TEX_ENVIRONMENT_BL"!=d&&"TEX_ENVIRONMENT_MX"!=d||de(e,t,0)||(e.addNode({originData:{name:"TexCoordObject",type:"TEX_COORD_BL",inputs:[],outputs:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}}),hd(e,e.len()-1,3,t,0));var n=d;if("BSDF_PRINCIPLED_BL"==n)switch(g.inputs.length){case 23:n="BSDF_PRINCIPLED_<3.0_BL";break;case 22:n="BSDF_PRINCIPLED_<2.91.0_BL"}if("STANDARD_SURFACE_AR"==(n="BUMP_BL"==n&&4==g.inputs.length?"BUMP_<2.81_BL":n)&&25==g.inputs.length&&(console.warn("v3d.MeshNodeMaterial: adding missing params to standard surface node, please reexport your scene"),g.inputs.push([0,0,0])),"SAMPLER_INFO_MY"==n&&0==g.inputs.length&&(console.warn("v3d.MeshNodeMaterial: adding missing params to samplerInfo node, please reexport your scene"),g.inputs.push([0,0,0])),"ARNOLD_MAP_TO_MTL_MX"==n&&(console.warn("v3d.MeshNodeMaterial: renaming Map To Material node, please reexport your scene"),g.type=n="MAP_TO_MTL_AR"),n in ud&&!de(e,t,ud[n])&&(e.addNode({originData:{name:"Normal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,ud[n])),"BSDF_PRINCIPLED_<2.91.0_BL"==n&&!de(e,t,20)&&(0<g.inputs[12]||de(e,t,12))&&(e.addNode({originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,20)),"BSDF_PRINCIPLED_<3.0_BL"==n&&!de(e,t,21)&&(0<g.inputs[12]||de(e,t,12))&&(e.addNode({originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,21)),"BSDF_PRINCIPLED_BL"==n&&!de(e,t,23)&&(0<g.inputs[14]||de(e,t,14))&&(e.addNode({originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,23)),"EEVEE_SPECULAR_BL"==n&&!de(e,t,8)&&(0<g.inputs[6]||de(e,t,6))&&(e.addNode({originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,8)),"OSL_NODE"==n)for(var r=g.initializers,i=0;i<r.length;i++){var a=r[i];a&&!de(e,t,i)&&(a={originData:{name:n+"init"+i,type:"OSL_NODE",shaderName:g.shaderName+"_init_"+i,inputs:[],outputs:[g.inputs[0]],fragCode:a[0],globalVariables:a[1],initializers:[]}},e.addNode(a),hd(e,e.len()-1,0,t,i))}if("NORMAL_MAP_AR"!=n||de(e,t,1)&&de(e,t,3)||(e.addNode({originData:{name:"SamplerInfo",type:"SAMPLER_INFO_MY",inputs:[[0,0,0]],outputs:[0,!1,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0],[0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0]]}}),de(e,t,1)||hd(e,e.len()-1,3,t,1),de(e,t,3)||hd(e,e.len()-1,8,t,3)),"IMAGE_AR"!=n||de(e,t,2)||(e.addNode({originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}}),hd(e,e.len()-1,0,t,2)),"FILE_MY"!=n||de(e,t,0)||(e.addNode({originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}}),hd(e,e.len()-1,0,t,0)),"RAMP_MY"!=n||de(e,t,0)||(e.addNode({originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}}),hd(e,e.len()-1,0,t,0)),"BITMAP_MX"!=d&&"BITMAP_ENV_MX"!=d||$t(g.mapping)||(g.mapping="EXPLICIT_MAP_CHANNEL",g.axis="XY",g.clampToEdgeNoExtend=[!1,!1],console.warn("v3d.MeshNodeMaterial: adding missing params to bitmap node, please reexport your scene")),"GRADIENT_RAMP_MX"==d&&($t(g.mapping)||(g.mapping="EXPLICIT_MAP_CHANNEL",g.axis="XY",g.clampToEdgeNoExtend=[!1,!1],console.warn("v3d.MeshNodeMaterial: adding missing params to gradient ramp node, please reexport your scene"))),$t(g.output)&&function(e,t,n){var r=n.output,i=e.findInEdges(t),a=e.findOutEdges(t),o={originData:{name:n.name+"Output",type:"OUTPUT_MAP_MX",invert:r.invert,clamp:r.clamp,alphaFromRGB:r.alphaFromRGB,inputs:[[0,0,0,0],r.rgbLevel,r.rgbOffset,r.outputAmount,r.bumpAmount],outputs:[[0,0,0,0]]}};$t(r.colorMap)&&(o.originData.colorMap=r.colorMap);e.addNode(o);for(var s=0;s<a.length;s++)for(var l=a[s],c=0;c<l.connections.length;c++){var u=l.connections[c];hd(e,e.len()-1,0,l.to(),u.to)}e.disconnect(t,!1);for(s=0;s<i.length;s++)e.addEdge(i[s]);hd(e,t,0,e.len()-1,0),delete n.output}(e,t,g),_(d)){if(!$t(g.inputFactors)){g.inputFactors=[];for(i=0;i<g.inputs.length;i++)g.inputFactors.push(1)}g.inputs.push([0,0,0]),g.inputFactors.push(0)}if("STANDARD_SURFACE_AR"==n&&!de(e,t,25)&&(0<g.inputs[15]||de(e,t,15))&&(e.addNode({originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}}),hd(e,e.len()-1,0,t,25)),"BUMP_2D_MY"==d&&0<g.bumpInterp){g.inputs[1]=[0,0,0];for(var o=e.findInEdges(t),i=0;i<o.length;i++)for(var s=o[i],l=e.node(s.from()).originData,c=0;c<s.connections.length;c++)1==(f=s.connections[c]).to&&"FILE_MY"==l.type?f.from=1:1==f.to&&"IMAGE_AR"==l.type&&(f.from=0)}"COLOR_CONSTANT_MY"!=d||de(e,t,0)||de(e,t,1)||(g.type="RGB_ALPHA",g.inputs=[]),"FLOAT_CONSTANT_MY"!=d||de(e,t,0)||(g.type="VALUE",g.inputs=[])}for(var u=0,t=0;t<e.len();t++)"MATERIAL_MX"!=(d=(g=e.node(t).originData).type)&&"PHYSICAL_MX"!=d||(function(e,t,n){for(var r=n.type,i=e.findInEdges(t),a=0;a<i.length;a++)for(var o=i[a],s=e.node(o.from()).originData,l=0;l<o.connections.length;l++){var c=o.connections[l];if("MATERIAL_MX"==r&&x(s.type)&&(9==c.to?s.reflectMode="MAX_ENV_COORDS_REFLECT":10==c.to&&(s.reflectMode="MAX_ENV_COORDS_REFRACT")),se(r,c.to)){if("BITMAP_MX"==s.type||"OUTPUT_MAP_MX"==s.type){e.removeEdge(o.from(),o.to());var u={originData:{name:(s="OUTPUT_MAP_MX"==s.type?pe(e,o.from(),0).originData:s).name+"Bump"+a,type:"BUMP_MX",texture:s.texture,uvIndex:s.uvIndex,inputs:JSON.parse(JSON.stringify(s.inputs)),outputs:[[0,0,0]]}};e.addNode(u),hd(e,e.len()-1,0,t,c.to),a=-1,i=e.findInEdges(t);break}for(var d=0;d<e.len();d++){var h,p=e.node(d).originData;_(p.type)&&(h=p.inputs.length-1,hd(e,o.from(),c.from,d,h),p.inputFactors[h]=n.inputFactors[c.to])}}}}(e,t,g),"MATERIAL_MX"==d&&(u=g.IOR));for(var d,t=0;t<e.len();t++)x(d=(g=e.node(t).originData).type)&&(g.IOR=u),x(d)&&!$t(g.reflectMode)&&(g.reflectMode="MAX_ENV_COORDS_REFLECT");for(t=0;t<e.len();t++)"COMPOSITE_MX"==(g=e.node(t).originData).type&&(function(e,t,n){for(var r=n.blendMode.length,i=e.findInEdges(t),a=e.findOutEdges(t),o=0;o<r;o++){var s={originData:{name:n.name+"Layer"+o,type:"COMPOSITE_LAYER_MX",blendMode:0!=o?n.blendMode[o]:0,opacity:n.opacity[o],inputs:[[0,0,0,0]].concat(n.inputs.slice(2*o,2*o+2)),outputs:[n.outputs[o]]}};e.addNode(s);for(var l=0;l<i.length;l++)for(var c=i[l],u=0;u<c.connections.length;u++)(h=c.connections[u]).to==2*o&&n.mapEnabled[o]?hd(e,c.from(),h.from,e.len()-1,1):h.to==2*o+1&&n.maskEnabled[o]&&hd(e,c.from(),h.from,e.len()-1,2);0<o&&hd(e,e.len()-2,0,e.len()-1,0)}for(o=0;o<a.length;o++)for(var d=a[o],l=0;l<d.connections.length;l++){var h=d.connections[l];hd(e,e.len()-1,0,d.to(),h.to)}}(e,t,g),e.disconnect(t,!0));for(t=0;t<e.len();t++)"LAYERED_TEXTURE_MY"==(g=e.node(t).originData).type&&(function(e,t,n){for(var r=n.inputs.length/4,i=e.findInEdges(t),a=e.findOutEdges(t),o=0;o<r;o++){var s={originData:{name:n.name+"Layer"+o,type:"LAYERED_TEXTURE_LAYER_MY",inputs:[0,[0,0,0]].concat(n.inputs.slice(4*o,4*o+4)),outputs:[0,[0,0,0]]}};e.addNode(s);for(var l=0;l<i.length;l++)for(var c=i[l],u=0;u<c.connections.length;u++)(h=c.connections[u]).to==4*o?hd(e,c.from(),h.from,e.len()-1,2,h.channelMatrix):h.to==4*o+1?hd(e,c.from(),h.from,e.len()-1,3,h.channelMatrix):h.to==4*o+2?hd(e,c.from(),h.from,e.len()-1,4,h.channelMatrix):h.to==4*o+3&&hd(e,c.from(),h.from,e.len()-1,5,h.channelMatrix);0<o&&(hd(e,e.len()-1,0,e.len()-2,0),hd(e,e.len()-1,1,e.len()-2,1))}for(o=0;o<a.length;o++)for(var d=a[o],l=0;l<d.connections.length;l++){var h=d.connections[l];hd(e,e.len()-r,h.from,d.to(),h.to,h.channelMatrix)}}(e,t,g),e.disconnect(t,!0));if(ae.hasNode("SKYDOME_LIGHT_AR"))for(t=0;t<e.len();t++)if("FILE_MY"==(g=e.node(t).originData).type||"IMAGE_AR"==g.type){var h={originData:{name:"envSphere",type:"ENV_SPHERE_MY",inputs:[[-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]],outputs:[0,[0,0,0]],texture:g.texture}};e.addNode(h);for(var p=e.findOutEdges(t),i=0;i<p.length;i++)for(var f,m=p[i],c=0;c<m.connections.length;c++)(f=m.connections[c]).from<2&&hd(e,e.len()-1,f.from,m.to(),f.to);e.disconnect(t,!0),t=-1}for(t=0;t<e.len();t++)if("ENV_SPHERE_MY"==(g=e.node(t).originData).type&&2==g.inputs.length)for(o=e.findInEdges(t),i=0;i<o.length;i++){s=o[i];"FILE_MY"!=(l=e.node(s.from()).originData).type&&"IMAGE_AR"!=l.type||(g.inputs.splice(0,1),g.texture=l.texture,e.removeEdge(s.from(),s.to()))}for(var g,t=0;t<e.len();t++)switch((g=e.node(t).originData).type){case"BSDF_DIFFUSE_BL":case"BSDF_GLOSSY_BL":case"BSDF_TRANSLUCENT_BL":case"BSDF_PRINCIPLED_BL":v(e,t,g,0,"Color");break;case"MATERIAL_MX":v(e,t,g,0,"Ambient Color")&&(g.inputFactors[0]=1),v(e,t,g,1,"Diffuse Color")&&(g.inputFactors[1]=1);break;case"PHYSICAL_MX":v(e,t,g,1,"Base Color")&&(g.inputFactors[1]=1)}}(ae.nodeGraph),pd(ae.nodeGraph),this.updateNodeGraph()}static nodeTexUniName(e,t){return e.toLowerCase()+"_par_tex_idx"+t}static nodeGraphFromExtGraph(e){for(var t=e.nodes,n=e.edges,r=new Wu.DiGraph(t.length),i=0;i<t.length;i++){t[i];r.node(i).originData=t[i];var a,o=r.node(i).originData,s=o.type;a=s.startsWith("AI_")&&s.endsWith("_MY")?s.replace("AI_","").replace("_MY","_AR"):"STANDARD_SURFACE_MY"==s?"STANDARD_SURFACE_AR":s.endsWith("_AR")||s.endsWith("_BL")||s.endsWith("_MX")||s.endsWith("_MY")?s:s.endsWith("_MAX")?s.replace("_MAX","_MX"):"OSL_NODE"==s?s:s+"_BL",s!=(o.type=a)&&console.warn("v3d.MeshNodeMaterial: converting node type: "+s+"->"+a+", please reexport your scene")}for(i=0;i<n.length;i++){var l=n[i];r.edge(l.fromNode,l.toNode)||r.addNewEdge(l.fromNode,l.toNode);var c=r.edge(l.fromNode,l.toNode);if(c.connections=c.connections||[],$t(l.fromChannel)||$t(l.toChannel)){for(var u=null,d=0;d<c.connections.length;d++)if((f=c.connections[d]).from==l.fromOutput&&f.to==l.toInput&&f.channelMatrix){u=f.channelMatrix;break}u||(f={from:l.fromOutput,to:l.toInput,channelMatrix:u=[[0,0,0],[0,0,0],[0,0,0]]},c.connections.push(f));var h=l.fromChannel||0,p=l.toChannel||0;u[h][p]=1}else{var f={from:l.fromOutput,to:l.toInput};c.connections.push(f)}}return pd(r),r}static nodeGraphDiffuse(e,t,n="blender"){let r=new Wu.DiGraph(0),i;switch(n){case"blender":i=e.toArray(),i.push(1),r.addNode({originData:{name:"Output",type:"OUTPUT_MATERIAL_BL",inputs:[[0,0,0,0],[0,0,0,0],[0,0,0]],outputs:[],is_active_output:!0}}),t<1?(r.addNode({originData:{name:"Mix",type:"MIX_SHADER_BL",inputs:[t,[0,0,0,0],[0,0,0,0]],outputs:[[0,0,0,0]],is_active_output:!1}}),hd(r,1,0,0,0),r.addNode({originData:{name:"Transparent",type:"BSDF_TRANSPARENT_BL",inputs:[[1,1,1,1]],outputs:[[0,0,0,0]],is_active_output:!1}}),hd(r,2,0,1,1),r.addNode({originData:{name:"Diffuse",type:"BSDF_DIFFUSE_BL",inputs:[i,0,[0,0,0]],outputs:[[0,0,0,0]],is_active_output:!1}}),hd(r,3,0,1,2)):(r.addNode({originData:{name:"Diffuse",type:"BSDF_DIFFUSE_BL",inputs:[i,0,[0,0,0]],outputs:[[0,0,0,0]],is_active_output:!1}}),hd(r,1,0,0,0));break;case"max":i=e.toArray(),r.addNode({originData:{name:"Diffuse",type:"LAMBERT_AR",inputs:[1,i,[0,0,0],[t,t,t]],outputs:[[0,0,0,0],0,[0,0,0]],is_active_output:!1}}),r.addNode({originData:{name:"Output",type:"OUTPUT_MX",inputs:[[0,0,0,0]],outputs:[],is_active_output:!0}}),hd(r,0,0,1,0);break;case"maya":i=e.toArray(),r.addNode({originData:{name:"Diffuse",type:"LAMBERT_MY",inputs:[i,[0,0,0],[0,0,0],1,.8,[1,1,1],0,[1-t,1-t,1-t]],outputs:[[0,0,0,0]],is_active_output:!1}}),r.addNode({originData:{name:"Output",type:"SHADING_ENGINE_MY",inputs:[[0,0,0,0],[0,0,0,0],[0,0,0]],outputs:[],is_active_output:!0}}),hd(r,0,0,1,0);break;default:console.error("nodeGraphDiffuse: Incorrect material profile - "+n),r=null}return r}hasNode(e){for(var t=0;t<this.nodeGraph.len();t++)if(this.nodeGraph.node(t).originData.type==e)return!0;return!1}traverseNodes(e){for(var t=0;t<this.nodeGraph.len();t++)e(this.nodeGraph.node(t))}findNodeByName(e){for(var t=0;t<this.nodeGraph.len();t++){var n=this.nodeGraph.node(t);if(n.originData.name===e)return n}return null}needsLightPathDir(){return!!(this.hasNode("LIGHT_PATH_BL")||this.hasNode("LIGHT_PATH_MY")||this.hasNode("RAY_SWITCH_AR")||"USE_OSL"in this.defines)}canUseGTAO(){return(this.hasNode("BSDF_DIFFUSE_BL")||this.hasNode("SUBSURFACE_SCATTERING_BL")||this.hasNode("PHYSICAL_MX")||this.hasNode("STANDARD_SURFACE_AR")||this.hasNode("BSDF_GLASS_BL")||this.hasNode("BSDF_GLOSSY_BL")||this.hasNode("BSDF_PRINCIPLED_BL")||this.hasNode("EEVEE_SPECULAR_BL"))&&this.gtaoVisible}copy(e){super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Bi.clone(e.uniforms),this.linewidth=e.linewidth,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.clipping=e.clipping,this.index0AttributeName=this.index0AttributeName,this.color.copy(e.color),this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.envMapParallaxType=e.envMapParallaxType,this.envMapParallaxMatrix.copy(e.envMapParallaxMatrix),this.envMapParallaxMatrixInv.copy(e.envMapParallaxMatrixInv),this.reflectivity=e.reflectivity,this.materialIndex=e.materialIndex,this.extensions=e.extensions,this.profile=e.profile,this.nodeTextures=e.nodeTextures,this.nodeRGB=e.nodeRGB.slice(),this.nodeRGBMap=Object.assign({},e.nodeRGBMap),this.nodeRGBArr=e.nodeRGBArr.slice(),this.nodeTexCoordObject=e.nodeTexCoordObject.slice(),this.nodeTexCoordObjectMap=Object.assign({},e.nodeTexCoordObjectMap),this.nodeTexCoordObjectArr=e.nodeTexCoordObjectArr.slice(),this.nodeValue=e.nodeValue.slice(),this.nodeValueMap=Object.assign({},e.nodeValueMap),this.needsBoundingBox=e.needsBoundingBox,this.useFloatTex=e.useFloatTex,this.nodeGraph=new Wu.DiGraph(e.nodeGraph.len());for(var t,n=0;n<this.nodeGraph.len();n++)this.nodeGraph.node(n).originData=e.nodeGraph.node(n).originData;for(t in e.nodeGraph.edges){var r=e.nodeGraph.edges[t];this.nodeGraph.addNewEdge(r.from(),r.to()).connections=r.connections.slice()}return this.additionalNodeGraphs=Object.assign({},e.additionalNodeGraphs),this.nodeChunks=Object.assign({},e.nodeChunks),this.nodeChunksHash=e.nodeChunksHash,this.nodeVCAliases=Object.assign({},e.nodeVCAliases),this.nodeUVAliases=Object.assign({},e.nodeUVAliases),this}toJSON(e){e=Gr.prototype.toJSON.call(this,e);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e}}function hd(e,t,n,r,i,a){e.edge(t,r)||e.addNewEdge(t,r);r=e.edge(t,r);r.connections=r.connections||[];i={from:n,to:i};a&&(i.channelMatrix=a),r.connections.push(i)}function pd(t){for(var e=-1,n=0;n<t.len();n++)if(t.node(n).originData.is_active_output){e=n;break}if(-1==e)t.removeAll();else{for(var r=new Wu.DepthFirstSearch(t.reverse(),e),i=[],n=0;n<t.len();n++)r.hasPathTo(n)||i.push(t.node(n));i.forEach(function(e){t.disconnect(t.nodeIndex(e),!0)})}}dd.prototype.isMeshNodeMaterial=!0;var fd=Object.freeze({__proto__:null,ShadowMaterial:Bu,SpriteMaterial:dl,RawShaderMaterial:aa,ShaderMaterial:Pi,PointsMaterial:ic,MeshPhysicalMaterial:Du,MeshStandardMaterial:Pu,MeshPhongMaterial:Nu,MeshToonMaterial:Fu,MeshNormalMaterial:Ou,MeshLambertMaterial:Uu,MeshDepthMaterial:ws,MeshDistanceMaterial:Es,MeshBasicMaterial:kr,MeshMatcapMaterial:zu,LineDashedMaterial:Vu,LineBasicMaterial:Xl,Material:Gr,MeshMaskMaterial:Gu,MeshNodeMaterial:dd});const md={arraySlice:function(e,t,n){return md.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(n){var t=n.length;const r=new Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort(function(e,t){return n[e]-n[t]}),r},sortedArray:function(n,r,i){var a=n.length;const o=new n.constructor(a);for(let e=0,t=0;t!==a;++e){var s=i[e]*r;for(let e=0;e!==r;++e)o[t++]=n[s+e]}return o},flattenJSON:function(t,n,r,i){let a=1,o=t[0];for(;void 0!==o&&void 0===o[i];)o=t[a++];if(void 0!==o){let e=o[i];if(void 0!==e)if(Array.isArray(e))for(;e=o[i],void 0!==e&&(n.push(o.time),r.push.apply(r,e)),o=t[a++],void 0!==o;);else if(void 0!==e.toArray)for(;e=o[i],void 0!==e&&(n.push(o.time),e.toArray(r,r.length)),o=t[a++],void 0!==o;);else for(;e=o[i],void 0!==e&&(n.push(o.time),r.push(e)),o=t[a++],void 0!==o;);}},subclip:function(e,t,n,r,i=30){const a=e.clone();a.name=t;const o=[];for(let e=0;e<a.tracks.length;++e){const u=a.tracks[e];var s=u.getValueSize();const d=[],h=[];for(let t=0;t<u.times.length;++t){var l=u.times[t]*i;if(!(l<n||r<=l)){d.push(u.times[t]);for(let e=0;e<s;++e)h.push(u.values[t*s+e])}}0!==d.length&&(u.times=md.convertArray(d,u.times.constructor),u.values=md.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;let c=1/0;for(let e=0;e<a.tracks.length;++e)c>a.tracks[e].times[0]&&(c=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*c);return a.resetDuration(),a},makeClipAdditive:function(t,e=0,n=t,r=30){var i=n.tracks.length,a=e/(r=r<=0?30:r);for(let e=0;e<i;++e){const m=n.tracks[e],g=m.ValueTypeName;if("bool"!==g&&"string"!==g){const v=t.tracks.find(function(e){return e.name===m.name&&e.ValueTypeName===g});if(void 0!==v){let e=0;var o=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=o/3);let t=0;var s=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=s/3);var l=m.times.length-1;let n;if(a<=m.times[0]){var c=e,u=o-e;n=md.arraySlice(m.values,c,u)}else if(a>=m.times[l]){var l=l*o+e,d=l+o-e;n=md.arraySlice(m.values,l,d)}else{const A=m.createInterpolant();d=e,o=o-e;A.evaluate(a),n=md.arraySlice(A.resultBuffer,d,o)}if("quaternion"===g){const _=(new Sn).fromArray(n).normalize().conjugate();_.toArray(n)}var h=v.times.length;for(let e=0;e<h;++e){var p=e*s+t;if("quaternion"===g)Sn.multiplyQuaternionsFlat(v.values,p,n,0,v.values,p);else{var f=s-2*t;for(let e=0;e<f;++e)v.values[p+e]-=n[e]}}}}}return t.blendMode=2501,t}};class gd extends ku{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ut,endingEnd:ut}}intervalChanged_(e,t,n){var r=this.parameterPositions;let i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case dt:i=e,o=2*t-n;break;case ht:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case dt:a=e,s=2*n-t;break;case ht:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p;var g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,A=(-1-h)*m+(1.5+h)*f+.5*p,_=h*m-h*f;for(let e=0;e!==o;++e)i[e]=g*a[c+e]+v*a[l+e]+A*a[s+e]+_*a[u+e];return i}}class vd{constructor(e,t,n,r){if(void 0===e)throw new Error("v3d.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("v3d.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=md.convertArray(t,this.TimeBufferType),this.values=md.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;var r;return t.toJSON!==this.toJSON?n=t.toJSON(e):(n={name:e.name,times:md.convertArray(e.times,Array),values:md.convertArray(e.values,Array)},(r=e.getInterpolation())!==e.DefaultInterpolation&&(n.interpolation=r)),n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Qu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ed(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new gd(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case lt:t=this.InterpolantFactoryMethodDiscrete;break;case ct:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("v3d.KeyframeTrack:",n),this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return lt;case this.InterpolantFactoryMethodLinear:return ct;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(n){if(0!==n){const r=this.times;for(let e=0,t=r.length;e!==t;++e)r[e]+=n}return this}scale(n){if(1!==n){const r=this.times;for(let e=0,t=r.length;e!==t;++e)r[e]*=n}return this}trim(e,t){var n,r=this.times,i=r.length;let a=0,o=i-1;for(;a!==i&&r[a]<e;)++a;for(;-1!==o&&r[o]>t;)--o;return++o,0===a&&o===i||(a>=o&&(o=Math.max(o,1),a=o-1),n=this.getValueSize(),this.times=md.arraySlice(r,a,o),this.values=md.arraySlice(this.values,a*n,o*n)),this}validate(){let n=!0;var e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("v3d.KeyframeTrack: Invalid value size in track.",this),n=!1);var t=this.times,r=this.values,i=t.length;0===i&&(console.error("v3d.KeyframeTrack: Track is empty.",this),n=!1);let a=null;for(let e=0;e!==i;e++){var o=t[e];if("number"==typeof o&&isNaN(o)){console.error("v3d.KeyframeTrack: Time is not a valid number.",this,e,o),n=!1;break}if(null!==a&&a>o){console.error("v3d.KeyframeTrack: Out of order keys.",this,e,o,a),n=!1;break}a=o}if(void 0!==r&&md.isTypedArray(r))for(let e=0,t=r.length;e!==t;++e){var s=r[e];if(isNaN(s)){console.error("v3d.KeyframeTrack: Value is not a valid number.",this,e,s),n=!1;break}}return n}optimize(){const n=md.arraySlice(this.times),r=md.arraySlice(this.values),i=this.getValueSize(),a=2302===this.getInterpolation(),o=n.length-1;let s=1;for(let e=1;e<o;++e){let t=!1;var l=n[e];if(l!==n[e+1]&&(1!==e||l!==n[0]))if(a)t=!0;else{var c=e*i,u=c-i,d=c+i;for(let e=0;e!==i;++e){var h=r[c+e];if(h!==r[u+e]||h!==r[d+e]){t=!0;break}}}if(t){if(e!==s){n[s]=n[e];var p=e*i,f=s*i;for(let e=0;e!==i;++e)r[f+e]=r[p+e]}++s}}if(0<o){n[s]=n[o];for(let e=o*i,t=s*i,n=0;n!==i;++n)r[t+n]=r[e+n];++s}return s!==n.length?(this.times=md.arraySlice(n,0,s),this.values=md.arraySlice(r,0,s*i)):(this.times=n,this.values=r),this}clone(){var e=md.arraySlice(this.times,0),t=md.arraySlice(this.values,0);const n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}vd.prototype.TimeBufferType=Float32Array,vd.prototype.ValueBufferType=Float32Array,vd.prototype.DefaultInterpolation=ct;class Ad extends vd{}Ad.prototype.ValueTypeName="bool",Ad.prototype.ValueBufferType=Array,Ad.prototype.DefaultInterpolation=lt,Ad.prototype.InterpolantFactoryMethodLinear=void 0,Ad.prototype.InterpolantFactoryMethodSmooth=void 0;class _d extends vd{}_d.prototype.ValueTypeName="color";class xd extends vd{}xd.prototype.ValueTypeName="number";class yd extends ku{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let l=e*o;for(var c=l+o;l!==c;l+=4)Sn.slerpFlat(i,0,a,l-o,a,l,s);return i}}class bd extends vd{InterpolantFactoryMethodLinear(e){return new yd(this.times,this.values,this.getValueSize(),e)}}bd.prototype.ValueTypeName="quaternion",bd.prototype.DefaultInterpolation=ct,bd.prototype.InterpolantFactoryMethodSmooth=void 0;class Md extends vd{}Md.prototype.ValueTypeName="string",Md.prototype.ValueBufferType=Array,Md.prototype.DefaultInterpolation=lt,Md.prototype.InterpolantFactoryMethodLinear=void 0,Md.prototype.InterpolantFactoryMethodSmooth=void 0;class Cd extends vd{}class Sd{constructor(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=It(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,i=1/(e.fps||1);for(let e=0,t=r.length;e!==t;++e)n.push(function(e){if(void 0===e.type)throw new Error("v3d.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return xd;case"vector":case"vector2":case"vector3":case"vector4":return Cd;case"color":return _d;case"quaternion":return bd;case"bool":case"boolean":return Ad;case"string":return Md}throw new Error("v3d.KeyframeTrack: Unsupported typeName: "+e)}(e.type);{var n,r;void 0===e.times&&(n=[],r=[],md.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r)}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}(r[e]).scale(i));const t=new this(e.name,e.duration,n,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){const n=[],r=e.tracks;e={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=r.length;e!==t;++e)n.push(vd.toJSON(r[e]));return e}static CreateFromMorphTargetSequence(e,r,i,a){var o=r.length;const s=[];for(let n=0;n<o;n++){let e=[],t=[];e.push((n+o-1)%o,n,(n+1)%o),t.push(0,1,0);var l=md.getKeyframeOrder(e);e=md.sortedArray(e,1,l),t=md.sortedArray(t,1,l),a||0!==e[0]||(e.push(o),t.push(t[0])),s.push(new xd(".morphTargetInfluences["+r[n].name+"]",e,t).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(n,e,t){const r={};var i=/^([\w-]*?)([\d]+)$/;for(let e=0,t=n.length;e<t;e++){const s=n[e];var a=s.name.match(i);if(a&&1<a.length){a=a[1];let e=r[a];e||(r[a]=e=[]),e.push(s)}}const o=[];for(const l in r)o.push(this.CreateFromMorphTargetSequence(l,r[l],e,t));return o}static parseAnimation(e,t){if(!e)return console.error("v3d.AnimationClip: No animation in JSONLoader data."),null;function n(e,t,n,r,i){var a,o;0!==n.length&&(a=[],o=[],md.flattenJSON(n,a,o,r),0!==a.length&&i.push(new e(t,a,o)))}const r=[];var i=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;var l=e.hierarchy||[];for(let e=0;e<l.length;e++){var c=l[e].keys;if(c&&0!==c.length)if(c[0].morphTargets){const h={};let t;for(t=0;t<c.length;t++)if(c[t].morphTargets)for(let e=0;e<c[t].morphTargets.length;e++)h[c[t].morphTargets[e]]=-1;for(const p in h){const f=[],m=[];for(let e=0;e!==c[t].morphTargets.length;++e){var u=c[t];f.push(u.time),m.push(u.morphTarget===p?1:0)}r.push(new xd(".morphTargetInfluence["+p+"]",f,m))}s=h.length*(a||1)}else{var d=".bones["+t[e].name+"]";n(Cd,d+".position",c,"pos",r),n(bd,d+".quaternion",c,"rot",r),n(Cd,d+".scale",c,"scl",r)}}return 0===r.length?null:new this(i,s,r,o)}resetDuration(){let n=0;for(let e=0,t=this.tracks.length;e!==t;++e){var r=this.tracks[e];n=Math.max(n,r.times[r.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}const wd={enabled:!(Cd.prototype.ValueTypeName="vector"),files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Ed{constructor(e,t,n){const r=this;let i=!1,a=0,o=0,s=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(n){for(let e=0,t=l.length;e<t;e+=2){const i=l[e];var r=l[e+1];if(i.global&&(i.lastIndex=0),i.test(n))return r}return null}}}const Td=new Ed;class Id{constructor(e){this.manager=void 0!==e?e:Td,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,r){const i=this;return new Promise(function(e,t){i.load(n,e,r,t)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Rd={};class Ld extends Id{constructor(e){super(e)}load(a,e,t,n){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);const r=wd.get(a);if(void 0!==r)return this.manager.itemStart(a),setTimeout(()=>{e&&e(r),this.manager.itemEnd(a)},0),r;if(void 0===Rd[a]){Rd[a]=[],Rd[a].push({onLoad:e,onProgress:t,onError:n});var i=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});const o=this.mimeType,s=this.responseType;fetch(i).then(e=>{if(200!==e.status&&0!==e.status)throw Error(`fetch for "${e.url}" responded with ${e.status}: `+e.statusText);{if(0===e.status&&console.warn("v3d.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body.getReader)return e;const s=Rd[a],t=e.body.getReader();e=e.headers.get("Content-Length");const l=e?parseInt(e):0,c=0!==l;let o=0;e=new ReadableStream({start(a){!function i(){t.read().then(({done:e,value:t})=>{if(e)a.close();else{o+=t.byteLength;const n=new ProgressEvent("progress",{lengthComputable:c,loaded:o,total:l});for(let e=0,t=s.length;e<t;e++){const r=s[e];r.onProgress&&r.onProgress(n)}a.enqueue(t),i()}})}()}});return new Response(e)}}).then(e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>{const t=new DOMParser;return t.parseFromString(e,o)});case"json":return e.json();default:if(void 0===o)return e.text();{const n=/charset="?([^;"\s]*)"?/i,r=n.exec(o);var t=r&&r[1]?r[1].toLowerCase():void 0;const i=new TextDecoder(t);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(n=>{wd.add(a,n);var r=Rd[a];delete Rd[a];for(let e=0,t=r.length;e<t;e++){const i=r[e];i.onLoad&&i.onLoad(n)}}).catch(n=>{var r=Rd[a];if(void 0===r)throw this.manager.itemError(a),n;delete Rd[a];for(let e=0,t=r.length;e<t;e++){const i=r[e];i.onError&&i.onError(n)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}else Rd[a].push({onLoad:e,onProgress:t,onError:n})}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Bd extends Id{constructor(e){super(e)}load(t,n,e,r){const i=this,a=new Ld(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(e){try{n(i.parse(JSON.parse(e)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}},e,r)}parse(t){const n=[];for(let e=0;e<t.length;e++){var r=Sd.parse(t[e]);n.push(r)}return n}}class Pd extends Id{constructor(e){super(e)}load(n,i,r,a){const o=this,s=[],l=new pc,c=new Ld(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(o.withCredentials);let u=0;if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)!function(t){c.load(n[t],function(e){e=o.parse(e,!0);s[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},u+=1,6===u&&(1===e.mipmapCount&&(l.minFilter=Ge),l.image=s,l.format=e.format,l.needsUpdate=!0,i&&i(l))},r,a)}(e);else c.load(n,function(e){var n=o.parse(e,!0);if(n.isCubemap){var r=n.mipmaps.length/n.mipmapCount;for(let t=0;t<r;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}l.image=s}else l.image.width=n.width,l.image.height=n.height,l.mipmaps=n.mipmaps;1===n.mipmapCount&&(l.minFilter=Ge),l.format=n.format,l.needsUpdate=!0,i&&i(l)},r,a);return l}}class Dd extends Id{constructor(e){super(e)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,a=wd.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0),a;const o=Jt("img");function s(){c(),wd.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){c(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}class Nd extends Id{constructor(e){super(e)}load(n,r,e,i){const a=new Oi,o=new Dd(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;for(let e=0;e<n.length;++e)!function(t){o.load(n[t],function(e){a.images[t]=e,s++,6===s&&(a.needsUpdate=!0,r&&r(a))},void 0,i)}(e);return a}}class Fd extends Id{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Ol,o=new Ld(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,function(e){e=i.parse(e);e&&(void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:ze,a.wrapT=void 0!==e.wrapT?e.wrapT:ze,a.magFilter=void 0!==e.magFilter?e.magFilter:Ge,a.minFilter=void 0!==e.minFilter?e.minFilter:Ge,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.encoding&&(a.encoding=e.encoding),void 0!==e.flipY&&(a.flipY=e.flipY),void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps,a.minFilter=ke),1===e.mipmapCount&&(a.minFilter=Ge),void 0!==e.generateMipmaps&&(a.generateMipmaps=e.generateMipmaps),a.needsUpdate=!0,t&&t(a,e))},n,r),a}}class Od extends Id{constructor(e){super(e)}load(e,t,n,r){const i=new _n,a=new Dd(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}class Ud extends Tr{constructor(e,t=1){super(),this.type="Light",this.color=new mn(e),this.intensity=t,this.isFreeLight=void 0}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this.isFreeLight=e.isFreeLight,this}getWorldDirection(e){this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Ud.prototype.isLight=!0;class zd extends Ud{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(Tr.DefaultUp),this.updateMatrix(),this.groundColor=new mn(t)}copy(e){return Ud.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}zd.prototype.isHemisphereLight=!0;const Vd=new wn;class Gd extends Ud{constructor(e,t,n=0,r=Math.PI/3,i=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(Tr.DefaultUp),this.updateMatrix(),this.target=new Tr,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.shadow=new Us}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.isFreeLight&&this.updateFreeLightTarget()}updateFreeLightTarget(){Vd.set(0,0,-1).applyQuaternion(this.quaternion).normalize(),this.target.position.addVectors(this.position,Vd),this.target.updateMatrix()}}Gd.prototype.isSpotLight=!0;const kd=new rr,Qd=new wn,Wd=new wn;class Hd extends Ps{constructor(){super(new Ni(90,1,.5,500)),this._frameExtents=new Yt(4,2),this._viewportCount=6,this._viewports=[new yn(2,1,1,1),new yn(0,1,1,1),new yn(3,1,1,1),new yn(1,1,1,1),new yn(3,0,1,1),new yn(1,0,1,1)],this._cubeDirections=[new wn(1,0,0),new wn(-1,0,0),new wn(0,0,1),new wn(0,0,-1),new wn(0,1,0),new wn(0,-1,0)],this._cubeUps=[new wn(0,1,0),new wn(0,1,0),new wn(0,1,0),new wn(0,1,0),new wn(0,0,1),new wn(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix;var i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Qd.setFromMatrixPosition(e.matrixWorld),n.position.copy(Qd),Wd.copy(n.position),Wd.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Wd),n.updateMatrixWorld(),r.makeTranslation(-Qd.x,-Qd.y,-Qd.z),kd.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kd)}}Hd.prototype.isPointLightShadow=!0;class Yd extends Ud{constructor(e,t,n=0,r=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Hd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Yd.prototype.isPointLight=!0;class Xd extends Ps{constructor(){super(new ia(-5,5,5,-5,.5,500))}}Xd.prototype.isDirectionalLightShadow=!0;class jd extends Ps{constructor(){super(new ia(-5,5,5,-5,.5,500)),this.maxDistance=10}copy(e){return super.copy(e),this.maxDistance=e.maxDistance,this}}jd.prototype.isDirectionalLightShadowCSM=!0;const Kd=new wn;class qd extends Ud{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Tr.DefaultUp),this.updateMatrix(),this.target=new Tr,this.shadow=new Xd}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.isFreeLight&&this.updateFreeLightTarget()}updateFreeLightTarget(){Kd.set(0,0,-1).applyQuaternion(this.quaternion).normalize(),this.target.position.addVectors(this.position,Kd),this.target.updateMatrix()}}qd.prototype.isDirectionalLight=!0;class Zd extends Ud{constructor(e,t){super(e,t),this.type="AmbientLight"}}Zd.prototype.isAmbientLight=!0;class Jd extends Hd{constructor(){super()}}Jd.prototype.isRectAreaLightShadow=!0;class $d extends Ud{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r,this.shadow=new Jd}get power(){return 2*this.intensity*Math.PI}set power(e){this.intensity=e/(2*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}$d.prototype.isRectAreaLight=!0;class eh{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new wn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){var n=e.x,r=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.282095),t.addScaledVector(e[1],.488603*r),t.addScaledVector(e[2],.488603*i),t.addScaledVector(e[3],.488603*n),t.addScaledVector(e[4],n*r*1.092548),t.addScaledVector(e[5],r*i*1.092548),t.addScaledVector(e[6],.315392*(3*i*i-1)),t.addScaledVector(e[7],n*i*1.092548),t.addScaledVector(e[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){var n=e.x,r=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.886227),t.addScaledVector(e[1],1.023328*r),t.addScaledVector(e[2],1.023328*i),t.addScaledVector(e[3],1.023328*n),t.addScaledVector(e[4],.858086*n*r),t.addScaledVector(e[5],.858086*r*i),t.addScaledVector(e[6],.743125*i*i-.247708),t.addScaledVector(e[7],.858086*n*i),t.addScaledVector(e[8],.429043*(n*n-r*r)),t}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,n){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(t.coefficients[e],n);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,n){for(let e=0;e<9;e++)this.coefficients[e].lerp(t.coefficients[e],n);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,n=0){const r=this.coefficients;for(let e=0;e<9;e++)r[e].fromArray(t,n+3*e);return this}toArray(t=[],n=0){const r=this.coefficients;for(let e=0;e<9;e++)r[e].toArray(t,n+3*e);return t}static getBasisAt(e,t){var n=e.x,r=e.y,e=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*e,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*n*e,t[8]=.546274*(n*n-r*r)}}eh.prototype.isSphericalHarmonics3=!0;class th extends Ud{constructor(e=new eh,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}th.prototype.isLightProbe=!0;class nh extends Id{constructor(e){super(e),this.textures={}}load(t,n,e,r){const i=this,a=new Ld(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(t,function(e){try{n(i.parse(JSON.parse(e)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}},e,r)}parse(t){const n=this.textures;function e(e){return void 0===n[e]&&console.warn("v3d.MaterialLoader: Undefined texture",e),n[e]}const r=new fd[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=t.sheen),void 0!==t.sheenColor&&(r.sheenColor=(new mn).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(r.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.specularIntensity&&(r.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.thickness&&(r.thickness=t.thickness),void 0!==t.attenuationDistance&&(r.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=0<t.vertexColors:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const a in t.uniforms){var i=t.uniforms[a];switch(r.uniforms[a]={},i.type){case"t":r.uniforms[a].value=e(i.value);break;case"c":r.uniforms[a].value=(new mn).setHex(i.value);break;case"v2":r.uniforms[a].value=(new Yt).fromArray(i.value);break;case"v3":r.uniforms[a].value=(new wn).fromArray(i.value);break;case"v4":r.uniforms[a].value=(new yn).fromArray(i.value);break;case"m3":r.uniforms[a].value=(new Xt).fromArray(i.value);break;case"m4":r.uniforms[a].value=(new rr).fromArray(i.value);break;default:r.uniforms[a].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const o in t.extensions)r.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=e(t.map)),void 0!==t.matcap&&(r.matcap=e(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Yt).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=e(t.specularMap)),void 0!==t.specularIntensityMap&&(r.specularIntensityMap=e(t.specularIntensityMap)),void 0!==t.specularColorMap&&(r.specularColorMap=e(t.specularColorMap)),void 0!==t.envMap&&(r.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Yt).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(r.transmissionMap=e(t.transmissionMap)),void 0!==t.thicknessMap&&(r.thicknessMap=e(t.thicknessMap)),void 0!==t.sheenColorMap&&(r.sheenColorMap=e(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(r.sheenRoughnessMap=e(t.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}}class rh{static decodeText(n){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(n);let r="";for(let e=0,t=n.length;e<t;e++)r+=String.fromCharCode(n[e]);try{return decodeURIComponent(escape(r))}catch(e){return r}}static extractUrlBase(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ih extends ci{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}ih.prototype.isInstancedBufferGeometry=!0;class ah extends Id{constructor(e){super(e)}load(t,n,e,r){const i=this,a=new Ld(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(t,function(e){try{n(i.parse(JSON.parse(e)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}},e,r)}parse(n){const i={},a={};function r(e,t){if(void 0!==i[t])return i[t];var n=e.interleavedBuffers[t],e=function(e,t){if(void 0!==a[t])return a[t];e=e.arrayBuffers,e=e[t],e=new Uint32Array(e).buffer;return a[t]=e}(e,n.buffer),e=Zt(n.type,e);const r=new ll(e,n.stride);return r.uuid=n.uuid,i[t]=r,r}const o=new(n.isInstancedBufferGeometry?ih:ci);var e=n.data.index;void 0!==e&&(m=Zt(e.type,e.array),o.setIndex(new Hr(m,1)));var t=n.data.attributes;for(const g in t){var s=t[g];let e;if(s.isInterleavedBufferAttribute){var l=r(n.data,s.data);e=new ul(l,s.itemSize,s.offset,s.normalized)}else{l=Zt(s.type,s.array);const v=s.isInstancedBufferAttribute?Gl:Hr;e=new v(l,s.itemSize,s.normalized)}void 0!==s.name&&(e.name=s.name),void 0!==s.usage&&e.setUsage(s.usage),void 0!==s.updateRange&&(e.updateRange.offset=s.updateRange.offset,e.updateRange.count=s.updateRange.count),o.setAttribute(g,e)}var c=n.data.morphAttributes;if(c)for(const A in c){var u=c[A];const _=[];for(let t=0,e=u.length;t<e;t++){var d,h=u[t];let e;e=h.isInterleavedBufferAttribute?(d=r(n.data,h.data),new ul(d,h.itemSize,h.offset,h.normalized)):(d=Zt(h.type,h.array),new Hr(d,h.itemSize,h.normalized)),void 0!==h.name&&(e.name=h.name),_.push(e)}o.morphAttributes[A]=_}n.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);var p=n.data.groups||n.data.drawcalls||n.data.offsets;if(void 0!==p)for(let e=0,t=p.length;e!==t;++e){var f=p[e];o.addGroup(f.start,f.count,f.materialIndex)}var m=n.data.boundingSphere;if(void 0!==m){const x=new wn;void 0!==m.center&&x.fromArray(m.center),o.boundingSphere=new jn(x,m.radius)}return n.name&&(o.name=n.name),n.userData&&(o.userData=n.userData),o}}class oh extends Id{constructor(e){super(e)}load(r,i,e,a){const o=this;var t=""===this.path?rh.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||t;const n=new Ld(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(r,function(e){let t=null;try{t=JSON.parse(e)}catch(e){return void 0!==a&&a(e),void console.error("v3d:ObjectLoader: Can't parse "+r+".",e.message)}const n=t.metadata;void 0!==n&&void 0!==n.type&&"geometry"!==n.type.toLowerCase()?o.parse(t,i):console.error("v3d.ObjectLoader: Can't load "+r)},e,a)}async loadAsync(e,t){var n=""===this.path?rh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Ld(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);t=await r.loadAsync(e,t),t=JSON.parse(t);const i=t.metadata;if(void 0===i||void 0===i.type||"geometry"===i.type.toLowerCase())throw new Error("v3d.ObjectLoader: Can't load "+e);return this.parseAsync(t)}parse(e,t){var n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,a),r=this.parseMaterials(e.materials,o);const s=this.parseObject(e.object,i,r,o,n);e=this.parseSkeletons(e.skeletons,s);if(this.bindSkeletons(s,e),void 0!==t){let e=!1;for(const l in a)if(a[l]instanceof HTMLImageElement){e=!0;break}!1===e&&t(s)}return s}async parseAsync(e){var t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),n=this.parseTextures(e.textures,i),i=this.parseMaterials(e.materials,n),t=this.parseObject(e.object,r,i,n,t),e=this.parseSkeletons(e.skeletons,t);return this.bindSkeletons(t,e),t}parseShapes(n){const r={};if(void 0!==n)for(let e=0,t=n.length;e<t;e++){var i=(new Xc).fromJSON(n[e]);r[i.uuid]=i}return r}parseSkeletons(n,e){const r={},i={};if(e.traverse(function(e){e.isBone&&(i[e.uuid]=e)}),void 0!==n)for(let e=0,t=n.length;e<t;e++){var a=(new Vl).fromJSON(n[e],i);r[a.uuid]=a}return r}parseGeometries(n,r){const i={};if(void 0!==n){const o=new ah;for(let t=0,e=n.length;t<e;t++){let e;var a=n[t];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":e=o.parse(a);break;case"Geometry":console.error("v3d.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Lu?e=Lu[a.type].fromJSON(a,r):console.warn(`v3d.ObjectLoader: Unsupported geometry type "${a.type}"`)}e.uuid=a.uuid,void 0!==a.name&&(e.name=a.name),!0===e.isBufferGeometry&&void 0!==a.userData&&(e.userData=a.userData),i[a.uuid]=e}}return i}parseMaterials(n,e){const r={},i={};if(void 0!==n){const s=new nh;s.setTextures(e);for(let e=0,t=n.length;e<t;e++){var a=n[e];if("MultiMaterial"===a.type){const l=[];for(let e=0;e<a.materials.length;e++){var o=a.materials[e];void 0===r[o.uuid]&&(r[o.uuid]=s.parse(o)),l.push(r[o.uuid])}i[a.uuid]=l}else void 0===r[a.uuid]&&(r[a.uuid]=s.parse(a)),i[a.uuid]=r[a.uuid]}}return i}parseAnimations(t){const n={};if(void 0!==t)for(let e=0;e<t.length;e++){var r=t[e],r=Sd.parse(r);n[r.uuid]=r}return n}parseImages(n,e){const r=this,i={};let a;function o(e){if("string"!=typeof e)return e.data?{data:Zt(e.type,e.data),width:e.width,height:e.height}:null;var t,e=e,e=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e;return t=e,r.manager.itemStart(t),a.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemError(t),r.manager.itemEnd(t)})}if(void 0!==n&&0<n.length){e=new Ed(e);a=new Dd(e),a.setCrossOrigin(this.crossOrigin);for(let e=0,t=n.length;e<t;e++){var s=n[e],l=s.url;if(Array.isArray(l)){i[s.uuid]=[];for(let e=0,t=l.length;e<t;e++){var c=o(l[e]);null!==c&&(c instanceof HTMLImageElement?i[s.uuid].push(c):i[s.uuid].push(new Ol(c.data,c.width,c.height)))}}else{var u=o(s.url);null!==u&&(i[s.uuid]=u)}}}return i}async parseImagesAsync(n){const t=this,r={};let i;async function a(e){if("string"!=typeof e)return e.data?{data:Zt(e.type,e.data),width:e.width,height:e.height}:null;e=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:t.resourcePath+e;return i.loadAsync(e)}if(void 0!==n&&0<n.length){i=new Dd(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,t=n.length;e<t;e++){var o=n[e],s=o.url;if(Array.isArray(s)){r[o.uuid]=[];for(let e=0,t=s.length;e<t;e++){var l=await a(s[e]);null!==l&&(l instanceof HTMLImageElement?r[o.uuid].push(l):r[o.uuid].push(new Ol(l.data,l.width,l.height)))}}else{var c=await a(o.url);null!==c&&(r[o.uuid]=c)}}}return r}parseTextures(n,r){function i(e,t){return"number"==typeof e?e:(console.warn("v3d.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const a={};if(void 0!==n)for(let t=0,e=n.length;t<e;t++){var o=n[t];void 0===o.image&&console.warn('v3d.ObjectLoader: No "image" specified for',o.uuid),void 0===r[o.image]&&console.warn("v3d.ObjectLoader: Undefined image",o.image);let e;var s=r[o.image];Array.isArray(s)?(e=new Oi(s),6===s.length&&(e.needsUpdate=!0)):(e=s&&s.data?new Ol(s.data,s.width,s.height):new _n(s),s&&(e.needsUpdate=!0)),e.uuid=o.uuid,void 0!==o.name&&(e.name=o.name),void 0!==o.mapping&&(e.mapping=i(o.mapping,sh)),void 0!==o.offset&&e.offset.fromArray(o.offset),void 0!==o.repeat&&e.repeat.fromArray(o.repeat),void 0!==o.center&&e.center.fromArray(o.center),void 0!==o.rotation&&(e.rotation=o.rotation),void 0!==o.wrap&&(e.wrapS=i(o.wrap[0],lh),e.wrapT=i(o.wrap[1],lh)),void 0!==o.format&&(e.format=o.format),void 0!==o.type&&(e.type=o.type),void 0!==o.encoding&&(e.encoding=o.encoding),void 0!==o.minFilter&&(e.minFilter=i(o.minFilter,ch)),void 0!==o.magFilter&&(e.magFilter=i(o.magFilter,ch)),void 0!==o.anisotropy&&(e.anisotropy=o.anisotropy),void 0!==o.flipY&&(e.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(e.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(e.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(e.userData=o.userData),a[o.uuid]=e}return a}parseObject(e,t,a,n,r){let i;function o(e){return void 0===t[e]&&console.warn("v3d.ObjectLoader: Undefined geometry",e),t[e]}function s(n){if(void 0!==n){if(Array.isArray(n)){const i=[];for(let e=0,t=n.length;e<t;e++){var r=n[e];void 0===a[r]&&console.warn("v3d.ObjectLoader: Undefined material",r),i.push(a[r])}return i}return void 0===a[n]&&console.warn("v3d.ObjectLoader: Undefined material",n),a[n]}}function l(e){return void 0===n[e]&&console.warn("v3d.ObjectLoader: Undefined texture",e),n[e]}let c,u;switch(e.type){case"Scene":i=new oa,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new mn(e.background):i.background=l(e.background)),void 0!==e.environment&&(i.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new sl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new ol(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Ni(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new ia(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Zd(e.color,e.intensity);break;case"DirectionalLight":i=new qd(e.color,e.intensity);break;case"PointLight":i=new Yd(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new $d(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Gd(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new zd(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new th).fromJSON(e);break;case"SkinnedMesh":c=o(e.geometry),u=s(e.material),i=new Nl(c,u),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":c=o(e.geometry),u=s(e.material),i=new Ei(c,u);break;case"InstancedMesh":c=o(e.geometry),u=s(e.material);var d=e.count,h=e.instanceMatrix,p=e.instanceColor;i=new Yl(c,u,d),i.instanceMatrix=new Gl(new Float32Array(h.array),16),void 0!==p&&(i.instanceColor=new Gl(new Float32Array(p.array),p.itemSize));break;case"LOD":i=new Il;break;case"Line":i=new $l(o(e.geometry),s(e.material));break;case"LineLoop":i=new rc(o(e.geometry),s(e.material));break;case"LineSegments":i=new nc(o(e.geometry),s(e.material));break;case"PointCloud":case"Points":i=new cc(o(e.geometry),s(e.material));break;case"Sprite":i=new Sl(s(e.material));break;case"Group":i=new js;break;case"Bone":i=new Fl;break;default:i=new Tr}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){var f=e.children;for(let e=0;e<f.length;e++)i.add(this.parseObject(f[e],t,a,n,r))}if(void 0!==e.animations){var m=e.animations;for(let e=0;e<m.length;e++){var g=m[e];i.animations.push(r[g])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);var v=e.levels;for(let e=0;e<v.length;e++){var A=v[e],_=i.getObjectByProperty("uuid",A.object);void 0!==_&&i.addLevel(_,A.distance)}}return i}bindSkeletons(e,n){0!==Object.keys(n).length&&e.traverse(function(e){var t;!0===e.isSkinnedMesh&&void 0!==e.skeleton&&(void 0===(t=n[e.skeleton])?console.warn("v3d.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(t,e.bindMatrix))})}setTexturePath(e){return console.warn("v3d.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const sh={UVMapping:o,CubeReflectionMapping:T,CubeRefractionMapping:I,EquirectangularReflectionMapping:l,EquirectangularRefractionMapping:c,CubeUVReflectionMapping:D,CubeUVRefractionMapping:N},lh={RepeatWrapping:k,ClampToEdgeWrapping:ze,MirroredRepeatWrapping:Q},ch={NearestFilter:Ve,NearestMipmapNearestFilter:W,NearestMipmapLinearFilter:H,LinearFilter:Ge,LinearMipmapNearestFilter:Y,LinearMipmapLinearFilter:ke};class uh extends Id{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("v3d.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("v3d.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(t,n,e,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,a=wd.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout(function(){n&&n(a),i.manager.itemEnd(t)},0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(e){wd.add(t,e),n&&n(e),i.manager.itemEnd(t)}).catch(function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}}uh.prototype.isImageBitmapLoader=!0;let dh;const hh={getContext:function(){return void 0===dh&&(dh=new(window.AudioContext||window.webkitAudioContext)),dh},setContext:function(e){dh=e}};class ph extends Id{constructor(e){super(e)}load(r,i,e,a){const o=this,t=new Ld(this.manager);t.setResponseType("arraybuffer"),t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials),t.load(r,function(e){try{var t=e.slice(0);const n=hh.getContext();n.decodeAudioData(t,function(e){i(e)})}catch(e){a?a(e):console.error(e),o.manager.itemError(r)}},e,a)}}class fh extends th{constructor(e,t,n=1){super(void 0,n);var r=(new mn).set(e),n=(new mn).set(t),e=new wn(r.r,r.g,r.b),t=new wn(n.r,n.g,n.b),r=Math.sqrt(Math.PI),n=r*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(r),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(n)}}class mh extends th{constructor(e,t=1){super(void 0,t);e=(new mn).set(e);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}}mh.prototype.isAmbientLightProbe=fh.prototype.isHemisphereLightProbe=!0;const gh=new rr,vh=new rr,Ah=new rr;class _h{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=xh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=xh(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e);var t}}function xh(){return("undefined"==typeof performance?Date:performance).now()}const yh=new wn,bh=new Sn,Mh=new wn,Ch=new wn;class Sh extends Tr{constructor(){super(),this.type="AudioListener",this.context=hh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _h}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;var n=this.up;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(yh,bh,Mh),Ch.set(0,0,-1).applyQuaternion(bh),t.positionX?(e=this.context.currentTime+this.timeDelta,t.positionX.linearRampToValueAtTime(yh.x,e),t.positionY.linearRampToValueAtTime(yh.y,e),t.positionZ.linearRampToValueAtTime(yh.z,e),t.forwardX.linearRampToValueAtTime(Ch.x,e),t.forwardY.linearRampToValueAtTime(Ch.y,e),t.forwardZ.linearRampToValueAtTime(Ch.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)):(t.setPosition(yh.x,yh.y,yh.z),t.setOrientation(Ch.x,Ch.y,Ch.z,n.x,n.y,n.z))}}class wh extends Tr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("v3d.Audio: this Audio has no playback control.")}else console.warn("v3d.Audio: Audio is already playing.")}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("v3d.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("v3d.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("v3d.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("v3d.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("v3d.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Eh=new wn,Th=new Sn,Ih=new wn,Rh=new wn;class Lh{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;var n=this.getFrequencyData();for(let e=0;e<n.length;e++)t+=n[e];return t/n.length}}class Bh{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,i,a;switch(t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[i+e]=n[e];a=t}else{a+=t;t=t/a;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=a}accumulateAdditive(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,r=this.buffer,i=e*n+n,t=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,t<1&&(e=n*this._origIndex,this._mixBufferRegion(r,i,e,1-t,n)),0<a&&this._mixBufferRegionAdditive(r,i,this._addIndex*n,1,n);for(let e=n,t=n+n;e!==t;++e)if(r[e]!==r[e+n]){o.setValue(r,i);break}}saveOriginalState(){const e=this.binding,n=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(n,i);for(let e=r,t=i;e!==t;++e)n[e]=n[i+e%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,n=t+this.valueSize;for(let e=t;e<n;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[n+e]=this.buffer[t+e]}_select(t,n,r,e,i){if(.5<=e)for(let e=0;e!==i;++e)t[n+e]=t[r+e]}_slerp(e,t,n,r){Sn.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){i=this._workIndex*i;Sn.multiplyQuaternionsFlat(e,i,e,t,e,n),Sn.slerpFlat(e,t,e,t,e,i,r)}_lerp(t,n,r,i,a){var o=1-i;for(let e=0;e!==a;++e){var s=n+e;t[s]=t[s]*o+t[r+e]*i}}_lerpAdditive(t,n,r,i,a){for(let e=0;e!==a;++e){var o=n+e;t[o]=t[o]+t[r+e]*i}}}var Ph="\\[\\]\\.";const Dh=new RegExp("["+Ph+"]","g");_a="[^"+Ph+"]",xa="[^"+Ph.replace("\\.","")+"]",/((?:WC+[\/:])*)/.source.replace("WC",_a),Ph=/(WCOD+)?/.source.replace("WCOD",xa),xa=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_a),_a=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_a);const Nh=new RegExp("^"+Ph+xa+_a+"$"),Fh=["material","materials","bones"];class Oh{constructor(e,t,n){this.path=t,this.parsedPath=n||Oh.parseTrackName(t),this.node=Oh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return new(e&&e.isAnimationObjectGroup?Oh.Composite:Oh)(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Dh,"")}static parseTrackName(e){var t=Nh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[1],objectName:t[2],objectIndex:t[3],propertyName:t[4],propertyIndex:t[5]};var r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r&&(t=n.nodeName.substring(r+1),-1!==Fh.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)),null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,r){if(!r||""===r||"."===r||-1===r||r===e.name||r===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(r);if(void 0!==t)return t}if(e.children){const i=function(t){for(let e=0;e<t.length;e++){var n=t[e];if(n.name===r||n.uuid===r)return n;n=i(n.children);if(n)return n}return null};e=i(e.children);if(e)return e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(n,r){var i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)n[r++]=i[e]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,r){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=n[r++]}_setValue_array_setNeedsUpdate(n,r){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=n[r++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,r){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=n[r++];if(this.targetObject.matrixWorldNeedsUpdate=!0,"morphTargetInfluences"===this.propertyName){var t=this.targetObject.getAuxClippingMeshes();for(let e=0;e<t.length;e++){const s=t[e];if(s.morphTargetInfluences){var a=this.targetObject.morphTargetInfluences;for(let e=0;e<a.length;e++){var o=a[e];s.morphTargetInfluences[e]=o}}}}}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let r=this.node;var e=this.parsedPath,i=e.objectName,a=e.propertyName;let o=e.propertyIndex;if(r||(r=Oh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,r){if(i){let t=e.objectIndex;switch(i){case"materials":if(!r.material)return void console.error("v3d.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("v3d.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("v3d.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let e=0;e<r.length;e++)if(r[e].name===t){t=e;break}break;default:if(void 0===r[i])return void console.error("v3d.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[i]}if(void 0!==t){if(void 0===r[t])return void console.error("v3d.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[t]}}let n=r[a];if(void 0!==n){let e=this.Versioning.None;this.targetObject=r,void 0!==r.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==r.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate);let t=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===a){if(!r.geometry)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.isBufferGeometry)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences on v3d.Geometry. Use v3d.BufferGeometry instead.",this);if(!r.geometry.morphAttributes)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==r.morphTargetDictionary[o]&&(o=r.morphTargetDictionary[o]),this.propertyName=a}else if("nodeValue"==a){if(o=o.replace(/"/g,""),!r.nodeValueMap)return void console.error("v3d.PropertyBinding: Trying to animate nodes in non-node material",this);if(o=r.nodeValueMap[o],void 0===o)return void console.error("v3d.PropertyBinding: Animated node not found ",this)}if(t=this.BindingType.ArrayElement,"nodeRGB"==a){if(o=o.replace(/"/g,""),!r.nodeRGBMap)return void console.error("v3d.PropertyBinding: Trying to animate nodes in non-node material",this);if(o=r.nodeRGBMap[o],void 0===o)return void console.error("v3d.PropertyBinding: Animated node not found ",this);t=this.BindingType.HasFromToArray,n=r.nodeRGB[o]}this.resolvedProperty=n,this.propertyIndex=o}else void 0!==n.fromArray&&void 0!==n.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(t=this.BindingType.EntireArray,this.resolvedProperty=n,"morphTargetInfluences"===a&&(this.propertyName=a)):this.propertyName=a;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}else{e=e.nodeName;console.error("v3d.PropertyBinding: Trying to update property for track: "+e+"."+a+" but it wasn't found.",r)}}else console.error("v3d.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Oh.Composite=class{constructor(e,t,n){n=n||Oh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(n,r){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].setValue(n,r)}bind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].bind()}unbind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].unbind()}},Oh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Oh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Oh.prototype.GetterByBindingType=[Oh.prototype._getValue_direct,Oh.prototype._getValue_array,Oh.prototype._getValue_arrayElement,Oh.prototype._getValue_toArray],Oh.prototype.SetterByBindingTypeAndVersioning=[[Oh.prototype._setValue_direct,Oh.prototype._setValue_direct_setNeedsUpdate,Oh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Oh.prototype._setValue_array,Oh.prototype._setValue_array_setNeedsUpdate,Oh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Oh.prototype._setValue_arrayElement,Oh.prototype._setValue_arrayElement_setNeedsUpdate,Oh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Oh.prototype._setValue_fromArray,Oh.prototype._setValue_fromArray_setNeedsUpdate,Oh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Uh{constructor(){this.uuid=It(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const n={};this._indicesByUUID=n;for(let e=0,t=arguments.length;e!==t;++e)n[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const r=this._objects,i=this._indicesByUUID,a=this._paths,o=this._parsedPaths,s=this._bindings,l=s.length;let c=void 0,u=r.length,d=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var h=arguments[e],p=h.uuid;let n=i[p];if(void 0===n){n=u++,i[p]=n,r.push(h);for(let e=0,t=l;e!==t;++e)s[e].push(new Oh(h,a[e],o[e]))}else if(n<d){c=r[n];var f=--d,m=r[f];i[m.uuid]=n,r[n]=m,i[p]=f,r[f]=h;for(let t=0,e=l;t!==e;++t){const g=s[t],v=g[f];let e=g[n];g[n]=v,void 0===e&&(e=new Oh(h,a[t],o[t])),g[f]=e}}else r[n]!==c&&console.error("v3d.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=d}remove(){const n=this._objects,r=this._indicesByUUID,i=this._bindings,a=i.length;let o=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var s=arguments[e],l=s.uuid,c=r[l];if(void 0!==c&&c>=o){var u=o++,d=n[u];r[d.uuid]=c,n[c]=d,r[l]=u,n[u]=s;for(let e=0,t=a;e!==t;++e){const h=i[e],p=h[u],f=h[c];h[c]=p,h[u]=f}}}this.nCachedObjects_=o}uncache(){const n=this._objects,r=this._indicesByUUID,i=this._bindings,a=i.length;let o=this.nCachedObjects_,s=n.length;for(let e=0,t=arguments.length;e!==t;++e){var l=arguments[e].uuid,c=r[l];if(void 0!==c)if(delete r[l],c<o){var u=--o,l=n[u],d=--s,h=n[d];r[l.uuid]=c,n[c]=l,r[h.uuid]=u,n[u]=h,n.pop();for(let e=0,t=a;e!==t;++e){const f=i[e],m=f[u],g=f[d];f[c]=m,f[u]=g,f.pop()}}else{var p=--s,h=n[p];0<p&&(r[h.uuid]=c),n[c]=h,n.pop();for(let e=0,t=a;e!==t;++e){const v=i[e];v[c]=v[p],v.pop()}}}this.nCachedObjects_=o}subscribe_(n,r){const e=this._bindingsIndicesByPath;let t=e[n];const i=this._bindings;if(void 0!==t)return i[t];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);t=i.length,e[n]=t,a.push(n),o.push(r),i.push(u);for(let e=c,t=s.length;e!==t;++e){var d=s[e];u[e]=new Oh(d,n,r)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],l=e[o];t[l]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}Uh.prototype.isAnimationObjectGroup=!0;class zh{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,a=i.length,o=new Array(a);var s={endingStart:ut,endingEnd:ut};for(let e=0;e!==a;++e){const l=i[e].createInterpolant(null);o[e]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._pingIsEven=!0,this._startTime=null,this.time=0,this.timeStart=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this._pingIsEven=!0,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){var r,i;return e.fadeOut(t),this.fadeIn(t),n&&(n=(r=this._clip.duration)/(i=e._clip.duration),e.warp(1,i/r,t),this.warp(n,1,t)),this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){i=(e-i)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);var a=this._updateTime(t),o=this._updateWeight(e);if(0<o){const s=this._interpolants,l=this._propertyBindings;if(2501===this.blendMode)for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(a),l[e].accumulateAdditive(o);else for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(a),l[e].accumulate(r,o)}}else this._updateWeight(e)}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;var n;null!==r&&(n=r.evaluate(e)[0],t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1)))}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;var n;null!==r&&(n=r.evaluate(e)[0],t*=n,e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_loopIsPing(e){return 2202!==this.loop||(-1==e||0==(1&e)===this._pingIsEven)}_updateTime(e){if(0===e)return this.time;if(2200!==this.loop&&this.repetitions<=0)return this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1}),this.time;var t=this.timeStart,n=Math.max(t,this._clip.duration),r=n-t;if(2200===this.loop)return this.time+=e,-1===this._loopCount&&(this._loopCount=0,this._setEndings(!0,!0,!1)),(this.time<t||this.time>n)&&(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Rt(this.time,t,n),this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})),this.time;var i=2202===this.loop,a=this._loopIsPing(this._loopCount)?1:-1;this.time+=a*e;var o,s=this.time<t||this.time>n,l=!1;return-1===this._loopCount&&(this._loopCount=(l=s)?-1:0,this._pingIsEven=!l,0<=e?this._setEndings(!0,0===this.repetitions,i):this._setEndings(0===this.repetitions,!0,i)),s&&(a=Math.floor((this.time-t)/r),this._loopCount+=Math.abs(a),(s=this.repetitions-this._loopCount)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Rt(this.time,t,n),this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})):(1==s?this._setEndings(o=e<0,!o,i):this._setEndings(!1,!1,i),(o=(this.time-t)%r)<0&&(o+=r),this.time=i?n-o:o+t,l||this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a}))),this.time}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=dt,r.endingEnd=dt):(r.endingStart=e?this.zeroSlopeAtStart?dt:ut:ht,r.endingEnd=t?this.zeroSlopeAtEnd?dt:ut:ht)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}class Vh extends t{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const r=e._localRoot||this._root,i=e._clip.tracks,a=i.length,o=e._propertyBindings,s=e._interpolants,l=r.uuid,t=this._bindingsByRootAndName;let c=t[l];void 0===c&&(c={},t[l]=c);for(let t=0;t!==a;++t){const d=i[t],h=d.name;let e=c[h];if(void 0!==e)++e.referenceCount,o[t]=e;else{if(e=o[t],void 0!==e){null===e._cacheIndex&&(++e.referenceCount,this._addInactiveBinding(e,l,h));continue}var u=n&&n._propertyBindings[t].binding.parsedPath;e=new Bh(Oh.create(r,h,u),d.ValueTypeName,d.getValueSize()),++e.referenceCount,this._addInactiveBinding(e,l,h),o[t]=e}s[t].resultBuffer=e.buffer}}_activateAction(e){if(!this._isActiveAction(e)){var t,n,r;null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n],this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t));var i=e._propertyBindings;for(let e=0,t=i.length;e!==t;++e){const a=i[e];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){var n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){const r=n[e];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;const u=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete u[d],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){var n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){const r=n[e];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let a=r[t];void 0===a&&(a={},r[t]=a),(a[n]=e)._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new ed(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){var r=t||this._root,i=r.uuid;let a="string"==typeof e?Sd.findByName(r,e):e;var o=null!==a?a.uuid:e,r=this._actionsByClip[o];let s=null;if(void 0===n&&(n=null!==a?a.blendMode:2500),void 0!==r){e=r.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;s=r.knownActions[0],null===a&&(a=s._clip)}if(null===a)return null;n=new zh(this,a,t,n);return this._bindAction(n,s),this._addInactiveAction(n,o,i),n}existingAction(e,t){var n=t||this._root,t=n.uuid,n="string"==typeof e?Sd.findByName(n,e):e,e=n?n.uuid:e,e=this._actionsByClip[e];return void 0!==e&&e.actionByRoot[t]||null}stopAllAction(){const t=this._actions,n=this._nActiveActions;for(let e=n-1;0<=e;--e)t[e].stop();return this}update(t){t*=this.timeScale;var n=this._actions,r=this._nActiveActions,i=this.time+=t,a=Math.sign(t),o=this._accuIndex^=1;for(let e=0;e!==r;++e){const c=n[e];c._update(i,t,a,o)}const s=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)s[e].apply(o);return this}setTime(e){for(let e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,t=e.uuid,r=this._actionsByClip,i=r[t];if(void 0!==i){var a=i.knownActions;for(let e=0,t=a.length;e!==t;++e){const o=a[e];this._deactivateAction(o);const s=o._cacheIndex,l=n[n.length-1];o._cacheIndex=null,o._byClipCacheIndex=null,l._cacheIndex=s,n[s]=l,n.pop(),this._removeInactiveBindingsForAction(o)}delete r[t]}}uncacheRoot(e){var t=e.uuid,n=this._actionsByClip;for(const a in n){var r=n[a].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var i=this._bindingsByRootAndName[t];if(void 0!==i)for(const o in i){const s=i[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,t){t=this.existingAction(e,t);null!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}}Vh.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Gh{constructor(e){"string"==typeof e&&(console.warn("v3d.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Gh(void 0===this.value.clone?this.value:this.value.clone())}}class kh extends ll{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Qh{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Qh.prototype.isGLBufferAttribute=kh.prototype.isInstancedInterleavedBuffer=!0;const Wh=new Yt;class Hh{constructor(e=new Yt(1/0,1/0),t=new Yt(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(n){this.makeEmpty();for(let e=0,t=n.length;e<t;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(e,t){t=Wh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=Wh.copy(e).clamp(this.min,this.max);return t.sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Hh.prototype.isBox2=!0;const Yh=new wn,Xh=new wn;class jh{constructor(e=new wn,t=new wn){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Yh.subVectors(e,this.start),Xh.subVectors(this.end,this.start);e=Xh.dot(Xh);let n=Xh.dot(Yh)/e;return t&&(n=Rt(n,0,1)),n}closestPointToPoint(e,t,n){t=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(t).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Kh=new wn;class qh extends Tr{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new ci,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1;e<32;e++,t++){var i=e/32*Math.PI*2,a=t/32*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(a),Math.sin(a),1)}n.setAttribute("position",new ei(r,3));t=new Xl({fog:!1,toneMapped:!1});this.cone=new nc(n,t),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();var e=this.light.distance||1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Kh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Kh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Zh=new wn,Jh=new rr,$h=new rr;class ep extends nc{constructor(e){var t=function t(n){const r=[];n&&n.isBone&&r.push(n);for(let e=0;e<n.children.length;e++)r.push.apply(r,t(n.children[e]));return r}(e);const n=new ci,r=[],i=[];var a=new mn(0,0,1),o=new mn(0,1,0);for(let e=0;e<t.length;e++){var s=t[e];s.parent&&s.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new ei(r,3)),n.setAttribute("color",new ei(i,3));var l=new Xl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){var n=this.bones;const t=this.geometry,r=t.getAttribute("position");$h.copy(this.root.matrixWorld).invert();for(let e=0,t=0;e<n.length;e++){var i=n[e];i.parent&&i.parent.isBone&&(Jh.multiplyMatrices($h,i.matrixWorld),Zh.setFromMatrixPosition(Jh),r.setXYZ(t,Zh.x,Zh.y,Zh.z),Jh.multiplyMatrices($h,i.parent.matrixWorld),Zh.setFromMatrixPosition(Jh),r.setXYZ(t+1,Zh.x,Zh.y,Zh.z),t+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}class tp extends Ei{constructor(e,t,n){super(new yu(t,4,2),new kr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const np=new wn,rp=new mn,ip=new mn;class ap extends Tr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Au(t);r.rotateY(.5*Math.PI),this.material=new kr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);t=r.getAttribute("position"),t=new Float32Array(3*t.count);r.setAttribute("color",new Hr(t,3)),this.add(new Ei(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const r=e.geometry.getAttribute("color");rp.copy(this.light.color),ip.copy(this.light.groundColor);for(let e=0,t=r.count;e<t;e++){var n=e<t/2?rp:ip;r.setXYZ(e,n.r,n.g,n.b)}r.needsUpdate=!0}e.lookAt(np.setFromMatrixPosition(this.light.matrixWorld).negate())}}class op extends nc{constructor(e=10,r=10,i=4473924,a=8947848){i=new mn(i),a=new mn(a);var o=r/2,s=e/r,l=e/2;const c=[],u=[];for(let e=0,t=0,n=-l;e<=r;e++,n+=s){c.push(-l,0,n,l,0,n),c.push(n,0,-l,n,0,l);const d=e===o?i:a;d.toArray(u,t),t+=3,d.toArray(u,t),t+=3,d.toArray(u,t),t+=3,d.toArray(u,t),t+=3}const t=new ci;t.setAttribute("position",new ei(c,3)),t.setAttribute("color",new ei(u,3));e=new Xl({vertexColors:!0,toneMapped:!1});super(t,e),this.type="GridHelper"}}nc;const sp=new wn,lp=new wn,cp=new wn;class up extends Tr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new ci;r.setAttribute("position",new ei([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));t=new Xl({fog:!1,toneMapped:!1});this.lightPlane=new $l(r,t),this.add(this.lightPlane),r=new ci,r.setAttribute("position",new ei([0,0,0,0,0,1],3)),this.targetLine=new $l(r,t),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){sp.setFromMatrixPosition(this.light.matrixWorld),lp.setFromMatrixPosition(this.light.target.matrixWorld),cp.subVectors(lp,sp),this.lightPlane.lookAt(lp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(lp),this.targetLine.scale.z=cp.length()}}const dp=new wn,hp=new Di;nc;function pp(e,t,n,r,i,a,o){dp.set(i,a,o).unproject(r);var s=t[e];if(void 0!==s){const l=n.getAttribute("position");for(let e=0,t=s.length;e<t;e++)l.setXYZ(s[e],dp.x,dp.y,dp.z)}}const fp=new In;class mp extends nc{constructor(e,t=16776960){var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24);const i=new ci;i.setIndex(new Hr(n,1)),i.setAttribute("position",new Hr(r,3)),super(i,new Xl({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("v3d.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&fp.setFromObject(this.object),!fp.isEmpty()){var t=fp.min,e=fp.max;const n=this.geometry.attributes.position,r=n.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}setFromObject(e){return this.object=e,this.update(),this}copy(e){return nc.prototype.copy.call(this,e),this.object=e.object,this}}class gp extends nc{constructor(e,t=16776960){var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);const r=new ci;r.setIndex(new Hr(n,1)),r.setAttribute("position",new ei([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Xl({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}$l;const vp=new wn;let Ap,_p;class xp extends Tr{constructor(e=new wn(0,0,1),t=new wn(0,0,0),n=1,r=16776960,i=.2*n,a=.2*i){super(),this.type="ArrowHelper",void 0===Ap&&(Ap=new ci,Ap.setAttribute("position",new ei([0,0,0,0,1,0],3)),_p=new gc(0,.5,1,5,1),_p.translate(0,-.5,0)),this.position.copy(t),this.line=new $l(Ap,new Xl({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ei(_p,new kr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}setDirection(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(vp.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle(vp,e))}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class yp extends nc{constructor(e=1){e=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];const t=new ci;t.setAttribute("position",new ei(e,3)),t.setAttribute("color",new ei([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));e=new Xl({vertexColors:!0,toneMapped:!1});super(t,e),this.type="AxesHelper"}setColors(e,t,n){const r=new mn;var i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class bp{constructor(){this.type="ShapePath",this.color=new mn,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Yc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(n,e){function t(n){const r=[];for(let e=0,t=n.length;e<t;e++){var i=n[e];const a=new Xc;a.curves=i.curves,r.push(a)}return r}const r=du.isClockWise,i=this.subPaths;if(0===i.length)return[];if(!0===e)return t(i);let a,o,s;const l=[];if(1===i.length)return o=i[0],s=new Xc,s.curves=o.curves,l.push(s),l;let c=!r(i[0].getPoints());c=n?!c:c;const u=[],d=[];let h=[],p=0;var f,m;d[p]=void 0,h[p]=[];for(let e=0,t=i.length;e<t;e++)o=i[e],f=o.getPoints(),a=r(f),a=n?!a:a,a?(!c&&d[p]&&p++,d[p]={s:new Xc,p:f},d[p].s.curves=o.curves,c&&p++,h[p]=[]):h[p].push({h:o,p:f[0]});if(!d[0])return t(i);if(1<d.length){let i=!1;const A=[];for(let e=0,t=d.length;e<t;e++)u[e]=[];for(let r=0,e=d.length;r<e;r++){var g=h[r];for(let n=0;n<g.length;n++){var v=g[n];let t=!0;for(let e=0;e<d.length;e++)!function(o,s){var e=s.length;let l=!1;for(let i=e-1,a=0;a<e;i=a++){let e=s[i],t=s[a],n=t.x-e.x,r=t.y-e.y;if(Math.abs(r)>Number.EPSILON){if(r<0&&(e=s[a],n=-n,t=s[i],r=-r),!(o.y<e.y||o.y>t.y))if(o.y===e.y){if(o.x===e.x)return 1}else{var c=r*(o.x-e.x)-n*(o.y-e.y);if(0==c)return 1;c<0||(l=!l)}}else if(o.y===e.y&&(t.x<=o.x&&o.x<=e.x||e.x<=o.x&&o.x<=t.x))return 1}return l}(v.p,d[e].p)||(r!==e&&A.push({froms:r,tos:e,hole:n}),t?(t=!1,u[e].push(v)):i=!0);t&&u[r].push(v)}}0<A.length&&(i||(h=u))}for(let n=0,e=d.length;n<e;n++){s=d[n].s,l.push(s);for(let e=0,t=(m=h[n]).length;e<t;e++)s.holes.push(m[e].h)}return l}}const Mp=new Float32Array(1),Cp=new Int32Array(Mp.buffer);class Sp{static toHalfFloat(e){65504<e&&(console.warn("v3d.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),Mp[0]=e;var t=Cp[0];let n=t>>16&32768,r=t>>12&2047;e=t>>23&255;return e<103||(142<e?(n|=31744,n|=(255==e?0:1)&&8388607&t):e<113?(r|=2048,n|=(r>>114-e)+(r>>113-e&1)):(n|=e-112<<10|r>>1,n+=1&r)),n}static fromHalfFloat(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31==t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}}Sc.create=function(e,t){return console.log("v3d.Curve.create() has been deprecated"),e.prototype=Object.create(Sc.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Yc.prototype.fromPoints=function(e){return console.warn("v3d.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},op.prototype.setColors=function(){console.error("v3d.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ep.prototype.update=function(){console.error("v3d.SkeletonHelper: update() no longer needs to be called.")},Id.prototype.extractUrlBase=function(e){return console.warn("v3d.Loader: .extractUrlBase() has been deprecated. Use v3d.LoaderUtils.extractUrlBase() instead."),rh.extractUrlBase(e)},Id.Handlers={add:function(){console.error("v3d.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("v3d.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Hh.prototype.center=function(e){return console.warn("v3d.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Hh.prototype.empty=function(){return console.warn("v3d.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Hh.prototype.isIntersectionBox=function(e){return console.warn("v3d.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Hh.prototype.size=function(e){return console.warn("v3d.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},In.prototype.center=function(e){return console.warn("v3d.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},In.prototype.empty=function(){return console.warn("v3d.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},In.prototype.isIntersectionBox=function(e){return console.warn("v3d.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},In.prototype.isIntersectionSphere=function(e){return console.warn("v3d.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},In.prototype.size=function(e){return console.warn("v3d.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},jn.prototype.empty=function(){return console.warn("v3d.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Hi.prototype.setFromMatrix=function(e){return console.warn("v3d.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},jh.prototype.center=function(e){return console.warn("v3d.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Xt.prototype.flattenToArrayOffset=function(e,t){return console.warn("v3d.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Xt.prototype.multiplyVector3=function(e){return console.warn("v3d.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3(matrix) instead."),e.applyMatrix3(this)},Xt.prototype.multiplyVector3Array=function(){console.error("v3d.Matrix3: .multiplyVector3Array() has been removed.")},Xt.prototype.applyToBufferAttribute=function(e){return console.warn("v3d.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3(matrix) instead."),e.applyMatrix3(this)},Xt.prototype.applyToVector3Array=function(){console.error("v3d.Matrix3: .applyToVector3Array() has been removed.")},Xt.prototype.getInverse=function(e){return console.warn("v3d.Matrix3: .getInverse() has been removed. Use matrixInv.copy(matrix).invert(); instead."),this.copy(e).invert()},rr.prototype.extractPosition=function(e){return console.warn("v3d.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},rr.prototype.flattenToArrayOffset=function(e,t){return console.warn("v3d.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},rr.prototype.getPosition=function(){return console.warn("v3d.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition(matrix) instead."),(new wn).setFromMatrixColumn(this,3)},rr.prototype.setRotationFromQuaternion=function(e){return console.warn("v3d.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},rr.prototype.multiplyToArray=function(){console.warn("v3d.Matrix4: .multiplyToArray() has been removed.")},rr.prototype.multiplyVector3=function(e){return console.warn("v3d.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4(matrix) instead."),e.applyMatrix4(this)},rr.prototype.multiplyVector4=function(e){return console.warn("v3d.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4(matrix) instead."),e.applyMatrix4(this)},rr.prototype.multiplyVector3Array=function(){console.error("v3d.Matrix4: .multiplyVector3Array() has been removed.")},rr.prototype.rotateAxis=function(e){console.warn("v3d.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection(matrix) instead."),e.transformDirection(this)},rr.prototype.crossVector=function(e){return console.warn("v3d.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4(matrix) instead."),e.applyMatrix4(this)},rr.prototype.translate=function(){console.error("v3d.Matrix4: .translate() has been removed.")},rr.prototype.rotateX=function(){console.error("v3d.Matrix4: .rotateX() has been removed.")},rr.prototype.rotateY=function(){console.error("v3d.Matrix4: .rotateY() has been removed.")},rr.prototype.rotateZ=function(){console.error("v3d.Matrix4: .rotateZ() has been removed.")},rr.prototype.rotateByAxis=function(){console.error("v3d.Matrix4: .rotateByAxis() has been removed.")},rr.prototype.applyToBufferAttribute=function(e){return console.warn("v3d.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4(matrix) instead."),e.applyMatrix4(this)},rr.prototype.applyToVector3Array=function(){console.error("v3d.Matrix4: .applyToVector3Array() has been removed.")},rr.prototype.makeFrustum=function(e,t,n,r,i,a){return console.warn("v3d.Matrix4: .makeFrustum() has been removed. Use .makePerspective(left, right, top, bottom, near, far) instead."),this.makePerspective(e,t,r,n,i,a)},rr.prototype.getInverse=function(e){return console.warn("v3d.Matrix4: .getInverse() has been removed. Use matrixInv.copy(matrix).invert(); instead."),this.copy(e).invert()},ki.prototype.isIntersectionLine=function(e){return console.warn("v3d.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Sn.prototype.multiplyVector3=function(e){return console.warn("v3d.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion(quaternion) instead."),e.applyQuaternion(this)},Sn.prototype.inverse=function(){return console.warn("v3d.Quaternion: .inverse() has been renamed to invert()."),this.invert()},nr.prototype.isIntersectionBox=function(e){return console.warn("v3d.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},nr.prototype.isIntersectionPlane=function(e){return console.warn("v3d.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},nr.prototype.isIntersectionSphere=function(e){return console.warn("v3d.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},zr.prototype.area=function(){return console.warn("v3d.Triangle: .area() has been renamed to .getArea()."),this.getArea()},zr.prototype.barycoordFromPoint=function(e,t){return console.warn("v3d.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},zr.prototype.midpoint=function(e){return console.warn("v3d.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},zr.prototypenormal=function(e){return console.warn("v3d.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},zr.prototype.plane=function(e){return console.warn("v3d.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},zr.barycoordFromPoint=function(e,t,n,r,i){return console.warn("v3d.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),zr.getBarycoord(e,t,n,r,i)},zr.normal=function(e,t,n,r){return console.warn("v3d.Triangle: .normal() has been renamed to .getNormal()."),zr.getNormal(e,t,n,r)},Xc.prototype.extractAllPoints=function(e){return console.warn("v3d.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Xc.prototype.extrude=function(e){return console.warn("v3d.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new fu(this,e)},Xc.prototype.makeGeometry=function(e){return console.warn("v3d.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new xu(this,e)},Yt.prototype.fromAttribute=function(e,t,n){return console.warn("v3d.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Yt.prototype.distanceToManhattan=function(e){return console.warn("v3d.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Yt.prototype.lengthManhattan=function(){return console.warn("v3d.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},wn.prototype.setEulerFromRotationMatrix=function(){console.error("v3d.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},wn.prototype.setEulerFromQuaternion=function(){console.error("v3d.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},wn.prototype.getPositionFromMatrix=function(e){return console.warn("v3d.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},wn.prototype.getScaleFromMatrix=function(e){return console.warn("v3d.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},wn.prototype.getColumnFromMatrix=function(e,t){return console.warn("v3d.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},wn.prototype.applyProjection=function(e){return console.warn("v3d.Vector3: .applyProjection() has been removed. Use .applyMatrix4(m) instead."),this.applyMatrix4(e)},wn.prototype.fromAttribute=function(e,t,n){return console.warn("v3d.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},wn.prototype.distanceToManhattan=function(e){return console.warn("v3d.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},wn.prototype.lengthManhattan=function(){return console.warn("v3d.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},yn.prototype.fromAttribute=function(e,t,n){return console.warn("v3d.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},yn.prototype.lengthManhattan=function(){return console.warn("v3d.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Tr.prototype.getChildByName=function(e){return console.warn("v3d.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Tr.prototype.renderDepth=function(){console.warn("v3d.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Tr.prototype.translate=function(e,t){return console.warn("v3d.Object3D: .translate() has been removed. Use .translateOnAxis(axis, distance) instead."),this.translateOnAxis(t,e)},Tr.prototype.getWorldRotation=function(){console.error("v3d.Object3D: .getWorldRotation() has been removed. Use v3d.Object3D.getWorldQuaternion(target) instead.")},Tr.prototype.applyMatrix=function(e){return console.warn("v3d.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Tr.prototype,{eulerOrder:{get:function(){return console.warn("v3d.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("v3d.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("v3d.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("v3d.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Ei.prototype.setDrawMode=function(){console.error("v3d.Mesh: .setDrawMode() has been removed. The renderer now always assumes v3d.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Ei.prototype,{drawMode:{get:function(){return console.error("v3d.Mesh: .drawMode has been removed. The renderer now always assumes v3d.TrianglesDrawMode."),0},set:function(){console.error("v3d.Mesh: .drawMode has been removed. The renderer now always assumes v3d.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Nl.prototype.initBones=function(){console.error("v3d.SkinnedMesh: initBones() has been removed.")},Ni.prototype.setLens=function(e,t){console.warn("v3d.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Ud.prototype,{onlyShadow:{set:function(){console.warn("v3d.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("v3d.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("v3d.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("v3d.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("v3d.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("v3d.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("v3d.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("v3d.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("v3d.Light: .shadowCameraVisible has been removed. Use new v3d.CameraHelper(light.shadow.camera) instead.")}},shadowBias:{set:function(e){console.warn("v3d.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("v3d.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("v3d.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("v3d.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Hr.prototype,{length:{get:function(){return console.warn("v3d.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("v3d.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===n},set:function(){console.warn("v3d.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(n)}}}),Hr.prototype.setDynamic=function(e){return console.warn("v3d.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?n:r),this},Hr.prototype.copyIndicesArray=function(){console.error("v3d.BufferAttribute: .copyIndicesArray() has been removed.")},Hr.prototype.setArray=function(){console.error("v3d.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ci.prototype.addIndex=function(e){console.warn("v3d.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},ci.prototype.addAttribute=function(e,t){return console.warn("v3d.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("v3d.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("v3d.BufferGeometry: .addAttribute() now expects (name, attribute)."),this.setAttribute(e,new Hr(t,arguments[2])))},ci.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("v3d.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("v3d.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},ci.prototype.clearDrawCalls=function(){console.warn("v3d.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ci.prototype.computeOffsets=function(){console.warn("v3d.BufferGeometry: .computeOffsets() has been removed.")},ci.prototype.removeAttribute=function(e){return console.warn("v3d.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},ci.prototype.applyMatrix=function(e){return console.warn("v3d.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(ci.prototype,{drawcalls:{get:function(){return console.error("v3d.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("v3d.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ll.prototype.setDynamic=function(e){return console.warn("v3d.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?n:r),this},ll.prototype.setArray=function(){console.error("v3d.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},fu.prototype.getArrays=function(){console.error("v3d.ExtrudeGeometry: .getArrays() has been removed.")},fu.prototype.addShapeList=function(){console.error("v3d.ExtrudeGeometry: .addShapeList() has been removed.")},fu.prototype.addShape=function(){console.error("v3d.ExtrudeGeometry: .addShape() has been removed.")},oa.prototype.dispose=function(){console.error("v3d.Scene: .dispose() has been removed.")},Gh.prototype.onUpdate=function(){return console.warn("v3d.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Gr.prototype,{wrapAround:{get:function(){console.warn("v3d.Material: .wrapAround has been removed.")},set:function(){console.warn("v3d.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("v3d.Material: .overdraw has been removed.")},set:function(){console.warn("v3d.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("v3d.Material: .wrapRGB has been removed."),new mn}},shading:{get:function(){console.error("v3d."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("v3d."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("v3d."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("v3d."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("v3d."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("v3d."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Pi.prototype,{derivatives:{get:function(){return console.warn("v3d.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("v3d. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),il.prototype.clearTarget=function(e,t,n,r){console.warn("v3d.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},il.prototype.animate=function(e){console.warn("v3d.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},il.prototype.getCurrentRenderTarget=function(){return console.warn("v3d.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},il.prototype.getMaxAnisotropy=function(){return console.warn("v3d.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},il.prototype.getPrecision=function(){return console.warn("v3d.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},il.prototype.resetGLState=function(){return console.warn("v3d.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},il.prototype.supportsFloatTextures=function(){return console.warn("v3d.WebGLRenderer: .supportsFloatTextures() is now .extensions.get('OES_texture_float')."),this.extensions.get("OES_texture_float")},il.prototype.supportsHalfFloatTextures=function(){return console.warn("v3d.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get('OES_texture_half_float')."),this.extensions.get("OES_texture_half_float")},il.prototype.supportsStandardDerivatives=function(){return console.warn("v3d.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get('OES_standard_derivatives')."),this.extensions.get("OES_standard_derivatives")},il.prototype.supportsCompressedTextureS3TC=function(){return console.warn("v3d.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get('WEBGL_compressed_texture_s3tc')."),this.extensions.get("WEBGL_compressed_texture_s3tc")},il.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("v3d.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get('WEBGL_compressed_texture_pvrtc')."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},il.prototype.supportsBlendMinMax=function(){return console.warn("v3d.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get('EXT_blend_minmax')."),this.extensions.get("EXT_blend_minmax")},il.prototype.supportsVertexTextures=function(){return console.warn("v3d.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},il.prototype.supportsInstancedArrays=function(){return console.warn("v3d.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get('ANGLE_instanced_arrays')."),this.extensions.get("ANGLE_instanced_arrays")},il.prototype.enableScissorTest=function(e){console.warn("v3d.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},il.prototype.initMaterial=function(){console.warn("v3d.WebGLRenderer: .initMaterial() has been removed.")},il.prototype.addPrePlugin=function(){console.warn("v3d.WebGLRenderer: .addPrePlugin() has been removed.")},il.prototype.addPostPlugin=function(){console.warn("v3d.WebGLRenderer: .addPostPlugin() has been removed.")},il.prototype.updateShadowMap=function(){console.warn("v3d.WebGLRenderer: .updateShadowMap() has been removed.")},il.prototype.setFaceCulling=function(){console.warn("v3d.WebGLRenderer: .setFaceCulling() has been removed.")},il.prototype.allocTextureUnit=function(){console.warn("v3d.WebGLRenderer: .allocTextureUnit() has been removed.")},il.prototype.setTexture=function(){console.warn("v3d.WebGLRenderer: .setTexture() has been removed.")},il.prototype.setTexture2D=function(){console.warn("v3d.WebGLRenderer: .setTexture2D() has been removed.")},il.prototype.setTextureCube=function(){console.warn("v3d.WebGLRenderer: .setTextureCube() has been removed.")},il.prototype.getActiveMipMapLevel=function(){return console.warn("v3d.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(il.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("v3d.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("v3d.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("v3d.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("v3d.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("v3d.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("v3d.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("v3d.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("v3d.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("v3d.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("v3d.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?ft:pt}},toneMappingWhitePoint:{get:function(){return console.warn("v3d.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("v3d.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("v3d.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("v3d.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Qs.prototype,{cullFace:{get:function(){console.warn("v3d.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("v3d.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("v3d.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("v3d.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("v3d.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("v3d.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(bn.prototype,{wrapS:{get:function(){return console.warn("v3d.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("v3d.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("v3d.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("v3d.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("v3d.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("v3d.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("v3d.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("v3d.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("v3d.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("v3d.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("v3d.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("v3d.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("v3d.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("v3d.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("v3d.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("v3d.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("v3d.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("v3d.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("v3d.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("v3d.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),wh.prototype.load=function(e){console.warn("v3d.Audio: .load has been deprecated. Use v3d.AudioLoader instead.");const t=this,n=new ph;return n.load(e,function(e){t.setBuffer(e)}),this},Lh.prototype.getData=function(){return console.warn("v3d.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Fi.prototype.updateCubeMap=function(e,t){return console.warn("v3d.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Fi.prototype.clear=function(e,t,n,r){return console.warn("v3d.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},vn.crossOrigin=void 0,vn.loadTexture=function(e,t,n,r){console.warn("v3d.ImageUtils.loadTexture has been deprecated. Use v3d.TextureLoader() instead.");const i=new Od;i.setCrossOrigin(this.crossOrigin);const a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},vn.loadTextureCube=function(e,t,n,r){console.warn("v3d.ImageUtils.loadTextureCube has been deprecated. Use v3d.CubeTextureLoader() instead.");const i=new Nd;i.setCrossOrigin(this.crossOrigin);const a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},vn.loadCompressedTexture=function(){console.error("v3d.ImageUtils.loadCompressedTexture has been removed. Use v3d.DDSLoader instead.")},vn.loadCompressedTextureCube=function(){console.error("v3d.ImageUtils.loadCompressedTextureCube has been removed. Use v3d.DDSLoader instead.")};class wp{constructor(e,t,n,r,i,a=0){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new wn,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new mn,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=a}clone(){return(new this.constructor).copy(this)}copy(n){this.a=n.a,this.b=n.b,this.c=n.c,this.normal.copy(n.normal),this.color.copy(n.color),this.materialIndex=n.materialIndex;for(let e=0,t=n.vertexNormals.length;e<t;e++)this.vertexNormals[e]=n.vertexNormals[e].clone();for(let e=0,t=n.vertexColors.length;e<t;e++)this.vertexColors[e]=n.vertexColors[e].clone();return this}}var Ep,Tp=new wn,Ip=new wn,Rp=new wn,Lp=new Yt,Bp=new Yt,Pp=new Yt,Dp=new wn,Np=new wn;function Fp(e,t,n,r,i,a,o,s){Tp.fromBufferAttribute(r,a),Ip.fromBufferAttribute(r,o),Rp.fromBufferAttribute(r,s);var l,c,u,d,l=(c=(l=e).material,u=t,d=n,r=Tp,e=Ip,t=Rp,n=Dp,null===(c=c.side===Fe?d.intersectTriangle(t,e,r,!0,n):d.intersectTriangle(r,e,t,c.side!==Oe,n))?null:(Np.copy(n),Np.applyMatrix4(l.matrixWorld),(n=u.ray.origin.distanceTo(Np))<u.near||n>u.far?null:{distance:n,point:Np.clone(),object:l}));return l&&(i&&(Lp.fromBufferAttribute(i,a),Bp.fromBufferAttribute(i,o),Pp.fromBufferAttribute(i,s),l.uv=zr.getUV(Dp,Tp,Ip,Rp,Lp,Bp,Pp,new Yt)),i=new wn,l.face=new wp(a,o,s,zr.getNormal(Tp,Ip,Rp,i)),l.faceIndex=a),l}function Op(e,t,n,r,i,a){var o=3*i,s=t.index.getX(o),l=t.index.getX(1+o),o=t.index.getX(2+o),o=Fp(e,n,r,t.attributes.position,t.attributes.uv,s,l,o);return o?(o.faceIndex=i,a&&a.push(o),o):null}function Up(e,t){return t.min.x=e[0],t.min.y=e[1],t.min.z=e[2],t.max.x=e[3],t.max.y=e[4],t.max.z=e[5],t}function zp(e){for(var t=-1,n=-1/0,r=0;r<3;r++){var i=e[r+3]-e[r];n<i&&(n=i,t=r)}return t}class Vp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){for(var n=1/0,r=-1/0,i=0,a=e.length;i<a;i++)var o=e[i][t],n=Math.min(o,n),r=Math.max(o,r);this.min=n,this.max=r}setFromPoints(e,t){for(var n=1/0,r=-1/0,i=0,a=t.length;i<a;i++)var o=t[i],o=e.dot(o),n=Math.min(o,n),r=Math.max(o,r);this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}Vp.prototype.setFromBox=(Ep=new wn,function(e,t){for(var n=t.min,r=t.max,i=1/0,a=-1/0,o=0;o<=1;o++)for(var s=0;s<=1;s++)for(var l=0;l<=1;l++){Ep.x=n.x*o+r.x*(1-o),Ep.y=n.y*s+r.y*(1-s),Ep.z=n.z*l+r.z*(1-l);var c=e.dot(Ep),i=Math.min(c,i),a=Math.max(c,a)}this.min=i,this.max=a});var Gp,kp,Qp,Wp,Hp,Yp,Xp,jp,Kp,qp,Zp,Jp,$p,ef,tf,nf,rf,af,of,sf,lf,cf,uf,df,hf,pf,ff,mf,gf,vf,Af,_f,xf,yf,bf,Mf=(Gp=new wn,kp=new wn,Qp=new wn,function(e,t,n){var r=e.start,i=Gp,a=t.start,o=kp;Qp.subVectors(r,a),Gp.subVectors(e.end,t.start),kp.subVectors(t.end,t.start);a=Qp.dot(o),e=o.dot(i),t=o.dot(o),o=Qp.dot(i),i=i.dot(i)*t-e*e,i=0!=i?(a*e-o*t)/i:0,t=(a+i*e)/t;n.x=i,n.y=t}),Cf=(Wp=new Yt,Hp=new wn,Yp=new wn,function(e,t,n,r){Mf(e,t,Wp);var i,a=Wp.x,o=Wp.y;0<=a&&a<=1&&0<=o&&o<=1?(e.at(a,n),t.at(o,r)):0<=a&&a<=1?(o<0?t.at(0,r):t.at(1,r),e.closestPointToPoint(r,!0,n)):0<=o&&o<=1?(a<0?e.at(0,n):e.at(1,n),t.closestPointToPoint(n,!0,r)):(i=a<0?e.start:e.end,a=o<0?t.start:t.end,o=Yp,e.closestPointToPoint(a,!0,e=Hp),t.closestPointToPoint(i,!0,Yp),e.distanceToSquared(a)<=o.distanceToSquared(i)?(n.copy(e),r.copy(a)):(n.copy(i),r.copy(o)))}),Sf=(Xp=new wn,jp=new wn,Kp=new ki,qp=new jh,function(e,t){var n=e.radius,r=e.center,i=t.a,a=t.b,e=t.c;if(qp.start=i,qp.end=a,qp.closestPointToPoint(r,!0,Xp).distanceTo(r)<=n)return!0;if(qp.start=i,qp.end=e,qp.closestPointToPoint(r,!0,Xp).distanceTo(r)<=n)return!0;if(qp.start=a,qp.end=e,qp.closestPointToPoint(r,!0,Xp).distanceTo(r)<=n)return!0;e=t.getPlane(Kp);if(Math.abs(e.distanceToPoint(r))<=n){r=e.projectPoint(r,jp);if(t.containsPoint(r))return!0}return!1});class wf extends zr{constructor(...e){super(...e),this.isSeparatingAxisTriangle=!0,this.satAxes=new Array(4).fill().map(function(){return new wn}),this.satBounds=new Array(4).fill().map(function(){return new Vp}),this.points=[this.a,this.b,this.c],this.sphere=new jn}}wf.prototype.update=(Zp=new Array(3),function(){var e=this.a,t=this.b,n=this.c;Zp[0]=this.a,Zp[1]=this.b,Zp[2]=this.c;var r=this.satAxes,i=this.satBounds,a=r[0],o=i[0];this.getNormal(a),o.setFromPoints(a,Zp);o=r[1],a=i[1];o.subVectors(e,t),a.setFromPoints(o,Zp);a=r[2],o=i[2];a.subVectors(t,n),o.setFromPoints(a,Zp);r=r[3],i=i[3];r.subVectors(n,e),i.setFromPoints(r,Zp),this.sphere.setFromPoints(this.points)}),wf.prototype.intersectsTriangle=(Jp=new wf,$p=new Array(3),ef=new Array(3),tf=new Vp,nf=new Vp,rf=new wn,function(e){e.isSeparatingAxisTriangle||(Jp.copy(e),Jp.update(),e=Jp);var t=this.satBounds,n=this.satAxes;ef[0]=e.a,ef[1]=e.b,ef[2]=e.c;for(var r=0;r<4;r++){var i=t[r],a=n[r];if(tf.setFromPoints(a,ef),i.isSeparated(tf))return!1}var o=e.satBounds,s=e.satAxes;$p[0]=this.a,$p[1]=this.b,$p[2]=this.c;for(var l=0;l<4;l++){var c=o[l],u=s[l];if(tf.setFromPoints(u,$p),c.isSeparated(tf))return!1}for(var d=0;d<4;d++)for(var h=n[d],p=0;p<4;p++){var f=s[p];if(rf.crossVectors(h,f),tf.setFromPoints(rf,$p),nf.setFromPoints(rf,ef),tf.isSeparated(nf))return!1}return!0}),wf.prototype.distanceToPoint=(af=new wn,function(e){return this.closestPointToPoint(e,af),e.distanceTo(af)}),wf.prototype.distanceToTriangle=(of=new wn,sf=new wn,lf=["a","b","c"],cf=new jh,uf=new jh,function(e,t=null,n=null){if(this.intersectsTriangle(e))return(t||n)&&(this.getMidpoint(of),e.closestPointToPoint(of,sf),this.closestPointToPoint(sf,of),t&&t.copy(of),n&&n.copy(sf)),0;for(var r=1/0,i=0;i<3;i++){var a=void 0,o=lf[i],s=e[o];this.closestPointToPoint(s,of),(a=s.distanceToSquared(of))<r&&(r=a,t&&t.copy(of),n&&n.copy(s));o=this[o];e.closestPointToPoint(o,of),(a=o.distanceToSquared(of))<r&&(r=a,t&&t.copy(o),n&&n.copy(of))}for(var l=0;l<3;l++){cf.set(this[lf[l]],this[lf[(l+1)%3]]);for(var c=0;c<3;c++){uf.set(e[lf[c]],e[lf[(c+1)%3]]),Cf(cf,uf,of,sf);var u=of.distanceToSquared(sf);u<r&&(r=u,t&&t.copy(of),n&&n.copy(sf))}}return Math.sqrt(r)});class Ef extends In{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new rr,this.invMatrix=new rr,this.points=new Array(8).fill().map(function(){return new wn}),this.satAxes=new Array(3).fill().map(function(){return new wn}),this.satBounds=new Array(3).fill().map(function(){return new Vp}),this.alignedSatBounds=new Array(3).fill().map(function(){return new Vp}),this.sphere=new jn}set(e,t,n){super.set(e,t),this.matrix=n}copy(e){super.copy(e),this.matrix.copy(e.matrix)}}Ef.prototype.update=function(){for(var e=this.matrix,t=this.min,n=this.max,r=this.points,i=0;i<=1;i++)for(var a=0;a<=1;a++)for(var o=0;o<=1;o++){var s=r[+i|2*a|4*o];s.x=(i?n:t).x,s.y=(a?n:t).y,s.z=(o?n:t).z,s.applyMatrix4(e)}this.sphere.setFromPoints(this.points);for(var l=this.satBounds,c=this.satAxes,u=r[0],d=0;d<3;d++){var h=c[d],p=l[d],f=r[1<<d];h.subVectors(u,f),p.setFromPoints(h,r)}var m=this.alignedSatBounds;m[0].setFromPointsField(r,"x"),m[1].setFromPointsField(r,"y"),m[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert()},Ef.prototype.intersectsBox=(df=new Vp,function(e){if(!e.intersectsSphere(this.sphere))return!1;var t=e.min,n=e.max,r=this.satBounds,i=this.satAxes,a=this.alignedSatBounds;if(df.min=t.x,df.max=n.x,a[0].isSeparated(df))return!1;if(df.min=t.y,df.max=n.y,a[1].isSeparated(df))return!1;if(df.min=t.z,df.max=n.z,a[2].isSeparated(df))return!1;for(var o=0;o<3;o++){var s=i[o],l=r[o];if(df.setFromBox(s,e),l.isSeparated(df))return!1}return!0}),Ef.prototype.intersectsTriangle=(hf=new wf,pf=new Array(3),ff=new Vp,mf=new Vp,gf=new wn,function(e){e.isSeparatingAxisTriangle||(hf.copy(e),hf.update(),e=hf);var t=this.satBounds,n=this.satAxes;pf[0]=e.a,pf[1]=e.b,pf[2]=e.c;for(var r=0;r<3;r++){var i=t[r],a=n[r];if(ff.setFromPoints(a,pf),i.isSeparated(ff))return!1}for(var o=e.satBounds,s=e.satAxes,l=this.points,c=0;c<3;c++){var u=o[c],d=s[c];if(ff.setFromPoints(d,l),u.isSeparated(ff))return!1}for(var h=0;h<3;h++)for(var p=n[h],f=0;f<4;f++){var m=s[f];if(gf.crossVectors(p,m),ff.setFromPoints(gf,pf),mf.setFromPoints(gf,l),ff.isSeparated(mf))return!1}return!0}),Ef.prototype.closestPointToPoint=function(e,t){return t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Ef.prototype.distanceToPoint=(vf=new wn,function(e){return this.closestPointToPoint(e,vf),e.distanceTo(vf)}),Ef.prototype.distanceToBox=(Af=["x","y","z"],_f=new Array(12).fill().map(function(){return new jh}),xf=new Array(12).fill().map(function(){return new jh}),yf=new wn,bf=new wn,function(e,t=0,n=null,r=null){if(this.intersectsBox(e))return(n||r)&&(e.getCenter(bf),this.closestPointToPoint(bf,yf),e.closestPointToPoint(yf,bf),n&&n.copy(yf),r&&r.copy(bf)),0;for(var i=t*t,a=e.min,o=e.max,s=this.points,l=1/0,c=0;c<8;c++){var u=s[c];bf.copy(u).clamp(a,o);var d=u.distanceToSquared(bf);if(d<l&&(l=d,n&&n.copy(u),r&&r.copy(bf),d<i))return Math.sqrt(d)}for(var h=0,p=0;p<3;p++)for(var f=0;f<=1;f++)for(var m=0;m<=1;m++){var g=(p+1)%3,v=(p+2)%3,A=s[f<<g|m<<v],_=s[1<<p|f<<g|m<<v];_f[h].set(A,_);var x=Af[p],A=Af[g],_=Af[v],g=xf[h],v=g.start,g=g.end;v[x]=a[x],v[A]=(f?a:o)[A],v[_]=m?a[_]:o[A],g[x]=o[x],g[A]=(f?a:o)[A],g[_]=m?a[_]:o[A],h++}for(var y=0;y<=1;y++)for(var b=0;b<=1;b++)for(var M=0;M<=1;M++){bf.x=(y?o:a).x,bf.y=(b?o:a).y,bf.z=(M?o:a).z,this.closestPointToPoint(bf,yf);var C=bf.distanceToSquared(yf);if(C<l&&(l=C,n&&n.copy(yf),r&&r.copy(bf),C<i))return Math.sqrt(C)}for(var S=0;S<12;S++)for(var w=_f[S],E=0;E<12;E++){var T=xf[E];Cf(w,T,yf,bf);T=yf.distanceToSquared(bf);if(T<l&&(l=T,n&&n.copy(yf),r&&r.copy(bf),T<i))return Math.sqrt(T)}return Math.sqrt(l)});var Tf,If,Rf,Lf,Bf,Pf,Df,Nf,Ff,Of,Uf,zf,Vf,Gf,kf,Qf=new In,Wf=new wn,Hf=["x","y","z"];function Yf(e,t,n,r){var i=e.a,a=e.b,o=e.c,e=n.getX(t);i.x=r.getX(e),i.y=r.getY(e),i.z=r.getZ(e),e=n.getX(t+1),a.x=r.getX(e),a.y=r.getY(e),a.z=r.getZ(e),e=n.getX(t+2),o.x=r.getX(e),o.y=r.getY(e),o.z=r.getZ(e)}class Xf{constructor(){}intersectRay(e,t){return Up(this.boundingData,Qf),e.intersectBox(Qf,t)}raycast(e,t,n,r){this.count?function(e,t,n,r,i,a,o){for(var s=i,l=i+a;s<l;s++)Op(e,t,n,r,s,o)}(e,e.geometry,t,n,this.offset,this.count,r):(this.left.intersectRay(n,Wf)&&this.left.raycast(e,t,n,r),this.right.intersectRay(n,Wf)&&this.right.raycast(e,t,n,r))}raycastFirst(e,t,n){if(this.count)return function(e,t,n,r,i,a){for(var o=1/0,s=null,l=i,c=i+a;l<c;l++){var u=Op(e,t,n,r,l);u&&u.distance<o&&(o=(s=u).distance)}return s}(e,e.geometry,t,n,this.offset,this.count);var r=this.splitAxis,i=Hf[r],a=0<=n.direction[i]?(l=this.left,this.right):(l=this.right,this.left),o=l.intersectRay(n,Wf)?l.raycastFirst(e,t,n):null;if(o){var s=n.origin[i],l=s-o.point[i],i=s-a.boundingData[r],r=s-a.boundingData[r+3],l=l*l;if(l<=i*i&&l<=r*r)return o}n=a.intersectRay(n,Wf)?a.raycastFirst(e,t,n):null;return o&&n?o.distance<=n.distance?o:n:o||n||null}}Xf.prototype.shapecast=(Tf=new wf,If=new In,Rf=new In,function(e,t,n=null,r=null){if(this.count&&n){for(var i=e.geometry,a=i.index,o=i.attributes.position,s=this.offset,l=3*s,c=3*(this.count+s);l<c;l+=3)if(Yf(Tf,l,a,o),Tf.update(),n(Tf,l,l+1,l+2))return!0;return!1}var u,d,h,p,f=this.left,m=this.right,i=f,s=m;return r&&(p=Rf,Up(i.boundingData,h=If),Up(s.boundingData,p),u=r(h),(d=r(p))<u&&(i=m,s=f,f=u,u=d,d=f,f=h,h=p,p=f)),h||Up(i.boundingData,h=If),!(!t(h,!!i.count,u,i)||!i.shapecast(e,t,n,r))||(p||Up(s.boundingData,p=Rf),!(!t(p,!!s.count,d,s)||!s.shapecast(e,t,n,r)))}),Xf.prototype.intersectsGeometry=(Lf=new wf,Bf=new wf,Pf=new Ei,Df=new rr,Nf=new Ef,Ff=new Ef,function(e,t,r,n=null){if(null===n&&(t.boundingBox||t.computeBoundingBox(),Nf.set(t.boundingBox.min,t.boundingBox.max,r),Nf.update(),n=Nf),!this.count){var i=this.left,a=this.right;return(Up(i.boundingData,Qf),n.intersectsBox(Qf)&&i.intersectsGeometry(e,t,r,n))?!0:(Up(a.boundingData,Qf),!(!n.intersectsBox(Qf)||!a.intersectsGeometry(e,t,r,n)))}var e=e.geometry,o=e.index,s=e.attributes.position,l=t.index,c=t.attributes.position,u=this.offset,d=this.count;if(Df.copy(r).invert(),t.boundsTree){Up(this.boundingData,Ff),Ff.matrix.copy(Df),Ff.update();t=(Pf.geometry=t).boundsTree.shapecast(Pf,function(e){return Ff.intersectsBox(e)},function(e){e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.update();for(var t=3*u,n=3*(d+u);t<n;t+=3)if(Yf(Bf,t,o,s),Bf.update(),e.intersectsTriangle(Bf))return!0;return!1});return Pf.geometry=null,t}for(var h=3*u,p=d+3*u;h<p;h+=3){Yf(Lf,h,o,s),Lf.a.applyMatrix4(Df),Lf.b.applyMatrix4(Df),Lf.c.applyMatrix4(Df),Lf.update();for(var f=0,m=l.count;f<m;f+=3)if(Yf(Bf,f,l,c),Bf.update(),Lf.intersectsTriangle(Bf))return!0}}),Xf.prototype.intersectsBox=(Of=new Ef,function(e,t,n){return Of.set(t.min,t.max,n),Of.update(),this.shapecast(e,function(e){return Of.intersectsBox(e)},function(e){return Of.intersectsTriangle(e)})}),Xf.prototype.intersectsSphere=function(e,t){return this.shapecast(e,function(e){return t.intersectsBox(e)},function(e){return Sf(t,e)})},Xf.prototype.closestPointToPoint=(Uf=new wn,function(e,t,n=null,r=0,i=1/0){var a=1/0;return this.shapecast(e,function(e,t,n){return n<a&&n<i},function(e){e.closestPointToPoint(t,Uf);e=t.distanceTo(Uf);return e<a&&(n&&n.copy(Uf),a=e),e<r},function(e){return e.distanceToPoint(t)}),a}),Xf.prototype.closestPointToGeometry=(zf=new wf,Vf=new Ef,Gf=new wn,kf=new wn,function(e,t,a,o=null,s=null,l=0,r=1/0){t.boundingBox||t.computeBoundingBox(),Vf.set(t.boundingBox.min,t.boundingBox.max,a),Vf.update();var c,u,d=t.attributes.position,h=t.index;o&&(c=Gf),s&&(u=kf);var p=1/0;return this.shapecast(e,function(e,t,n){return n<p&&n<r},function(e){for(var t=e.sphere,n=0,r=h.count;n<r;n+=3){Yf(zf,n,h,d),zf.a.applyMatrix4(a),zf.b.applyMatrix4(a),zf.c.applyMatrix4(a),zf.sphere.setFromPoints(zf.points);var i=zf.sphere,i=i.center.distanceTo(t.center)-i.radius-t.radius;if(!(p<i)){zf.update();i=e.distanceToTriangle(zf,c,u);if(i<p&&(o&&o.copy(c),s&&s.copy(u),p=i),i<l)return!0}}return!1},function(e){return Vf.distanceToBox(e,Math.min(p,r))}),p});var jf=["x","y","z"];var Kf=new In;class qf{constructor(e,t){if(this.geo=e,this.options=t,this.bounds=function(e){for(var t=e.attributes.position.array,n=e.index.array,r=n.length/3,i=new Float32Array(6*r),a=0;a<r;a++)for(var o=3*n[3*a+0],s=3*n[3*a+1],l=3*n[3*a+2],c=0;c<3;c++){var u=t[o+c],d=t[s+c],h=t[l+c],p=Math.min(u,d,h),h=(Math.max(u,d,h)-p)/2;i[6*a+2*c]=p+h,i[6*a+2*c+1]=h}return i}(e),this.sahplanes=null,2===t.strategy){var n=e.index.count/3;this.sahplanes=[new Array(n),new Array(n),new Array(n)];for(var r=0;r<n;r++)for(var i=0;i<3;i++)this.sahplanes[i][r]={p:this.bounds[6*r+2*i],tri:r}}}getAverage(e,t,n){for(var r=0,i=this.bounds,a=e,o=e+t;a<o;a++)r+=i[6*a+2*n];return r/t}getBounds(e,t,n){for(var r=1/0,i=1/0,a=1/0,o=-1/0,s=-1/0,l=-1/0,c=this.bounds,u=e,d=e+t;u<d;u++)var h=c[6*u+0],p=c[6*u+1],r=Math.min(r,h-p),o=Math.max(o,h+p),h=c[6*u+2],p=c[6*u+3],i=Math.min(i,h-p),s=Math.max(s,h+p),h=c[6*u+4],p=c[6*u+5],a=Math.min(a,h-p),l=Math.max(l,h+p);return n[0]=r,n[1]=i,n[2]=a,n[3]=o,n[4]=s,n[5]=l,n}partition(e,t,n){for(var r=e,i=e+t-1,a=n.pos,o=2*n.axis,s=this.geo.index.array,l=this.bounds,c=this.sahplanes;;){for(;r<=i&&l[6*r+o]<a;)r++;for(;r<=i&&l[6*i+o]>=a;)i--;if(!(r<i))return r;for(var u=0;u<3;u++){var d=s[3*r+u];s[3*r+u]=s[3*i+u],s[3*i+u]=d;d=l[6*r+2*u];l[6*r+2*u]=l[6*i+2*u],l[6*i+2*u]=d;d=l[6*r+2*u+1];l[6*r+2*u+1]=l[6*i+2*u+1],l[6*i+2*u+1]=d}if(c)for(var h=0;h<3;h++){var p=c[h][r];c[h][r]=c[h][i],c[h][i]=p}r++,i--}}getOptimalSplit(e,t,n,r){var i=-1,a=0;if(0===r)-1!==(i=zp(e))&&(a=(e[i+3]+e[i])/2);else if(1===r)-1!==(i=zp(e))&&(a=this.getAverage(t,n,i));else if(2===r){for(var o=3,s=1,l=Up(e,Kf),c=[l.max.x-l.min.x,l.max.y-l.min.y,l.max.z-l.min.z],u=2*(c[0]*c[1]+c[0]*c[2]+c[1]*c[2]),d=[[],[],[]],h=t,p=t+n;h<p;h++)for(var f=0;f<3;f++)d[f].push(this.sahplanes[f][h]);d.forEach(function(e){return e.sort(function(e,t){return e.p-t.p})});for(var i=-1,m=s*n,g=0;g<3;g++)for(var v=(g+1)%3,A=(g+2)%3,_=l.min[jf[g]],x=l.max[jf[g]],y=d[g],b=0,M=n,C=0;C<y.length;C++){var S=y[C];b++,M--;var w=S.p-_,E=x-S.p,T=c[v],I=c[v],R=c[A],L=c[A],B=o+s*(2*(T*R+T*w+R*w)/u*b+2*(I*L+I*E+L*E)/u*M);B<m&&(i=g,a=S.p,m=B)}}return{axis:i,pos:a}}}class Zf{constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.attributes.position.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the position attribute.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0},t)).strategy=Math.max(0,Math.min(2,t.strategy)),this._roots=this._buildTree(e,t)}_ensureIndex(e){if(!e.index){var t=e.attributes.position.count,n=new(65535<t?Uint32Array:Uint16Array)(t);e.setIndex(new Hr(n,1));for(var r=0;r<t;r++)n[r]=r}}_getRootIndexRanges(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];for(var t=[],n=new Set,r=0,i=e.groups;r<i.length;r++){var a=i[r];n.add(a.start),n.add(a.start+a.count)}for(var o=Array.from(n.values()).sort(function(e,t){return e-t}),s=0;s<o.length-1;s++){var l=o[s],c=o[s+1];t.push({offset:l/3,count:(c-l)/3})}return t}_buildTree(e,s){this._ensureIndex(e);var t,n,l=new qf(e,s),c=!1,u=function(e,t,n,r=0){if(r>=s.maxDepth&&(c=!0),n<=s.maxLeafTris||r>=s.maxDepth)return e.offset=t,e.count=n,e;var i=l.getOptimalSplit(e.boundingData,t,n,s.strategy);if(-1===i.axis)return e.offset=t,e.count=n,e;var a,o=l.partition(t,n,i);return o===t||o===t+n?(e.offset=t,e.count=n):(e.splitAxis=i.axis,(a=e.left=new Xf).boundingData=l.getBounds(i=t,t=o-t,new Float32Array(6)),u(a,i,t,r+1),(i=e.right=new Xf).boundingData=l.getBounds(o=o,t=n-t,new Float32Array(6)),u(i,o,t,r+1)),e},r=[],i=this._getRootIndexRanges(e);if(1===i.length){var a=new Xf,o=i[0];null!=e.boundingBox?a.boundingData=(t=e.boundingBox,(n=new Float32Array(6))[0]=t.min.x,n[1]=t.min.y,n[2]=t.min.z,n[3]=t.max.x,n[4]=t.max.y,n[5]=t.max.z,n):a.boundingData=l.getBounds(o.offset,o.count,new Float32Array(6)),u(a,o.offset,o.count),r.push(a)}else for(var d=0;d<i.length;d++){var h=i[d],p=new Xf;p.boundingData=l.getBounds(h.offset,h.count,new Float32Array(6)),u(p,h.offset,h.count),r.push(p)}if(c&&s.verbose&&(console.warn(`MeshBVH: Max depth of ${s.maxDepth} reached when generating BVH. Consider increasing maxDepth.`),console.warn(this,e)),null==e.boundingBox){var f=new In;e.boundingBox=new In;for(var m=0;m<r.length;m++){var g=r[m];e.boundingBox.union(Up(g.boundingData,f))}}return r}raycast(e,t,n,r){for(var i=0,a=this._roots;i<a.length;i++)a[i].raycast(e,t,n,r)}raycastFirst(e,t,n){for(var r=null,i=0,a=this._roots;i<a.length;i++){var o=a[i].raycastFirst(e,t,n);null!=o&&(null==r||o.distance<r.distance)&&(r=o)}return r}intersectsGeometry(e,t,n){for(var r=0,i=this._roots;r<i.length;r++)if(i[r].intersectsGeometry(e,t,n))return!0;return!1}shapecast(e,t,n=null,r=null){for(var i=0,a=this._roots;i<a.length;i++)if(a[i].shapecast(e,t,n,r))return!0;return!1}intersectsBox(e,t,n){for(var r=0,i=this._roots;r<i.length;r++)if(i[r].intersectsBox(e,t,n))return!0;return!1}intersectsSphere(e,t){for(var n=0,r=this._roots;n<r.length;n++)if(r[n].intersectsSphere(e,t))return!0;return!1}closestPointToGeometry(e,t,n,r,i,a,o){for(var s=1/0,l=0,c=this._roots;l<c.length;l++){var u=c[l].closestPointToGeometry(e,t,n,r,i,a,o);if(u<s&&(s=u),u<a)return u}return s}distanceToGeometry(e,t,n,r,i){return this.closestPointToGeometry(e,t,n,null,null,r,i)}closestPointToPoint(e,t,n,r,i){for(var a=1/0,o=0,s=this._roots;o<s.length;o++){var l=s[o].closestPointToPoint(e,t,n,r,i);if(l<a&&(a=l),l<r)return l}return a}distanceToPoint(e,t,n,r){return this.closestPointToPoint(e,t,null,n,r)}}var Jf=new Xl({color:65416,transparent:!0,opacity:.3}),$f=(new gp).geometry,em=new In;class tm extends Tr{constructor(e,t=10,n=0){super("MeshBVHRootVisualizer"),this.depth=t,this._oldDepth=-1,this._mesh=e,this._boundsTree=null,this._group=n,this.update()}update(){var i=this;if(this._mesh.geometry.boundsTree!==this._boundsTree||this._oldDepth!==this.depth){this._oldDepth=this.depth,this._boundsTree=this._mesh.geometry.boundsTree;var a,o=0;for(this._boundsTree&&(a=function(e,t){var n,r="count"in e;t!==i.depth&&(t!==i.depth-1&&!r||((n=o<i.children.length?i.children[o]:null)||((n=new nc($f,Jf)).raycast=function(){return[]},i.add(n)),o++,Up(e.boundingData,em),em.getCenter(n.position),n.scale.subVectors(em.max,em.min).multiplyScalar(.5),0===n.scale.x&&(n.scale.x=Number.EPSILON),0===n.scale.y&&(n.scale.y=Number.EPSILON),0===n.scale.z&&(n.scale.z=Number.EPSILON)),r||(a(e.left,t+1),a(e.right,t+1)))})(this._boundsTree._roots[this._group],0);this.children.length>o;)this.remove(this.children.pop())}}}class nm extends Tr{constructor(e,t=10){super("MeshBVHVisualizer"),this.depth=t,this._mesh=e,this._roots=[],this.update()}update(){for(var e=this._mesh.geometry.boundsTree,t=e?e._roots.length:0;this._roots.length>t;)this._roots.pop();for(var n,r=0;r<t;r++)r>=this._roots.length?(n=new tm(this._mesh,this.depth,r),this.add(n),this._roots.push(n)):((n=this._roots[r]).depth=this.depth,n.update());this.position.copy(this._mesh.position),this.rotation.copy(this._mesh.rotation),this.scale.copy(this._mesh.scale)}}var rm=new nr,im=new rr,am=Ei.prototype.raycast;function om(e,t){if(this.geometry.boundsTree){if(!this.isAuxClippingMesh&&void 0!==this.material){try{im.copy(this.matrixWorld).invert()}catch(e){return}var n;rm.copy(e.ray).applyMatrix4(im),!0===e.firstHitOnly?(n=this.geometry.boundsTree.raycastFirst(this,e,rm))&&t.push(n):this.geometry.boundsTree.raycast(this,e,rm,t)}}else am.call(this,e,t)}function sm(e){return this.boundsTree=new Zf(this,e),this.boundsTree}function lm(){this.boundsTree=null}var cm=["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","envMap","gradientMap","lightMap","map","metalnessMap","normalMap","roughnessMap","specularMap"],um={disposeTextures:function(t){if(cm.forEach(function(e){t[e]&&t[e].isTexture&&t[e].dispose()}),"MeshNodeMaterial"==t.type)for(var e in t.nodeTextures)t.nodeTextures[e]&&t.nodeTextures[e].dispose()}};class dm{constuctor(){this.name="",this.type="Constraint",this.mute=!1}_updateObjMatrixWorld(e){e.matrixAutoUpdate&&e.matrix.compose(e.position,e.quaternion,e.scale),null==e.parent?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(e.parent.matrixWorld,e.matrix)}update(e){this.mute}copy(e){return this.name=e.name,this.mute=e.mute,this}clone(){return(new this.constructor).copy(this)}}dm.prototype.isConstraint=!0;class hm extends dm{constructor(e){super(),this.type="TargetConstraint",this.target=e}copy(e){return super.copy(e),this.target=e.target,this}clone(){return new this.constructor(this.target).copy(this)}}hm.prototype.isTargetConstraint=!0;const pm=new rr,fm=(new Sn).setFromAxisAngle(new wn(1,0,0),-Math.PI/2);class mm extends hm{constructor(e){super(e),this.type="ChildOfConstraint",this.offsetMatrix=new rr,this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.offsetMatrix.copy(e.offsetMatrix),this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){super.update(e),this.mute||(pm.multiplyMatrices(this.target.matrixWorld,this.offsetMatrix),pm.decompose(e.position,e.quaternion,e.scale),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(fm))}}mm.prototype.isChildOfConstraint=!0;const gm=new wn,vm=new Sn,Am=new wn;class _m extends hm{constructor(e){super(e),this.type="CopyLocationConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.invertX=!1,this.invertY=!1,this.invertZ=!1,this.useOffset=!1,this.influence=1,this._firstIteration=!0,this._objPosInit=new wn,this._offset=new wn}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.invertX=e.invertX,this.invertY=e.invertY,this.invertZ=e.invertZ,this.useOffset=e.useOffset,this.influence=e.influence,this._firstIteration=!1,this}update(e){super.update(e),this.mute||(this.target.matrixWorld.decompose(gm,vm,Am),this._firstIteration&&(this._updateObjMatrixWorld(e),e.getWorldPositionNU(this._objPosInit),this._offset.subVectors(gm,this._objPosInit),this._firstIteration=!1),this.useX&&(this.invertX&&(gm.x=-gm.x),this.useOffset&&(gm.x-=this._offset.x)),this.useY&&(this.invertY&&(gm.y=-gm.y),this.useOffset&&(gm.y-=this._offset.y)),this.useZ&&(this.invertZ&&(gm.z=-gm.z),this.useOffset&&(gm.z-=this._offset.z)),e.position.lerpVectors(this._objPosInit,gm,this.influence),e.parent&&e.parent.worldToLocal(e.position))}}_m.prototype.isCopyLocationConstraint=!0;const xm=(new Sn).setFromAxisAngle(new wn(1,0,0),-Math.PI/2),ym=new wn,bm=new Sn,Mm=new wn;class Cm extends hm{constructor(e){super(e),this.type="CopyRotationConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.invertX=!1,this.invertY=!1,this.invertZ=!1,this.mixMode="REPLACE",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objQuatInit=new Sn}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.invertX=e.invertX,this.invertY=e.invertY,this.invertZ=e.invertZ,this.mixMode=e.mixMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!1,this}update(e){super.update(e),this.mute||(this.target.matrixWorld.decompose(ym,bm,Mm),this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(ym,this._objQuatInit,Mm),this._firstIteration=!1),e.quaternion.copy(this._objQuatInit),(this.useX||this.useY||this.useZ)&&("REPLACE"==this.mixMode||"ADD"==this.mixMode||("BEFORE"==this.mixMode?bm.multiply(e.quaternion):"AFTER"==this.mixMode?bm.premultiply(e.quaternion):this.mixMode),e.quaternion.slerp(bm,this.influence)),e.parent&&(e.parent.matrixWorld.decompose(ym,bm,Mm),e.quaternion.premultiply(bm.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(xm))}}Cm.prototype.isCopyRotationConstraint=!0;const Sm=new wn,wm=new Sn,Em=new wn;class Tm extends hm{constructor(e){super(e),this.type="CopyScaleConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.power=1,this.useMakeUniform=!1,this.useOffset=!1,this.useAdd=!1,this.influence=1,this._objInitScale=new wn,this._volumeScaleFactor=new wn,this._firstIteration=!0}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.power=e.power,this.useMakeUniform=e.useMakeUniform,this.useOffset=e.useOffset,this.useAdd=e.useAdd,this.influence=e.influence,this._firstIteration=!1,this}update(e){if(super.update(e),!this.mute){if(this.target.matrixWorld.decompose(Sm,wm,Em),this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(Sm,wm,this._objInitScale),this._volumeScaleFactor.set(Math.pow(Em.x-this._objInitScale.x,3),Math.pow(Em.y-this._objInitScale.y,3),Math.pow(Em.z-this._objInitScale.z,3)),this._firstIteration=!1),this.useMakeUniform){let e=1;this.useX&&(e*=Em.x),this.useY&&(e*=Em.y),this.useZ&&(e*=Em.z),e=Math.pow(Math.cbrt(e),this.power),Em.set(e,e,e),this.useOffset&&(this.useAdd?(Em.add(this._objInitScale),Em.addScalar(-1)):Em.multiply(this._objInitScale))}else Em.set(this.useX?Math.pow(Em.x,this.power):this._objInitScale.x,this.useY?Math.pow(Em.y,this.power):this._objInitScale.y,this.useZ?Math.pow(Em.z,this.power):this._objInitScale.z),this.useOffset&&(this.useAdd?Em.set(this.useX?Em.x+this._objInitScale.x-1:Em.x,this.useY?Em.y+this._objInitScale.y-1:Em.y,this.useZ?Em.z+this._objInitScale.z-1:Em.z):Em.set(this.useX?Em.x*this._objInitScale.x:Em.x,this.useY?Em.y*this._objInitScale.y:Em.y,this.useZ?Em.z*this._objInitScale.z:Em.z));e.scale.copy(this._objInitScale),e.scale.lerp(Em,this.influence)}}}Tm.prototype.isCopyScaleConstraint=!0;const Im=(new Sn).setFromAxisAngle(new wn(1,0,0),-Math.PI/2),Rm=new rr,Lm=new wn,Bm=new Sn,Pm=new wn;class Dm extends hm{constructor(e){super(e),this.type="CopyTransformsConstraint",this.mixMode="REPLACE",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new rr}copy(e){return super.copy(e),this.mixMode=e.mixMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}update(e){super.update(e),this.mute||(this._firstIteration&&(this._updateObjMatrixWorld(e),this._objMatrixWorldInit.copy(e.matrixWorld),this._firstIteration=!1),Rm.copy(this.target.matrixWorld),"REPLACE"==this.mixMode||("BEFORE"==this.mixMode?Rm.multiply(this._objMatrixWorldInit):"AFTER"==this.mixMode&&Rm.premultiply(this._objMatrixWorldInit)),Rm.decompose(Lm,Bm,Pm),this._objMatrixWorldInit.decompose(e.position,e.quaternion,e.scale),e.position.lerp(Lm,this.influence),e.quaternion.slerp(Bm,this.influence),e.scale.lerp(Pm,this.influence),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Im))}}Dm.prototype.isCopyTransformsConstraint=!0;const Nm=(new Sn).setFromAxisAngle(new wn(1,0,0),-Math.PI/2),Fm=new wn,Om=new Sn,Um=new wn,zm=new wn,Vm=new wn,Gm=new wn,km=new wn,Qm={X:0,Y:1,Z:2,"-X":3,"-Y":4,"-Z":5},Wm={0:new wn(1,0,0),1:new wn(0,1,0),2:new wn(0,0,1),3:new wn(-1,0,0),4:new wn(0,-1,0),5:new wn(0,0,-1)};class Hm extends hm{constructor(e){super(e),this.type="DampedTrackConstraint",this.trackAxis="X",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!1,this}update(t){if(super.update(t),!this.mute&&(this.target.matrixWorld.decompose(Fm,Om,Um),this._firstIteration&&(this._updateObjMatrixWorld(t),this._firstIteration=!1),t.matrixWorld.decompose(zm,Om,Um),Vm.subVectors(Fm,zm),0!=Vm.length())){let e;if(Vm.normalize(),Gm.copy(Wm[Qm[this.trackAxis]]),Gm.applyQuaternion(Om),0==Gm.length()&&Gm.copy(Wm[Qm[this.trackAxis]]),Gm.normalize(),km.crossVectors(Gm,Vm),e=Gm.angleTo(Vm),km.length()<Number.EPSILON){if(Math.abs(e)<Math.PI-.01)return;if(e=Math.PI,Vm.copy(Wm[(Qm[this.trackAxis]+2)%6]),Vm.applyQuaternion(Om),km.crossVectors(Gm,Vm),0==km.length())return}km.normalize(),t.quaternion.premultiply(Om.setFromAxisAngle(km,e)),t.parent&&(t.parent.matrixWorld.decompose(Fm,Om,Um),t.quaternion.premultiply(Om.invert())),this.fixCameraLightRotation&&(t.isCamera||t.isLight)&&t.quaternion.multiply(Nm)}}}Hm.prototype.isDampedTrackConstraint=!0;const Ym={X:new wn(1,0,0),Y:new wn(0,1,0),Z:new wn(0,0,1),"-X":new wn(-1,0,0),"-Y":new wn(0,-1,0),"-Z":new wn(0,0,-1)},Xm=new wn,jm=new wn,Km=new wn,qm=new wn;class Zm extends hm{constructor(e){super(e),this.type="FloorConstraint",this.floorLocation="Y",this.offset=0,this.useRotation=!1}copy(e){return super.copy(e),this.floorLocation=e.floorLocation,this.offset=e.offset,this.useRotation=e.useRotation,this}update(e){if(super.update(e),!this.mute){const r=e.position;qm.copy(this.target.position);var t=this.target.scale,n=this.offset;if(this.useRotation){Xm.copy(Ym[this.floorLocation]),Xm.applyQuaternion(this.target.quaternion);let e;switch(this.floorLocation){case"X":qm.x+=n*t.x,Km.subVectors(r,qm),e=Xm.dot(Km),Xm.multiplyScalar(e),jm.subVectors(Km,Xm).add(qm),jm.x>r.x?r.copy(jm):r.x=Math.max(r.x,qm.x);break;case"Y":qm.y+=n*t.y,Km.subVectors(r,qm),e=Xm.dot(Km),Xm.multiplyScalar(e),jm.subVectors(Km,Xm).add(qm),jm.y>r.y?r.copy(jm):r.y=Math.max(r.y,qm.y);break;case"Z":qm.z+=n*t.z,Km.subVectors(r,qm),e=Xm.dot(Km),Xm.multiplyScalar(e),jm.subVectors(Km,Xm).add(qm),jm.z>r.z?r.copy(jm):r.z=Math.max(r.z,qm.z);break;case"-X":qm.x+=n*t.x,Km.subVectors(r,qm),e=Xm.dot(Km),Xm.multiplyScalar(e),jm.subVectors(Km,Xm).add(qm),jm.x<r.x?r.copy(jm):r.x=Math.min(r.x,qm.x);break;case"-Y":qm.y+=n*t.y,Km.subVectors(r,qm),e=Xm.dot(Km),Xm.multiplyScalar(e),jm.subVectors(Km,Xm).add(qm),jm.y<r.y?r.copy(jm):r.y=Math.min(r.y,qm.y);break;case"-Z":qm.z+=n*t.z,Km.subVectors(r,qm),e=Xm.dot(Km),Xm.multiplyScalar(e),jm.subVectors(Km,Xm).add(qm),jm.z<r.z?r.copy(jm):r.z=Math.min(r.z,qm.z)}}else switch(this.floorLocation){case"X":r.x=Math.max(r.x,qm.x+n);break;case"Y":r.y=Math.max(r.y,qm.y+n);break;case"Z":r.z=Math.max(r.z,qm.z+n);break;case"-X":r.x=Math.min(r.x,qm.x+n);break;case"-Y":r.y=Math.min(r.y,qm.y+n);break;case"-Z":r.z=Math.min(r.z,qm.z+n)}}}}Zm.prototype.isFloorConstraint=!0;const Jm=new wn,$m=new Sn,e0=new wn,t0=new wn;class n0 extends hm{constructor(e){super(e),this.type="LimitDistanceConstraint",this.distance=0,this.limitMode="LIMITDIST_ONSURFACE",this.useTransformLimit=!1,this.influence=1,this._objPosInit=new wn,this._distInit=0,this._sfac=1,this._clampSurf=0}copy(e){return super.copy(e),this.distance=e.distance,this.limitMode=e.limitMode,this.useTransformLimit=e.useTransformLimit,this.influence=e.influence,this}update(e){super.update(e),this.mute||(this._sfac=1,this._clampSurf=0,this.target.matrixWorld.decompose(Jm,$m,e0),this._updateObjMatrixWorld(e),e.getWorldPositionNU(this._objPosInit),t0.subVectors(this._objPosInit,Jm),this._distInit=t0.length(),"LIMITDIST_INSIDE"==this.limitMode?this._distInit>=this.distance&&(this._clampSurf=1,0!=this._distInit&&(this._sfac=this.distance/this._distInit)):"LIMITDIST_OUTSIDE"==this.limitMode?this._distInit<=this.distance&&(this._clampSurf=1,0!=this._distInit&&(this._sfac=this.distance/this._distInit)):"LIMITDIST_ONSURFACE"==this.limitMode&&this._distInit-this.distance!=0&&(this._clampSurf=1,0!=this._distInit&&(this._sfac=this.distance/this._distInit)),this._clampSurf&&(e.position.lerpVectors(this._objPosInit,Jm,(1-this._sfac)*this.influence),e.parent&&e.parent.worldToLocal(e.position)))}}n0.prototype.isLimitDistanceConstraint=!0;class r0 extends dm{constructor(){super(),this.type="LimitLocationConstraint",this.min=(new wn).setScalar(-1/0),this.max=(new wn).setScalar(1/0)}copy(e){return super.copy(e),this.min.copy(e.min),this.max.copy(e.max),this}update(e){super.update(e),this.mute||e.position.clamp(this.min,this.max)}}r0.prototype.isLimitLocationConstraint=!0;const i0=new pr;class a0 extends dm{constructor(){super(),this.type="LimitRotationConstraint",this.axis="Y",this.min=0,this.max=2*Math.PI}copy(e){return super.copy(e),this.axis=e.axis,this.min=e.min,this.max=e.max,this}update(e){super.update(e),this.mute||("X"==this.axis?(i0.setFromQuaternion(e.quaternion,"XYZ"),i0.x=this._clampAngle(i0.x,this.min,this.max)):"Y"==this.axis?(i0.setFromQuaternion(e.quaternion,"YZX"),i0.y=this._clampAngle(i0.y,this.min,this.max)):"Z"==this.axis&&(i0.setFromQuaternion(e.quaternion,"ZXY"),i0.z=this._clampAngle(i0.z,this.min,this.max)),e.quaternion.setFromEuler(i0))}_clampAngle(e,t,n){return e=Math.abs(n-t)<2*Math.PI?Wt(e,t,n):e}}a0.prototype.isLimitRotationConstraint=!0;class o0 extends dm{constructor(){super(),this.type="LimitScaleConstraint",this.min=(new wn).setScalar(-1/0),this.max=(new wn).setScalar(1/0)}copy(e){return super.copy(e),this.min.copy(e.min),this.max.copy(e.max),this}update(e){super.update(e),this.mute||e.scale.clamp(this.min,this.max)}}o0.prototype.isLimitScaleConstraint=!0;const s0=(new Sn).setFromAxisAngle(new wn(1,0,0),-Math.PI/2),l0=new wn,c0=new wn,u0=new wn,d0=new wn,h0=new wn,p0=new ki,f0=new wn,m0=new wn,g0=new Sn;class v0 extends hm{constructor(e){super(e),this.type="LockedTrackConstraint",this.trackAxis="X",this.lockAxis="Y",this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.lockAxis=e.lockAxis,this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){var t;super.update(e),this.mute||(u0.set("X"==this.trackAxis?1:"-X"==this.trackAxis?-1:0,"Y"==this.trackAxis?1:"-Y"==this.trackAxis?-1:0,"Z"==this.trackAxis?1:"-Z"==this.trackAxis?-1:0),d0.set("X"==this.lockAxis?1:0,"Y"==this.lockAxis?1:0,"Z"==this.lockAxis?1:0),1!=Math.abs(u0.dot(d0))&&(l0.setFromMatrixPosition(e.matrixWorld),c0.setFromMatrixPosition(this.target.matrixWorld),p0.setFromNormalAndCoplanarPoint(d0,l0),p0.projectPoint(c0,h0).sub(l0),t=0<f0.crossVectors(u0,h0).dot(d0)?1:-1,e.setRotationFromAxisAngle(p0.normal,t*u0.angleTo(h0)),e.parent&&(e.parent.matrixWorld.decompose(m0,g0,m0),e.quaternion.premultiply(g0.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(s0)))}}v0.prototype.isLockedTrackConstraint=!0;const A0=new wn(0,1,0),_0=(new Sn).setFromAxisAngle(new wn(1,0,0),-Math.PI/2),x0=new ki,y0=new wn,b0=new wn,M0=new wn,C0=new wn,S0=new wn,w0=new rr,E0=new wn,T0=new Sn;class I0 extends hm{constructor(e){super(e),this.type="TrackToConstraint",this.trackAxis="X",this.upAxis="Y",this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.upAxis=e.upAxis,this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(r){if(super.update(r),!this.mute){var i=this.trackAxis[this.trackAxis.length-1],a=this.upAxis[this.upAxis.length-1],o="-"==this.trackAxis[0],s="-"==this.upAxis[0];if(i!=a){y0.setFromMatrixPosition(r.matrixWorld),b0.setFromMatrixPosition(this.target.matrixWorld),M0.subVectors(b0,y0),M0.lengthSq()?M0.normalize():M0.set(0,-1,0),x0.set(M0,0),1!=Math.abs(M0.dot(A0))?x0.projectPoint(A0,C0).normalize():C0.set(0,0,-1),o&&M0.negate(),s&&C0.negate();let e="X"==i?M0:"X"==a?C0:null,t="Y"==i?M0:"Y"==a?C0:null,n="Z"==i?M0:"Z"==a?C0:null;e?t?n=n||S0.crossVectors(e,t):t=S0.crossVectors(n,e):e=S0.crossVectors(t,n),w0.makeBasis(e,t,n),r.setRotationFromMatrix(w0),r.parent&&(r.parent.matrixWorld.decompose(E0,T0,E0),r.quaternion.premultiply(T0.invert())),this.fixCameraLightRotation&&(r.isCamera||r.isLight)&&r.quaternion.multiply(_0)}}}}I0.prototype.isTrackToConstraint=!0;class R0 extends hm{constructor(e){super(e),this._orthoZoom=1}copy(e){super.copy(e),this._orthoZoom=e._orthoZoom}update(e){var t,n;super.update(e),this.mute||(t=this.target,e.parent===t&&t.isOrthographicCamera?(n=this._orthoZoom/t.zoom,e.position.multiplyScalar(n),e.scale.multiplyScalar(n),this._orthoZoom=t.zoom):console.error("FixOrthoZoom: object should be a direct child of the orthographic camera"))}}R0.prototype.isFixOrthoZoomConstraint=!0;var L0=new wn,B0=new wn,P0=new Sn,D0=new In,N0=new jn;class F0 extends hm{constructor(e){super(e),this.type="CanvasFitConstraint",this.edgeH=0,this.edgeV=0,this.offset=0,this.useBoundingBox=!0}copy(e){return super.copy(e),this.edgeH=e.edgeH,this.edgeV=e.edgeV,this.offset=e.offset,this.useBoundingBox=e.useBoundingBox,this}update(s){if(super.update(s),!this.mute){var l=this.target;if(s.parent===l){let e,t,n;var c,u,d="LEFT"==this.edgeH?-1:"RIGHT"==this.edgeH?1:0,h="BOTTOM"==this.edgeV?-1:"TOP"==this.edgeV?1:0;l.isPerspectiveCamera&&(t=Dt(l.fov/2),e=Math.atan(l.aspect*Math.tan(t)),"LEFT"==this.edgeH&&(e*=d),"BOTTOM"==this.edgeV&&(t*=h),n=Math.abs(s.position.z));const p=s.geometry;let r=0,i=0,a=0,o=0;p&&(s.matrix.compose(s.position,s.quaternion,s.scale),o=this.useBoundingBox?(null===p.boundingBox&&p.computeBoundingBox(),D0.copy(s.geometry.boundingBox).applyMatrix4(s.matrix),c=D0.getCenter(L0).sub(s.position),u=D0.getSize(B0).addScalar(2*this.offset),r=-(.5*u.x*d+c.x),i=-(.5*u.y*h+c.y),a=u.x,u.y):(null===p.boundingSphere&&p.computeBoundingSphere(),N0.copy(s.geometry.boundingSphere).applyMatrix4(s.matrix),N0.radius+=this.offset,u=L0.copy(N0.center).sub(s.position),r=-(N0.radius*d+u.x),i=-(N0.radius*h+u.y),l.isPerspectiveCamera&&(r/=Math.cos(e),i/=Math.cos(t)),a=2*N0.radius,2*N0.radius)),"STRETCH"==this.edgeH?(s.position.x=r,0!==a&&(s.scale.applyQuaternion(P0.copy(s.quaternion)),l.isPerspectiveCamera?s.scale.x*=2*n*Math.tan(e)/a:s.scale.x*=(l.right-l.left)/l.zoom/a,s.scale.applyQuaternion(P0.copy(s.quaternion).invert()))):"NONE"!==this.edgeH&&(l.isPerspectiveCamera?s.position.x=n*Math.tan(e)+r:s.position.x=(d<0?l.left:l.right)/l.zoom+r),"STRETCH"==this.edgeV?(s.position.y=i,0!==o&&(s.scale.applyQuaternion(P0.copy(s.quaternion)),l.isPerspectiveCamera?s.scale.y*=2*n*Math.tan(t)/o:s.scale.y*=(l.top-l.bottom)/l.zoom/o,s.scale.applyQuaternion(P0.copy(s.quaternion).invert()))):"NONE"!==this.edgeV&&(l.isPerspectiveCamera?s.position.y=n*Math.tan(t)+i:s.position.y=(h<0?l.bottom:l.top)/l.zoom+i)}else console.error("CanvasFitConstraint: object should be a direct child of the camera")}}}F0.prototype.isCanvasFitConstraint=!0;class O0 extends dm{constructor(){super(),this.type="CanvasBreakpointsConstraint",this.minWidth=0,this.maxWidth=1/0,this.minHeight=0,this.maxHeight=1/0,this.orientation="ALL",this.appInstance=null}copy(e){return super.copy(e),this.minWidth=e.minWidth,this.maxWidth=e.maxWidth,this.minHeight=e.minHeight,this.maxHeight=e.maxHeight,this.orientation=e.orientation,this.appInstance=null,this}update(t){if(super.update(t),!this.mute&&this.appInstance){var n=this.appInstance.getWidth(),r=this.appInstance.getHeight();let e;switch(this.orientation){case"ALL":e=!0;break;case"LANDSCAPE":e=1<=n/r;break;case"PORTRAIT":e=n/r<1}this.appInstance.getCamera()!==t||n>=this.minWidth&&n<=this.maxWidth&&r>=this.minHeight&&r<=this.maxHeight&&e?n>=this.minWidth&&n<=this.maxWidth&&r>=this.minHeight&&r<=this.maxHeight&&e?t.traverse(e=>{e.internVisible=!0}):t.traverse(e=>{e.internVisible=!1}):(t=this.findAlternativeCamera(t,this.appInstance.scene,n,r))&&this.appInstance.setCamera(t)}}findAlternativeCamera(e,t,r,i){let a,o,s=!1;return e&&t.traverse(function(t){if(!s&&t.isCamera&&t!=e)for(let e=0;e<t.constraints.length;e++){var n=t.constraints[e];if(n.isCanvasBreakpointsConstraint){switch(n.orientation){case"ALL":a=!0;break;case"LANDSCAPE":a=1<=r/i;break;case"PORTRAIT":a=r/i<1}r>=n.minWidth&&r<=n.maxWidth&&i>=n.minHeight&&i<=n.maxHeight&&a&&(o?(console.error("CanvasBreakpointsConstraint: two or more alternative cameras"),s=!0):o=t)}}}),o}}O0.prototype.isCanvasBreakpointsConstraint=!0;var U0,z0,V0,G0={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222};function k0(e){for(var t in this.isKeyDown={},G0)this.isKeyDown[G0[t]]=!1;this.onKeyDown=null,this.onKeyUp=null,this._domElement=e,this._keydownCb=function(e){this.isKeyDown[e.keyCode]=!0,this.onKeyDown&&this.onKeyDown(e)}.bind(this),this._keyupCb=function(e){this.isKeyDown[e.keyCode]=!1,this.onKeyUp&&this.onKeyUp(e)}.bind(this),this._domElement.addEventListener("keydown",this._keydownCb,!1),this._domElement.addEventListener("keyup",this._keyupCb,!1)}function Q0(){this.posFrom=new wn,this.targetFrom=new wn,this.posTo=new wn,this.targetTo=new wn,this.sphericalFrom=new sd,this.sphericalTo=new sd,this.finishCb=function(){},this.movementType=0,this.active=!1,this.duration=0,this.clock=new _h}Object.assign(k0.prototype,{dispose:function(){this._domElement.removeEventListener("keydown",this._keydownCb,!1),this._domElement.removeEventListener("keyup",this._keyupCb,!1)}}),Object.assign(Q0.prototype,{setup:(V0=new wn,function({posFrom:e=new wn,targetFrom:t=new wn,posTo:n=new wn,targetTo:r=new wn,finishCb:i=function(){},movementType:a=0}){return this.posFrom.copy(e),this.targetFrom.copy(t),this.posTo.copy(n),this.targetTo.copy(r),this.finishCb=i,this.movementType=a,1===this.movementType&&(V0.copy(this.posFrom).sub(this.targetFrom),this.sphericalFrom.setFromVector3(V0),V0.copy(this.posTo).sub(this.targetTo),this.sphericalTo.setFromVector3(V0),r=kt(this.sphericalFrom.theta),i=kt(this.sphericalTo.theta),(a=Math.abs(r-i))>Math.PI&&(i=r+Math.sign(r-i)*(2*Math.PI-a)),this.sphericalFrom.theta=r,this.sphericalTo.theta=i),this}),start(e){this.active=!0,this.duration=e,this.clock.start()},update:(U0=new wn,z0=new wn,function(e=function(e,t,n){}){var t,n,r,i=Pt(i=this.clock.getElapsedTime()/this.duration,0,1);z0.lerpVectors(this.targetFrom,this.targetTo,i),0===this.movementType?U0.lerpVectors(this.posFrom,this.posTo,i):1===this.movementType&&(t=Bt(this.sphericalFrom.radius,this.sphericalTo.radius,i),n=Bt(this.sphericalFrom.phi,this.sphericalTo.phi,i),r=Bt(this.sphericalFrom.theta,this.sphericalTo.theta,i),U0.setFromSphericalCoords(t,n,r),U0.add(z0)),e(i,U0,z0),1<=i&&(this.active=!1,this.finishCb())})});const W0={gazeLevel:1.8,enablePan:!0,panInertia:.05,panSpeedKey:.15,enableRotate:!0,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:.9,rotateSpeedTouch:.75,storyHeight:3,enableZoom:!0,zoomInertia:.05,zoomSpeed:30,zoomSpeedKey:.2,enableDamping:!0,enableKeys:!0};class H0 extends t{constructor(e,t){super();var s=this;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.enableDamping=W0.enableDamping,this.enableRotate=W0.enableRotate,this.rotateSpeed=W0.rotateSpeed,this.rotateSpeedTouch=W0.rotateSpeedTouch,this.rotateInertia=W0.rotateInertia,this.rotateInertiaTouch=W0.rotateInertiaTouch,this.enableZoom=W0.enableZoom,this.zoomSpeed=W0.zoomSpeed,this.zoomSpeedKey=W0.zoomSpeedKey,this.zoomInertia=W0.zoomInertia,this.enablePan=W0.enablePan,this.panSpeedKey=W0.panSpeedKey,this.panInertia=W0.panInertia,this.enableKeys=W0.enableKeys,this.gazeLevel=W0.gazeLevel,this.storyHeight=W0.storyHeight;let n=!(this.collisionMeshes=[]);Object.defineProperty(this,"enablePointerLock",{get(){return n},set(e){n!==e&&(n=e,$())}}),Object.defineProperty(this,"inTween",{get(){return L.active}});var l,c=new _h,r=new wn,i=new wn,a=new wn,o=new wn,u=new Sn,d=new wn,h={};h[G0.W]=h[G0.S]=h[G0.A]=h[G0.D]=h[G0.UP_ARROW]=h[G0.DOWN_ARROW]=h[G0.LEFT_ARROW]=h[G0.RIGHT_ARROW]=0;var p=!1,f=new sd,m=new sd,g=new Yt,v=1,A=1,_=new Yt,x=new Yt,y=0,b=0,M=1,C=1,S=new Yt,w=new Yt,E=1,T=1,I=new Js(new wn,new wn(0,-1,0)),R=I.params.checkVisibility=!1,L=new Q0,B={type:"change"},P={type:"start"},D={type:"end"};this.handleResize=function(){var e,t;this.domElement===document?(this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight):(e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement,this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var N,F,O,U,z=(N=new Yt,function(e,t){return N.set((e-.5*s.screen.width-s.screen.left)/(.5*s.screen.width),(s.screen.height+2*(s.screen.top-t))/s.screen.width),N});const V=function(){const n=new Yt;return function(e,t){return n.set(e,-t).multiplyScalar(2/s.screen.width)}}();function G(e){!1!==s.enabled&&(e.preventDefault(),!1!==s.enableRotate&&(x.copy(z(e.pageX,e.pageY).negate()),_.copy(x),p=!0,document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",Q,!1),document.addEventListener("mouseleave",Q,!1),s.dispatchEvent(P)))}function k(e){!1!==s.enabled&&(e.preventDefault(),p&&!1!==s.enableRotate&&(x.copy(z(e.pageX,e.pageY).negate()),g.add(x).sub(_),_.copy(x),v=s.rotateSpeed,A=s.rotateInertia))}function Q(e){!1!==s.enabled&&(e.preventDefault(),p=!1,document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",Q),document.removeEventListener("mouseleave",Q),s.dispatchEvent(D))}function W(e){if(!1!==s.enabled&&!1!==s.enableZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:b-=.025*e.deltaY,M=s.zoomSpeed,C=s.zoomInertia;break;case 1:b-=.01*e.deltaY,M=s.zoomSpeed,C=s.zoomInertia;break;default:b-=25e-5*e.deltaY,M=s.zoomSpeed,C=s.zoomInertia}s.dispatchEvent(P),s.dispatchEvent(D)}}function H(e){!1!==s.enabled&&(e=e.touches[0],p=!0,x.copy(z(e.pageX,e.pageY).negate()),_.copy(x),s.dispatchEvent(P))}function Y(e){!1!==s.enabled&&(e.preventDefault(),e=e.touches[0],!1!==s.enableRotate&&(x.copy(z(e.pageX,e.pageY).negate()),g.add(x).sub(_),_.copy(x),v=s.rotateSpeedTouch,A=s.rotateInertiaTouch))}function X(e){if(!1!==s.enabled){if(0===e.touches.length)p=!1;else{if(!1===s.enableRotate)return;p=!0,x.copy(z(e.touches[0].pageX,e.touches[0].pageY).negate()),_.copy(x)}s.dispatchEvent(D)}}function j(e){!1!==s.enabled&&e.preventDefault()}function K(e){s.domElement.requestPointerLock()}function q(e){document.pointerLockElement===s.domElement?(s.dispatchEvent(P),document.addEventListener("mousemove",J)):(s.dispatchEvent(D),document.removeEventListener("mousemove",J))}function Z(e){console.error("Pointer lock failed")}function J(e){e.preventDefault(),s.enabled&&s.enableRotate&&(g.add(V(e.movementX,e.movementY).negate()),v=s.rotateSpeed,A=s.rotateInertia)}function $(){ee(),s.domElement.addEventListener("contextmenu",j),s.enablePointerLock?(s.domElement.addEventListener("click",K),document.addEventListener("pointerlockchange",q),document.addEventListener("pointerlockerror",Z)):s.domElement.addEventListener("mousedown",G),s.domElement.addEventListener("wheel",W),s.domElement.addEventListener("touchstart",H),s.domElement.addEventListener("touchend",X),s.domElement.addEventListener("touchmove",Y),(l=new k0(window)).onKeyDown=function(e){e.keyCode in h&&(h[e.keyCode]=1)}}function ee(){s.domElement.removeEventListener("contextmenu",j),s.domElement.removeEventListener("click",K),document.removeEventListener("pointerlockchange",q),document.removeEventListener("pointerlockerror",Z),document.removeEventListener("mousemove",J),s.domElement.removeEventListener("mousedown",G),s.domElement.removeEventListener("wheel",W),s.domElement.removeEventListener("touchstart",H),s.domElement.removeEventListener("touchend",X),s.domElement.removeEventListener("touchmove",Y),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",Q),document.removeEventListener("mouseleave",Q),l&&l.dispose()}this.update=function(){var e;L.active?L.update(function(e,t,n){if(s.object.position.copy(t),s.object.lookAt(n),1<=e){for(var r in m.set(0,0,0),g.set(0,0),b=y=0,S.set(0,0),w.set(0,0),h)h[r]=0;c.getDelta()}}):(s.object.getLocalDirection(d),f.setFromVector3(d),f.theta+=m.theta*v,f.phi+=m.phi*v,f.makeSafe(),d.setFromSpherical(f),r.copy(d).add(s.object.position),s.object.lookAtLocal(r),s.object.isPerspectiveCamera?s.object.position.addScaledVector(d,y):s.object.isOrthographicCamera&&(s.object.zoom*=1+.15*y,s.object.updateProjectionMatrix()),i.copy(d).cross(s.object.up).setLength(-S.x),i.add(a.copy(s.object.up).setLength(S.y)),s.object.position.add(i),function(){var e,t=c.getDelta();for(e in m.set(m.radius,g.y,g.x),g.x=s.enableDamping?Gt(g.x,0,t,A,.001):0,g.y=s.enableDamping?Gt(g.y,0,t,A,.001):0,m.set(m.radius,m.phi-g.y,m.theta-g.x),S.copy(w),w.x=s.enableDamping?Gt(w.x,0,t,T,.001):0,w.y=s.enableDamping?Gt(w.y,0,t,T,.001):0,S.sub(w),S.multiplyScalar(E),y=b,b=s.enableDamping?Gt(b,0,t,C,.001):0,y-=b,y*=M,h){var n,r=e==G0.A||e==G0.LEFT_ARROW||e==G0.D||e==G0.RIGHT_ARROW,i=e==G0.W||e==G0.UP_ARROW||e==G0.S||e==G0.DOWN_ARROW,a=r?s.panInertia:s.zoomInertia,o=r?s.panSpeedKey:s.zoomSpeedKey;n=l.isKeyDown[e]?h[e]=1:(n=h[e],h[e]=Gt(h[e],0,t,a,.001),n-h[e]),s.enabled&&s.enableKeys&&(r&&!s.enablePan||i&&!s.enableZoom||(n*=60*t*o,e==G0.A||e==G0.LEFT_ARROW?S.x+=n:e==G0.D||e==G0.RIGHT_ARROW?S.x-=n:e==G0.W||e==G0.UP_ARROW?y+=n:e!=G0.S&&e!=G0.DOWN_ARROW||(y-=n)))}}()),s.collisionMeshes.length&&(I.ray.origin.copy(s.object.position),I.far=s.storyHeight,0<(e=I.intersectObjects(s.collisionMeshes,!1)).length?(t=e[0],s.object.position.y=t.point.y+s.gazeLevel,R=!0):R&&s.object.position.copy(o));var t=!1;1e-6<o.distanceToSquared(s.object.position)&&(o.copy(s.object.position),t=!0),u.dot(s.object.quaternion)<1-1e-6&&(u.copy(s.object.quaternion),t=!0),t&&s.dispatchEvent(B)},this.forceMouseUp=function(){Q({preventDefault:function(){}})},this.dispose=ee,this.releaseFromCollision=function(){R=!1},this.tween=(F=new wn,O=new wn,U=new wn,function(e,t,n,r,i){s.object.parent&&(e=F.copy(e),s.object.parent.worldToLocal(e));var a=s.object.getWorldPosition(O),o=U.subVectors(t,a).length(),a=s.object.getWorldDirection(U).multiplyScalar(o).add(a);e.manhattanDistanceTo(s.object.position)<1e-5&&t.manhattanDistanceTo(a)<1e-5?void 0!==r&&r():L.setup({posFrom:s.object.position,targetFrom:a,posTo:e,targetTo:t,finishCb:r,movementType:i}).start(n)}),$(),this.handleResize(),this.update()}}const Y0={panInertia:.05,panInertiaTouch:.05,panSpeed:20,panSpeedKey:.15,panSpeedTouch:15,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:.9,rotateSpeedTouch:.75,zoomInertia:.05,zoomInertiaTouch:.05,zoomSpeed:150,zoomSpeedKey:.5,zoomSpeedTouch:20,enableDamping:!0,enableRotate:!0,enableZoom:!0,enablePan:!0,enableKeys:!0,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,minPolarAngle:0,maxPolarAngle:Math.PI};class X0 extends t{constructor(e,t){super();var s=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.enableDamping=Y0.enableDamping,this.enableRotate=Y0.enableRotate,this.rotateSpeed=Y0.rotateSpeed,this.rotateSpeedTouch=Y0.rotateSpeedTouch,this.rotateInertia=Y0.rotateInertia,this.rotateInertiaTouch=Y0.rotateInertiaTouch,this.enableZoom=Y0.enableZoom,this.zoomSpeed=Y0.zoomSpeed,this.zoomSpeedKey=Y0.zoomSpeedKey,this.zoomSpeedTouch=Y0.zoomSpeedTouch,this.zoomInertia=Y0.zoomInertia,this.zoomInertiaTouch=Y0.zoomInertiaTouch,this.enablePan=Y0.enablePan,this.panSpeed=Y0.panSpeed,this.panSpeedKey=Y0.panSpeedKey,this.panSpeedTouch=Y0.panSpeedTouch,this.panInertia=Y0.panInertia,this.panInertiaTouch=Y0.panInertiaTouch,this.enableKeys=Y0.enableKeys,this.minAzimuthAngle=Y0.minAzimuthAngle,this.maxAzimuthAngle=Y0.maxAzimuthAngle,this.minPolarAngle=Y0.minPolarAngle,this.maxPolarAngle=Y0.maxPolarAngle,this.mouseButtons={ROTATE:$.LEFT,ZOOM:$.MIDDLE,PAN:$.RIGHT},Object.defineProperty(this,"inTween",{get(){return D.active}});var l=new _h,n=new wn,i=new wn,a=new wn,o=new Yt,c=new wn,u=new Sn,d=r.NONE,h=new wn,p={};p[G0.W]=p[G0.S]=p[G0.A]=p[G0.D]=p[G0.UP_ARROW]=p[G0.DOWN_ARROW]=p[G0.LEFT_ARROW]=p[G0.RIGHT_ARROW]=0;var f=new k0(window);f.onKeyDown=function(e){e.keyCode in p&&(p[e.keyCode]=1)};var m=new sd,g=new sd,v=new Yt,A=1,_=1,x=new Yt,y=new Yt,b=0,M=0,C=1,S=1,w=0,E=0,T=new Yt,I=new Yt,R=1,L=1,B=new Yt,P=new Yt,D=new Q0,N={type:"change"},F={type:"start"},O={type:"end"};this.handleResize=function(){var e,t;this.domElement===document?(this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight):(e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement,this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var U,z,V,G,k,Q=(U=new Yt,function(e,t){return U.set((e-s.screen.left)/s.screen.width,(t-s.screen.top)/s.screen.height),U}),W=(z=new Yt,function(e,t){return z.set((e-.5*s.screen.width-s.screen.left)/(.5*s.screen.width),(s.screen.height+2*(s.screen.top-t))/s.screen.width),z});function H(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.ROTATE:if(!1===s.enableRotate)return;y.copy(W(e.pageX,e.pageY).negate()),x.copy(y),d=r.ROTATE;break;case s.mouseButtons.ZOOM:case s.mouseButtons.PAN:if(!1===s.enablePan)return;B.copy(Q(e.pageX,e.pageY)),P.copy(B),d=e.button==s.mouseButtons.PAN?r.PAN:r.ZOOM}document.addEventListener("mousemove",Y,!1),document.addEventListener("mouseup",X,!1),document.addEventListener("mouseleave",X,!1),s.dispatchEvent(F)}}function Y(e){!1!==s.enabled&&(e.preventDefault(),d===r.ROTATE?!1!==s.enableRotate&&(y.copy(W(e.pageX,e.pageY).negate()),v.add(y).sub(x),x.copy(y),A=s.rotateSpeed,_=s.rotateInertia):d!==r.PAN&&d!==r.ZOOM||!1!==s.enablePan&&(P.copy(Q(e.pageX,e.pageY)),I.add(P).sub(B),B.copy(P),R=s.panSpeed,L=s.panInertia))}function X(e){!1!==s.enabled&&(e.preventDefault(),d=r.NONE,document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",X),document.removeEventListener("mouseleave",X),s.dispatchEvent(O))}function j(e){if(!1!==s.enabled&&!1!==s.enableZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:M-=.025*e.deltaY,C=s.zoomSpeed,S=s.zoomInertia;break;case 1:M-=.01*e.deltaY,C=s.zoomSpeed,S=s.zoomInertia;break;default:M-=25e-5*e.deltaY,C=s.zoomSpeed,S=s.zoomInertia}s.dispatchEvent(F),s.dispatchEvent(O)}}function K(e){if(!1!==s.enabled){var t=e.touches[0],n=e.touches[1];if(1===e.touches.length){if(!1===s.enableRotate)return;d=r.TOUCH_ROTATE,y.copy(W(t.pageX,t.pageY).negate()),x.copy(y)}else{if(!1===s.enableZoom&&!1===s.enablePan)return;d=r.TOUCH_ZOOM_PAN,s.enableZoom&&(e=Q(t.pageX-n.pageX,t.pageY-n.pageY),w=E=e.length()),s.enablePan&&(n=Q((t.pageX+n.pageX)/2,(t.pageY+n.pageY)/2),B.copy(n),P.copy(B))}s.dispatchEvent(F)}}function q(e){if(!1!==s.enabled){e.preventDefault();var t=e.touches[0],n=e.touches[1];if(1===e.touches.length)!1!==s.enableRotate&&(y.copy(W(t.pageX,t.pageY).negate()),v.add(y).sub(x),x.copy(y),A=s.rotateSpeedTouch,_=s.rotateInertiaTouch);else!1===s.enableZoom&&!1===s.enablePan||(e=Q(t.pageX-n.pageX,t.pageY-n.pageY),e=(E=e.length())-w,w=E,t=Q((t.pageX+n.pageX)/2,(t.pageY+n.pageY)/2),P.copy(t),t=(n=o.subVectors(P,B)).length(),B.copy(P),s.enableZoom&&Math.abs(e)>Math.abs(t)&&(M+=e,C=s.zoomSpeedTouch,S=s.zoomInertiaTouch),s.enablePan&&Math.abs(e)<=Math.abs(t)&&(I.add(n),R=s.panSpeedTouch,L=s.panInertiaTouch))}}function Z(e){if(!1!==s.enabled){switch(e.touches.length){case 0:d=r.NONE;break;case 1:if(!1===s.enableRotate)return;d=r.TOUCH_ROTATE,y.copy(W(e.touches[0].pageX,e.touches[0].pageY).negate()),x.copy(y)}s.dispatchEvent(O)}}function J(e){!1!==s.enabled&&e.preventDefault()}this.update=function(){D.active?D.update(function(e,t,n){if(s.object.position.copy(t),s.object.lookAt(n),1<=e){for(var r in g.set(0,0,0),v.set(0,0),M=b=0,T.set(0,0),I.set(0,0),p)p[r]=0;l.getDelta()}}):(s.object.getLocalDirection(h),m.setFromVector3(h),m.theta+=g.theta*A,m.phi+=g.phi*A,m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),h.setFromSpherical(m),n.copy(h).add(s.object.position),s.object.lookAtLocal(n),s.object.isPerspectiveCamera?s.object.position.addScaledVector(h,b):s.object.isOrthographicCamera&&(s.object.zoom*=1+.15*b,s.object.updateProjectionMatrix()),i.copy(h).cross(s.object.up).setLength(-T.x),i.add(a.copy(s.object.up).setLength(T.y)),s.object.position.add(i),function(){var e,t=l.getDelta();for(e in g.set(g.radius,v.y,v.x),v.x=s.enableDamping?Gt(v.x,0,t,_,.001):0,v.y=s.enableDamping?Gt(v.y,0,t,_,.001):0,g.set(g.radius,g.phi-v.y,g.theta-v.x),T.copy(I),I.x=s.enableDamping?Gt(I.x,0,t,L,.001):0,I.y=s.enableDamping?Gt(I.y,0,t,L,.001):0,T.sub(I),T.multiplyScalar(R),b=M,M=s.enableDamping?Gt(M,0,t,S,.001):0,b-=M,b*=C,p){var n,r=e==G0.A||e==G0.LEFT_ARROW||e==G0.D||e==G0.RIGHT_ARROW,i=e==G0.W||e==G0.UP_ARROW||e==G0.S||e==G0.DOWN_ARROW,a=r?s.panInertia:s.zoomInertia,o=r?s.panSpeedKey:s.zoomSpeedKey;n=f.isKeyDown[e]?p[e]=1:(n=p[e],p[e]=Gt(p[e],0,t,a,.001),n-p[e]),s.enabled&&s.enableKeys&&(r&&!s.enablePan||i&&!s.enableZoom||(n*=60*t*o,e==G0.A||e==G0.LEFT_ARROW?T.x+=n:e==G0.D||e==G0.RIGHT_ARROW?T.x-=n:e==G0.W||e==G0.UP_ARROW?b+=n:e!=G0.S&&e!=G0.DOWN_ARROW||(b-=n)))}}());var e=!1;1e-6<c.distanceToSquared(s.object.position)&&(c.copy(s.object.position),e=!0),u.dot(s.object.quaternion)<1-1e-6&&(u.copy(s.object.quaternion),e=!0),e&&s.dispatchEvent(N)},this.forceMouseUp=function(){X({preventDefault:function(){}})},this.dispose=function(){this.domElement.removeEventListener("contextmenu",J,!1),this.domElement.removeEventListener("mousedown",H,!1),this.domElement.removeEventListener("wheel",j,!1),this.domElement.removeEventListener("touchstart",K,!1),this.domElement.removeEventListener("touchend",Z,!1),this.domElement.removeEventListener("touchmove",q,!1),document.removeEventListener("mousemove",Y,!1),document.removeEventListener("mouseup",X,!1),document.removeEventListener("mouseleave",X,!1),f.dispose()},this.tween=(V=new wn,G=new wn,k=new wn,function(e,t,n,r,i){s.object.parent&&(e=V.copy(e),s.object.parent.worldToLocal(e));var a=s.object.getWorldPosition(G),o=k.subVectors(t,a).length(),a=s.object.getWorldDirection(k).multiplyScalar(o).add(a);e.manhattanDistanceTo(s.object.position)<1e-5&&t.manhattanDistanceTo(a)<1e-5?void 0!==r&&r():D.setup({posFrom:s.object.position,targetFrom:a,posTo:e,targetTo:t,finishCb:r,movementType:i}).start(n)}),this.domElement.addEventListener("contextmenu",J,!1),this.domElement.addEventListener("mousedown",H,!1),this.domElement.addEventListener("wheel",j,!1),this.domElement.addEventListener("touchstart",K,!1),this.domElement.addEventListener("touchend",Z,!1),this.domElement.addEventListener("touchmove",q,!1),this.handleResize(),this.update()}}const j0={minDistance:0,maxDistance:1/0,minZoom:0,maxZoom:1/0,minPolarAngle:0,maxPolarAngle:Math.PI,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,autoRotate:!1,autoRotateSpeed:2,enablePan:!0,panInertia:.05,panSpeed:1.3,panSpeedKey:15,screenSpacePanning:!0,enableRotate:!0,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:1.2,rotateSpeedTouch:.7,enableZoom:!0,zoomInertia:.05,zoomInertiaTouch:.05,zoomSpeed:5,zoomSpeedTouch:1,enableDamping:!0,enableTurnover:!1,enableKeys:!0},K0=new wn(0,1,0),q0=(new Sn).setFromAxisAngle(new wn(0,0,1),Math.PI),Z0={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},J0=new wn,$0=new wn,eg=new Sn,tg=new Sn,ng={type:"change"},rg={type:"start"},ig={type:"end"};class ag extends t{constructor(e,t){super(),void 0===t&&console.warn('v3d.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('v3d.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.targetObj=new Tr,this.minDistance=j0.minDistance,this.maxDistance=j0.maxDistance,this.minZoom=j0.minZoom,this.maxZoom=j0.maxZoom,this.minPolarAngle=j0.minPolarAngle,this.maxPolarAngle=j0.maxPolarAngle,this.minAzimuthAngle=j0.minAzimuthAngle,this.maxAzimuthAngle=j0.maxAzimuthAngle,this.enableDamping=j0.enableDamping,this.enableZoom=j0.enableZoom,this.zoomSpeed=j0.zoomSpeed,this.zoomSpeedTouch=j0.zoomSpeedTouch,this.zoomInertia=j0.zoomInertia,this.zoomInertiaTouch=j0.zoomInertiaTouch,this.enableRotate=j0.enableRotate,this.rotateSpeed=j0.rotateSpeed,this.rotateSpeedTouch=j0.rotateSpeedTouch,this.rotateInertia=j0.rotateInertia,this.rotateInertiaTouch=j0.rotateInertiaTouch,this.enablePan=j0.enablePan,this.panSpeed=j0.panSpeed,this.screenSpacePanning=j0.screenSpacePanning,this.panSpeedKey=j0.panSpeedKey,this.panInertia=j0.panInertia,this.autoRotate=j0.autoRotate,this.autoRotateSpeed=j0.autoRotateSpeed,this.enableTurnover=j0.enableTurnover,this.enableKeys=j0.enableKeys,this.mouseButtons={ROTATE:$.LEFT,ZOOM:$.MIDDLE,PAN:$.RIGHT},this.target0=this.targetObj.position.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,Object.defineProperty(this,"inTween",{get(){return I.active},set(e){I.active=e}}),this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.targetObj.position)},this.saveState=function(){c.targetObj.updateWorldMatrix(!0,!1),c.target0.setFromMatrixPosition(c.targetObj.matrixWorld),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.forceMouseUp=function(){z()},this.reset=function(){c.targetObj.updateWorldMatrix(!0,!1);var e=J0.copy(c.target0);c.targetObj.worldToLocal(e),c.targetObj.position.add(e),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(ng),c.update(),u=Z0.NONE},this.update=function(){const a=new wn,n=new wn,r=new wn,o=new Sn;let s=!1,l=!1;return function(){const i=c.object.position;var e,t;return c.targetObj.updateWorldMatrix(!0,!1),I.active?I.update(function(e,t,n){if(i.copy(t),a.copy(n),c.object.lookAt(a),1<=e){for(var r in h.set(0,0,0),f.set(0,0,0),p=1,M.set(0,0),g)g[r]=0;_.set(0,0),T.getDelta()}}):(a.setFromMatrixPosition(c.targetObj.matrixWorld),n.copy(i).sub(a),t=eg.setFromUnitVectors(c.object.up,K0),e=tg.copy(t).invert(),n.applyQuaternion(t),d.setFromVector3(n),c.autoRotate&&u===Z0.NONE&&L(2*Math.PI/60/60*c.autoRotateSpeed),d.theta+=h.theta,d.phi+=h.phi,c.enableTurnover?(s&&(d.phi-=2*h.phi),l!=s&&u==Z0.NONE&&(l=s),l&&(d.theta-=2*h.theta),((t=d.phi)<=0||t>=Math.PI)&&(s=!s,d.theta+=Math.PI,d.phi=0<t?2*Math.PI-t:Math.abs(t))):(isFinite(c.minAzimuthAngle)&&isFinite(c.maxAzimuthAngle)&&(d.theta=Wt(d.theta,c.minAzimuthAngle,c.maxAzimuthAngle)),d.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,d.phi))),d.makeSafe(),c.object.isPerspectiveCamera?(d.radius*=p,d.radius=Math.max(c.minDistance,Math.min(c.maxDistance,d.radius))):c.object.isOrthographicCamera&&(c.object.zoom/=p,c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom)),c.object.updateProjectionMatrix()),a.add(f),n.setFromSpherical(d),n.applyQuaternion(e),i.copy(a).add(n),c.object.lookAt(a),s&&(c.enableTurnover?c.object.quaternion.multiply(q0):s=!1),h.set(0,0,0),f.set(0,0,0),function(){var e=T.getDelta();A.copy(_),_.x=c.enableDamping?Gt(_.x,0,e,y,1):0,_.y=c.enableDamping?Gt(_.y,0,e,y,1):0,A.sub(_),function(){var e=c.domElement===document?c.domElement.body:c.domElement,t=e.clientWidth,e=e.clientHeight;t&&e&&(L(2*Math.PI*A.x/t*x),function(e){h.phi-=e}(2*Math.PI*A.y/e*x))}(),b.copy(M),M.x=c.enableDamping?Gt(M.x,0,e,c.panInertia,.1):0,M.y=c.enableDamping?Gt(M.y,0,e,c.panInertia,.1):0,b.sub(M),b.multiplyScalar(c.panSpeed);let t,n;for(var r in g)t=v.isKeyDown[r]?g[r]=1:(n=g[r],g[r]=Gt(g[r],0,e,c.panInertia,.1),n-g[r]),c.enabled&&c.enableKeys&&c.enablePan&&(t*=60*e*c.panSpeedKey,r==G0.A||r==G0.LEFT_ARROW?b.x+=t:r==G0.D||r==G0.RIGHT_ARROW?b.x-=t:r==G0.W||r==G0.UP_ARROW?b.y+=t:r!=G0.S&&r!=G0.DOWN_ARROW||(b.y-=t));(function(e,t){var n=c.domElement===document?c.domElement.body:c.domElement,r=n.clientWidth,i=n.clientHeight;if(r&&i)if(c.object.isPerspectiveCamera){c.targetObj.updateWorldMatrix(!0,!1);var a=J0.setFromMatrixPosition(c.targetObj.matrixWorld),n=c.object.position;const o=$0.copy(n).sub(a);a=o.length();a*=Math.tan(c.object.fov/2*Et),P(2*e*a/i,c.object.matrix),D(2*t*a/i,c.object.matrix)}else c.object.isOrthographicCamera?(P(e*(c.object.right-c.object.left)/c.object.zoom/r,c.object.matrix),D(t*(c.object.top-c.object.bottom)/c.object.zoom/i,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)})(b.x,b.y),p=S,S=c.enableDamping?Gt(S,1,e,E,.01):1,p/=S}()),c.targetObj.position.copy(a),!!(m||1e-6<r.distanceToSquared(c.object.position)||1e-6<8*(1-o.dot(c.object.quaternion)))&&(c.dispatchEvent(ng),r.copy(c.object.position),o.copy(c.object.quaternion),!(m=!1))}}(),this.dispose=function(){c.domElement.removeEventListener("contextmenu",W,!1),c.domElement.removeEventListener("mousedown",O,!1),c.domElement.removeEventListener("wheel",V,!1),c.domElement.removeEventListener("touchstart",G,!1),c.domElement.removeEventListener("touchend",Q,!1),c.domElement.removeEventListener("touchmove",k,!1),document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",z,!1),document.removeEventListener("mouseleave",z,!1),v.dispose()},this.tween=function(e,t,n,r,i){c.targetObj.updateWorldMatrix(!0,!1);var a=J0.setFromMatrixPosition(c.targetObj.matrixWorld);c.object.parent&&(e=$0.copy(e),c.object.parent.worldToLocal(e)),e.manhattanDistanceTo(c.object.position)<1e-5&&t.manhattanDistanceTo(a)<1e-5?void 0!==r&&r():I.setup({posFrom:c.object.position,targetFrom:a,posTo:e,targetTo:t,finishCb:r,movementType:i}).start(n)};const c=this;let u=Z0.NONE;const d=new sd,h=new sd;let p=1;const f=new wn;let m=!1;const g={};g[G0.W]=g[G0.S]=g[G0.A]=g[G0.D]=g[G0.UP_ARROW]=g[G0.DOWN_ARROW]=g[G0.LEFT_ARROW]=g[G0.RIGHT_ARROW]=0;const v=new k0(window);v.onKeyDown=function(e){e.keyCode in g&&(g[e.keyCode]=1)};const i=new Yt,n=new Yt,A=new Yt,_=new Yt;let x=1,y=1;const a=new Yt,o=new Yt,b=new Yt,M=new Yt,s=new Yt,l=new Yt,C=new Yt;let S=1,w=1,E=1;const T=new _h,I=new Q0;function R(e=1){return Math.pow(.95,w*e)}function L(e){h.theta-=e}function B(e,t){n.set(e,t),_.add(n).sub(i),i.copy(n)}function P(e,t){J0.setFromMatrixColumn(t,0),J0.multiplyScalar(-e),f.add(J0)}function D(e,t){!0===c.screenSpacePanning?J0.setFromMatrixColumn(t,1):(J0.setFromMatrixColumn(t,0),J0.crossVectors(c.object.up,J0)),J0.multiplyScalar(e),f.add(J0)}function N(e){c.object.isPerspectiveCamera?S/=e:c.object.isOrthographicCamera?(S/=e,m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function F(e){c.object.isPerspectiveCamera?S*=e:c.object.isOrthographicCamera?(S*=e,m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function r(e){var t;t=e.clientX,e=e.clientY,o.set(t,e),M.add(o).sub(a),a.copy(o)}function O(e){if(!1!==c.enabled){switch(e.preventDefault(),e.button){case c.mouseButtons.ROTATE:if(!1===c.enableRotate)return;t=e,i.set(t.clientX,t.clientY),u=Z0.ROTATE;break;case c.mouseButtons.ZOOM:case c.mouseButtons.PAN:if(!1===c.enablePan)return;t=e,a.set(t.clientX,t.clientY),u=Z0.PAN}var t;u!==Z0.NONE&&(document.addEventListener("mousemove",U,!1),document.addEventListener("mouseup",z,!1),document.addEventListener("mouseleave",z,!1),c.dispatchEvent(rg))}}function U(e){var t;if(!1!==c.enabled)switch(e.preventDefault(),u){case Z0.ROTATE:if(!1===c.enableRotate)return;B(e.clientX,e.clientY),x=c.rotateSpeed,y=c.rotateInertia;break;case Z0.DOLLY:if(!1===c.enableZoom)return;t=e,l.set(t.clientX,t.clientY),C.subVectors(l,s),0<C.y?N(R()):C.y<0&&F(R()),s.copy(l),c.update();break;case Z0.PAN:if(!1===c.enablePan)return;r(e)}}function z(e){!1!==c.enabled&&(document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",z,!1),document.removeEventListener("mouseleave",z,!1),c.dispatchEvent(ig),u=Z0.NONE)}function V(e){!1===c.enabled||!1===c.enableZoom||u!==Z0.NONE&&u!==Z0.ROTATE||(e.preventDefault(),e.stopPropagation(),c.dispatchEvent(rg),e=e,w=c.zoomSpeed,E=c.zoomInertia,e.deltaY<0?F(R(Math.abs(e.deltaY)/100)):0<e.deltaY&&N(R(Math.abs(e.deltaY)/100)),c.update(),c.dispatchEvent(ig))}function G(e){if(!1!==c.enabled){switch(e.touches.length){case 1:if(!1===c.enableRotate)return;r=e,i.set(r.touches[0].pageX,r.touches[0].pageY),u=Z0.TOUCH_ROTATE;break;case 2:if(!1===c.enableZoom&&!1===c.enablePan)return;t=e,c.enableZoom&&(w=c.zoomSpeedTouch,E=c.zoomInertiaTouch,r=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(r*r+n*n),s.set(0,n)),c.enablePan&&(n=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),a.set(n,t)),c.update(),u=Z0.TOUCH_DOLLY_PAN;break;default:u=Z0.NONE}var t,n,r;u!==Z0.NONE&&c.dispatchEvent(rg)}}function k(e){var t,n,r;if(!1!==c.enabled)switch(e.preventDefault(),e.touches.length){case 1:if(!1===c.enableRotate)return;if(u!==Z0.TOUCH_ROTATE)return;B(e.touches[0].pageX,e.touches[0].pageY),x=c.rotateSpeedTouch,y=c.rotateInertiaTouch;break;case 2:if(!1===c.enableZoom&&!1===c.enablePan)return;if(u!==Z0.TOUCH_DOLLY_PAN)return;n=(t=e).touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(n*n+r*r),l.set(0,r),C.subVectors(l,s),s.copy(l),r=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),o.set(r,t),b.subVectors(o,a),a.copy(o),c.enableZoom&&Math.abs(C.length())>Math.abs(b.length())&&(0<C.y?F(R()):C.y<0&&N(R())),c.enablePan&&Math.abs(C.length())<Math.abs(b.length())&&M.add(b),c.update();break;default:u=Z0.NONE}}function Q(e){!1!==c.enabled&&(c.dispatchEvent(ig),u=Z0.NONE)}function W(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener("contextmenu",W,!1),c.domElement.addEventListener("mousedown",O,!1),c.domElement.addEventListener("wheel",V,!1),c.domElement.addEventListener("touchstart",G,!1),c.domElement.addEventListener("touchend",Q,!1),c.domElement.addEventListener("touchmove",k,!1),this.update()}set target(e){console.warn("v3d.OrbitControls: .target has been deprecated, use .targetObj instead")}get target(){return console.warn("v3d.OrbitControls: .target has been deprecated, use .targetObj instead"),new wn}}function og(e){this.sourceTexture=e,this.camera=new ia(-1,1,1,-1,0,1),this.shader=new Pi({type:"CubeCopy",uniforms:{faceIdx:{value:0},cubemap:{value:null}},vertexShader:`
        uniform int faceIdx;

        varying vec3 vCubeDirection;

        vec3 uvToCubeDirection(vec2 uv, int face) {
            vec3 dir;
            uv = 2.0 * uv - 1.0;

            if (face == 0) {
                dir = vec3(1.0, -uv.y, -uv.x);
            } else if (face == 1) {
                dir = vec3(-1.0, -uv.y, uv.x);
            } else if (face == 2) {
                dir = vec3(uv.x, 1.0, uv.y);
            } else if (face == 3) {
                dir = vec3(uv.x, -1.0, -uv.y);
            } else if (face == 4) {
                dir = vec3(uv.x, -uv.y, 1.0);
            } else if (face == 5) {
                dir = vec3(-uv.x, -uv.y, -1.0);
            }
            return dir;
        }

        void main() {
            vCubeDirection = uvToCubeDirection(uv, faceIdx);
            gl_Position = vec4(position, 1.0);
        }
        `,fragmentShader:`
        uniform samplerCube cubemap;

        varying vec3 vCubeDirection;

        void main() {
            gl_FragColor = textureCube(cubemap, vCubeDirection);

            #include <tonemapping_fragment>

            gl_FragColor = linearToOutputTexel(gl_FragColor);
        }
        `}),this.shader.map=e,this.shader.uniforms.cubemap.value=e,this.planeMesh=new Ei(new ji(2,2),this.shader),this.scene=new oa,this.scene.add(this.camera),this.scene.add(this.planeMesh)}function sg(e,t){this.sourceTexture=e,this.resolution=void 0!==t?t:256;e=this.resolution,t={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.renderTarget=new Ui(e,e,t),this.renderTarget.texture.name="EquiCube.cube",this.camera=new ia(-1,1,1,-1,0,1e3),this.shader=new Pi(Zi.equicube),this.planeMesh=new Ei(new ji(2,2),this.shader),this.planeMesh.material.side=Oe,this.scene=new oa,this.scene.add(this.planeMesh),this.scene.add(this.camera),this.invertU=!1,this.offsetU=0,this.shader.uniforms.tEquirect.value=this.sourceTexture}ag.prototype.isOrbitControls=!0,og.prototype={constructor:og,render:function(e,t,n=1){var r=e.toneMapping,i=e.toneMappingExposure,a=e.getRenderTarget();e.toneMapping=1,e.toneMappingExposure=n;for(var o=0;o<6;o++)e.setRenderTarget(t,o),this.shader.uniforms.faceIdx.value=o,e.render(this.scene,this.camera);e.toneMapping=r,e.toneMappingExposure=i,e.setRenderTarget(a)},dispose:function(){this.planeMesh.geometry.dispose(),this.planeMesh.material.dispose()}},sg.prototype={constructor:sg,update:function(e){var t=e.gammaInput,n=e.gammaOutput,r=e.toneMapping,i=e.toneMappingExposure,a=e.getRenderTarget();e.toneMapping=1,e.toneMappingExposure=1,e.gammaInput=!1,e.gammaOutput=!1,this.renderToCubeMapTarget(e,this.renderTarget),e.setRenderTarget(a),e.toneMapping=r,e.toneMappingExposure=i,e.gammaInput=t,e.gammaOutput=n},renderToCubeMapTarget:function(e,t){this.shader.uniforms.invertU.value=this.invertU,this.shader.uniforms.offsetU.value=this.offsetU;for(var n=0;n<6;n++)this.renderToCubeMapTargetFace(e,t,n)},renderToCubeMapTargetFace:function(e,t,n){this.shader.uniforms.faceIndex.value=n,e.setRenderTarget(t,n),e.render(this.scene,this.camera)},dispose:function(){this.renderTarget.dispose(),this.planeMesh.geometry.dispose(),this.planeMesh.material.dispose()}};class lg extends t{constructor(){super(),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setCamera(e){}setSize(e,t){}dispose(){}render(e,t,n,r,i){console.error("v3d.Pass: .render() must be implemented in derived pass.")}}const cg=new ia(-1,1,1,-1,0,1),ug=new ji(2,2);class dg{constructor(e){this._mesh=new Ei(ug,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,cg)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}static dispose(){ug.dispose()}}class hg extends lg{constructor(e,t,n){super(),this.damp=t,this.shader=Zi.afterimage,this.uniforms=Bi.clone(this.shader.uniforms),this.uniforms.damp.value=this.damp,this.textureComp=new bn(e.x,e.y,n),this.textureOld=new bn(e.x,e.y,n),this.shaderMaterial=new Pi({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new dg(this.shaderMaterial);n=new kr;this.copyFsQuad=new dg(n)}dispose(){this.textureComp.dispose(),this.textureOld.dispose()}render(e,t,n,r,i){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=n.texture,this.uniforms.damp.value=this.damp,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureComp.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.copyFsQuad.render(e);e=this.textureOld;this.textureOld=this.textureComp,this.textureComp=e}setSize(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}}class pg extends lg{constructor(e,t,n,r,i){super(),this.strength=void 0!==t?t:1,this.radius=n,this.threshold=r,this.resolution=void 0!==e?new Yt(e.x,e.y):new Yt(256,256),i=i||{minFilter:Ge,magFilter:Ge,format:Ke},this.clearColor=new mn(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new bn(a,o,i),this.renderTargetBright.texture.name="BloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new bn(a,o,i);l.texture.name="BloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l),(l=new bn(a,o,i)).texture.name="BloomPass.v"+s,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),a=Math.round(a/2),o=Math.round(o/2)}e=Zi.bloomLumHighPass;this.highPassUniforms=Bi.clone(e.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Pi({type:"BloomHighPass",uniforms:this.highPassUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{}}),this.separableBlurMaterials=[];for(var c=[3,5,7,9,11],a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Yt(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new wn(1,1,1),new wn(1,1,1),new wn(1,1,1),new wn(1,1,1),new wn(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;t=Zi.copy;this.copyUniforms=Bi.clone(t.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Pi({type:"BloomCopy",defines:Object.assign({},t.defines),uniforms:this.copyUniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:ce,blendEquation:ue,blendEquationAlpha:ue,blendSrc:_e,blendDst:ge,blendSrcAlpha:me,blendDstAlpha:ge,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new mn,this.oldClearAlpha=1,this.basic=new kr,this.fsQuad=new dg(null)}dispose(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){var n=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new Yt(n,r),n=Math.round(n/2),r=Math.round(r/2)}render(e,t,n,r,i){e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=pg.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=pg.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){return new Pi({type:"BloomSeparableBlur",defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new Yt(.5,.5)},direction:{value:new Yt(.5,.5)}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_bloom_separable_blur_frag})}getCompositeMaterial(e){return new Pi({type:"BloomComposite",defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_bloom_composite_frag})}}pg.BlurDirectionX=new Yt(1,0),pg.BlurDirectionY=new Yt(0,1);class fg extends lg{constructor(e,t,n){super(),this.scene=e,this.camera=t;var r=n.width||window.innerWidth||1,e=n.height||window.innerHeight||1,r=new bn(r,e,{minFilter:Ge,magFilter:Ge,format:Ke});this.renderTargetDepth=r.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new ws,this.materialDepth.depthPacking=i,this.materialDepth.blending=ie;e=Zi.bokeh,r=Bi.clone(e.uniforms);r.tDepth.value=this.renderTargetDepth.texture,r.focus.value=$t(n.focus)?n.focus:1,r.aperture.value=$t(n.aperture)?n.aperture:1,r.maxblur.value=$t(n.maxblur)?n.maxblur:1,r.depthLeakThreshold.value=$t(n.depthLeakThreshold)?n.depthLeakThreshold:.2,r.nearClip.value=t.near,r.farClip.value=t.far,r.aspect.value=t.aspect,Object.defineProperties(this,{focus:{get:function(){return this.uniforms.focus.value},set:function(e){this.uniforms.focus.value=e}},aperture:{get:function(){return this.uniforms.aperture.value},set:function(e){this.uniforms.aperture.value=e}},maxblur:{get:function(){return this.uniforms.maxblur.value},set:function(e){this.uniforms.maxblur.value=e}},depthLeakThreshold:{get:function(){return this.uniforms.depthLeakThreshold.value},set:function(e){this.uniforms.depthLeakThreshold.value=e}}}),this.materialBokeh=new Pi({type:"Bokeh",defines:Object.assign({},e.defines),uniforms:r,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.uniforms=r,this.camera2=new ia(-1,1,1,-1,0,1),this.scene2=new oa,this.quad2=new Ei(new ji(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new mn,this.oldClearAlpha=1}render(e,t,n,r,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha();e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.uniforms.aspect.value=this.camera.aspect,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),e.clear()),e.render(this.scene2,this.camera2),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(this.oldClearAlpha),e.autoClear=this.oldAutoClear}setCamera(e){this.camera=e}setSize(e,t){this.renderTargetDepth.setSize(e,t)}dispose(){this.renderTargetDepth.dispose()}}class mg extends lg{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof Pi?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Bi.clone(e.uniforms),this.material=new Pi({type:"ShaderPass",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new dg(this.material)}render(e,t,n,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.material.dispose()}}class gg extends mg{constructor(){super(Zi.brightness_contrast),this.material.type="Grayscale"}get brightness(){return this.uniforms.brightness.value}set brightness(e){this.uniforms.brightness.value=e}get constrast(){return this.uniforms.contrast.value}set constrast(e){this.uniforms.contrast.value=e}}class vg extends mg{constructor(e,t,n,r){super(Zi.fxaa),this.material.type="FXAA",this.width=void 0!==n?n:512,this.height=void 0!==r?r:256,this.needsSwap=!1}setSize(e,t){this.width=e,this.height=t,this.uniforms.resolution.value.set(1/e,1/t)}}class Ag extends mg{constructor(){super(Zi.grayscale),this.material.type="Grayscale"}}class _g extends lg{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n,r,i){var a,o,s=e.context,l=e.state;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0),o=this.inverse?(a=0,1):(a=1,0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),l.buffers.stencil.setFunc(s.ALWAYS,a,4294967295),l.buffers.stencil.setClear(o),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.stencil.setFunc(s.EQUAL,1,4294967295),l.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP)}setCamera(e){this.camera=e}}class xg extends lg{constructor(){super(),this.needsSwap=!1}render(e,t,n,r,i){e.state.buffers.stencil.setTest(!1)}}function yg(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new ci,this.widthCallback=null}function bg(e,t,n,r,i){var a;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,n.set)n.set(e,r);else for(a=0;a<e.length;a++)n[a+r]=e[a];return n}function Mg(e){this.headEdge=this.tailEdge=e,this.headIndex=e.index0,this.tailIndex=e.index1,this.indexCount=2}function Cg(e,t){this.index0=e,this.index1=t,this.edge0=null,this.edge1=null}function Sg(){this.geometry=new ci}function wg(e,t,n){var r=e.headIndex,e=e.tailIndex;return t[r][0]||t[e][0]||n[r][0]||n[e][0]||null}yg.prototype.setGeometry=function(e,t){if(this.widthCallback=t,this.positions=[],this.counters=[],e instanceof Float32Array||e instanceof Array)for(var n=0;n<e.length;n+=3){t=n/e.length;this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(t),this.counters.push(t)}this.process()},yg.prototype.compareV3=function(e,t){e*=6,t*=6;return this.positions[e]===this.positions[t]&&this.positions[1+e]===this.positions[1+t]&&this.positions[2+e]===this.positions[2+t]},yg.prototype.copyV3=function(e){e*=6;return[this.positions[e],this.positions[1+e],this.positions[2+e]]},yg.prototype.process=function(){var e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var t,n=0;n<e;n++)this.side.push(1),this.side.push(-1);for(n=0;n<e;n++)t=this.widthCallback?this.widthCallback(n/(e-1)):1,this.width.push(t),this.width.push(t);for(var r,n=0;n<e;n++)this.uvs.push(n/(e-1),0),this.uvs.push(n/(e-1),1);r=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(n=0;n<e-1;n++)r=this.copyV3(n),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(n=1;n<e;n++)r=this.copyV3(n),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);r=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);for(n=0;n<e-1;n++){var i=2*n;this.indices_array.push(i,1+i,2+i),this.indices_array.push(2+i,1+i,3+i)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.counters.copyArray(new Float32Array(this.counters)),this.attributes.counters.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new Hr(new Float32Array(this.positions),3),previous:new Hr(new Float32Array(this.previous),3),next:new Hr(new Float32Array(this.next),3),side:new Hr(new Float32Array(this.side),1),width:new Hr(new Float32Array(this.width),1),uv:new Hr(new Float32Array(this.uvs),2),counters:new Hr(new Float32Array(this.counters),1),index:new Hr(new Uint16Array(this.indices_array),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},yg.prototype.advance=function(e){var t=this.attributes.position.array,n=this.attributes.previous.array,r=this.attributes.next.array,i=t.length;bg(t,0,n,0,i),bg(t,6,t,0,i-6),t[i-6]=e.x,t[i-5]=e.y,t[i-4]=e.z,t[i-3]=e.x,t[i-2]=e.y,t[i-1]=e.z,bg(t,6,r,0,i-6),r[i-6]=e.x,r[i-5]=e.y,r[i-4]=e.z,r[i-3]=e.x,r[i-2]=e.y,r[i-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},yg.updateAttributes=function(e){var t=e.attributes.position.array,n=(e.attributes.previous.array,e.attributes.next.array,new yg);n.positions=t,n.process(),e.attributes.previous=n.attributes.previous,e.attributes.previous.needsUpdate=!0,e.attributes.next=n.attributes.next,e.attributes.next.needsUpdate=!0},Object.assign(Mg.prototype,{mergeStrip:function(e){var t=this.headIndex,n=e.headIndex,r=this.tailIndex,i=e.tailIndex;t==n?(this.headEdge.linkToEdge(e.headEdge),e.headEdge.linkToEdge(this.headEdge),this.headEdge=e.tailEdge,this.headIndex=e.tailIndex,this.indexCount+=e.indexCount-1):t==i?(this.headEdge.linkToEdge(e.tailEdge),e.tailEdge.linkToEdge(this.headEdge),this.headEdge=e.headEdge,this.headIndex=e.headIndex,this.indexCount+=e.indexCount-1):r==n?(this.tailEdge.linkToEdge(e.headEdge),e.headEdge.linkToEdge(this.tailEdge),this.tailEdge=e.tailEdge,this.tailIndex=e.tailIndex,this.indexCount+=e.indexCount-1):r==i&&(this.tailEdge.linkToEdge(e.tailEdge),e.tailEdge.linkToEdge(this.tailEdge),this.tailEdge=e.headEdge,this.tailIndex=e.headIndex,this.indexCount+=e.indexCount-1)},getIndicesFlat:function(){for(var e=new Float32Array(this.indexCount),t=0,n=null,r=this.headEdge,i=e[t++]=this.headIndex;null!==r;){i=r.index0==i?r.index1:r.index0;e[t++]=i;var a=r.edge0;(a=a==n||null===a?r.edge1:a)==n&&(a=null),n=r,r=a}return e}}),Object.assign(Cg.prototype,{linkToEdge:function(e){null===this.edge0?this.edge0=e:null===this.edge1&&(this.edge1=e)}}),Object.assign(Sg.prototype,{fromBufferGeometry:function(e){var r,n,i,a,o,s,l,c,u,d,t,h=e.getAttribute("position"),e=e.getIndex();void 0!==h&&(r=[],null!==e?function(e){for(var t=e.length%2?e.length-1:e.length,n={},r={},i=0;i<t;i+=2){var a=(u=new Mg(new Cg(e[i],e[i+1]))).headIndex,o=u.tailIndex;n[a]=n[a]||[],n[o]=n[o]||[],r[a]=r[a]||[],r[o]=r[o]||[],n[a].push(u),r[o].push(u)}var s,l=new Wu.LinkMap;for(s in n)n[s].length&&l.push(new Wu.LinkMapNode(n[s]),s);for(var c=[],u=l.first&&l.first.value[0];u;){n[a=u.headIndex].splice(n[a].indexOf(u),1),r[o=u.tailIndex].splice(r[o].indexOf(u),1),0==n[a].length&&l.removeNodeByKey(a);for(var d=wg(u,n,r);null!==d;)n[a=d.headIndex].splice(n[a].indexOf(d),1),r[o=d.tailIndex].splice(r[o].indexOf(d),1),0==n[a].length&&l.removeNodeByKey(a),u.mergeStrip(d),d=wg(u,n,r);c.push(u),u=l.first&&l.first.value[0]}return c}(e.array).forEach(function(e){var t=new yg,n=new Float32Array(3*e.indexCount);e.getIndicesFlat().forEach(function(e,t){n.set(h.array.subarray(3*e,3*e+3),3*t)}),t.setGeometry(n),r.push(t)}):((t=new yg).setGeometry(h.array),r.push(t)),n=[],i=[],a=[],o=[],s=[],l=[],c=[],u=[],d=0,r.forEach(function(e){n=n.concat(e.positions),i=i.concat(e.previous),a=a.concat(e.next),o=o.concat(e.side),s=s.concat(e.width),l=l.concat(e.uvs),c=c.concat(e.counters);var t=e.indices_array.map(function(e){return e+d});u=u.concat(t),d+=e.positions.length/3}),this.geometry.setAttribute("position",new Hr(new Float32Array(n),3)),this.geometry.setAttribute("previous",new Hr(new Float32Array(i),3)),this.geometry.setAttribute("next",new Hr(new Float32Array(a),3)),this.geometry.setAttribute("side",new Hr(new Float32Array(o),1)),this.geometry.setAttribute("width",new Hr(new Float32Array(s),1)),this.geometry.setAttribute("uv",new Hr(new Float32Array(l),2)),this.geometry.setAttribute("counters",new Hr(new Float32Array(c),1)),t=65535<jt(u)?Uint32Array:Uint16Array,this.geometry.setIndex(new Hr(new t(u),1)))}});class Eg extends aa{constructor(e){super(),this.type="MeshLineMaterial",this.lineWidth=1,this.sizeAttenuation=1,this.color=new mn(16777215),this.opacity=1,this.useMap=0,this.map=null,this.useAlphaMap=0,this.alphaMap=null,this.visibility=1,this.alphaTest=0,this.repeat=new Yt(1,1),this.uniforms={lineWidth:{value:1},sizeAttenuation:{value:1},color:{value:new mn(16777215)},opacity:{value:1},useMap:{value:0},map:{value:null},alphaMap:{value:null},useAlphaMap:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Yt(1,1)}},this.vertexShader=Ki.raw_meshline_vert,this.fragmentShader=Ki.raw_meshline_frag,this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.sizeAttenuation=e.sizeAttenuation,this.color.copy(e.color),this.opacity=e.opacity,this.useMap=e.useMap,this.map=e.map,this.useAlphaMap=e.useAlphaMap,this.alphaMap=e.alphaMap,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}Eg.prototype.isMeshLineMaterial=!0;class Tg extends lg{constructor(e,t,n,r){super(),this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new yn(1,1,1,1),this.hiddenEdgeColor=new yn(.1,.04,.02,1),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this.renderToScreen=!1,this.resolution=void 0!==e?new Yt(e.x,e.y):new Yt(256,256);n={minFilter:Ge,magFilter:Ge,format:Ke},r=Math.round(this.resolution.x/this.downSampleRatio),e=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new bn(this.resolution.x,this.resolution.y,n),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetDepthBuffer=new bn(this.resolution.x,this.resolution.y,n),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new bn(r,e,n),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new bn(r,e,n),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new bn(Math.round(r/2),Math.round(e/2),n),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new bn(r,e,n),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new bn(Math.round(r/2),Math.round(e/2),n),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeparableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Yt(r,e),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeparableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Yt(Math.round(r/2),Math.round(e/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();e=Zi.copy;this.copyUniforms=Bi.clone(e.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Pi({defines:Object.assign({},e.defines),uniforms:this.copyUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,blending:ie,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new mn,this.oldClearAlpha=1,this.basic=new kr({toneMapped:!1}),this.fsQuad=new dg(null),this.camera=new ia(-1,1,1,-1,0,1),this.tempPulseColor1=new yn,this.tempPulseColor2=new yn,this.textureMatrix=new rr,this.visibilityState=new WeakMap,this._depthMaterial=new ws({blending:ie,depthPacking:i,side:Oe}),this._maskMaterial=new Gu({side:Oe})}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t);e=Math.round(e/this.downSampleRatio),t=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(e,t),this.renderTargetBlurBuffer1.setSize(e,t),this.renderTargetEdgeBuffer1.setSize(e,t),this.separableBlurMaterial1.uniforms.texSize.value=new Yt(e,t),e=Math.round(e/2),t=Math.round(t/2),this.renderTargetBlurBuffer2.setSize(e,t),this.renderTargetEdgeBuffer2.setSize(e,t),this.separableBlurMaterial2.uniforms.texSize.value=new Yt(e,t)}saveVisibilityState(){const t=this;t.renderScene.traverse(function(e){e instanceof Ei&&t.visibilityState.set(e,e.visible)})}restoreVisibilityState(){const t=this;t.renderScene.traverse(function(e){e instanceof Ei&&(e.visible=t.visibilityState.get(e))})}changeVisibilityOfSelectedObjects(t){const n=this;function e(e){e instanceof Ei&&n.visibilityState.get(e)&&(e.visible=t)}for(var r=0;r<n.selectedObjects.length;r++){var i=n.selectedObjects[r];e(i);for(var a=i.children,o=0;o<a.length;o++){var s=a[o];s.isMesh&&s.isMaterialGeneratedMesh&&e(s)}}}changeVisibilityOfNonSelectedObjects(r){const i=this;var a=[];function e(e){e instanceof Ei&&i.visibilityState.get(e)&&a.push(e)}for(var t=0;t<i.selectedObjects.length;t++){var n=i.selectedObjects[t];e(n);for(var o=n.children,s=0;s<o.length;s++){var l=o[s];l.isMesh&&l.isMaterialGeneratedMesh&&e(l)}}i.renderScene.traverse(function(e){if(e instanceof Ei&&i.visibilityState.get(e)){for(var t=!1,n=0;n<a.length;n++)if(a[n].id===e.id){t=!0;break}t||(e.visible=r)}})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,n,r,i){var a,o;this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),0!==this.selectedObjects.length&&(e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha(),a=e.autoClear,e.autoClear=!1,i&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1),o=this.renderScene.background,this.renderScene.background=null,this.saveVisibilityState(),e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),this.changeVisibilityOfSelectedObjects(!1),this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.overrideMaterial=this._depthMaterial,e.render(this.renderScene,this.renderCamera),this.updateTextureMatrix(),e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),this.changeVisibilityOfSelectedObjects(!0),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this._maskMaterial,this.renderScene.overrideMaterial.cameraNearFar=new Yt(this.renderCamera.near,this.renderCamera.far),this.renderScene.overrideMaterial.depthTexture=this.renderTargetDepthBuffer.texture,this.renderScene.overrideMaterial.textureMatrix=this.textureMatrix,e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.restoreVisibilityState(),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),0<this.pulsePeriod&&(o=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2,this.tempPulseColor1.multiplyScalar(o),this.tempPulseColor2.multiplyScalar(o)),this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Yt(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Tg.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Tg.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Tg.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Tg.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a)}getEdgeDetectionMaterial(){return new Pi({type:"OutlineEdgeDetection",defines:{HIDDEN_EDGE_ALPHA:1},uniforms:{maskTexture:{value:null},texSize:{value:new Yt(.5,.5)},visibleEdgeColor:{value:new yn(1,1,1,1)},hiddenEdgeColor:{value:new yn(1,1,1,1)}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_outline_edge_frag})}getSeparableBlurMaterial(e){return new Pi({type:"OutlineSeparableBlur",defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Yt(.5,.5)},direction:{value:new Yt(.5,.5)},kernelRadius:{value:1}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_outline_blur_frag})}getOverlayMaterial(){return new Pi({type:"OutlineOverlay",uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_outline_overlay_frag,blending:ce,blendEquation:ue,blendEquationAlpha:ue,blendSrc:_e,blendDst:xe,blendSrcAlpha:ge,blendDstAlpha:ge,depthTest:!1,depthWrite:!1,transparent:!0})}setCamera(e){this.renderCamera=e}}Tg.BlurDirectionX=new Yt(1,0),Tg.BlurDirectionY=new Yt(0,1);class Ig extends lg{constructor(e,t,n,r,i){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new mn}render(e,t,n,r,i){var a=e.autoClear;e.autoClear=!1;let o,s;void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,o),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=a}setCamera(e){this.camera=e}}class Rg extends lg{constructor(e,t,n,r){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==r?r:0,this.oldClearColor=new mn,this.oldClearAlpha=1;r=Zi.copy;this.copyUniformsAccum=Bi.clone(r.uniforms),this.copyMaterialAccum=new Pi({type:"SSAACopyAccum",defines:Object.assign({},r.defines),uniforms:this.copyUniformsAccum,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:oe,depthTest:!1,depthWrite:!1}),this.fsQuadAccum=new dg(this.copyMaterialAccum),this.copyUniformsFinal=Bi.clone(r.uniforms),this.copyMaterialFinal=new Pi({type:"SSAACopyFinal",defines:Object.assign({},r.defines),uniforms:this.copyUniformsFinal,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,premultipliedAlpha:!1,transparent:!1,blending:ie,depthTest:!1,depthWrite:!1}),this.fsQuadFinal=new dg(this.copyMaterialFinal),this.iterative=!1,this.iterativeFrame=0}_getJitterOffsets(){return Rg.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))]}_isLastIterativeFrame(){var e=this._getJitterOffsets();return this.iterativeFrame==e.length-1}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null,this.accumRenderTarget.dispose(),this.accumRenderTarget=null)}setSize(e,t){this.sampleRenderTarget&&(this.sampleRenderTarget.setSize(e,t),this.accumRenderTarget.setSize(e,t))}render(e,t,n){this.sampleRenderTarget||(this.sampleRenderTarget=n.clone(),this.sampleRenderTarget.texture.name="SSAARenderPass.sample",this.accumRenderTarget=n.clone(),this.accumRenderTarget.texture.name="SSAARenderPass.accum");var r=this._getJitterOffsets(),i=e.autoClear;e.autoClear=!1,e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha();var a=1/r.length;this.copyUniformsAccum.tDiffuse.value=this.sampleRenderTarget.texture;var o,s,l=n.width,c=n.height,u=this.camera.view?this.camera.view.offsetX:0,d=this.camera.view?this.camera.view.offsetY:0;this.iterative?(s=this.iterativeFrame,o=performance.now()):s=0;for(var h=r.length,p=s;p<h;p++){this.dispatchEvent({type:"iteration",frame:p});var f=r[p];this.camera.setViewOffset&&this.camera.setViewOffset(l,c,u+.0625*f[0],d+.0625*f[1],l,c);f=a;if(this.unbiased&&(f+=1/32*((p+.5)/r.length-.5)),this.copyUniformsAccum.opacity.value=f,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),this.iterative?e.setRenderTarget(this.accumRenderTarget):e.setRenderTarget(this.renderToScreen?null:t),0===p&&(e.setClearColor(0,0),e.clear()),this.fsQuadAccum.render(e),this.iterativeFrame=p,this.iterative&&4<performance.now()-o)break}this.iterative&&(this._isLastIterativeFrame()?(this.copyUniformsFinal.tDiffuse.value=this.accumRenderTarget.texture,e.setRenderTarget(this.renderToScreen?null:t),this.fsQuadFinal.render(e),this.iterativeFrame=0):this.iterativeFrame++),this.camera.setViewOffset&&this.camera.setViewOffset(l,c,u,d,l,c),e.autoClear=i,e.setClearColor(this.oldClearColor,this.oldClearAlpha)}isLastIterativeFrame(){console.error("isLastIterativeFrame() deprectated, use pass event listener instead")}setCamera(e){this.camera=e}}Rg.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class Lg extends lg{constructor(e,t,n){super(),this.enabled=!0,this.needsSwap=!1,this.objects=(n=n||{}).objects||[],this.steps=$t(n.steps)||10,this.stride=$t(n.stride)||30,this.binarySearchSteps=$t(n.binarySearchSteps)||4,this.renderTargetScale=$t(n.renderTargetScale)||.5,this.thickness=$t(n.thickness)||.01,this.maxDistance=$t(n.maxDistance)||100,this.jitter=$t(n.jitter)||1,this.useRefract=$t(n.useRefract)||!1,this.renderAfter=$t(n.renderAfter)||[],this.simpleRefraction=$t(n.simpleRefraction)||!1,this.scene=e,this.camera=t,this._prevClearColor=new mn,this._depthBuffer=new bn(256,256,{minFilter:Ve,magFilter:Ve,format:Ke,type:Xe}),this._depthBuffer.texture.name="SSRPass.Depth",this._depthBuffer.texture.generateMipmaps=!1,this._depthMaterial=new ws,this._depthMaterial.depthPacking=3202,this._backfaceDepthBuffer=this._depthBuffer.clone(),this._backfaceDepthBuffer.texture.name="SSRPass.Depth",this._backfaceDepthMaterial=new ws,this._backfaceDepthMaterial.depthPacking=3202,this._backfaceDepthMaterial.side=Fe,this.basic=new kr,this.fsQuad=new dg(null)}_setLayer(e,t){e.layers.set(t),e.isMesh&&e.isMaterialGeneratedMesh&&e.parent.layers.enable(t)}dispose(){this._depthBuffer.dispose(),this._backfaceDepthBuffer.dispose();for(var e=0;e<this.objects.length;e++){var t=(n=this.objects[e]).material;t&&(this._setLayer(n,0),delete t.defines.USE_SSR,delete t.defines.USE_SSR_REFRACT,t.needsUpdate=!0)}this.objects.splice(0);for(e=0;e<this.renderAfter.length;e++){var n=this.renderAfter[e];this._setLayer(n,0)}this.renderAfter.splice(0)}setCamera(e){this.camera=e}setSize(e,t){e*=this.renderTargetScale,t*=this.renderTargetScale,this._depthBuffer.setSize(e,t),this._backfaceDepthBuffer.setSize(e,t)}render(e,t,n,r,i){var a=this;e.getClearColor(this._prevClearColor);var o=e.getClearAlpha(),s=e.autoClear;e.autoClear=!0,e.setClearColor(new mn(0,0,0),0);var l=this.scene.background;this.scene.background=null;var c=this.camera.layers.mask,u=this.camera.ignoreShadowLayers,d=this.scene.overrideMaterial;this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e),this.useRefract||(this._depthMaterial.side=Oe),this.camera.layers.enable(this.useRefract?3:5),this.useRefract&&this.simpleRefraction||(this.scene.overrideMaterial=this._depthMaterial,e.setRenderTarget(this._depthBuffer),e.clear(),e.render(this.scene,this.camera)),this.useRefract||(this.scene.overrideMaterial=this._backfaceDepthMaterial,e.setRenderTarget(this._backfaceDepthBuffer),e.clear(),e.render(this.scene,this.camera)),this.scene.overrideMaterial=d,this.scene.traverse(function(e){e.isLight&&(e.userData.oldLayersMask=e.layers.mask,e.layers.enable(a.useRefract?5:3),a.renderAfter.length&&e.layers.enable(a.useRefract?6:4))});for(var h=0;h<this.objects.length;h++){var p=(f=this.objects[h]).material;p&&p.isMeshNodeMaterial&&(this._setLayer(f,this.useRefract?5:3),p.defines.USE_SSR="",this.useRefract&&(p.defines.USE_SSR_REFRACT="",this.simpleRefraction&&(p.defines.SSR_SIMPLE_REFRACT="")),p.ssrParams={invProjectionMatrix:(new rr).copy(this.camera.projectionMatrix).invert(),sourceBuffer:t,depthBuffer:this._depthBuffer,backfaceDepthBuffer:this._backfaceDepthBuffer,stride:this.stride,thickness:this.thickness,maxDistance:this.maxDistance,jitter:this.jitter},p.needsUpdate=!0,p.defines.MAX_STEPS!==this.steps&&(p.defines.MAX_STEPS=Math.floor(this.steps),p.needsUpdate=!0),p.defines.BINARY_SEARCH_ITERATIONS!==this.binarySearchSteps&&(p.defines.BINARY_SEARCH_ITERATIONS=Math.floor(this.binarySearchSteps),p.needsUpdate=!0))}for(h=0;h<this.renderAfter.length;h++){var f=this.renderAfter[h];this._setLayer(f,this.useRefract?6:4)}this.camera.layers.set(this.useRefract?5:3),this.camera.ignoreShadowLayers=!0,e.autoClear=!1,e.setRenderTarget(n),e.render(this.scene,this.camera),this.renderAfter.length&&(this.camera.layers.set(this.useRefract?6:4),e.render(this.scene,this.camera)),this.scene.background=l,this.camera.layers.mask=c,this.camera.ignoreShadowLayers=u,this.scene.traverse(function(e){e.isLight&&"oldLayersMask"in e.userData&&(e.layers.mask=e.userData.oldLayersMask,delete e.userData.oldLayersMask)}),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),e.setClearColor(this._prevClearColor,o),e.autoClear=s}}class Bg extends mg{constructor(){super(Zi.tonemap),this.material.type="ToneMap"}}const Pg={Bloom:pg,Bokeh:fg,"Brightness/Contrast":gg,FXAA:vg,Grayscale:Ag,Mask:_g,Outline:Tg,Render:Ig,SSAA:Rg,SSR:Lg,ToneMapping:Bg,"Copy/Other":mg},Dg={getPageParams:function(e){let t=(e=e||window).location.href.toString();const n={};if(-1==t.indexOf("?"))return n;const r=t.split("#")[0].split("?")[1].split("&");for(let e=0;e<r.length;e++){var i=r[e].split("="),a=decodeURIComponent(i[0]);1==i.length?n[a]="":n[a]=decodeURIComponent(i[1])}return n},updatePageParam:function(e,t,n){let r=null,i="",a=e.split("?"),o=a[0],s=a[1],l="",c,u;if(s){c=s.split("#"),u=c[0],r=c[1],r&&(s=u),a=s.split("&");for(let e=0;e<a.length;e++)a[e].split("=")[0]!=t&&(i+=l+a[e],l="&")}else c=o.split("#"),u=c[0],r=c[1],u&&(o=u);r&&(n+="#"+r);n=l+""+t+"="+n;return o+"?"+i+n},loadScript:function(e,t,n,r){function i(e){o.removeEventListener("load",i,!1),o.removeEventListener("error",a,!1),t.removeChild(o),n(e)}function a(e){o.removeEventListener("load",i,!1),o.removeEventListener("error",a,!1),t.removeChild(o),r(e)}const o=document.createElement("script");o.addEventListener("load",i,!1),o.addEventListener("error",a,!1),t.appendChild(o),o.src=e},drawWatermark:function(e){const t=e.container;if(3483952072==zt(Ct)){var n=["color: #fff;","opacity: 0.5;","font-size: 18px;","font-family: sans-serif;","text-align: center;","text-decoration: none;","position: absolute;","bottom: 1%;","right: 1%;","user-select: none;","z-index: 9999;","text-shadow: 1px 1px #000;"].join("\n");const r=document.createElement("div");r.innerHTML=`<a href="https://www.soft8soft.com/verge3d-trial/" target="_blank" style="${n}">MADE WITH VERGE3D TRIAL</a>`,t.appendChild(r),setTimeout(function(){t.contains(r)&&890310108==zt(r.textContent)||e.dispose()},1e3)}},isXML:function(e){return null!==e.match(/.*\.xml$/)},isJS:function(e){return null!==e.match(/.*\.js$/)},createLineObjectHTML:function(d,h,p,e,t,f){console.warn("v3d.AppUtils.createLineObjectHTML has been deprecated. Use v3d.LineHTML instead."),e=e||2,t=t?t.convertSRGBToLinear():new mn(1,0,.2),f=f||5;const m=new wn(1,0,0),n=new yg;n.setGeometry([0,0,0,m.x,m.y,m.z]);e=new Eg({color:t,lineWidth:e,sizeAttenuation:0});const g=new Ei(n.geometry,e);g.name=h.name+"_LINE",h.add(g);const v=new wn,A=new wn,_=new Sn;d.renderCallbacks.push(function(){d.camera.updateMatrixWorld(),h.traverseAncestors(function(e){e.updateMatrixWorld()});var e=p.getBoundingClientRect(),t=(e.left+e.right)/2,n=(e.top+e.bottom)/2;const r=h.getWorldPosition(v);r.project(d.camera);var i=(r.x+1)/2*d.getWidth(),a=(1-r.y)/2*d.getHeight(),o=(n-a)/(t-i),s=(e.height+2*f)/(e.width+2*f);let l,c;Math.abs(o)>s?(c=n<a?Math.min(e.bottom+f,a):Math.max(e.top-f,a),l=(c-a)/o+i):(l=i<t?Math.max(e.left-f,i):Math.min(e.right+f,i),c=(l-i)*o+a),o=2*l/d.getWidth()-1,a=1-2*c/d.getHeight();const u=A.set(o,a,0);u.unproject(d.camera),h.worldToLocal(u),a=u.length(),g.scale.set(a,a,a),u.normalize(),a=_.setFromUnitVectors(m,u),g.setRotationFromQuaternion(a)})},addToAppList:function(e){const t=rn();t.v3d&&(t.v3d.apps=t.v3d.apps||[],-1==t.v3d.apps.indexOf(e)&&t.v3d.apps.push(e))},removeFromAppList:function(e){const t=rn();t.v3d&&t.v3d.apps&&(-1<(e=t.v3d.apps.indexOf(e))&&t.v3d.apps.splice(e,1))},printPerformanceInfo:function(_,x){x=x||1;const y=_.renderer.info,b=y.autoReset;y.autoReset=!1,y.reset();const M=_.frame;for(let e=0;e<y.programs.length;e++)y.programs[e].profile.calcRenderTime=!0;function C(e,t){t?console.log("%c"+e,"color:red"):console.log(e)}setTimeout(function(){if(C("--- Verge3D Performance Profile ("+x+"s) ---"),_.scene){var c=_.frame-M,u=Math.round(_._loadingTime);C(`Scene Loading Time: ${u}ms`,1e4<u);u=-1!=_._loadSceneURL.indexOf(".xz",_._loadSceneURL.length-3);C("Asset Compression: "+(u?"yes":"no"),0==u);u=c/x;C("FPS: "+u,u<30);u=y.render.calls/c;C("Render Calls: "+u,1e3<u);u=y.render.triangles/c;C("Triangles Rendered: "+u,1e6<u),C("Geometry Buffers: "+y.memory.geometries,200<y.memory.geometries),C("HDR Rendering: "+(_.useHDR?"yes":"no"));u=_.renderer.getDrawingBufferSize(new Yt);C("Viewport Resolution: "+u.x+"x"+u.y),C(`Pixel Ratio: ${_.renderer.getPixelRatio()} (current) / ${window.devicePixelRatio} (device)`);let e="N/A";switch(_._envIBLMode){case 0:e="PMREM";break;case 1:e="Light Probe + Cubemap";break;case 2:e="Light Probe"}C(`Image-Based Lighting: ${e} ${_._pmremMaxTileSize}px`);let t=0,n=0,r=0,i=0,a=0,o=0;_.scene.traverse(function(e){e.isLight&&(t++,e.castShadow&&e.shadow&&(i++,a=e.shadow.mapSize.width,o=e.shadow.mapSize.height)),e.isCubeReflectionProbe&&n++,e.isPlaneReflectionProbe&&r++}),C("Lights: "+t,10<t),C(`Reflection Probes: ${n} (cube) / ${r} (plane) `,3<n||1<r);const p=[];if(_.postprocessing){const g=_.postprocessing.composer.passes;g.forEach(function(e){for(var t in Pg)if(e instanceof Pg[t])return void p.push(t);p.push("Undefined")})}C("Post-Processing: "+(p.length?p.join(","):"N/A"));let s="N/A";if(i&&_.renderer.shadowMap&&_.renderer.shadowMap.enabled){switch(_.renderer.shadowMap.type){case q:s="Basic";break;case re:s="Bilinear";break;case Z:s="PCF";break;case J:s="PCF (Bilinear)";break;case ne:s="PCF (Poisson Disk)";break;case te:s="ESM";break;case ee:s="VSM";break;default:s="Unknown"}s+=` ${i}x${a}x`+o}C("Shadow Map: "+s,4<i||2048<a||2048<o);const f=y.programs.slice(0);C("Materials and Shaders: "+f.length,100<f),f.sort(function(e,t){return t.profile.renderTime-e.profile.renderTime});let l=0;for(let e=0;e<f.length;e++){const v=f[e];v.profile.calcRenderTime=!1;const A=v.profile.materials;var d=v.profile.renderTime/c;C("    "+(0==A.length?"System Material":A.join(","))+" - "+v.name+" - "+String(Math.round(10*d)/10)+"ms",16<d),l+=d,v.profile.renderTime=0}C("Total Render Time: "+String(Math.round(10*l)/10)+"ms",16<l),C("Textures & Render Buffers: "+y.memory.textures,100<y.memory.textures);const m=Array.from(y.memory.textureSpecs.values());m.sort(function(e,t){return e.type<t.type?-1:e.type>t.type?1:e.width!=t.width?t.width-e.width:t.height-e.height});for(let e=0;e<m.length;e++){var h=m[e];C(`    ${h.name||"N/A"} - ${h.type} - ${h.width}x`+h.height,4096<=h.width||4096<=h.height)}y.autoReset=b}else C("Scene not loaded")},1e3*x)}},Ng={prepareRenderer:function(e){var t=rl.getGPUVendor(e),n=rl.getGPUModel(e),r=rl.checkAndroid();r&&"ARM"===t&&"Mali-T760"===n&&(e.compatSettings.saturateSpecEnvBlenderApprox=!0),e.compatSettings.gtaoDisableBkgFix=r}},Fg={_useHalfFloatCubemaps(e){return!!rl.checkHalfFloatTex(e,!0)&&(!/Firefox/.test(navigator.userAgent)||!/Android/.test(navigator.userAgent))},renderSceneToCubemap(e,t,n,{camPos:r=new wn,clipStart:i=.1,clipEnd:a=100}={}){this._useHalfFloatCubemaps(t)||(console.warn("v3d.RenderUtils: disabling half float cubemaps"),n.texture.type=Qe);const o=new Fi(i,a,n);o.position.copy(r);r=e.worldMaterial;if(null!==r&&r.isMeshNodeMaterial){const s=new Ei(new Ii(1,1,1),r);s.material.side=Fe,s.material.defines.WORLD_NODES=1,new Fi(.1,10,n).update(t,s),s.geometry.disposeBoundsTree&&s.geometry.disposeBoundsTree(),s.geometry.dispose();r=e.background;e.background=null;n=t.autoClearColor;t.autoClearColor=!1,o.update(t,e),t.autoClearColor=n,e.background=r}else o.update(t,e);return o.renderTarget},renderWorldNodeMatToCubemap(e,t,n,r){t.isMeshNodeMaterial||console.error("v3d.RenderUtils.renderWorldNodeMatToCubemap(): material is not an instance of MeshNodeMaterial.");const i=new oa;return i.worldMaterial=t,this.renderSceneToCubemap(i,e,new Ui(n,r))},assignAllLayersMask:function(e){var t=e.layers.mask;return e.layers.set(0),e.isArrayCamera&&(e.layers.enable(1),e.layers.enable(2)),e.layers.enable(3),e.layers.enable(4),e.layers.enable(5),e.layers.enable(6),e.layers.enable(7),t}},Og=new In,Ug=new jn,zg=new rr,Vg=new wn,Gg=new wn;class kg extends Tr{constructor(e=256){super(),this.type="CubeReflectionProbe",this.influenceType=1,this.influenceDistance=1,this.parallaxType=1,this.parallaxDistance=1,this.probeClipStart=.1,this.probeClipEnd=100,this.probeIntensity=1,this.visibilityGroup=null,this.visibilityGroupInv=!1,this.influenceGroup=null,this.influenceGroupInv=!1,this._renderTargetCube=new Ui(e,{encoding:ft,format:Ke,generateMipmaps:!0,minFilter:ke,type:Xe}),this._exposureRenderTargetCube=this._renderTargetCube.clone(),this.renderTarget=null,this.matrixWorldInverse=new rr}setSize(e){this._renderTargetCube.setSize(e,e),this._exposureRenderTargetCube.setSize(e,e)}setEncoding(e){this._renderTargetCube.texture.encoding=e,this._exposureRenderTargetCube.texture.encoding=e}intersectsMesh(e){let t=!1;const n=e.geometry,r=n.boundsTree,i=zg;try{i.copy(e.matrixWorld).invert()}catch(e){return!1}switch(i.multiply(this.matrixWorld),this.influenceType){case 0:t=!0;break;case 1:Ug.center.setScalar(0),Ug.radius=this.influenceDistance,Ug.applyMatrix4(i),t=r?r.intersectsSphere(e,Ug):(null===n.boundingBox&&n.computeBoundingBox(),n.boundingBox.intersectsSphere(Ug));break;case 2:var a=Vg.setScalar(0),o=Gg.setScalar(2*this.influenceDistance);Og.setFromCenterAndSize(a,o),t=r?r.intersectsBox(e,Og,i):(Og.applyMatrix4(i),null===n.boundingBox&&n.computeBoundingBox(),n.boundingBox.intersectsBox(Og))}return t}update(e,t){const n={};e.traverse(e=>{!e.isCubeReflectionProbe&&this._isVisible(e)||(n[e.id]=e.layers.mask,e.layers.disableAll())});const r=e.worldMaterial;var i=null!==r&&r.isMeshNodeMaterial&&r.needsLightPathDir();let a;i&&(a=r.defines.LIGHT_PATH_IS_CAM_RAY,r.defines.LIGHT_PATH_IS_CAM_RAY=0),Fg.renderSceneToCubemap(e,t,this._renderTargetCube,{camPos:this.position,clipStart:this.probeClipStart,clipEnd:this.probeClipEnd}),this._exposureRenderTargetCube.texture.type=this._renderTargetCube.texture.type;const o=new og(this._renderTargetCube.texture);o.render(t,this._exposureRenderTargetCube,this.probeIntensity),o.dispose(),this.renderTarget=this.onUpdate(this._exposureRenderTargetCube),i&&(r.defines.LIGHT_PATH_IS_CAM_RAY=a),e.traverse(e=>{!e.isCubeReflectionProbe&&this._isVisible(e)||(e.layers.mask=n[e.id])})}onUpdate(e){return e}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}copy(e){return super.copy(e),this.influenceType=e.influenceType,this.influenceDistance=e.influenceDistance,this.parallaxType=e.parallaxType,this.parallaxDistance=e.parallaxDistance,this.probeClipStart=e.probeClipStart,this.probeClipEnd=e.probeClipEnd,this.probeIntensity=e.probeIntensity,this.visibilityGroup=e.visibilityGroup,this.visibilityGroupInv=e.visibilityGroupInv,this.influenceGroup=e.influenceGroup,this.influenceGroupInv=e.influenceGroupInv,this.setSize(e._renderTargetCube.width),this.matrixWorldInverse.copy(e.matrixWorldInverse),this}dispose(){null!==this._renderTargetCube&&this._renderTargetCube.dispose(),null!==this._exposureRenderTargetCube&&this._exposureRenderTargetCube.dispose(),null!==this.renderTarget&&(this.renderTarget.dispose(),this.renderTarget=null),this.dispatchEvent({type:"dispose"})}_isVisible(e){return null===this.visibilityGroup||(!e.isMesh||-1!==e.groupNames.indexOf(this.visibilityGroup)^this.visibilityGroupInv)}}kg.prototype.isCubeReflectionProbe=!0;class Qg{constructor(e,t){var n;this.renderer=e,void 0===t&&(n={minFilter:Ge,magFilter:Ge,format:Ke,stencilBuffer:!0},e=e.getDrawingBufferSize(),(t=new bn(e.width,e.height,n)).texture.name="EffectComposer.rt1",t.texture.encoding=ft),this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new mg(Zi.copy),this._previousFrameTime=Date.now(),this._pixelRatio=1}swapBuffers(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize(new Yt);e.setSize(t.width,t.height)}insertPass(e,t){this.passes.splice(t,0,e)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(e){void 0===e&&(e=.001*(Date.now()-this._previousFrameTime)),this._previousFrameTime=Date.now();var t=this.renderer.getRenderTarget();let n=!1,r,i,a=this.passes.length;for(i=0;i<a;i++)if(r=this.passes[i],!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){const o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}r instanceof _g?n=!0:r instanceof xg&&(n=!1)}this.renderer.setRenderTarget(t)}reset(e){var t;void 0===e&&(t=this.renderer.getDrawingBufferSize(new Yt),(e=this.renderTarget1.clone()).setSize(t.width,t.height)),this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,n){t*=this._pixelRatio,n*=this._pixelRatio,this.renderTarget1.setSize(t,n),this.renderTarget2.setSize(t,n);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(t,n)}setPixelRatio(e){this._pixelRatio=e}getPixelRatio(){return this._pixelRatio}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}getActiveSSAAPass(){return this.passes[0]instanceof Rg?this.passes[0]:null}insertPassAfter(e,t){for(var n=0,r=0;r<this.passes.length;r++)-1<t.indexOf(this.passes[r])&&(n=r+1);this.insertPass(e,n)}enableAllPasses(){for(var e=0;e<this.passes.length;e++)this.passes[e].enabled=!0}disableAllPasses(){for(var e=0;e<this.passes.length;e++)this.passes[e].enabled=!1}setStencil(e){this.renderTarget1.stencilBuffer=e,this.renderTarget1.dispose(),this.renderTarget2.stencilBuffer=e,this.renderTarget2.dispose()}}var Wg,Hg=(Wg="undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("v3d.js",document.baseURI).href,function(a){var n,o,a=void 0!==(a=a||{})?a:{},e=Object.assign;a.ready=new Promise(function(e,t){n=e,o=t});var t,s,r,i,l,c,u=e({},a),d="object"==typeof window,h="function"==typeof importScripts,p="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,f="";p?(f=h?require("path").dirname(f)+"/":__dirname+"/",c=()=>{l||(i=require("fs"),l=require("path"))},t=function(e,t){var n=H(e);return n?t?n:n.toString():(c(),e=l.normalize(e),i.readFileSync(e,t?null:"utf8"))},r=e=>{e=t(e,!0);return e=!e.buffer?new Uint8Array(e):e},s=(e,n,r)=>{var t=H(e);t&&n(t),c(),e=l.normalize(e),i.readFile(e,function(e,t){e?r(e):n(t.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof Z))throw e}),process.on("unhandledRejection",function(e){throw e}),a.inspect=function(){return"[Emscripten Module object]"}):(d||h)&&(h?f=self.location.href:"undefined"!=typeof document&&document.currentScript&&(f=document.currentScript.src),f=0!==(f=Wg?Wg:f).indexOf("blob:")?f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):"",t=t=>{try{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}catch(e){t=H(t);if(t)return function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];255<r&&(r&=255),t.push(String.fromCharCode(r))}return t.join("")}(t);throw e}},h&&(r=t=>{try{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}catch(e){t=H(t);if(t)return t;throw e}}),s=(t,n,r)=>{var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=()=>{var e;200==i.status||0==i.status&&i.response?n(i.response):(e=H(t))?n(e.buffer):r()},i.onerror=r,i.send(null)});a.print||console.log.bind(console);var m,g=a.printErr||console.warn.bind(console);e(a,u),a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit,a.wasmBinary&&(m=a.wasmBinary);var v;a.noExitRuntime;"object"!=typeof WebAssembly&&D("no native wasm support detected");var A=!1;function _(e){return a["_"+e]}function x(e,r,t,n){var i={string:function(e){var t,n=0;return null!=e&&0!==e&&(t=1+(e.length<<2),n=q(t),function(e,t,n,r){if(!(0<r))return;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s,l=e.charCodeAt(o);if(55296<=l&&l<=57343&&(s=e.charCodeAt(++o),l=65536+((1023&l)<<10)|1023&s),l<=127){if(a<=n)break;t[n++]=l}else if(l<=2047){if(a<=n+1)break;t[n++]=192|l>>6,t[n++]=128|63&l}else if(l<=65535){if(a<=n+2)break;t[n++]=224|l>>12,t[n++]=128|l>>6&63,t[n++]=128|63&l}else{if(a<=n+3)break;t[n++]=240|l>>18,t[n++]=128|l>>12&63,t[n++]=128|l>>6&63,t[n++]=128|63&l}}t[n]=0}(e,M,n,t)),n},array:function(e){var t=q(e.length);return b.set(e,t),t}};function a(e){return"string"===r?(t=e)?function(e,t,n){var r=t+n,i=t;for(;e[i]&&!(r<=i);)++i;{if(16<i-t&&e.subarray&&C)return C.decode(e.subarray(t,i));for(var a="";t<i;){var o,s,l=e[t++];128&l?(o=63&e[t++],192!=(224&l)?(s=63&e[t++],(l=224==(240&l)?(15&l)<<12|o<<6|s:(7&l)<<18|o<<12|s<<6|63&e[t++])<65536?a+=String.fromCharCode(l):(s=l-65536,a+=String.fromCharCode(55296|s>>10,56320|1023&s))):a+=String.fromCharCode((31&l)<<6|o)):a+=String.fromCharCode(l)}}return a}(M,t,n):"":"boolean"===r?Boolean(e):e;var t,n}var e=_(e),o=[],s=0;if(n)for(var l=0;l<n.length;l++){var c=i[t[l]];c?(0===s&&(s=j()),o[l]=c(n[l])):o[l]=n[l]}var u,e=e.apply(null,o);return u=e,0!==s&&K(s),e=a(u)}var y,b,M,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function S(e){y=e,a.HEAP8=b=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=new Int32Array(e),a.HEAPU8=M=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}a.INITIAL_MEMORY;var w,E=[],T=[],I=[];function R(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),E.unshift(e);var e;G(E)}function L(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),I.unshift(e);var e;G(I)}var B=0,P=null;function D(e){a.onAbort&&a.onAbort(e),g(e="Aborted("+e+")"),A=!0,e+=". Build with -s ASSERTIONS=1 for more info.";e=new WebAssembly.RuntimeError(e);throw o(e),e}a.preloadedImages={},a.preloadedAudios={};var N,F,O="data:application/octet-stream;base64,";function U(e){return e.startsWith(O)}function z(e){return e.startsWith("file://")}function V(e){try{if(e==N&&m)return new Uint8Array(m);var t=H(e);if(t)return t;if(r)return r(e);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function G(e){for(;0<e.length;){var t,n=e.shift();"function"!=typeof n?"number"==typeof(t=n.func)?void 0===n.arg?Q(t)():Q(t)(n.arg):t(void 0===n.arg?null:n.arg):n(a)}}U(N="data:application/octet-stream;base64,AGFzbQEAAAABIwdgAX8AYAABf2ABfwF/YAN/f38Bf2ADf39/AGACf38AYAAAAg0CAWEBYQACAWEBYgADAxoZBAMCAAIFBgQCAAQDAQEBAQIAAQEBAAAAAAQFAXABAQEFBwEBgAKAgAIGCQF/AUHQpIADCwdBEAFjAgABZAAIAWUAEQFmABABZwAPAWgADgFpABoBagAZAWsAGAFsABcBbQAWAW4AFQFvAQABcAAUAXEAEwFyABIKl6QBGf0DAQJ/IAJBgARPBEAgACABIAIQARoPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAEEDcUUEQCAAIQIMAQsgAkUEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAFBAWohASACQQFqIgJBA3FFDQEgAiADSQ0ACwsCQCADQXxxIgBBwABJDQAgAiAAQUBqIgRLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAETQ0ACwsgACACTQ0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgAEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCwujAQEBfyACQX9zIQICQCABRQ0AIAFBAXEEfyAALQAAIAJB/wFxc0ECdEGwCGooAgAgAkEIdnMhAiAAQQFqIQAgAUEBawUgAQshAyABQQFGDQADQCAALQABIAAtAAAgAkH/AXFzQQJ0QbAIaigCACACQQh2cyIBQf8BcXNBAnRBsAhqKAIAIAFBCHZzIQIgAEECaiEAIANBAmsiAw0ACwsgAkF/cwtRAQJ/QaAIKAIAIgEgAEEDakF8cSICaiEAAkAgAkEAIAAgAU0bDQAgAD8AQRB0SwRAIAAQAEUNAQtBoAggADYCACABDwtB1KDAAEEwNgIAQX8L8QwBB38CQCAARQ0AIABBCGsiAyAAQQRrKAIAIgFBeHEiAGohBQJAIAFBAXENACABQQNxRQ0BIAMgAygCACIBayIDQeigwAAoAgBJDQEgACABaiEAIANB7KDAACgCAEcEQCABQf8BTQRAIAMoAggiAiABQQN2IgRBA3RBgKHAAGpGGiACIAMoAgwiAUYEQEHYoMAAQdigwAAoAgBBfiAEd3E2AgAMAwsgAiABNgIMIAEgAjYCCAwCCyADKAIYIQYCQCADIAMoAgwiAUcEQCADKAIIIgIgATYCDCABIAI2AggMAQsCQCADQRRqIgIoAgAiBA0AIANBEGoiAigCACIEDQBBACEBDAELA0AgAiEHIAQiAUEUaiICKAIAIgQNACABQRBqIQIgASgCECIEDQALIAdBADYCAAsgBkUNAQJAIAMgAygCHCICQQJ0QYijwABqIgQoAgBGBEAgBCABNgIAIAENAUHcoMAAQdygwAAoAgBBfiACd3E2AgAMAwsgBkEQQRQgBigCECADRhtqIAE2AgAgAUUNAgsgASAGNgIYIAMoAhAiAgRAIAEgAjYCECACIAE2AhgLIAMoAhQiAkUNASABIAI2AhQgAiABNgIYDAELIAUoAgQiAUEDcUEDRw0AQeCgwAAgADYCACAFIAFBfnE2AgQgAyAAQQFyNgIEIAAgA2ogADYCAA8LIAMgBU8NACAFKAIEIgFBAXFFDQACQCABQQJxRQRAIAVB8KDAACgCAEYEQEHwoMAAIAM2AgBB5KDAAEHkoMAAKAIAIABqIgA2AgAgAyAAQQFyNgIEIANB7KDAACgCAEcNA0HgoMAAQQA2AgBB7KDAAEEANgIADwsgBUHsoMAAKAIARgRAQeygwAAgAzYCAEHgoMAAQeCgwAAoAgAgAGoiADYCACADIABBAXI2AgQgACADaiAANgIADwsgAUF4cSAAaiEAAkAgAUH/AU0EQCAFKAIIIgIgAUEDdiIEQQN0QYChwABqRhogAiAFKAIMIgFGBEBB2KDAAEHYoMAAKAIAQX4gBHdxNgIADAILIAIgATYCDCABIAI2AggMAQsgBSgCGCEGAkAgBSAFKAIMIgFHBEAgBSgCCCICQeigwAAoAgBJGiACIAE2AgwgASACNgIIDAELAkAgBUEUaiICKAIAIgQNACAFQRBqIgIoAgAiBA0AQQAhAQwBCwNAIAIhByAEIgFBFGoiAigCACIEDQAgAUEQaiECIAEoAhAiBA0ACyAHQQA2AgALIAZFDQACQCAFIAUoAhwiAkECdEGIo8AAaiIEKAIARgRAIAQgATYCACABDQFB3KDAAEHcoMAAKAIAQX4gAndxNgIADAILIAZBEEEUIAYoAhAgBUYbaiABNgIAIAFFDQELIAEgBjYCGCAFKAIQIgIEQCABIAI2AhAgAiABNgIYCyAFKAIUIgJFDQAgASACNgIUIAIgATYCGAsgAyAAQQFyNgIEIAAgA2ogADYCACADQeygwAAoAgBHDQFB4KDAACAANgIADwsgBSABQX5xNgIEIAMgAEEBcjYCBCAAIANqIAA2AgALIABB/wFNBEAgAEEDdiIBQQN0QYChwABqIQACf0HYoMAAKAIAIgJBASABdCIBcUUEQEHYoMAAIAEgAnI2AgAgAAwBCyAAKAIICyECIAAgAzYCCCACIAM2AgwgAyAANgIMIAMgAjYCCA8LQR8hAiADQgA3AhAgAEH///8HTQRAIABBCHYiASABQYD+P2pBEHZBCHEiAXQiAiACQYDgH2pBEHZBBHEiAnQiBCAEQYCAD2pBEHZBAnEiBHRBD3YgASACciAEcmsiAUEBdCAAIAFBFWp2QQFxckEcaiECCyADIAI2AhwgAkECdEGIo8AAaiEBAkACQAJAQdygwAAoAgAiBEEBIAJ0IgdxRQRAQdygwAAgBCAHcjYCACABIAM2AgAgAyABNgIYDAELIABBAEEZIAJBAXZrIAJBH0YbdCECIAEoAgAhAQNAIAEiBCgCBEF4cSAARg0CIAJBHXYhASACQQF0IQIgBCABQQRxaiIHQRBqKAIAIgENAAsgByADNgIQIAMgBDYCGAsgAyADNgIMIAMgAzYCCAwBCyAEKAIIIgAgAzYCDCAEIAM2AgggA0EANgIYIAMgBDYCDCADIAA2AggLQfigwABB+KDAACgCAEEBayIAQX8gABs2AgALC5IvAQt/IwBBEGsiCyQAAkACQAJAAkACQAJAAkACQAJAAkACQCAAQfQBTQRAQdigwAAoAgAiBkEQIABBC2pBeHEgAEELSRsiB0EDdiICdiIBQQNxBEAgAUF/c0EBcSACaiIDQQN0IgFBiKHAAGooAgAiBEEIaiEAAkAgBCgCCCICIAFBgKHAAGoiAUYEQEHYoMAAIAZBfiADd3E2AgAMAQsgAiABNgIMIAEgAjYCCAsgBCADQQN0IgFBA3I2AgQgASAEaiIBIAEoAgRBAXI2AgQMDAsgB0HgoMAAKAIAIgpNDQEgAQRAAkBBAiACdCIAQQAgAGtyIAEgAnRxIgBBACAAa3FBAWsiACAAQQx2QRBxIgJ2IgFBBXZBCHEiACACciABIAB2IgFBAnZBBHEiAHIgASAAdiIBQQF2QQJxIgByIAEgAHYiAUEBdkEBcSIAciABIAB2aiIDQQN0IgBBiKHAAGooAgAiBCgCCCIBIABBgKHAAGoiAEYEQEHYoMAAIAZBfiADd3EiBjYCAAwBCyABIAA2AgwgACABNgIICyAEQQhqIQAgBCAHQQNyNgIEIAQgB2oiAiADQQN0IgEgB2siA0EBcjYCBCABIARqIAM2AgAgCgRAIApBA3YiAUEDdEGAocAAaiEFQeygwAAoAgAhBAJ/IAZBASABdCIBcUUEQEHYoMAAIAEgBnI2AgAgBQwBCyAFKAIICyEBIAUgBDYCCCABIAQ2AgwgBCAFNgIMIAQgATYCCAtB7KDAACACNgIAQeCgwAAgAzYCAAwMC0HcoMAAKAIAIglFDQEgCUEAIAlrcUEBayIAIABBDHZBEHEiAnYiAUEFdkEIcSIAIAJyIAEgAHYiAUECdkEEcSIAciABIAB2IgFBAXZBAnEiAHIgASAAdiIBQQF2QQFxIgByIAEgAHZqQQJ0QYijwABqKAIAIgEoAgRBeHEgB2shAyABIQIDQAJAIAIoAhAiAEUEQCACKAIUIgBFDQELIAAoAgRBeHEgB2siAiADIAIgA0kiAhshAyAAIAEgAhshASAAIQIMAQsLIAEoAhghCCABIAEoAgwiBEcEQCABKAIIIgBB6KDAACgCAEkaIAAgBDYCDCAEIAA2AggMCwsgAUEUaiICKAIAIgBFBEAgASgCECIARQ0DIAFBEGohAgsDQCACIQUgACIEQRRqIgIoAgAiAA0AIARBEGohAiAEKAIQIgANAAsgBUEANgIADAoLQX8hByAAQb9/Sw0AIABBC2oiAEF4cSEHQdygwAAoAgAiCUUNAEEAIAdrIQMCQAJAAkACf0EAIAdBgAJJDQAaQR8gB0H///8HSw0AGiAAQQh2IgAgAEGA/j9qQRB2QQhxIgJ0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgAnIgAHJrIgBBAXQgByAAQRVqdkEBcXJBHGoLIgZBAnRBiKPAAGooAgAiAkUEQEEAIQAMAQtBACEAIAdBAEEZIAZBAXZrIAZBH0YbdCEBA0ACQCACKAIEQXhxIAdrIgUgA08NACACIQQgBSIDDQBBACEDIAIhAAwDCyAAIAIoAhQiBSAFIAIgAUEddkEEcWooAhAiAkYbIAAgBRshACABQQF0IQEgAg0ACwsgACAEckUEQEEAIQRBAiAGdCIAQQAgAGtyIAlxIgBFDQMgAEEAIABrcUEBayIAIABBDHZBEHEiAnYiAUEFdkEIcSIAIAJyIAEgAHYiAUECdkEEcSIAciABIAB2IgFBAXZBAnEiAHIgASAAdiIBQQF2QQFxIgByIAEgAHZqQQJ0QYijwABqKAIAIQALIABFDQELA0AgACgCBEF4cSAHayIBIANJIQIgASADIAIbIQMgACAEIAIbIQQgACgCECIBBH8gAQUgACgCFAsiAA0ACwsgBEUNACADQeCgwAAoAgAgB2tPDQAgBCgCGCEGIAQgBCgCDCIBRwRAIAQoAggiAEHooMAAKAIASRogACABNgIMIAEgADYCCAwJCyAEQRRqIgIoAgAiAEUEQCAEKAIQIgBFDQMgBEEQaiECCwNAIAIhBSAAIgFBFGoiAigCACIADQAgAUEQaiECIAEoAhAiAA0ACyAFQQA2AgAMCAsgB0HgoMAAKAIAIgJNBEBB7KDAACgCACEDAkAgAiAHayIBQRBPBEBB4KDAACABNgIAQeygwAAgAyAHaiIANgIAIAAgAUEBcjYCBCACIANqIAE2AgAgAyAHQQNyNgIEDAELQeygwABBADYCAEHgoMAAQQA2AgAgAyACQQNyNgIEIAIgA2oiACAAKAIEQQFyNgIECyADQQhqIQAMCgsgB0HkoMAAKAIAIghJBEBB5KDAACAIIAdrIgE2AgBB8KDAAEHwoMAAKAIAIgIgB2oiADYCACAAIAFBAXI2AgQgAiAHQQNyNgIEIAJBCGohAAwKC0EAIQAgB0EvaiIJAn9BsKTAACgCAARAQbikwAAoAgAMAQtBvKTAAEJ/NwIAQbSkwABCgKCAgICABDcCAEGwpMAAIAtBDGpBcHFB2KrVqgVzNgIAQcSkwABBADYCAEGUpMAAQQA2AgBBgCALIgFqIgZBACABayIFcSICIAdNDQlBkKTAACgCACIEBEBBiKTAACgCACIDIAJqIgEgA00NCiABIARLDQoLQZSkwAAtAABBBHENBAJAAkBB8KDAACgCACIDBEBBmKTAACEAA0AgAyAAKAIAIgFPBEAgASAAKAIEaiADSw0DCyAAKAIIIgANAAsLQQAQBCIBQX9GDQUgAiEGQbSkwAAoAgAiA0EBayIAIAFxBEAgAiABayAAIAFqQQAgA2txaiEGCyAGIAdNDQUgBkH+////B0sNBUGQpMAAKAIAIgQEQEGIpMAAKAIAIgMgBmoiACADTQ0GIAAgBEsNBgsgBhAEIgAgAUcNAQwHCyAGIAhrIAVxIgZB/v///wdLDQQgBhAEIgEgACgCACAAKAIEakYNAyABIQALAkAgAEF/Rg0AIAdBMGogBk0NAEG4pMAAKAIAIgEgCSAGa2pBACABa3EiAUH+////B0sEQCAAIQEMBwsgARAEQX9HBEAgASAGaiEGIAAhAQwHC0EAIAZrEAQaDAQLIAAiAUF/Rw0FDAMLQQAhBAwHC0EAIQEMBQsgAUF/Rw0CC0GUpMAAQZSkwAAoAgBBBHI2AgALIAJB/v///wdLDQEgAhAEIQFBABAEIQAgAUF/Rg0BIABBf0YNASAAIAFNDQEgACABayIGIAdBKGpNDQELQYikwABBiKTAACgCACAGaiIANgIAQYykwAAoAgAgAEkEQEGMpMAAIAA2AgALAkACQAJAQfCgwAAoAgAiBQRAQZikwAAhAANAIAEgACgCACIDIAAoAgQiAmpGDQIgACgCCCIADQALDAILQeigwAAoAgAiAEEAIAAgAU0bRQRAQeigwAAgATYCAAtBACEAQZykwAAgBjYCAEGYpMAAIAE2AgBB+KDAAEF/NgIAQfygwABBsKTAACgCADYCAEGkpMAAQQA2AgADQCAAQQN0IgNBiKHAAGogA0GAocAAaiICNgIAIANBjKHAAGogAjYCACAAQQFqIgBBIEcNAAtB5KDAACAGQShrIgNBeCABa0EHcUEAIAFBCGpBB3EbIgBrIgI2AgBB8KDAACAAIAFqIgA2AgAgACACQQFyNgIEIAEgA2pBKDYCBEH0oMAAQcCkwAAoAgA2AgAMAgsgAC0ADEEIcQ0AIAMgBUsNACABIAVNDQAgACACIAZqNgIEQfCgwAAgBUF4IAVrQQdxQQAgBUEIakEHcRsiAGoiAjYCAEHkoMAAQeSgwAAoAgAgBmoiASAAayIANgIAIAIgAEEBcjYCBCABIAVqQSg2AgRB9KDAAEHApMAAKAIANgIADAELQeigwAAoAgAgAUsEQEHooMAAIAE2AgALIAEgBmohAkGYpMAAIQACQAJAAkACQAJAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQZikwAAhAANAIAUgACgCACICTwRAIAIgACgCBGoiBCAFSw0DCyAAKAIIIQAMAAsACyAAIAE2AgAgACAAKAIEIAZqNgIEIAFBeCABa0EHcUEAIAFBCGpBB3EbaiIJIAdBA3I2AgQgAkF4IAJrQQdxQQAgAkEIakEHcRtqIgYgByAJaiIIayECIAUgBkYEQEHwoMAAIAg2AgBB5KDAAEHkoMAAKAIAIAJqIgA2AgAgCCAAQQFyNgIEDAMLIAZB7KDAACgCAEYEQEHsoMAAIAg2AgBB4KDAAEHgoMAAKAIAIAJqIgA2AgAgCCAAQQFyNgIEIAAgCGogADYCAAwDCyAGKAIEIgBBA3FBAUYEQCAAQXhxIQUCQCAAQf8BTQRAIAYoAggiAyAAQQN2IgBBA3RBgKHAAGpGGiADIAYoAgwiAUYEQEHYoMAAQdigwAAoAgBBfiAAd3E2AgAMAgsgAyABNgIMIAEgAzYCCAwBCyAGKAIYIQcCQCAGIAYoAgwiAUcEQCAGKAIIIgAgATYCDCABIAA2AggMAQsCQCAGQRRqIgAoAgAiAw0AIAZBEGoiACgCACIDDQBBACEBDAELA0AgACEEIAMiAUEUaiIAKAIAIgMNACABQRBqIQAgASgCECIDDQALIARBADYCAAsgB0UNAAJAIAYgBigCHCIDQQJ0QYijwABqIgAoAgBGBEAgACABNgIAIAENAUHcoMAAQdygwAAoAgBBfiADd3E2AgAMAgsgB0EQQRQgBygCECAGRhtqIAE2AgAgAUUNAQsgASAHNgIYIAYoAhAiAARAIAEgADYCECAAIAE2AhgLIAYoAhQiAEUNACABIAA2AhQgACABNgIYCyAFIAZqIQYgAiAFaiECCyAGIAYoAgRBfnE2AgQgCCACQQFyNgIEIAIgCGogAjYCACACQf8BTQRAIAJBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAg2AgggACAINgIMIAggAjYCDCAIIAA2AggMAwtBHyEAIAJB////B00EQCACQQh2IgAgAEGA/j9qQRB2QQhxIgN0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgA3IgAHJrIgBBAXQgAiAAQRVqdkEBcXJBHGohAAsgCCAANgIcIAhCADcCECAAQQJ0QYijwABqIQQCQEHcoMAAKAIAIgNBASAAdCIBcUUEQEHcoMAAIAEgA3I2AgAgBCAINgIAIAggBDYCGAwBCyACQQBBGSAAQQF2ayAAQR9GG3QhACAEKAIAIQEDQCABIgMoAgRBeHEgAkYNAyAAQR12IQEgAEEBdCEAIAMgAUEEcWoiBCgCECIBDQALIAQgCDYCECAIIAM2AhgLIAggCDYCDCAIIAg2AggMAgtB5KDAACAGQShrIgNBeCABa0EHcUEAIAFBCGpBB3EbIgBrIgI2AgBB8KDAACAAIAFqIgA2AgAgACACQQFyNgIEIAEgA2pBKDYCBEH0oMAAQcCkwAAoAgA2AgAgBSAEQScgBGtBB3FBACAEQSdrQQdxG2pBL2siACAAIAVBEGpJGyICQRs2AgQgAkGgpMAAKQIANwIQIAJBmKTAACkCADcCCEGgpMAAIAJBCGo2AgBBnKTAACAGNgIAQZikwAAgATYCAEGkpMAAQQA2AgAgAkEYaiEAA0AgAEEHNgIEIABBCGohASAAQQRqIQAgASAESQ0ACyACIAVGDQMgAiACKAIEQX5xNgIEIAUgAiAFayIEQQFyNgIEIAIgBDYCACAEQf8BTQRAIARBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAU2AgggACAFNgIMIAUgAjYCDCAFIAA2AggMBAtBHyEAIAVCADcCECAEQf///wdNBEAgBEEIdiIAIABBgP4/akEQdkEIcSICdCIAIABBgOAfakEQdkEEcSIBdCIAIABBgIAPakEQdkECcSIAdEEPdiABIAJyIAByayIAQQF0IAQgAEEVanZBAXFyQRxqIQALIAUgADYCHCAAQQJ0QYijwABqIQMCQEHcoMAAKAIAIgJBASAAdCIBcUUEQEHcoMAAIAEgAnI2AgAgAyAFNgIAIAUgAzYCGAwBCyAEQQBBGSAAQQF2ayAAQR9GG3QhACADKAIAIQEDQCABIgIoAgRBeHEgBEYNBCAAQR12IQEgAEEBdCEAIAIgAUEEcWoiAygCECIBDQALIAMgBTYCECAFIAI2AhgLIAUgBTYCDCAFIAU2AggMAwsgAygCCCIAIAg2AgwgAyAINgIIIAhBADYCGCAIIAM2AgwgCCAANgIICyAJQQhqIQAMBQsgAigCCCIAIAU2AgwgAiAFNgIIIAVBADYCGCAFIAI2AgwgBSAANgIIC0HkoMAAKAIAIgAgB00NAEHkoMAAIAAgB2siATYCAEHwoMAAQfCgwAAoAgAiAiAHaiIANgIAIAAgAUEBcjYCBCACIAdBA3I2AgQgAkEIaiEADAMLQdSgwABBMDYCAEEAIQAMAgsCQCAGRQ0AAkAgBCgCHCICQQJ0QYijwABqIgAoAgAgBEYEQCAAIAE2AgAgAQ0BQdygwAAgCUF+IAJ3cSIJNgIADAILIAZBEEEUIAYoAhAgBEYbaiABNgIAIAFFDQELIAEgBjYCGCAEKAIQIgAEQCABIAA2AhAgACABNgIYCyAEKAIUIgBFDQAgASAANgIUIAAgATYCGAsCQCADQQ9NBEAgBCADIAdqIgBBA3I2AgQgACAEaiIAIAAoAgRBAXI2AgQMAQsgBCAHQQNyNgIEIAQgB2oiBSADQQFyNgIEIAMgBWogAzYCACADQf8BTQRAIANBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAU2AgggACAFNgIMIAUgAjYCDCAFIAA2AggMAQtBHyEAIANB////B00EQCADQQh2IgAgAEGA/j9qQRB2QQhxIgJ0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgAnIgAHJrIgBBAXQgAyAAQRVqdkEBcXJBHGohAAsgBSAANgIcIAVCADcCECAAQQJ0QYijwABqIQECQAJAIAlBASAAdCICcUUEQEHcoMAAIAIgCXI2AgAgASAFNgIADAELIANBAEEZIABBAXZrIABBH0YbdCEAIAEoAgAhBwNAIAciASgCBEF4cSADRg0CIABBHXYhAiAAQQF0IQAgASACQQRxaiICKAIQIgcNAAsgAiAFNgIQCyAFIAE2AhggBSAFNgIMIAUgBTYCCAwBCyABKAIIIgAgBTYCDCABIAU2AgggBUEANgIYIAUgATYCDCAFIAA2AggLIARBCGohAAwBCwJAIAhFDQACQCABKAIcIgJBAnRBiKPAAGoiACgCACABRgRAIAAgBDYCACAEDQFB3KDAACAJQX4gAndxNgIADAILIAhBEEEUIAgoAhAgAUYbaiAENgIAIARFDQELIAQgCDYCGCABKAIQIgAEQCAEIAA2AhAgACAENgIYCyABKAIUIgBFDQAgBCAANgIUIAAgBDYCGAsCQCADQQ9NBEAgASADIAdqIgBBA3I2AgQgACABaiIAIAAoAgRBAXI2AgQMAQsgASAHQQNyNgIEIAEgB2oiAiADQQFyNgIEIAIgA2ogAzYCACAKBEAgCkEDdiIAQQN0QYChwABqIQVB7KDAACgCACEEAn9BASAAdCIAIAZxRQRAQdigwAAgACAGcjYCACAFDAELIAUoAggLIQAgBSAENgIIIAAgBDYCDCAEIAU2AgwgBCAANgIIC0HsoMAAIAI2AgBB4KDAACADNgIACyABQQhqIQALIAtBEGokACAAC9YCAQF/AkAgAUUNACAAQQA6AAAgACABaiICQQFrQQA6AAAgAUEDSQ0AIABBADoAAiAAQQA6AAEgAkEDa0EAOgAAIAJBAmtBADoAACABQQdJDQAgAEEAOgADIAJBBGtBADoAACABQQlJDQAgAEEAIABrQQNxIgJqIgBBADYCACAAIAEgAmtBfHEiAmoiAUEEa0EANgIAIAJBCUkNACAAQQA2AgggAEEANgIEIAFBCGtBADYCACABQQxrQQA2AgAgAkEZSQ0AIABBADYCGCAAQQA2AhQgAEEANgIQIABBADYCDCABQRBrQQA2AgAgAUEUa0EANgIAIAFBGGtBADYCACABQRxrQQA2AgAgAiAAQQRxQRhyIgJrIgFBIEkNACAAIAJqIQADQCAAQgA3AxggAEIANwMQIABCADcDCCAAQgA3AwAgAEEgaiEAIAFBIGsiAUEfSw0ACwsLAwABC7AEAQd/AkAgACgCACIGQYCAgAhPBEAgACgCBCEEDAELIAAgBkEIdCIGNgIAIAAgACgCECIDQQFqNgIQIAAgAyAAKAIMai0AACAAKAIEQQh0ciIENgIECwJ/IAEvAQAiBSAGQQt2bCIDIARLBEAgASAFQYAQIAVrQQV2ajsBACABIAJBBHRqQQRqIQhBAiEFQQgMAQsgACAEIANrIgQ2AgQgASAFIAVBBXZrOwEAIAYgA2siBkH///8HTQRAIAAgBkEIdCIGNgIAIAAgACgCECIDQQFqNgIQIAAgAyAAKAIMai0AACAEQQh0ciIENgIECyABLwECIgUgBkELdmwiAyAESwRAIAEgBUGAECAFa0EFdmo7AQIgASACQQR0akGEAmohCEEKIQVBCAwBCyAAIAQgA2siBDYCBCABIAUgBUEFdms7AQIgAUGEBGohCCAGIANrIQNBEiEFQYACCyEGIAAgBTYCaEEBIQEDQCAIIAFBAXQiAWohCQJAIANB////B0sEQCADIQIMAQsgACADQQh0IgI2AgAgACAAKAIQIgNBAWo2AhAgACADIAAoAgxqLQAAIARBCHRyIgQ2AgQLAkAgCS8BACIHIAJBC3ZsIgMgBE0EQCAAIAQgA2siBDYCBCAAIAIgA2siAzYCACAJIAcgB0EFdms7AQAgAUEBciEBDAELIAAgAzYCACAJIAdBgBAgB2tBBXZqOwEACyABIAZJDQALIAAgASAGayAFajYCaAvIHwEQfwJAIAAoAigiASAAKAIgIglNDQAgACgCaCICRQ0AIAAoAlQiAyAAKAIkTw0AIAAoAjAgA00NACAAIAIgASAJayIBIAIgASACSRsiBms2AmggCSADQX9zaiEEIAMgCU8EQCAAKAIsIARqIQQLIAAoAhgiAyAEai0AACEBIAAgCUEBajYCICADIAlqIAE6AAACQCAGQQFrIgdFDQAgB0EBcQRAIAAoAhgiAkEAIARBAWoiASABIAAoAixGGyIEai0AACEDIAAgACgCICIBQQFqNgIgIAEgAmogAzoAACAGQQJrIQcLIAZBAkYNAANAIAAoAhgiAkEAIARBAWoiASABIAAoAixGGyIGai0AACEDIAAgACgCICIBQQFqNgIgIAEgAmogAzoAACAAKAIYIgJBACAGQQFqIgEgASAAKAIsRhsiBGotAAAhAyAAIAAoAiAiAUEBajYCICABIAJqIAM6AAAgB0ECayIHDQALCyAAKAIgIgkgACgCJE0NACAAIAk2AiQLAkACQCAJIAAoAihPDQAgAEHcDWohDiAAQeAVaiEPIABB1ABqIRADQCAAKAIQIgMgACgCFEsNASAAIAAoAmQiCkEFdGogACgCdCAJcSIIQQF0aiIMIQYCQCAAKAIAIgVBgICACE8EQCAAKAIEIQQMAQsgACAFQQh0IgU2AgAgACADQQFqIgE2AhAgACAAKAIMIANqLQAAIAAoAgRBCHRyIgQ2AgQgASEDCwJAIAYvAXgiASAFQQt2bCICIARLBEAgACACNgIAIAYgAUGAECABa0EFdmo7AXggCUEBayEFIAlFBEAgACgCLCAFaiEFCyAAKAJwIAlxIAAoAmwiAXQgACgCJCIGBH8gACgCGCAFai0AAAVBAAtBCCABa3ZqIQ1BASEFAkAgCkEGTQRAA0AgBUEBdCIFIAAgDUGADGxqakHkHWohBgJAIAJB////B0sEQCACIQEMAQsgACACQQh0IgE2AgAgACADQQFqIgI2AhAgACAAKAIMIANqLQAAIARBCHRyIgQ2AgQgAiEDCwJAIAYvAQAiCCABQQt2bCICIARNBEAgACAEIAJrIgQ2AgQgACABIAJrIgI2AgAgBiAIIAhBBXZrOwEAIAVBAXIhBQwBCyAAIAI2AgAgBiAIQYAQIAhrQQV2ajsBAAsgBUGAAkkNAAwCCwALIAkgACgCVCIBQX9zaiEFIAEgCU8EQCAAKAIsIAVqIQULIAYEfyAAKAIYIAVqLQAABUEACyEGQQEhBUGAAiEHA0AgACANQYAMbGogBkEBdCIGIAdxIgwgB2ogBWpBAXRqQeQdaiELAkAgAkH///8HSwRAIAIhCAwBCyAAIAJBCHQiCDYCACAAIANBAWoiATYCECAAIAAoAgwgA2otAAAgBEEIdHIiBDYCBCABIQMLIAsCfyAEIAsvAQAiASAIQQt2bCICTyIKRQRAIAAgAjYCACABQYAQIAFrQQV2agwBCyAAIAQgAmsiBDYCBCAAIAggAmsiAjYCAEEAIQcgASABQQV2aws7AQAgByAMcyEHIAVBAXQgCnIiBUGAAkkNAAsLIAAgCUEBajYCICAAKAIYIAlqIAU6AAAgACgCICIJIAAoAiRLBEAgACAJNgIkC0EAIQIgACAAKAJkIgFBBE8EfyABQQlNBEAgACABQQNrNgJkDAMLIAFBBmsFQQALNgJkDAELIAAgBCACayIENgIEIAAgBSACayICNgIAIAYgASABQQV2azsBeCAAIApBAXRqIgshBgJAIAJB////B0sEQCADIQEMAQsgACACQQh0IgI2AgAgACADQQFqIgE2AhAgACAAKAIMIANqLQAAIARBCHRyIgQ2AgQLAkAgBi8B+AMiCiACQQt2bCIDIARNBEAgACAEIANrIgQ2AgQgACACIANrIgI2AgAgBiAKIApBBXZrOwH4AwJAIAJB////B0sEQCABIQYMAQsgACACQQh0IgI2AgAgACABQQFqIgY2AhAgACAAKAIMIAFqLQAAIARBCHRyIgQ2AgQLAkAgCy8BkAQiASACQQt2bCIFIARLBEAgCyABQYAQIAFrQQV2ajsBkAQgBUH///8HTQRAIAAgBUEIdCIFNgIAIAAgBkEBajYCECAAIAAoAgwgBmotAAAgBEEIdHIiBDYCBAsgDC8B2AQiAyAFQQt2bCIBIARNBEAgACAEIAFrNgIEIAAgBSABazYCACAMIAMgA0EFdms7AdgEDAILIAAgATYCACAMIANBgBAgA2tBBXZqOwHYBCAAQQE2AmggAEEJQQsgACgCZEEHSRs2AmQMAwsgACAEIAVrIgQ2AgQgCyABIAFBBXZrOwGQBAJAIAIgBWsiAkH///8HSwRAIAYhAQwBCyAAIAJBCHQiAjYCACAAIAZBAWoiATYCECAAIAAoAgwgBmotAAAgBEEIdHIiBDYCBAsCQCALLwGoBCIGIAJBC3ZsIgMgBEsEQCAAIAM2AgAgCyAGQYAQIAZrQQV2ajsBqAQgACgCWCECDAELIAAgBCADayIENgIEIAsgBiAGQQV2azsBqAQgAiADayICQf///wdNBEAgACACQQh0IgI2AgAgACABQQFqNgIQIAAgACgCDCABai0AACAEQQh0ciIENgIECwJAIAsvAcAEIgMgAkELdmwiASAESwRAIAAgATYCACALIANBgBAgA2tBBXZqOwHABCAAKAJcIQIMAQsgACAEIAFrNgIEIAAgAiABazYCACALIAMgA0EFdms7AcAEIAAoAmAhAiAAIAAoAlw2AmALIAAgACgCWDYCXAsgACAAKAJUNgJYIAAgAjYCVAsgAEEIQQsgACgCZEEHSRs2AmQgACAPIAgQCQwBCyAAIAM2AgAgBiAKQYAQIAprQQV2ajsB+AMgACAAKAJcNgJgIAAgACkCVDcCWCAAQQdBCiAAKAJkQQdJGzYCZCAAIA4gCBAJIAAoAmgiAUECa0EDIAFBBkkbIQMgACgCACECQQEhBANAIARBAXQiBCAAIANBB3RqaiEGAkAgAkGAgIAITwRAIAAoAgQhBQwBCyAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgACgCBEEIdHIiBTYCBAsCQCAGLwHYByIIIAJBC3ZsIgEgBU0EQCAAIAUgAWsiBTYCBCAAIAIgAWsiAjYCACAGIAggCEEFdms7AdgHIARBAXIhBAwBCyAAIAE2AgAgBiAIQYAQIAhrQQV2ajsB2AcgASECCyAEQcAASQ0ACyAEQUBqIgNBA00EQCAAIAM2AlQMAQsgACAEQQFxQQJyIgc2AlQgA0EBdiEBIANBDU0EQCAAIAcgAUEBayIKdCIINgJUQQEhByAQIAhBAXRqQQAgBGtBAXRqQYIMaiEGQQAhCwNAIAYgB0EBdCIHaiEMAkAgAkH///8HSwRAIAIhAQwBCyAAIAJBCHQiATYCACAAIAAoAhAiA0EBajYCECAAIAMgACgCDGotAAAgBUEIdHIiBTYCBAsCQCAMLwEAIgMgAUELdmwiAiAFTQRAIAAgBSACayIFNgIEIAAgASACayICNgIAIAwgAyADQQV2azsBACAAQQEgC3QgCGoiCDYCVCAHQQFyIQcMAQsgACACNgIAIAwgA0GAECADa0EFdmo7AQALIAtBAWoiCyAKRw0ACwwBCyABQQVrIQQDQAJAIAJB////B0sEQCACIQMMAQsgACACQQh0IgM2AgAgACAAKAIQIgFBAWo2AhAgASAAKAIMai0AACAFQQh0ciEFCyAAIANBAXYiAjYCACAAIAUgAmsiBkEfdSIBIAdBAXRqQQFqIgc2AlQgACABIAJxIAZqIgU2AgQgBEEBayIEDQALIAAgB0EEdCIHNgJUIANB////D00EQCAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsgAAJ/IAAvAb4NIgEgAkELdmwiBCAFTQRAIAAgBSAEayIFNgIEIAAgB0EBciIHNgJUIAAgASABQQV2azsBvg0gAiAEayEEQQMMAQsgACABQYAQIAFrQQV2ajsBvg1BAgtBAXQiA2pBvA1qIQYgBEH///8HTQRAIAAgBEEIdCIENgIAIAAgACgCECIBQQFqNgIQIAAgASAAKAIMai0AACAFQQh0ciIFNgIECwJAIAYvAQAiASAEQQt2bCICIAVNBEAgACAFIAJrIgU2AgQgBiABIAFBBXZrOwEAIAAgB0ECaiIHNgJUIAQgAmshAiADQQFyIQMMAQsgBiABQYAQIAFrQQV2ajsBAAsgACADQQF0IgNqQbwNaiEGIAJB////B00EQCAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsCQCAGLwEAIgEgAkELdmwiBCAFTQRAIAAgBSAEayIFNgIEIAYgASABQQV2azsBACAAIAdBBGoiBzYCVCACIARrIQQgA0EBciEDDAELIAYgAUGAECABa0EFdmo7AQALIARB////B00EQCAAIARBCHQiBDYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsgACADQQF0akG8DWoiAS8BACICIARBC3ZsIgMgBU0EQCAAIAUgA2s2AgQgACAEIANrNgIAIAEgAiACQQV2azsBACAAIAdBCGo2AlQMAQsgACADNgIAIAEgAkGAECACa0EFdmo7AQALQQAhAiAAKAJUIgYgACgCJE8NAyAAKAIwIAZNDQMgACAAKAJoIgMgACgCKCAAKAIgIgprIgEgAyABIANJGyIIazYCaCAKIAZBf3NqIQIgBiAKTwRAIAAoAiwgAmohAgsgACgCGCIDIAJqLQAAIQEgACAKQQFqNgIgIAMgCmogAToAAAJAIAhBAWsiBUUNACAFQQFxBEAgACgCGCIGQQAgAkEBaiIBIAEgACgCLEYbIgJqLQAAIQMgACAAKAIgIgFBAWo2AiAgASAGaiADOgAAIAhBAmshBQsgCEECRg0AA0AgACgCGCIGQQAgAkEBaiIBIAEgACgCLEYbIgJqLQAAIQMgACAAKAIgIgFBAWo2AiAgASAGaiADOgAAIAAoAhgiBkEAIAJBAWoiASABIAAoAixGGyICai0AACEDIAAgACgCICIBQQFqNgIgIAEgBmogAzoAACAFQQJrIgUNAAsLIAAoAiAiCSAAKAIkTQ0AIAAgCTYCJAsgCSAAKAIoSQ0ACwtBASECIAAoAgAiAUH///8HSw0AIAAgAUEIdDYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgACgCBEEIdHI2AgQLIAILJgEBfyAABEAgACgCsAkiASgCPARAIAEoAhgQBQsgARAFIAAQBQsLMgEBfyAAIAApA4ABIAIgACgCECICayIDrXw3A4ABIAAgASACaiADIAAoAhgQA603AxgLgQEBAn8CQAJAIAJBBE8EQCAAIAFyQQNxDQEDQCAAKAIAIAEoAgBHDQIgAUEEaiEBIABBBGohACACQQRrIgJBA0sNAAsLIAJFDQELA0AgAC0AACIDIAEtAAAiBEYEQCABQQFqIQEgAEEBaiEAIAJBAWsiAg0BDAILCyADIARrDwtBAAsJAEG8oCAoAgALCQBBsKAgKAIAC9QzAhR/An4CQAJAAkACQAJAAkACQAJAAn8Cf0HQoMAAKAIAIgEoAiQEQCABKAIADAELIAFBADoAKCABQgA3AwAgAUIANwMYIAFByABqQeQAEAcgAUEMNgKsAUEACyEAQcCgICgCACENIAFBtKAgKAIAIg42AhAgAUHgAGohDyABQbYBaiEQIAFBsAFqIREgAUGoAWohCANAAkACQAJAAkACQAJAAkACQAJAAkAgCAJ/AkACQAJAIAAOCgECAAoLDAQFBgcOC0GwoCAoAgAhAyABKAKsASECQbSgICgCACEAQbigICgCACEGIAEoAqgBDAILIAggASgCqAEiAGpBCGpBtKAgKAIAIgJBsKAgKAIAakG4oCAoAgAgAmsiAiABKAKsASAAayIAIAAgAksbIgAQAkG0oCBBtKAgKAIAIABqNgIAQQAhAyABQQAgASgCqAEgAGoiACAAIAEoAqwBIgJGGzYCqAEgACACRw0LIAFBATYCACARQYAIQQYQDQRAQQUhAwwMCyAQQQJBABADIAEoALgBRwRAQQchAwwMC0EGIQMgEC0AAA0LIAEgAS0AtwEiADYCICAAQQ9LDQtBAiEDIABBBEsNC0EBIAB0QRNxRQ0LC0G0oCAoAgAiAEG4oCAoAgAiBkYEQEEAIQMMCwtBsKAgKAIAIgMgAGotAAAiAkUEQEG0oCAgAEEBajYCACABIAA2AhBBBiEAIAFBBjYCAAwMCyABQQA2AqgBIAFBAjYCACABIAJBAnRBBGoiAjYCrAEgASACNgJAQQALIgVqQQhqIAAgA2ogBiAAayIAIAIgBWsiAiAAIAJJGyIAEAJBtKAgIABBtKAgKAIAajYCAEEAIQMgAUEAIAEoAqgBIABqIgAgACABKAKsASICRhs2AqgBIAAgAkcNCSABIABBBGsiADYCrAEgESAAQQAQAyABIAEoAqwBIgVqKACwAUcEQEEHIQMMCgsgAUECNgKoASABLACxASIEQT9xBEBBBiEDDAoLQQIhAEJ/IRVCfyEUIARBwABxRQ0FIAEoAgQiAkUEQCABQgA3AwgLIAVBAiAFQQJLGyEGA0AgACAGRgRAQQchAwwLCyAAIAhqLQAIIQMgASAAQQFqIgA2AqgBIAEgASkDCCADQf8Aca0gAq2GhCIUNwMIIANBgAFxRQRAAkAgAw0AIAJFDQBBByEDDAwLIAFBADYCBAwHC0EHIQMgASACQQdqIgI2AgQgAkE/Rw0ACwwJCwJ/IAFBkAFqIQYDQEG4oCAoAgAhAkGwoCAoAgAhBCABKAIEIgVFBEAgAUIANwMIC0G0oCAoAgAiACACIAAgAksbIQICQANAAkAgACACRgRAQQAhAyACIQAMAQsgACAEai0AACEDQbSgICAAQQFqIgA2AgAgASABKQMIIANB/wBxrSAFrYaEIhQ3AwggA0GAAXFFBEAgAw0DIAVFDQNBByEDDAELQQchAyABIAVBB2oiBTYCBCAFQT9HDQELCyABIAEpA4ABIAAgASgCECIAayICrXw3A4ABIAEgACAEaiACIAEoAhgQA603AxggAwwCCyABQQA2AgQCQAJAAkACQAJAIAEoAngOAwACAQMLIAEgFDcDiAFBByABKQNYIBRSDQUaIAFBATYCeAwDCyABIAEpA5gBIBR8NwOYASABIAZBGCABKAKgARADNgKgASABQQE2AnggASABKQOIAUIBfSIUNwOIAQwCCyABQQI2AnggASABKQOQASAUfDcDkAELIAEpA4gBIRQLIBRCAFINAAtBAQsiA0EBRw0IIAFBBzYCAAsCQCABKQOAASIUQbSgICgCACIAIAEoAhAiBGutfEIDg1ANAEGwoCAoAgAhBkG4oCAoAgAgAEYEQCAAIQIMBAtBtKAgIABBAWoiAjYCAEEHIQMgACAGai0AAA0IAkAgFCACIARrrXxCA4NQDQBBsKAgKAIAIQYgAkG4oCAoAgBGDQRBtKAgIABBAmoiBTYCACACIAZqLQAADQkgFCAFIARrrXxCA4NQBEAgBSEADAILQbCgICgCACEGQbigICgCACAFRgRAIAUhAgwFC0G0oCAgAEEDaiICNgIAIAUgBmotAAANCSAUIAIgBGutfEIDg1ANAEG4oCAoAgAgAkYEQEGwoCAoAgAhBgwFC0G0oCAgAEEEajYCAAwJCyACIQALIAFBsKAgKAIAIAAQDEEHIQMgDyABQZABakEYEA0NByABQQg2AgALAn9BtKAgKAIAIQBBuKAgKAIAIQUDQEEAIAAgBUYNARogASkDGCEUIAEoAgQhA0G0oCAgAEEBaiICNgIAQQdBsKAgKAIAIABqLQAAIBQgA62Ip0H/AXFHDQEaIAEgA0EIaiIDNgIEIAIhACADQSBJDQALIAFBADYCBCABQgA3AxhBAQsiA0EBRw0GIAFBCTYCACABQQw2AqwBC0EAIQMgASABKAKoASIAakGwAWpBtKAgKAIAIgJBsKAgKAIAakG4oCAoAgAgAmsiAiABKAKsASAAayIAIAAgAksbIgAQAkG0oCBBtKAgKAIAIABqNgIAIAFBACABKAKoASAAaiIAIAAgASgCrAFGIgAbNgKoASAARQ0FQQchAAJAIAEvALoBQdm0AUcNACABQbQBakEGQQAQAyABKACwAUcNACABNQC0ASABKQOAAUICiFINACABLQC4AQ0AQQFBByABKAIgIAEtALkBRhshAAsgACEDDAULIAEgBiACEAxBACEDDAQLIAEgFDcDMCAEQQBIBEAgASgCBCICRQRAIAFCADcDCAsgACAFIAAgBUsbIQQDQCAAIARGBEBBByEDDAYLIAAgCGotAAghAyABIABBAWoiADYCqAEgASABKQMIIANB/wBxrSACrYaEIhU3AwgCQCADQYABcUUEQCADDQEgAkUNAUEHIQMMBwtBByEDIAEgAkEHaiICNgIEIAJBP0cNAQwGCwsgAUEANgIECyABIBU3AzggBSAAa0ECSQRAQQchAwwECyABIABBAWoiAjYCqAEgACAIai0ACEEhRwRAQQYhAwwECyABIABBAmoiBDYCqAEgAiAIai0ACEEBRwRAQQYhAwwEC0EHIQMgBCAFRg0DIAEgAEEDajYCqAEgASgCsAkhAEEGIQICQCAEIAhqLQAIIgNBJ0sNACAAIANBAXFBAnIgA0EBdkELanQiBTYCMAJ/AkAgACgCPCIDRQ0AQQQhAiAFIAAoAjRLDQIgACAFNgIsIANBAkcNACAFIABBOGoiAygCAE0NACAAKAIYEAUgACAAKAIwEAYiAjYCGCACDQBBAwwBCyAAQQA2AkAgAEEBOgBQIABBADYCaCAAQeTdAWohA0EACyECIANBADYCAAsgAiIDDQMgASgCqAEiACABKAKsASICIAAgAksbIQMCQANAIAAgA0YNASABIABBAWoiAjYCqAEgACAIaiEFIAIhACAFLQAIRQ0AC0EGIQMMBAsgAUEANgKoASABQgA3A1AgAUIANwNIIAFBAzYCAAsgAUG0oCAoAgA2AhAgAUHAoCAoAgA2AhQCfyABKAKwCSIEQejdAWohBSAEQfgAaiEKIARB5N0BaiELA38gBCgCQCEDAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAQbSgICgCACIAQbigICgCACICTwRAIANBB0YNAUEADBELIAMOCQECAwQFBgcACQ8LIAQoAkwhAwwHC0EBIQZBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIgBFDQggAEEBRyAAQd8BTXFFBEAgBEGAAjsBUCAEKAI8RQRAIARBwKAgKAIAIgJBvKAgKAIAajYCGCAEQcSgICgCACACazYCLAsgBEIANwIcIARCADcCJAwLCyAELQBQRQ0KQQcMDgtBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIQAgBEECNgJAIAQgBCgCSCAAQQh0ajYCSAwMC0G0oCAgAEEBajYCAEGwoCAoAgAgAGotAAAhACAEQQM2AkAgBCAAIAQoAkhqQQFqNgJIDAsLQbSgICAAQQFqNgIAQbCgICgCACAAai0AACEAIARBBDYCQCAEIABBCHQ2AkwMCgtBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIQAgBCAEKAJENgJAIAQgACAEKAJMakEBajYCTAwJC0G0oCAgAEEBajYCAEEHIQZBsKAgKAIAIABqLQAAIgBB4AFLDQNBACEDIARBfyAAQS1JBH9BAAUgAEEtayIAIABB/wFxQS1uIgJBLWxrIQAgAkEBagt0QX9zNgJ0IABB/wFxQQlPBEAgAEEJayIAIABB/wFxQQluIgJBCWxrIQAgAkEBaiEDCyAEIAM2AnAgBCAAQf8BcSIANgJsIAAgA2pBBEsNAyAEQX8gA3RBf3M2AnBBACEAIARBADYCZCAEQgA3AlwgBEIANwJUA0AgCiAAQQF0IgJqQYAIOwEAIAogAkECcmpBgAg7AQAgAEECaiIAQbbuAEcNAAsgBEEGNgJAIARBBTYCCCAEQv////8PNwIAC0EHIAQoAkwiBkEFSQ0IGiAEKAIIIgMEQEG0oCAoAgAhAEG4oCAoAgAhBwNAQQAgACAHRg0KGiAEKAIEIQxBtKAgIABBAWoiAjYCAEGwoCAoAgAgAGotAAAhACAEIANBAWsiAzYCCCAEIAAgDEEIdHI2AgQgAiEAIAMNAAsLIARBBzYCQCAEIAZBBWsiAzYCTAsgBCAEKAIgIgBBxKAgKAIAQcCgICgCAGsiAiAEKAJIIgYgAiAGSRsiAmogBCgCLCIGIAYgAGsgAksbNgIoQbigICgCACIGQbSgICgCACICayEAAkACQCAEKALk3QEiB0UEQCADDQFBACEDCyAHIAtqQQRqQbCgICgCACACaiAAIAMgB2siAkEqIAdrIgMgAiADSRsiAiAAIAJJGyIAEAICfyAAIAQoAuTdASIDaiICIAQoAkxGBEAgAyALaiAAakEEakE/IAJrEAcgBCgC5N0BIABqDAELIAJBFE0EQCAEIAI2AuTdAUG0oCBBtKAgKAIAIABqNgIADAMLIAJBFWsLIQIgBEEANgIQIAQgBTYCDCAEIAI2AhRBByEGIAQQCkUNAyAEKAIQIgcgACAEKALk3QEiAmpLDQMgBCAEKAJMIAdrIgM2AkwgAiAHSwRAIAQgAiAHayIANgLk3QECQCAFIgIgByALakEEaiIDRg0AIAMgACACaiIHa0EAIABBAXRrTQRAIAIgAyAAEAIMAQsgAiADc0EDcSEGAkACQCACIANJBEAgBg0CIAJBA3FFDQEDQCAARQ0EIAIgAy0AADoAACADQQFqIQMgAEEBayEAIAJBAWoiAkEDcQ0ACwwBCwJAIAYNACAHQQNxBEADQCAARQ0FIAIgAEEBayIAaiIGIAAgA2otAAA6AAAgBkEDcQ0ACwsgAEEDTQ0AA0AgAiAAQQRrIgBqIAAgA2ooAgA2AgAgAEEDSw0ACwsgAEUNAgNAIAIgAEEBayIAaiAAIANqLQAAOgAAIAANAAsMAgsgAEEDTQ0AA0AgAiADKAIANgIAIANBBGohAyACQQRqIQIgAEEEayIAQQNLDQALCyAARQ0AA0AgAiADLQAAOgAAIAJBAWohAiADQQFqIQMgAEEBayIADQALCwwCC0G0oCBBtKAgKAIAIAcgAmtqIgI2AgAgBEEANgLk3QFBuKAgKAIAIgYgAmshAAsgAEEVTwRAQbCgICgCACEHIAQgAjYCECAEIAc2AgwgBCAGQRVrIAIgA2ogACADQRVqSRs2AhRBByEGIAQQCkUNAyAEKAJMIgAgBCgCECICQbSgICgCAGsiA0kNAyAEIAAgA2siAzYCTEG0oCAgAjYCAEG4oCAoAgAgAmsiAEEUSw0BCyAFQbCgICgCACACaiADIAAgACADSxsiABACIAQgADYC5N0BQbSgIEG0oCAoAgAgAGo2AgALIAQoAiAiAiAEKAIcIgNrIQAgBCAEKAI8BH8gBCgCLCACRgRAIARBADYCIAtBvKAgKAIAQcCgICgCAGogBCgCGCADaiAAEAIgBCgCIAUgAgs2AhxBwKAgQcCgICgCACAAaiICNgIAIAQgBCgCSCAAayIANgJIIABFBEBBByEGIAQoAkwNAiAEKAJoDQIgBCgCBA0CIARBADYCQAwFC0EAIQYgAkHEoCAoAgBGDQFBtKAgKAIAQbigICgCAEcNBiAEKALk3QEgBCgCTE8NBgwBCyAEKAJMIgNFDQFBACEGIAAgAk8NAANAQcSgICgCACIHQcCgICgCACIMTQ0BIAQgAyADIAQoAiwgBCgCICISayITIAIgAGsiAiAHIAxrIgcgAiAHSRsiAiACIBNLGyICIAIgA0sbIgJrNgJMIBIgBCgCGGpBsKAgKAIAIABqIAIQAiAEIAQoAiAgAmoiADYCICAAIAQoAiRLBEAgBCAANgIkCyAEIAQoAjwEfyAEKAIsIABGBEAgBEEANgIgC0G8oCAoAgBBwKAgKAIAakGwoCAoAgBBtKAgKAIAaiACEAIgBCgCIAUgAAs2AhxBwKAgQcCgICgCACACajYCAEG0oCBBtKAgKAIAIAJqIgA2AgAgBCgCTCIDRQ0CQbigICgCACICIABLDQALCyAGDAULIARBADYCQAwDCyAAQRh0QRh1QQBODQEgBEEBNgJAIAQgAEEQdEGAgPwAcTYCSCAAQcABTwRAIARBBTYCRCAEQQA6AFEMAwtBByAELQBRDQMaIARBBjYCRCAAQaABSQ0CIARCADcCVEEAIQAgBEEANgJkIARCADcCXANAIAogAEEBdCICakGACDsBACAKIAJBAnJqQYAIOwEAIABBAmoiAEG27gBHDQALCyAEQQU2AgggBEL/////DzcCAAwBCyAAQQJLBH9BBwUgBEKDgICAgAE3AkAMAQsLCyEDIAEgASkDSEG0oCAoAgAgASgCEGutfCIUNwNIIAEgASkDUEHAoCAoAgAgASgCFCICayIArXwiFTcDUCABKQMwIBRUBEBBByEDDAMLIAEpAzggFVQEQEEHIQMMAwsCQCABAn4CQAJAIAEoAiBBAWsOBAADAwEDC0G8oCAoAgAgAmogACABKAIYEAOtDAELQbygICgCACACaiEFIAEpAxhCf4UhFAJAIABFDQAgAEEBcQR/IAUxAAAgFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUhFCAFQQFqIQUgAEEBawUgAAshAiAAQQFGDQADQCAFMQABIAUxAAAgFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUiFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUhFCAFQQJqIQUgAkECayICDQALCyAUQn+FCzcDGAsgA0EBRw0CAkAgASkDMCIUQn9RDQAgFCABKQNIUQ0AQQchAwwDCyABKQNQIRUCQCABKQM4IhRCf1EEQCAVIRQMAQtBByEDIBQgFVINAwsgASABKQNoIBR8NwNoIAEgASgCIEGQCGoxAAAgASkDYCABKQNIIAE1AkB8fHw3A2AgASAPQRggASgCcBADNgJwIAFBBDYCACABIAEpA1hCAXw3A1gLAkAgASkDSCIUQgODUA0AQQAhA0G0oCAoAgAiAEG4oCAoAgAiAkYNAkG0oCAgAEEBaiIFNgIAQbCgICgCACAAai0AAARAQQchAwwDCyABIBRCAXwiFTcDSCAVQgODUA0AIAIgBUYNAkG0oCAgAEECaiIENgIAQbCgICgCACAFai0AAARAQQchAwwDCyABIBRCAnwiFTcDSCAVQgODUA0AIAIgBEYNAkG0oCAgAEEDaiIFNgIAQbCgICgCACAEai0AAARAQQchAwwDCyABIBRCA3wiFTcDSCAVQgODUA0AIAIgBUYNAkG0oCAgAEEEajYCAEEHIQNBsKAgKAIAIAVqLQAADQIgASAUQgR8NwNICyABQQU2AgALAkACQAJAAkACQCABKAIgIgBBAWsOBAACAgECC0G0oCAoAgAhAEG4oCAoAgAhBQNAIAAgBUYEQEEAIQMMBgsgASkDGCEUIAEoAgQhA0G0oCAgAEEBaiICNgIAQbCgICgCACAAai0AACAUIAOtiKdB/wFxRwRAQQchAwwGCyABIANBCGoiAzYCBCACIQAgA0EgSQ0ACyABQgA3AxgMAgtBtKAgKAIAIQBBuKAgKAIAIQUDQCAAIAVGBEBBACEDDAULIAEpAxghFCABKAIEIQNBtKAgIABBAWoiAjYCAEGwoCAoAgAgAGotAAAgFCADrYinQf8BcUcEQEEHIQMMBQsgASADQQhqIgM2AgQgAiEAIANBwABJDQALIAFCADcDGAwBCyABKAIEIgIgAEGQCGotAAAiBU8NAEEAIQNBtKAgKAIAIgBBuKAgKAIAIgRGDQIDQAJAIABBAWohACACQQFqIgIgBUYNACAAIARHDQEMAwsLQbSgICAANgIACyABQQA2AgRBASEAIAFBATYCAAwCC0G0oCAgBDYCACABIAI2AgRBASEAIAIgBUkNACABQQE2AgAMAQsLAkAgASgCJEUEQAJAAkAgAw4CAAMBC0EHQQhBtKAgKAIAQbigICgCAEYbIQMLQcCgICANNgIAQbSgICAONgIAIAMMAgsCQCADDQAgDkG0oCAoAgBHDQAgDUHAoCAoAgBHDQAgAS0AKCEAIAFBAToAKCAAQQN0DAILIAFBADoAKAsgAwsOCQcGBwABAgMEBAULQQEhCQwFC0ECIQkMBAtBBCEJDAMLQQUhCQwCC0EGIQkMAQtBByEJC0HQoMAAKAIAEAsLIAkL9wQCA38DfkHAoCBCgICAgICAgAQ3AgBBvKAgQdCgIDYCAEG0oCBCADcCAEGwoCBBsCA2AgADQCAAQQJ0QbAIakEAQQBBAEEAIABBAXYiAUEBcWtBoIbi7X5xQQAgAEEBcWtBoIbi7X5xIAFzQQF2IgFzQQF2IgJBAXFrQaCG4u1+cUEAIAFBAXFrQaCG4u1+cSACc0EBdiIBc0EBdiICQQFxa0GghuLtfnFBACABQQFxa0GghuLtfnEgAnNBAXYiAXNBAXYiAkEBcWtBoIbi7X5xQQAgAUEBcWtBoIbi7X5xIAJzQQF2czYCACAAQQFqIgBBgAJHDQALA0AgBadBA3RBsBBqQgBCAEIAQgAgBUIBiCIDQgGDfULCnpy83fKVtkmDQgAgBUIBg31Cwp6cvN3ylbZJgyADhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiIU3AwAgBUIBfCIFQoACUg0AC0HQoMAAAn9BuAkQBiIABEAgAEECNgIkIABBqN4BEAYiAQR/IAFBgICABDYCNCABQQI2AjwgAUEANgIYIAFBADYCOCABBUEACyIBNgKwCSABBEAgAEEAOgAoIABCADcDACAAQgA3AxggAEHIAGpB5AAQByAAQQw2AqwBIAAMAgsgABAFC0EACyIANgIAIAAEf0EABUEAEAtBAQsLEAAjACAAa0FwcSIAJAAgAAsGACAAJAALBAAjAAsRAEG0oCAoAgBBuKAgKAIARgsJAEHAoCAoAgALFwBBxKAgIABBgIAgIABBgIAgSRs2AgALCwBBwKAgIAA2AgALFwBBuKAgIABBgIAgIABBgIAgSRs2AgALCwBBtKAgIAA2AgALCyoDAEGACAsF/Td6WFoAQZEICw8EBAQICAgQEBAgICBAQEAAQaAICwNQEmA=")||(F=N,N=a.locateFile?a.locateFile(F,f):f+F);var k=[];function Q(e){var t=k[e];return t||(e>=k.length&&(k.length=e+1),k[e]=t=w.get(e)),t}var W="function"==typeof atob?atob:function(e){var t,n,r,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");r=s.indexOf(e.charAt(c++)),t=(15&(i=s.indexOf(e.charAt(c++))))<<4|(a=s.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),l+=String.fromCharCode(r<<2|i>>4),64!==a&&(l+=String.fromCharCode(t)),64!==o&&(l+=String.fromCharCode(n)),c<e.length;);return l};function H(e){if(U(e))return function(e){if("boolean"==typeof p&&p){var t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var n=W(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}catch(e){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(O.length))}var Y,X={b:function(e,t,n){M.copyWithin(e,t,t+n)},a:function(e){var t=M.length;if(2147483648<(e>>>=0))return!1;for(var n,r=1;r<=4;r*=2){var i=t*(1+.2/r),i=Math.min(i,e+100663296);if(function(e){try{return v.grow(e-y.byteLength+65535>>>16),S(v.buffer),1}catch(e){}}(Math.min(2147483648,(0<(n=Math.max(e,i))%(i=65536)&&(n+=i-n%i),n))))return!0}return!1}},j=(function(){var t={a:X};function n(e,t){e=e.exports;a.asm=e,S((v=a.asm.c).buffer),w=a.asm.o,e=a.asm.d,T.unshift(e),B--,a.monitorRunDependencies&&a.monitorRunDependencies(B),0==B&&P&&(e=P,P=null,e())}function r(e){n(e.instance)}function i(e){return function(){if(!m&&(d||h)){if("function"==typeof fetch&&!z(N))return fetch(N,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+N+"'";return e.arrayBuffer()}).catch(function(){return V(N)});if(s)return new Promise(function(t,e){s(N,function(e){t(new Uint8Array(e))},e)})}return Promise.resolve().then(function(){return V(N)})}().then(function(e){return WebAssembly.instantiate(e,t)}).then(function(e){return e}).then(e,function(e){g("failed to asynchronously prepare wasm: "+e),D(e)})}if(B++,a.monitorRunDependencies&&a.monitorRunDependencies(B),a.instantiateWasm)try{return a.instantiateWasm(t,n)}catch(e){return g("Module.instantiateWasm callback failed with error: "+e)}(m||"function"!=typeof WebAssembly.instantiateStreaming||U(N)||z(N)||"function"!=typeof fetch?i(r):fetch(N,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(r,function(e){return g("wasm streaming compile failed: "+e),g("falling back to ArrayBuffer instantiation"),i(r)})})).catch(o)}(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.d).apply(null,arguments)},a._init_decompressor=function(){return(a._init_decompressor=a.asm.e).apply(null,arguments)},a._decompress=function(){return(a._decompress=a.asm.f).apply(null,arguments)},a._get_in_buffer_ptr=function(){return(a._get_in_buffer_ptr=a.asm.g).apply(null,arguments)},a._get_out_buffer_ptr=function(){return(a._get_out_buffer_ptr=a.asm.h).apply(null,arguments)},a._in_buffer_set_pos=function(){return(a._in_buffer_set_pos=a.asm.i).apply(null,arguments)},a._in_buffer_set_size=function(){return(a._in_buffer_set_size=a.asm.j).apply(null,arguments)},a._out_buffer_set_pos=function(){return(a._out_buffer_set_pos=a.asm.k).apply(null,arguments)},a._out_buffer_set_size=function(){return(a._out_buffer_set_size=a.asm.l).apply(null,arguments)},a._get_curr_output_length=function(){return(a._get_curr_output_length=a.asm.m).apply(null,arguments)},a._is_input_end_reached=function(){return(a._is_input_end_reached=a.asm.n).apply(null,arguments)},a.stackSave=function(){return(j=a.stackSave=a.asm.p).apply(null,arguments)}),K=a.stackRestore=function(){return(K=a.stackRestore=a.asm.q).apply(null,arguments)},q=a.stackAlloc=function(){return(q=a.stackAlloc=a.asm.r).apply(null,arguments)};function Z(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function J(e){function t(){Y||(Y=!0,a.calledRun=!0,A||(G(T),n(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),L()))}0<B||(R(),0<B||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),t()},1)):t()))}if(a.cwrap=function(e,t,n,r){var i=(n=n||[]).every(function(e){return"number"===e});return"string"!==t&&i&&!r?_(e):function(){return x(e,t,n,arguments)}},P=function e(){Y||J(),Y||(P=e)},a.run=J,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return J(),a.ready});const Yg=["","Memory allocation failed","Memory usage limit reached","Unsupported check; not verifying file integrity","Not an .xz file","Unsupported options in the .xz headers","File is corrupt","Unknown decompression bug"];class Xg{constructor(e){this.manager=void 0!==e?e:Td,this.crossOrigin="Anonymous",this.xz=null}init(){return this.xz?Promise.resolve():Hg().then(e=>{this._emInitDecompressor=e.cwrap("init_decompressor","number"),this._emDecompress=e.cwrap("decompress","number"),this._emGetInBufferPtr=e.cwrap("get_in_buffer_ptr","number"),this._emGetOutBufferPtr=e.cwrap("get_out_buffer_ptr","number"),this._emInBufferSetPos=e.cwrap("in_buffer_set_pos",null,["number"]),this._emInBufferSetSize=e.cwrap("in_buffer_set_size",null,["number"]),this._emOutBufferSetPos=e.cwrap("out_buffer_set_pos",null,["number"]),this._emOutBufferSetSize=e.cwrap("out_buffer_set_size",null,["number"]),this._emGetCurrOutputLength=e.cwrap("get_curr_output_length","number"),this._emIsInputEndReached=e.cwrap("is_input_end_reached","number"),this.xz=e})}load(n,r,i,a){void 0===n&&(n=""),void 0!==this.path&&(n=this.path+n);const o=this,e=wd.get(n);if(void 0!==e)return o.manager.itemStart(n),setTimeout(function(){r&&r(e),o.manager.itemEnd(n)},0),e;const s=this.init(),t=new XMLHttpRequest;return t.open("GET",n,!0),t.addEventListener("load",function(e){const t=e.target.response;200===this.status||0===this.status?(0===this.status&&console.warn("v3d.XZLoader: HTTP Status 0 received."),s.then(()=>{o.decompressArrayBuffer(t,function(e){setTimeout(function(){r&&r(e),o.manager.itemEnd(n),wd.add(n,e)},1)},function(e){i&&i((+e+2)/3)},function(e){a&&a(e),o.manager.itemEnd(n),o.manager.itemError(n)})})):(a&&a(e),o.manager.itemEnd(n),o.manager.itemError(n))},!1),i&&t.addEventListener("progress",function(e){let t;t=e.lengthComputable?e.loaded/e.total:1;e=2*t/3;i(e)},!1),t.addEventListener("error",function(e){a&&a(e),o.manager.itemEnd(n),o.manager.itemError(n)},!1),t.responseType="arraybuffer",t.send(null),o.manager.itemStart(n),t}setCrossOrigin(e){return this.crossOrigin=e,this}setPath(e){return this.path=e,this}decompressArrayBuffer(e,i,a,o){const s=this;function l(e){var t=s._emGetInBufferPtr();s.xz.HEAPU8.set(e,t),s._emInBufferSetPos(0),s._emInBufferSetSize(e.length),c()}function c(){s._emOutBufferSetPos(0)}var t=s._emInitDecompressor();if(0!=t)return console.error("XZLoader._emInitDecompressor: error code "+t+" ("+Yg[t]+")"),void(o&&o(t));const u=new Uint8Array(e),d=u.length,h=[];let p=0,f=Math.min(524288,d),m=0;l(u.subarray(p,f)),function e(){var n=s._emDecompress();if(n)console.error("XZLoader._emDecompress: error code "+n+" ("+Yg[n]+")"),o&&o(n);else{var t=s._emGetCurrOutputLength();if(h.push((n=t,t=s._emGetOutBufferPtr(),new Uint8Array(s.xz.HEAPU8.subarray(t,t+n)))),c(),s._emIsInputEndReached()&&(p=f,f=Math.min(f+524288,d),l(u.subarray(p,f))),a&&a(p/d),p==f){n=h.reduce(function(e,t,n,r){return e+t.length},0);const r=new Uint8Array(n);let t=0;h.forEach(function(e){r.set(e,t),t+=e.length}),i&&i(r.buffer)}else m++,m%2==0?setTimeout(e,1):e()}}()}}class jg extends Id{constructor(e){super(e),this.reversed=!1}load(e,t,n,r){var i=this,a=new Ld(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},n,r)}parse(e){return"undefined"==typeof opentype?(console.warn("v3d.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,t){for(var n=Math.round,r={},i=1e3/(e.unitsPerEm||2048),a=e.encoding.cmap.glyphIndexMap,o=Object.keys(a),s=0;s<o.length;s++){var l,c=o[s],u=e.glyphs.glyphs[a[c]];void 0!==c&&(l={ha:n(u.advanceWidth*i),x_min:n(u.xMin*i),x_max:n(u.xMax*i),o:""},t&&(u.path.commands=function(e){var t,n=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});var i=[];return n.forEach(function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};i.push(t);for(var n=e.length-1;0<n;n--){var r=e[n],t={type:r.type};void 0!==r.x2&&void 0!==r.y2?(t.x1=r.x2,t.y1=r.y2,t.x2=r.x1,t.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(t.x1=r.x1,t.y1=r.y1),t.x=e[n-1].x,t.y=e[n-1].y,i.push(t)}}),i}(u.path.commands)),u.path.commands.forEach(function(e){"c"===e.type.toLowerCase()&&(e.type="b"),l.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(l.o+=n(e.x*i)+" "+n(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(l.o+=n(e.x1*i)+" "+n(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(l.o+=n(e.x2*i)+" "+n(e.y2*i)+" ")}),r[String.fromCodePoint(u.unicode)]=l)}return{glyphs:r,familyName:e.getEnglishName("fullName"),ascender:n(e.tables.os2.sTypoAscender*i),descender:n(e.tables.os2.sTypoDescender*i),lineGap:e.tables.os2.sTypoLineGap*i,underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin*i,xMax:e.tables.head.xMax*i,yMin:e.tables.head.yMin*i,yMax:e.tables.head.yMax*i},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}}class Kg extends Fd{constructor(e){super(e),this.type=Xe}parse(r){const n=-1,m=1,i=2,g=3,v=4,A=function(e,t){switch(e){case m:console.error("v3d.RGBELoader Read Error: "+(t||""));break;case i:console.error("v3d.RGBELoader Write Error: "+(t||""));break;case g:console.error("v3d.RGBELoader Bad File Format: "+(t||""));break;default:case v:console.error("v3d.RGBELoader: Error: "+(t||""))}return n},l=1,c=2,u=4,d="\n",h=function(e,t,n){t=t||1024;let r=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;(i=s.indexOf(d))<0&&a<t&&r<e.byteLength;)o+=s,a+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=a+i+1),o+s.slice(0,i))};const e=new Uint8Array(r);e.pos=0;var a,o,s,p,f,_,x,y,b,M,C=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let o,s;if(e.pos>=e.byteLength||!(o=h(e)))return A(m,"no header found");if(!(s=o.match(/^#\?(\S+)/)))return A(g,"bad initial token");for(a.valid|=l,a.programtype=s[1],a.string+=o+"\n";;){if(o=h(e),!1===o)break;if(a.string+=o+"\n","#"!==o.charAt(0)){if((s=o.match(t))&&(a.gamma=parseFloat(s[1],10)),(s=o.match(n))&&(a.exposure=parseFloat(s[1],10)),(s=o.match(r))&&(a.valid|=c,a.format=s[1]),(s=o.match(i))&&(a.valid|=u,a.height=parseInt(s[1],10),a.width=parseInt(s[2],10)),a.valid&c&&a.valid&u)break}else a.comments+=o+"\n"}return a.valid&c?a.valid&u?a:A(g,"missing image size specifier"):A(g,"missing format specifier")}(e);if(n!==C){var S=C.width,r=C.height,w=function(e,t,n){var r=t;if(r<8||32767<r||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(r!==(e[2]<<8|e[3]))return A(g,"wrong scanline width");const i=new Uint8Array(4*t*n);if(!i.length)return A(v,"unable to allocate buffer space");let a=0,o=0;var s=4*r;const l=new Uint8Array(4),c=new Uint8Array(s);let u=n;for(;0<u&&o<e.byteLength;){if(o+4>e.byteLength)return A(m);if(l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=r)return A(g,"bad rgbe scanline format");let t=0,n;for(;t<s&&o<e.byteLength;){n=e[o++];var d=128<n;if(d&&(n-=128),0===n||t+n>s)return A(g,"bad scanline data");if(d){var h=e[o++];for(let e=0;e<n;e++)c[t++]=h}else c.set(e.subarray(o,o+n),t),t+=n,o+=n}var p=r;for(let e=0;e<p;e++){var f=0;i[a]=c[e+0],f+=r,i[a+1]=c[e+f],f+=r,i[a+2]=c[e+f],f+=r,i[a+3]=c[e+f],a+=4}u--}return i}(e.subarray(e.pos),S,r);if(n!==w){let e,t,n;switch(this.type){case Ye:n=w.length/4;var E=new Float32Array(4*n);for(let e=0;e<n;e++)_=w,x=4*e,y=E,b=4*e,M=void 0,M=_[x+3],M=Math.pow(2,M-128)/255,y[b+0]=_[x+0]*M,y[b+1]=_[x+1]*M,y[b+2]=_[x+2]*M,y[b+3]=1;e=E,t=Ye;break;case Xe:n=w.length/4;var T=new Uint16Array(4*n);for(let e=0;e<n;e++)a=w,o=4*e,s=T,p=4*e,f=void 0,f=a[o+3],f=Math.pow(2,f-128)/255,s[p+0]=Sp.toHalfFloat(Math.min(a[o+0]*f,65504)),s[p+1]=Sp.toHalfFloat(Math.min(a[o+1]*f,65504)),s[p+2]=Sp.toHalfFloat(Math.min(a[o+2]*f,65504)),s[p+3]=Sp.toHalfFloat(1);e=T,t=Xe;break;default:console.error("v3d.RGBELoader: unsupported type: ",this.type)}return{width:S,height:r,data:e,header:C.string,gamma:C.gamma,exposure:C.exposure,format:void 0,type:t}}}return null}setDataType(e){return this.type=e,this}load(e,n,t,r){return super.load(e,function(e,t){switch(e.type){case Ye:case Xe:e.encoding=pt,e.minFilter=Ge,e.magFilter=Ge,e.generateMipmaps=!1,e.flipY=!0}n&&n(e,t)},t,r)}}const qg=new In,Zg=new rr,Jg=new wn,$g=new wn,ev=new yn;class tv extends Tr{constructor(){super(),this.type="PlaneReflectionProbe",this.influenceDistance=1,this.falloff=.5,this.probeClipStart=.1,this.planeSize=new Yt(1,1),this.qualityFactor=.75,this.visibilityGroup=null,this.visibilityGroupInv=!1,this.reflectorPlane=new ki,this.normal=new wn,this.reflectorWorldPosition=new wn,this.cameraWorldPosition=new wn,this.rotationMatrix=new rr,this.lookAtPosition=new wn(0,0,-1),this.clipPlane=new yn,this.view=new wn,this.target=new wn,this.textureMatrix=new rr,this.virtualCamera=new Ni;var e={minFilter:Ge,magFilter:Ge,format:Ke,encoding:ft};this.renderTarget=new bn(1024,1024,e),this.matrixWorldInverse=new rr,this.boundingBox=new In}_calcLocalBounding(){var e=Jg.setScalar(0),t=$g.set(2*this.planeSize.x,2*this.influenceDistance/this.scale.y,2*this.planeSize.y);this.boundingBox.setFromCenterAndSize(e,t)}makeMultisampleRenderTarget(e){const t=this.renderTarget;t.samples=e,this.renderTarget=new Cn(t.width,t.height),this.renderTarget.copy(t),t.dispose()}setSize(e,t){this.renderTarget.setSize(this.qualityFactor*e,this.qualityFactor*t)}setEncoding(e){this.renderTarget.texture.encoding=e}intersectsMesh(e){let t=!1;const n=e.geometry,r=n.boundsTree,i=Zg;try{i.copy(e.matrixWorld).invert()}catch(e){return!1}return i.multiply(this.matrixWorld),qg.copy(this.boundingBox),t=r?r.intersectsBox(e,qg,i):(qg.applyMatrix4(i),null===n.boundingBox&&n.computeBoundingBox(),n.boundingBox.intersectsBox(qg)),t}update(e,t,n){const r={};e.traverse(e=>{!e.isPlaneReflectionProbe&&this._isVisible(e)||(r[e.id]=e.layers.mask,e.layers.disableAll())});const i=this.reflectorWorldPosition;i.setFromMatrixPosition(this.matrixWorld);const a=this.cameraWorldPosition;a.setFromMatrixPosition(t.matrixWorld);const o=this.rotationMatrix;o.extractRotation(this.matrixWorld);const s=this.normal;s.set(0,1,0),s.applyMatrix4(o);const l=this.view;if(l.subVectors(i,a),0<l.dot(s))e.traverse(e=>{!e.isPlaneReflectionProbe&&this._isVisible(e)||(e.layers.mask=r[e.id])});else{l.reflect(s).negate(),l.add(i),o.extractRotation(t.matrixWorld);const h=this.lookAtPosition;h.set(0,0,-1),h.applyMatrix4(o),h.add(a);const p=this.target;p.subVectors(i,h),p.reflect(s).negate(),p.add(i);const f=this.virtualCamera;f.position.copy(l),f.up.set(0,1,0),f.up.applyMatrix4(o),f.up.reflect(s),f.lookAt(p),f.far=t.far,f.updateMatrixWorld();const m=f.projectionMatrix;m.copy(t.projectionMatrix);const g=this.textureMatrix;g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiply(m),g.multiply(f.matrixWorldInverse);const v=this.reflectorPlane;v.setFromNormalAndCoplanarPoint(s,i),v.applyMatrix4(f.matrixWorldInverse);const A=this.clipPlane;A.set(v.normal.x,v.normal.y,v.normal.z,v.constant),ev.x=(Math.sign(A.x)+m.elements[8])/m.elements[0],ev.y=(Math.sign(A.y)+m.elements[9])/m.elements[5],ev.z=-1,ev.w=(1+m.elements[10])/m.elements[14],A.multiplyScalar(2/A.dot(ev)),m.elements[2]=A.x,m.elements[6]=A.y,m.elements[10]=A.z+1-this.probeClipStart,m.elements[14]=A.w;var c=n.getRenderTarget(),u=n.xr.enabled,d=n.shadowMap.autoUpdate;n.xr.enabled=!1,n.shadowMap.autoUpdate=!1,n.setRenderTarget(this.renderTarget),n.state.buffers.depth.setMask(!0),!1===n.autoClear&&n.clear(),n.render(e,f),n.xr.enabled=u,n.shadowMap.autoUpdate=d,n.setRenderTarget(c);t=t.viewport;void 0!==t&&n.state.viewport(t),e.traverse(e=>{!e.isPlaneReflectionProbe&&this._isVisible(e)||(e.layers.mask=r[e.id])}),this._calcLocalBounding()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}copy(e){return super.copy(e),this.influenceDistance=e.influenceDistance,this.probeClipStart=e.probeClipStart,this.visibilityGroup=e.visibilityGroup,this.visibilityGroupInv=e.visibilityGroupInv,this}dispose(){null!==this.renderTarget&&(this.renderTarget.dispose(),this.renderTarget=null),this.dispatchEvent({type:"dispose"})}_isVisible(e){return null===this.visibilityGroup||(!e.isMesh||-1!==e.groupNames.indexOf(this.visibilityGroup)^this.visibilityGroupInv)}}tv.prototype.isPlaneReflectionProbe=!0;class nv{static init(e,t){void 0!==e&&void 0!==t||console.error("RectAreaLightUniformsLib: Missing LTC data (required in Verge3D)");var n=new Float32Array(e),r=new Float32Array(t);qi.LTC_FLOAT_1=new Ol(n,64,64,Ke,Ye,o,ze,ze,Ge,Ve,1),qi.LTC_FLOAT_2=new Ol(r,64,64,Ke,Ye,o,ze,ze,Ge,Ve,1),qi.LTC_FLOAT_1.needsUpdate=!0,qi.LTC_FLOAT_2.needsUpdate=!0;const i=new Uint16Array(e.length);e.forEach(function(e,t){i[t]=Sp.toHalfFloat(e)});const a=new Uint16Array(t.length);t.forEach(function(e,t){a[t]=Sp.toHalfFloat(e)}),qi.LTC_HALF_1=new Ol(i,64,64,Ke,Xe,o,ze,ze,Ge,Ve,1),qi.LTC_HALF_2=new Ol(a,64,64,Ke,Xe,o,ze,ze,Ge,Ve,1),qi.LTC_HALF_1.needsUpdate=!0,qi.LTC_HALF_2.needsUpdate=!0}}class rv{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100,n="left",r="topBaseline",i=-1,a=!1){var o=[];const s=function(e,t,n,r,i,a,o){const s=String(e).split("\n"),l=[];for(let e=0;e<s.length;e++){var c=s[e];l[e]=Array.from?Array.from(c):String(c).split("")}let u=t/n.resolution;o&&(u*=(n.ascender-n.descender)/(n.boundingBox.yMax-n.boundingBox.yMin));n.lineGap=n.lineGap||0,-1===a?a=(n.ascender-n.descender+n.lineGap)*u:a*=t;const d=[];let h=0,p=0;var f=l.length,m=a*f,t=a*Math.abs(n.descender)/n.ascender,g=a-t;switch(i){case"topBaseline":p=0;break;case"top":p=-g;break;case"center":p=1<f?.5*m-g:-n.ascender/2*u;break;case"bottom":p=m-a-n.descender*u;break;case"bottomBaseline":p=m-a;break;default:p=0}for(let e=0;e<l.length;e++){var v=l[e];switch(r){case"left":h=0;break;case"center":h=-iv(v,u,n)/2;break;case"right":h=-iv(v,u,n);break;default:h=0}for(let e=0;e<v.length;e++){var A=function(e,u,d,h,t){const p=t.glyphs[e]||t.glyphs["?"];if(p){const m=new bp;let n,r,i,a,o,s,l,c;if(p.o){var f=p._cachedOutline||(p._cachedOutline=p.o.split(" "));for(let e=0,t=f.length;e<t;)switch(f[e++]){case"m":n=f[e++]*u+d,r=f[e++]*u+h,m.moveTo(n,r);break;case"l":n=f[e++]*u+d,r=f[e++]*u+h,m.lineTo(n,r);break;case"q":i=f[e++]*u+d,a=f[e++]*u+h,o=f[e++]*u+d,s=f[e++]*u+h,m.quadraticCurveTo(o,s,i,a);break;case"b":i=f[e++]*u+d,a=f[e++]*u+h,o=f[e++]*u+d,s=f[e++]*u+h,l=f[e++]*u+d,c=f[e++]*u+h,m.bezierCurveTo(o,s,l,c,i,a)}}return{offsetX:p.ha*u,path:m}}console.error('v3d.Font: character "'+e+'" does not exists in font family '+t.familyName+".")}(v[e],u,h,p,n);h+=A.offsetX,d.push(A.path)}p-=a}return d}(e,t,this.data,n,r,i,a);for(let e=0,t=s.length;e<t;e++)Array.prototype.push.apply(o,s[e].toShapes());return o}}function iv(e,t,n){let r=0;for(var i=0;i<e.length;i++){var a=e[i],a=n.glyphs[a]||n.glyphs["?"];r+=a.ha*t}return r}rv.prototype.isFont=!0;const av=new wn,ov=new wn;class sv extends Tr{constructor(){super(),this.type="ClippingPlaneObject",this.plane=new ki,this.clippingGroup=null,this.clipShadows=!1,this.negated=!1,this.clipIntersection=!1,this.crossSection=!1,this.crossSectionColor=new mn(16711680),this.crossSectionOpacity=1,this.crossSectionRenderSide=Ne,this.crossSectionSize=100,this._crossMatProfile="blender"}updatePlane(){this.updateWorldMatrix(!0,!1),this.getWorldPosition(av);var e=this.matrixWorld.elements;ov.set(e[4],e[5],e[6]).normalize(),this.plane.setFromNormalAndCoplanarPoint(ov,av),this.negated&&this.plane.negate()}updateMatrixWorld(e){Tr.prototype.updateMatrixWorld.call(this,e),this.updatePlane()}needsClippingPlane(e){return e.isMesh&&(0<=e.groupNames.indexOf(this.clippingGroup)||null===this.clippingGroup)&&!e.isAuxClippingMesh}assignToObject(n,r=0){var i=this.plane;const a=n.material;var o=n.geometry;if(a.clippingPlanes=a.clippingPlanes||[],-1==a.clippingPlanes.indexOf(i)&&a.clippingPlanes.push(i),a.clipShadows=this.clipShadows,a.clipIntersection=this.clipIntersection,this.crossSection){this.cleanupAuxMeshes(n);const c=new kr;c.depthWrite=!1,c.depthTest=!1,c.colorWrite=!1,c.stencilWrite=!0,c.stencilFunc=519,c.clipShadows=this.clipShadows,c.clipIntersection=this.clipIntersection;var s=!!n.isSkinnedMesh;const u=n.morphTargetInfluences;var l=$t(u)&&0<u.length;const d=c.clone();d.name="ClipCrossSectionStencilBack",d.side=Fe,d.clippingPlanes=[i],d.stencilFail=_t,d.stencilZFail=_t,d.stencilZPass=_t;let e;s?(e=new Nl(o,d),e.skeleton=n.skeleton):e=new Ei(o,d),e.renderOrder=r,e.name="ClipCrossSectionStencilBack",e.isAuxClippingMesh=!0,l&&(e.morphTargetInfluences=u.slice(),e.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),n.add(e);const h=c.clone();h.name="ClipCrossSectionStencilFront",h.side=Ne,h.clippingPlanes=[i],h.stencilFail=xt,h.stencilZFail=xt,h.stencilZPass=xt;let t;s?(t=new Nl(o,h),t.skeleton=n.skeleton):t=new Ei(o,h),t.renderOrder=r+.1,t.name="ClipCrossSectionStencilFront",t.isAuxClippingMesh=!0,l&&(t.morphTargetInfluences=u.slice(),t.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),n.add(t),a.isMeshNodeMaterial&&(this._crossMatProfile=a.profile)}}createCrossSectionPlane(e,t){this.cleanupAuxMeshes();const n=new dd({name:"ClipCrossSectionColor",nodeGraph:dd.nodeGraphDiffuse(this.crossSectionColor,this.crossSectionOpacity,this._crossMatProfile),profile:this._crossMatProfile,clippingPlanes:e.filter(e=>e!==this.plane),clipShadows:this.clipShadows,clipIntersection:this.clipIntersection,stencilWrite:!0,stencilRef:0,stencilFunc:517,stencilFail:7681,stencilZFail:7681,stencilZPass:7681,side:this.crossSectionRenderSide});this.crossSectionOpacity<1&&(n.transparent=!0,n.premultipliedAlpha=!0,n.blending=ce,n.blendEquation=ue,n.blendSrc=ge,n.blendDst=xe);const r=new ji(this.crossSectionSize,this.crossSectionSize);this.negated?r.rotateX(-Math.PI/2):r.rotateX(Math.PI/2);const i=new Ei(r,n);i.name="ClipCrossSectionColor",i.isAuxClippingMesh=!0,i.renderOrder=t,i.onAfterRender=function(e){e.clearStencil()},this.add(i)}cleanupAuxMeshes(t=null){if(t)for(let e=t.children.length-1;0<=e;e--){const n=t.children[e];n.isAuxClippingMesh&&n.material.clippingPlanes[0]==this.plane&&(n.geometry.dispose(),n.material.dispose(),t.remove(n))}else for(let e=this.children.length-1;0<=e;e--){const r=this.children[e];r.isAuxClippingMesh&&(r.geometry.dispose(),r.material.dispose(),this.remove(r))}}copy(e){return super.copy(e),this.plane=e.plane,this.clippingGroup=e.clippingGroup,this.clipShadows=e.clipShadows,this.negated=e.negated,this.clipIntersection=e.clipIntersection,this.crossSection=e.crossSection,this.crossSectionColor.copy(e.crossSectionColor),this.crossSectionOpacity=e.crossSectionOpacity,this.crossSectionRenderSide=e.crossSectionRenderSide,this.crossSectionSize=e.crossSectionSize,this._crossMatProfile=e._crossMatProfile,this}}sv.prototype.isClippingPlaneObject=!0;const lv={ORBIT:j0,FIRST_PERSON:W0,FLYING:Y0};class cv{constructor(e="ORBIT",t=!0,n=1,r=1){this.type=e,this.enablePan=t,this.enableKeys=!0,this.rotateSpeed=n,this.moveSpeed=r,this.orbitMinDistance=j0.minDistance,this.orbitMaxDistance=j0.maxDistance,this.orbitMinZoom=j0.minZoom,this.orbitMaxZoom=j0.maxZoom,this.orbitMinPolarAngle=j0.minPolarAngle,this.orbitMaxPolarAngle=j0.maxPolarAngle,this.orbitMinAzimuthAngle=j0.minAzimuthAngle,this.orbitMaxAzimuthAngle=j0.maxAzimuthAngle,this.orbitEnableTurnover=j0.enableTurnover,this.orbitTarget=null,this.collisionMaterial=null,this.gazeLevel=W0.gazeLevel,this.storyHeight=W0.storyHeight,this.enablePointerLock=!1}copy(e){return this.type=e.type,this.enablePan=e.enablePan,this.enableKeys=e.enableKeys,this.rotateSpeed=e.rotateSpeed,this.moveSpeed=e.moveSpeed,this.orbitMinDistance=e.orbitMinDistance,this.orbitMaxDistance=e.orbitMaxDistance,this.orbitMinZoom=e.orbitMinZoom,this.orbitMaxZoom=e.orbitMaxZoom,this.orbitMinPolarAngle=e.orbitMinPolarAngle,this.orbitMaxPolarAngle=e.orbitMaxPolarAngle,this.orbitMinAzimuthAngle=e.orbitMinAzimuthAngle,this.orbitMaxAzimuthAngle=e.orbitMaxAzimuthAngle,this.orbitEnableTurnover=e.orbitEnableTurnover,this.orbitTarget=e.orbitTarget,this.collisionMaterial=e.collisionMaterial,this.gazeLevel=e.gazeLevel,this.storyHeight=e.storyHeight,this.enablePointerLock=e.enablePointerLock,this}clone(){return(new this.constructor).copy(this)}assignToControls(n,e){var t=lv[this.type];switch(this.type){case"ORBIT":n.targetObj=this.orbitTarget,n.minDistance=this.orbitMinDistance,n.maxDistance=this.orbitMaxDistance,n.minZoom=this.orbitMinZoom,n.maxZoom=this.orbitMaxZoom,n.minPolarAngle=this.orbitMinPolarAngle,n.maxPolarAngle=this.orbitMaxPolarAngle,n.minAzimuthAngle=this.orbitMinAzimuthAngle,n.maxAzimuthAngle=this.orbitMaxAzimuthAngle,n.enableTurnover=this.orbitEnableTurnover;break;case"FLYING":n.panSpeedTouch=t.panSpeedTouch*this.moveSpeed,n.zoomSpeedKey=t.panSpeedTouch*this.moveSpeed;break;case"FIRST_PERSON":n.gazeLevel=this.gazeLevel,n.storyHeight=this.storyHeight,n.zoomSpeedKey=t.zoomSpeedKey*this.moveSpeed,n.enablePointerLock=this.enablePointerLock;const r=this;n.collisionMeshes=[],e.traverse(function(e){var t=e.material;t&&r.collisionMaterial&&t.name==r.collisionMaterial.name&&n.collisionMeshes.push(e)});break;default:return void console.error("ControlSettings: unsupported control type")}n.enablePan=this.enablePan,n.enableKeys=this.enableKeys,n.rotateSpeed=t.rotateSpeed*this.rotateSpeed,n.rotateSpeedTouch=t.rotateSpeedTouch*this.rotateSpeed,n.panSpeed=t.panSpeed*this.moveSpeed,n.panSpeedKey=t.panSpeedKey*this.moveSpeed,n.zoomSpeed=t.zoomSpeed*this.moveSpeed,n.zoomSpeedTouch=t.zoomSpeedTouch*this.moveSpeed}}const uv=["IMAGE_AR","SKYDOME_LIGHT_AR","TEXTURE_BL","TEX_IMAGE_BL","TEX_ENVIRONMENT_BL","BITMAP_MX","BITMAP_ENV_MX","TEX_ENVIRONMENT_MX","REFLECT_REFRACT_MX","FILE_MY","TEXTURE","TEX_IMAGE","TEX_ENVIRONMENT","TEX_ENVIRONMENT_MAX","BITMAP_MAX","BITMAP_ENV_MAX","REFLECT_REFRACT_MAX","AI_SKYDOME_LIGHT_MY","OSL_NODE"];class dv extends Id{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new gv(e)}),this.register(function(e){return new bv(e)}),this.register(function(e){return new Mv(e)}),this.register(function(e){return new vv(e)}),this.register(function(e){return new Av(e)}),this.register(function(e){return new _v(e)}),this.register(function(e){return new xv(e)}),this.register(function(e){return new yv(e)}),this.register(function(e){return new fv(e)}),this.register(function(e){return new Cv(e)}),this.register(function(e){return new Pv(e)}),this.register(function(e){return new Dv(e)}),this.register(function(e){return new Nv(e)}),this.register(function(e){return new Fv(e)}),this.register(function(e){return new Ov(e)}),this.register(function(e){return new Uv(e)}),this.register(function(e){return new zv(e)}),this.register(function(e){return new Vv(e)}),this.register(function(e){return new Gv(e)}),this.onProgress=null}load(e,t,n,r){const i=this;i.onProgress=n||function(){};let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:rh.extractUrlBase(e);const o=-1!=e.indexOf(".xz",e.length-3);let s;o?s=new Xg(i.manager):(s=new Ld(i.manager),s.setResponseType("arraybuffer"));const l=function(e){i.onProgress&&i.onProgress(.3*e*100)};let c=l;s instanceof Ld&&(c=function(e){e=e.lengthComputable?e.loaded/e.total:1;l(e)}),s.load(e,function(e){try{i.parse(e,a,t,r,o)}catch(e){void 0!==r&&r(e.constructor===Error?e:new Error("v3d.GLTFLoader: Unable to parse model."))}},c,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('v3d.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r,i){let a;const o={},s={};if("string"==typeof e)a=e;else if(rh.decodeText(new Uint8Array(e,0,4))===Sv){try{o[pv.KHR_BINARY_GLTF]=new Ev(e)}catch(e){return void(r&&r(e))}a=o[pv.KHR_BINARY_GLTF].content}else a=rh.decodeText(new Uint8Array(e));var l=JSON.parse(a);if(void 0===l.asset||l.asset.version[0]<2)r&&r(new Error("v3d.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{const d=this;!function(i){const t=["S8S_v3d_lights","S8S_v3d_light_probes","S8S_v3d_curves","S8S_v3d_clipping_planes"],e=i.extensionsUsed||[];e.includes("S8S_v3d_animation_data")&&(d1("S8S_v3d_animation_data","S8S_v3d_animation",e),(i.animations||[]).forEach(e=>{h1("S8S_v3d_animation_data","S8S_v3d_animation",e)}),p1("S8S_v3d_animation_data"));e.includes("S8S_v3d_node_data")&&(d1("S8S_v3d_node_data","S8S_v3d_node",e),(i.nodes||[]).forEach(e=>{h1("S8S_v3d_node_data",[].concat(["S8S_v3d_node"],t),e)}),p1("S8S_v3d_node_data"));e.includes("S8S_v3d_material_data")&&(d1("S8S_v3d_material_data","S8S_v3d_materials",e),(i.materials||[]).forEach(e=>{e.extensions&&e.extensions.S8S_v3d_material_data&&e.pbrMetallicRoughness?delete e.extensions.S8S_v3d_material_data:h1("S8S_v3d_material_data","S8S_v3d_materials",e)}),p1("S8S_v3d_material_data"));e.includes("S8S_v3d_mesh_data")&&(d1("S8S_v3d_mesh_data","S8S_v3d_mesh",e),(i.meshes||[]).forEach(e=>{h1("S8S_v3d_mesh_data","S8S_v3d_mesh",e)}),p1("S8S_v3d_mesh_data"));e.includes("S8S_v3d_camera_data")&&(d1("S8S_v3d_camera_data","S8S_v3d_camera",e),(i.cameras||[]).forEach(e=>{h1("S8S_v3d_camera_data","S8S_v3d_camera",e)}),p1("S8S_v3d_camera_data"));e.includes("S8S_v3d_scene_data")&&(d1("S8S_v3d_scene_data","S8S_v3d_scene",e),(i.scenes||[]).forEach(e=>{h1("S8S_v3d_scene_data","S8S_v3d_scene",e)}),p1("S8S_v3d_scene_data"));e.includes("S8S_v3d_texture_data")&&(d1("S8S_v3d_texture_data","S8S_v3d_texture",e),(i.textures||[]).forEach(e=>{h1("S8S_v3d_texture_data","S8S_v3d_texture",e)}),p1("S8S_v3d_texture_data"));e.includes("S8S_v3d_data")&&(d1("S8S_v3d_data",t,e),h1("S8S_v3d_data",[].concat(t,["S8S_v3d_materials"]),i),p1("S8S_v3d_data"));const n=i.textures||[];n.forEach(e=>{if($t(e.source)){var t=i.images[e.source];const n=t.uri||"";t=t.mimeType;if("hdr"==n.split(".").pop()||"image/vnd.radiance"==t||"xz"==n.split(".").pop()||"application/x-xz"==t){e.extensions=e.extensions||{};const r=e.extensions.S8S_v3d_texture||{};r.source=e.source,delete e.source,e.extensions.S8S_v3d_texture=r,console.warn("Placing HDR map to S8S_v3d_texture extension, please reexport your scene file")}}})}(l);const h=new l1(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder,loadBinXZ:i,onProgress:function(e){d.onProgress&&d.onProgress(e)}});for(let e=0;e<this.pluginCallbacks.length;e++){var c=this.pluginCallbacks[e](h);s[c.name]=c,o[c.name]=!0}if(l.extensionsUsed)for(let e=0;e<l.extensionsUsed.length;++e){var u=l.extensionsUsed[e];const p=l.extensionsRequired||[];switch(u){case pv.KHR_MATERIALS_UNLIT:o[u]=new mv;break;case pv.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new Lv;break;case pv.KHR_DRACO_MESH_COMPRESSION:o[u]=new Tv(l,this.dracoLoader);break;case pv.KHR_TEXTURE_TRANSFORM:o[u]=new Iv;break;case pv.KHR_MESH_QUANTIZATION:o[u]=new Bv;break;default:0<=p.indexOf(u)&&void 0===s[u]&&console.warn('v3d.GLTFLoader: Unknown extension "'+u+'".')}}h.setExtensions(o),h.setPlugins(s),h.parse(function(e){d.onProgress&&d.onProgress(100),n(e)},r)}}parseAsync(n,r){const i=this;return new Promise(function(e,t){i.parse(n,r,e,t)})}}function hv(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const pv={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",S8S_V3D_ANIMATION:"S8S_v3d_animation",S8S_V3D_CAMERA:"S8S_v3d_camera",S8S_V3D_MATERIALS:"S8S_v3d_materials",S8S_V3D_MESH:"S8S_v3d_mesh",S8S_V3D_NODE:"S8S_v3d_node",S8S_V3D_SCENE:"S8S_v3d_scene",S8S_V3D_TEXTURE:"S8S_v3d_texture",S8S_V3D_LIGHTS:"S8S_v3d_lights",S8S_V3D_LIGHT_PROBES:"S8S_v3d_light_probes",S8S_V3D_CURVES:"S8S_v3d_curves",S8S_V3D_CLIPPING_PLANES:"S8S_v3d_clipping_planes"};class fv{constructor(e){this.parser=e,this.name=pv.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var i=r[e];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&n._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser;var n="light:"+e;let r=t.cache.get(n);if(r)return r;var i=t.json;const a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let o;const s=new mn(16777215);void 0!==a.color&&s.fromArray(a.color);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":o=new qd(s),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new Yd(s),o.distance=l;break;case"spot":o=new Gd(s),o.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("v3d.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,void 0!==a.intensity&&(o.intensity=a.intensity),o.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(o),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser;e=n.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class mv{constructor(){this.name=pv.KHR_MATERIALS_UNLIT}getMaterialType(){return kr}extendParams(e,t,n){const r=[];e.color=new mn(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;return i&&(Array.isArray(i.baseColorFactor)&&(t=i.baseColorFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))),Promise.all(r)}}class gv{constructor(e){this.parser=e,this.name=pv.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Du:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];e=e.extensions[this.name];return void 0!==e.clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale&&(e=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Yt(e,e))),Promise.all(r)}}class vv{constructor(e){this.parser=e,this.name=pv.KHR_MATERIALS_SHEEN}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Du:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new mn(0,0,0),t.sheenRoughness=0,t.sheen=1;e=e.extensions[this.name];return void 0!==e.sheenColorFactor&&t.sheenColor.fromArray(e.sheenColorFactor),void 0!==e.sheenRoughnessFactor&&(t.sheenRoughness=e.sheenRoughnessFactor),void 0!==e.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",e.sheenColorTexture)),void 0!==e.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",e.sheenRoughnessTexture)),Promise.all(r)}}class Av{constructor(e){this.parser=e,this.name=pv.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Du:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];e=e.extensions[this.name];return void 0!==e.transmissionFactor&&(t.transmission=e.transmissionFactor),void 0!==e.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",e.transmissionTexture)),Promise.all(r)}}class _v{constructor(e){this.parser=e,this.name=pv.KHR_MATERIALS_VOLUME}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Du:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];e=e.extensions[this.name];t.thickness=void 0!==e.thicknessFactor?e.thicknessFactor:0,void 0!==e.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",e.thicknessTexture)),t.attenuationDistance=e.attenuationDistance||0;e=e.attenuationColor||[1,1,1];return t.attenuationColor=new mn(e[0],e[1],e[2]),Promise.all(r)}}class xv{constructor(e){this.parser=e,this.name=pv.KHR_MATERIALS_IOR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Du:null}extendMaterialParams(e,t){e=this.parser.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();e=e.extensions[this.name];return t.ior=void 0!==e.ior?e.ior:1.5,Promise.resolve()}}class yv{constructor(e){this.parser=e,this.name=pv.KHR_MATERIALS_SPECULAR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?Du:null}extendMaterialParams(e,t){const n=this.parser;var r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];e=r.extensions[this.name];t.specularIntensity=void 0!==e.specularFactor?e.specularFactor:1,void 0!==e.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",e.specularTexture));r=e.specularColorFactor||[1,1,1];return t.specularColor=new mn(r[0],r[1],r[2]),void 0!==e.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",e.specularColorTexture).then(function(e){e.encoding=ft})),Promise.all(i)}}class bv{constructor(e){this.parser=e,this.name=pv.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json;var r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],r=n.images[i.source],i=t.options.ktx2Loader;if(i)return t.loadTextureImage(e,r,i);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(this.name))throw new Error("v3d.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}}class Mv{constructor(e){this.parser=e,this.name=pv.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,r=this.parser,i=r.json;var e=i.textures[t];if(!e.extensions||!e.extensions[n])return null;e=e.extensions[n];const a=i.images[e.source];let o=r.textureLoader;return!a.uri||null!==(e=r.options.manager.getHandler(a.uri))&&(o=e),this.detectSupport().then(function(e){if(e)return r.loadTextureImage(t,a,o);if(i.extensionsRequired&&0<=i.extensionsRequired.indexOf(n))throw new Error("v3d.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Cv{constructor(e){this.name=pv.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json;e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){const o=e.extensions[this.name];e=this.parser.getDependency("buffer",o.buffer);const s=this.parser.options.meshoptDecoder;if(s&&s.supported)return Promise.all([e,s.ready]).then(function(e){var t=o.byteOffset||0,n=o.byteLength||0,r=o.count,i=o.byteStride,a=new ArrayBuffer(r*i),n=new Uint8Array(e[0],t,n);return s.decodeGltfBuffer(new Uint8Array(a),r,i,n,o.mode,o.filter),a});if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("v3d.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}const Sv="glTF",wv={JSON:1313821514,BIN:5130562};class Ev{constructor(e){this.name=pv.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:rh.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Sv)throw new Error("v3d.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("v3d.GLTFLoader: Legacy binary file detected.");var n=this.header.length-12;const r=new DataView(e,12);let i=0;for(;i<n;){var a=r.getUint32(i,!0);i+=4;var o,s=r.getUint32(i,!0);i+=4,s===wv.JSON?(o=new Uint8Array(e,12+i,a),this.content=rh.decodeText(o)):s===wv.BIN&&(s=12+i,this.body=e.slice(s,s+a)),i+=a}if(null===this.content)throw new Error("v3d.GLTFLoader: JSON content not found.")}}class Tv{constructor(e,t){if(!t)throw new Error("v3d.GLTFLoader: No DRACOLoader instance provided.");this.name=pv.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){var n=this.json;const r=this.dracoLoader;var i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes;const o={},s={},l={};for(const p in a){var c=Jv[p]||f1(p)||p.toLowerCase();o[c]=a[p]}for(const f in e.attributes){var u,d,h=Jv[f]||f1(f)||f.toLowerCase();void 0!==a[f]&&(u=n.accessors[e.attributes[f]],d=Yv[u.componentType],l[h]=d,s[h]=!0===u.normalized)}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(i){r.decodeDracoFile(e,function(e){for(const n in e.attributes){const r=e.attributes[n];var t=s[n];void 0!==t&&(r.normalized=t)}i(e)},o,l)})})}}class Iv{constructor(){this.name=pv.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('v3d.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Rv extends Pu{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","    uniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","    uniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","    vec4 texelSpecular = texture2D(specularMap, vUv);","    // reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","    specularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","    vec4 texelGlossiness = texture2D(glossinessMap, vUv);","    // reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","    glossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * (1. - max(specularFactor.r, max(specularFactor.g, specularFactor.b)));","vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));","float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);","material.roughness = max(1.0 - glossinessFactor, 0.0525); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min(material.roughness, 1.0);","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new mn).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(const t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){(s.specularMap.value=e)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){(s.glossinessMap.value=e)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Lv{constructor(){this.name=pv.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Rv}extendParams(e,t,n){var r=t.extensions[this.name];e.color=new mn(1,1,1),e.opacity=1;const i=[];return Array.isArray(r.diffuseFactor)&&(t=r.diffuseFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new mn(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new mn(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture&&(r=r.specularGlossinessTexture,i.push(n.assignTexture(e,"glossinessMap",r)),i.push(n.assignTexture(e,"specularMap",r))),Promise.all(i)}createMaterial(e){const t=new Rv(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class Bv{constructor(){this.name=pv.KHR_MESH_QUANTIZATION}}class Pv{constructor(e){this.parser=e,this.name=pv.S8S_V3D_LIGHTS,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var i=r[e];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&n._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;var i=t.json;const a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let o;var s=(new mn).fromArray(a.color),l=a.intensity;switch(a.type){case"point":o=new Yd(s,l);break;case"directional":o=new qd(s,l),$t(a.shadow)&&$t(a.shadow.csm)&&(o.shadow=new jd);break;case"spot":o=new Gd(s,l);break;case"area":o=new $d(s,l,a.width,a.height);break;case"hemisphere":o=new zd(s,new mn(0,0,0),l);break;case"ambient":o=new Zd(s,l)}$t(a.distance)&&(o.distance=a.distance),$t(a.decay)&&(o.decay=a.decay,"blender"==a.profile&&(o.userData.usePowerUnits=!0,o.power=o.intensity)),$t(a.angle)&&(o.angle=a.angle),$t(a.penumbra)&&(o.penumbra=a.penumbra),o.isRectAreaLight&&nv.init(a.ltcMat1,a.ltcMat2),$t(a.shadow)?($t(a.shadow.enabled)||(a.shadow.enabled=!0),o.castShadow=a.shadow.enabled,o.shadow.bias=a.shadow.bias,$t(a.shadow.expBias)&&(o.shadow.expBias=a.shadow.expBias),$t(a.shadow.slopeScaledBias)&&(o.shadow.slopeScaledBias=a.shadow.slopeScaledBias),o.shadow.radius=a.shadow.radius,o.shadow.mapSize.width=a.shadow.mapSize,o.shadow.mapSize.height=a.shadow.mapSize,o.shadow.camera.near=a.shadow.cameraNear,o.shadow.camera.far=a.shadow.cameraFar,o.isSpotLight?(o.shadow.camera.fov=Nt(a.shadow.cameraFov),o.shadow.useMinFov90="blender"===a.profile):o.isDirectionalLight&&($t(a.shadow.cameraOrthoLeft)&&$t(a.shadow.cameraOrthoRight)&&$t(a.shadow.cameraOrthoBottom)&&$t(a.shadow.cameraOrthoTop)&&(o.shadow.camera.left=a.shadow.cameraOrthoLeft,o.shadow.camera.right=a.shadow.cameraOrthoRight,o.shadow.camera.bottom=a.shadow.cameraOrthoBottom,o.shadow.camera.top=a.shadow.cameraOrthoTop),o.shadow.isDirectionalLightShadowCSM&&(o.shadow.maxDistance=a.shadow.csm.maxDistance)),o.shadow.camera.updateProjectionMatrix()):o.castShadow=!1,o.name=t.createUniqueName(a.name||"light_"+e);let c;return c=(o.isDirectionalLight||o.isSpotLight)&&$t(a.target)?(o.isFreeLight=!1,t.getDependency("node",a.target)):(o.isFreeLight=!0,Promise.resolve()),c.then(e=>(e&&(o.target=e),r=Promise.resolve(o),t.cache.add(n,r),r))}createNodeAttachment(e){const t=this,n=this.parser;e=n.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class Dv{constructor(e){this.parser=e,this.name=pv.S8S_V3D_LIGHT_PROBES,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var i=r[e];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].lightProbe&&n._addNodeRef(this.cache,i.extensions[this.name].lightProbe)}}_loadLightProbe(e){const t=this.parser;var n="lightProbe:"+e;let r=t.cache.get(n);if(r)return r;var i=t.json,i=((i.extensions&&i.extensions[this.name]||{}).lightProbes||[])[e];let a;if("CUBEMAP"==(i.type||"CUBEMAP")){switch(a=new kg,i.influenceType){case"ELIPSOID":a.influenceType=1;break;case"BOX":a.influenceType=2}switch(i.parallaxType){case"ELIPSOID":a.parallaxType=1;break;case"BOX":a.parallaxType=2}a.parallaxDistance=i.parallaxDistance,a.probeClipEnd=i.clipEnd,a.probeIntensity=i.intensity,$t(i.influenceGroup)&&(a.influenceGroup=i.influenceGroup),$t(i.influenceGroupInv)&&(a.influenceGroupInv=i.influenceGroupInv)}else a=new tv,a.falloff=i.falloff,$t(i.planeSize)&&a.planeSize.set(i.planeSize[0],i.planeSize[1]);return a.influenceDistance=i.influenceDistance,a.probeClipStart=i.clipStart,a.visibilityGroup=i.visibilityGroup,a.visibilityGroupInv=i.visibilityGroupInv,a.name=t.createUniqueName(i.name||"lightProbe_"+e),r=Promise.resolve(a),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser;e=n.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).lightProbe;return void 0===r?null:this._loadLightProbe(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class Nv{constructor(e){this.parser=e,this.name=pv.S8S_V3D_CURVES,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var i=r[e];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].curve&&n._addNodeRef(this.cache,i.extensions[this.name].curve)}}_loadOpenType(){return new Promise(function(e){sn("opentype.js",function(){e()},function(){console.error("GLTFLoader: opentype.js module not found, please copy it to your app directory"),e()})})}_loadFont(e){const r=this.parser,t="curve:"+e;let n=r.cache.get(t);if(n)return n;var i=r.json;const a=((i.extensions&&i.extensions[this.name]||{}).fonts||[])[e];let o=a.uri,s=!1;return void 0!==a.bufferView&&(o=r.getDependency("bufferView",a.bufferView).then(function(e){s=!0;e=new Blob([e],{type:a.mimeType});return o=URL.createObjectURL(e),o})),Promise.all([this._loadOpenType(),o]).then(function(e){if(o=e[1],"undefined"==typeof opentype)return null;const n=new jg;return n.setCrossOrigin(r.options.crossOrigin),new Promise(function(e,t){n.load(rh.resolveURL(o,r.options.path),e,void 0,t)}).then(function(e){return new rv(e)},function(e){return null})}).then(function(e){return!0===s&&URL.revokeObjectURL(o),n=Promise.resolve(e),r.cache.add(t,n),n})}_loadCurve(r){const i=this.parser,a="curve:"+r;let o=i.cache.get(a);if(o)return o;var e=i.json;const s=((e.extensions&&e.extensions[this.name]||{}).curves||[])[r];let l,c=s.type;const t=[];return t.push(this._loadFont(s.font)),void 0!==s.material?t.push(i.getDependency("material",s.material)):t.push(r1(i.cache)),Promise.all(t).then(function(e){var t=e[0],n=e[1];return null===t&&(c="empty"),l="font"===c?(e=0<s.bevelSize||0<s.bevelThickness,e=new Tu(s.text,{font:t,size:s.size,height:s.height,curveSegments:s.curveSegments,bevelEnabled:e,bevelThickness:s.bevelThickness,bevelSize:s.bevelSize,bevelSegments:s.bevelSegments,alignX:s.alignX,alignY:s.alignY,lineHeight:s.lineHeight,scaledEmSize:s.scaledEmSize}),new Ei(e,n)):new Tr,l.name=i.createUniqueName(s.name||"curve_"+r),o=Promise.resolve(l),i.cache.add(a,o),o})}createNodeAttachment(e){const t=this,n=this.parser;e=n.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).curve;return void 0===r?null:this._loadCurve(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class Fv{constructor(e){this.parser=e,this.name=pv.S8S_V3D_CLIPPING_PLANES,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var i=r[e];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].clippingPlane&&n._addNodeRef(this.cache,i.extensions[this.name].clippingPlane)}}_loadClippingPlane(e){const t=this.parser;var n="clippingPlane:"+e;let r=t.cache.get(n);if(r)return r;var i=t.json,i=((i.extensions&&i.extensions[this.name]||{}).clippingPlanes||[])[e];const a=new sv;return a.clippingGroup=i.clippingGroup,a.clipShadows=i.clipShadows,a.negated=i.negated,a.clipIntersection=i.clipIntersection,a.crossSection=i.crossSection,a.crossSectionColor=(new mn).fromArray(i.color),a.crossSectionOpacity=i.opacity,a.crossSectionSize=i.size,$t(i.renderSide)&&(a.crossSectionRenderSide=n1[i.renderSide]),a.name=t.createUniqueName(i.name||"clippingPlane_"+e),r=Promise.resolve(a),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser;e=n.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).clippingPlane;return void 0===r?null:this._loadClippingPlane(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class Ov{constructor(e){this.name=pv.S8S_V3D_SCENE,this.parser=e}beforeRoot(){const n=this.parser.json.asset.generator||"";if(-1<n.indexOf("Verge3D")&&"ALL"!=Mt){const e=[["Blender","BLENDER"],["3ds Max","MAX"],["Maya","MAYA"]];e.forEach(function(e){var t=e[0],e=e[1];-1<n.indexOf(t)&&Mt!=e&&console.warn("The glTF asset was exported from "+t+". It may not be fully compatible with Verge3D "+tn()+".")})}}afterRoot(c){const n=this.parser;var e=n.json;const u=e.scenes[e.scene||0],d=c.scene;e=$t(u.extensions)?u.extensions[pv.S8S_V3D_SCENE]:void 0;const r=[],h=[],p=[];let t;return t=u&&e&&e.worldMaterial?n.getDependency("material",e.worldMaterial):Promise.resolve(),t.then(e=>{const t={};e&&(t.material=e),c.world=t}).then(()=>(n.assignedMaterials.forEach(function(t){t.isMeshNodeMaterial&&t.traverseNodes(function(e){"TEX_COORD_BL"===e.originData.type&&$t(e.originData.object)&&-1<e.originData.object&&(r.push(n.getDependency("node",e.originData.object)),h.push(e),p.push(t))})}),Promise.all(r))).then(t=>{for(let e=0;e<t.length;e++){var n=t[e],r=h[e];const o=p[e];r=o.nodeTexCoordObjectMap[r.originData.name];o.nodeTexCoordObject[r]=n}const i=[];for(let e=0;e<c.cameras.length;e++){const s=c.cameras[e];let t=!1;s.traverseAncestors(function(e){e==d&&(t=!0)}),t&&i.push(s)}c.cameras=i;for(let e=0;e<c.animations.length;e++){const l=c.animations[e];l.clip&&void 0!==l.clip.name&&(l.clip.name=l.clip.name)}const e={};if(u){var a=$t(u.extensions)?u.extensions[pv.S8S_V3D_SCENE]:void 0;if(a){if($t(a.shadowMap)){switch(e.shadowMap={enabled:!0},a.shadowMap.type){case"BASIC":e.shadowMap.type=q;break;case"BILINEAR":e.shadowMap.type=re;break;case"PCF":e.shadowMap.type=Z;break;case"PCFSOFT":e.shadowMap.type=J;break;case"PCFPOISSON":e.shadowMap.type=ne;break;case"ESM":e.shadowMap.type=te}let n;n=a.shadowMap.renderSingleSided?a.shadowMap.renderReverseSided?Fe:Ne:Oe,d.traverse(function(e){const t=e.material;t&&(t.shadowSide=n)}),e.esmDistanceScale=a.shadowMap.esmDistanceScale}if($t(a.physicallyCorrectLights)&&(e.physicallyCorrectLights=a.physicallyCorrectLights),$t(a.aaMethod)&&(e.aaMethod=a.aaMethod),$t(a.useHDR)&&(e.useHDR=a.useHDR),$t(a.unitsScaleFactor)?e.unitsScaleFactor=a.unitsScaleFactor:e.unitsScaleFactor=1,$t(a.toneMapping))switch(a.toneMapping.type){case"logarithmicMax":e.toneMapping=6,e.toneMappingBrightness=a.toneMapping.brightness,e.toneMappingContrast=a.toneMapping.contrast,e.toneMappingMidTones=a.toneMapping.midTones,e.toneMappingPhysicalScale=a.toneMapping.physicalScale,e.toneMappingChromaticAdaptation=a.toneMapping.chromaticAdaptation,e.toneMappingWhiteColor=(new mn).fromArray(a.toneMapping.whiteColor),e.toneMappingColorDifferentiation=a.toneMapping.colorDifferentiation,e.toneMappingExteriorDaylight=a.toneMapping.exteriorDaylight;break;case"physicalMax":e.toneMapping=7,e.toneMappingWhiteBalance=(new mn).fromArray(a.toneMapping.whiteBalance),e.toneMappingHighlights=a.toneMapping.highlights,e.toneMappingMidTones=a.toneMapping.midTones,e.toneMappingShadows=a.toneMapping.shadows,e.toneMappingSaturation=a.toneMapping.saturation,e.toneMappingPhysicalScale=a.toneMapping.physicalScale,e.toneMappingAperture=a.toneMapping.aperture,e.toneMappingShutter=a.toneMapping.shutter,e.toneMappingISO=a.toneMapping.iso,e.toneMappingVignetting=a.toneMapping.vignetting;break;case"filmicBlender":e.toneMapping=8}if($t(a.pmremMaxTileSize)&&(e.pmremMaxTileSize=a.pmremMaxTileSize),$t(a.iblEnvironmentMode))switch(a.iblEnvironmentMode){case"PMREM":e.iblEnvironmentMode=0;break;case"PROBE_CUBEMAP":e.iblEnvironmentMode=1;break;case"PROBE":e.iblEnvironmentMode=2;break;default:e.iblEnvironmentMode=0}$t(a.postprocessing)&&(d.postprocessing=a.postprocessing)}}c.renderer=e})}}class Uv{constructor(e){this.name=pv.S8S_V3D_NODE,this.parser=e}extendNodeParams(e,t){t=t.extensions&&t.extensions[this.name];if(!t)return e;if(t.hidden&&(e.visible=!1),e.isMesh&&($t(t.useCastShadows)?e.castShadow=t.useCastShadows:$t(e.material.castShadow)&&(e.castShadow=e.material.castShadow),$t(t.useShadows)?e.receiveShadow=t.useShadows:$t(e.material.receiveShadow)&&(e.receiveShadow=e.material.receiveShadow)),$t(t.objectIndex)&&(e.objectIndex=t.objectIndex),$t(t.objectColor)&&(e.objectColor=(new mn).fromArray(t.objectColor)),e.renderOrder=t.renderOrder,e.frustumCulled=t.frustumCulling,$t(t.groupNames)&&(e.groupNames=t.groupNames),$t(t.hidpiCompositing)&&(e.hidpiCompositing=t.hidpiCompositing),e.isMesh&&e.material.isMeshNodeMaterial){const n=e.material;(n.hasNode("MATTE_SHADOW_MX")||n.hasNode("SHADOW_MATTE_AR")||n.hasNode("AI_SHADOW_MATTE_MY"))&&(n.transparent=!1,n.premultipliedAlpha=!0,v1(n),e.renderOrder-=1e3,e.castShadow=!1,e.receiveShadow=!0)}return this.processConstraints(e,t.constraints)}processConstraints(a,o=[]){const t=this.parser,n=[];for(let e=0;e<o.length;e++){var r=o[e];$t(r.target)?n.push(t.getDependency("node",r.target)):n.push(Promise.resolve(null))}return Promise.all(n).then(function(n){for(let t=0;t<o.length;t++){var r=o[t],i=n[t];let e;switch(r.type){case"copyLocation":e=new _m(i),e.useX=!$t(r.useX)||r.useX,e.useY=!$t(r.useY)||r.useY,e.useZ=!$t(r.useZ)||r.useZ,e.invertX=!!$t(r.invertX)&&r.invertX,e.invertY=!!$t(r.invertY)&&r.invertY,e.invertZ=!!$t(r.invertZ)&&r.invertZ,e.useOffset=!$t(r.useOffset)||r.useOffset,e.influence=$t(r.influence)?r.influence:1;break;case"copyRotation":e=new Cm(i),e.useX=!$t(r.useX)||r.useX,e.useY=!$t(r.useY)||r.useY,e.useZ=!$t(r.useZ)||r.useZ,e.invertX=!!$t(r.invertX)&&r.invertX,e.invertY=!!$t(r.invertY)&&r.invertY,e.invertZ=!!$t(r.invertZ)&&r.invertZ,e.mixMode=$t(r.mixMode)?r.mixMode:"REPLACE",e.influence=$t(r.influence)?r.influence:1,e.fixCameraLightRotation=!!$t(r.fixCameraLightRotation)&&r.fixCameraLightRotation;break;case"copyScale":e=new Tm(i),e.useX=!$t(r.useX)||r.useX,e.useY=!$t(r.useY)||r.useY,e.useZ=!$t(r.useZ)||r.useZ,e.power=$t(r.power)?r.power:1,e.useMakeUniform=!!$t(r.useMakeUniform)&&r.useMakeUniform,e.useOffset=!!$t(r.useOffset)&&r.useOffset,e.useAdd=!!$t(r.useAdd)&&r.useAdd,e.influence=$t(r.influence)?r.influence:1;break;case"copyTransforms":e=new Dm(i),e.mixMode=$t(r.mixMode)?r.mixMode:"REPLACE",e.influence=$t(r.influence)?r.influence:1,e.fixCameraLightRotation=!!$t(r.fixCameraLightRotation)&&r.fixCameraLightRotation;break;case"dampedTrack":e=new Hm(i),e.trackAxis=r.trackAxis,e.influence=$t(r.influence)?r.influence:1,e.fixCameraLightRotation=!!$t(r.fixCameraLightRotation)&&r.fixCameraLightRotation;break;case"limitDistance":e=new n0(i),e.distance=$t(r.distance)?r.distance:0,e.limitMode=$t(r.limitMode)?r.limitMode:"LIMITDIST_INSIDE",e.useTransformLimit=!!$t(r.useTransformLimit)&&r.useTransformLimit,e.influence=$t(r.influence)?r.influence:1;break;case"limitLocation":e=new r0,e.min.set(Number(r.minX),Number(r.minY),Number(r.minZ)),e.max.set(Number(r.maxX),Number(r.maxY),Number(r.maxZ));break;case"limitRotation":e=new a0,e.axis=r.axis,e.min=r.min,e.max=r.max;break;case"limitScale":e=new o0,e.min.set(Number(r.minX),Number(r.minY),Number(r.minZ)),e.max.set(Number(r.maxX),Number(r.maxY),Number(r.maxZ));break;case"lockedTrack":e=new v0(i),e.trackAxis=r.trackAxis,e.lockAxis=r.lockAxis,e.fixCameraLightRotation=!!$t(r.fixCameraLightRotation)&&r.fixCameraLightRotation;break;case"trackTo":e=new I0(i),e.trackAxis=r.trackAxis,e.upAxis=r.upAxis,e.fixCameraLightRotation=!!$t(r.fixCameraLightRotation)&&r.fixCameraLightRotation;break;case"childOf":e=new mm(i),e.offsetMatrix=(new rr).fromArray(r.offsetMatrix),e.fixCameraLightRotation=!!$t(r.fixCameraLightRotation)&&r.fixCameraLightRotation;break;case"floor":e=new Zm(i),e.floorLocation=consDeconsDef.floorLocation,e.offset=r.offset,e.useRotation=!!$t(r.useRotation)&&r.useRotation;break;case"fixOrthoZoom":e=new R0(i);break;case"canvasFit":e=new F0(i),e.edgeH=r.edgeH,e.edgeV=r.edgeV,e.useBoundingBox="BOX"==r.fitShape,e.offset=r.offset;break;case"canvasBreakpoints":e=new O0,e.minWidth=Number(r.minWidth),e.maxWidth=Number(r.maxWidth),e.minHeight=Number(r.minHeight),e.maxHeight=Number(r.maxHeight),e.orientation=r.orientation}e&&(e.name=r.name,e.mute=r.mute,a.constraints.push(e))}return a})}}class zv{constructor(e){this.name=pv.S8S_V3D_CAMERA,this.parser=e}extendCameraParams(t,e){const n=this.parser;e=e.extensions&&e.extensions[this.name];if(!e)return Promise.resolve(t);if(t.controls=new cv(e.controls,e.enablePan,e.rotateSpeed,e.moveSpeed),t.viewportFit.type=3,$t(e.viewportFitType))switch(e.viewportFitType){case"VERTICAL":t.viewportFit.type=1;break;case"HORIZONTAL":t.viewportFit.type=2;break;case"AUTO":t.viewportFit.type=3;break;case"FILL":t.viewportFit.type=4;break;case"OVERSCAN":t.viewportFit.type=5}$t(e.viewportFitInitialAspect)&&(t.viewportFit.initialAspect=e.viewportFitInitialAspect),$t(e.orbitMinDistance)&&(t.controls.orbitMinDistance=e.orbitMinDistance),$t(e.orbitMaxDistance)&&(t.controls.orbitMaxDistance=e.orbitMaxDistance),$t(e.orbitMinZoom)&&(t.controls.orbitMinZoom=e.orbitMinZoom),$t(e.orbitMaxZoom)&&(t.controls.orbitMaxZoom=e.orbitMaxZoom),$t(e.orbitMinPolarAngle)&&(t.controls.orbitMinPolarAngle=e.orbitMinPolarAngle),$t(e.orbitMaxPolarAngle)&&(t.controls.orbitMaxPolarAngle=e.orbitMaxPolarAngle),$t(e.orbitMinAzimuthAngle)&&(t.controls.orbitMinAzimuthAngle=e.orbitMinAzimuthAngle),$t(e.orbitMaxAzimuthAngle)&&(t.controls.orbitMaxAzimuthAngle=e.orbitMaxAzimuthAngle);const r=[];if($t(e.orbitTarget))if(e.orbitTarget instanceof Array){const i=new Tr;i.position.fromArray(e.orbitTarget),r.push(Promise.resolve(i))}else r.push(n.getDependency("node",e.orbitTarget));else r.push(Promise.resolve());return $t(e.fpsCollisionMaterial)?r.push(n.getDependency("material",e.fpsCollisionMaterial)):r.push(Promise.resolve()),$t(e.fpsGazeLevel)&&(t.controls.gazeLevel=e.fpsGazeLevel),$t(e.fpsStoryHeight)&&(t.controls.storyHeight=e.fpsStoryHeight),$t(e.enablePointerLock)&&(t.controls.enablePointerLock=e.enablePointerLock),Promise.all(r).then(e=>(e[0]&&(t.controls.orbitTarget=e[0]),e[1]&&(t.controls.collisionMaterial=e[1]),t))}}class Vv{constructor(e){this.name=pv.S8S_V3D_MATERIALS,this.parser=e}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?dd:null}extendMaterialParams(e,t){var n=this.parser.json,e=n.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();e=e.extensions[this.name];const r=[];if($t(e.nodeGraph)){var i,a=e.nodeGraph;t.nodeGraph=dd.nodeGraphFromExtGraph(a);for(let e=0;e<a.nodes.length;e++){const d=a.nodes[e];-1<uv.indexOf(d.type)&&$t(d.texture)?(i=dd.nodeTexUniName(d.type,d.texture),r.push(this.assignTextureNode(t,i,d.texture))):"RAMP_MY"==d.type&&(d.wrapS=jv[d.wrapS]||k,d.wrapT=jv[d.wrapT]||k)}var o=n.extensions&&n.extensions[this.name]||{};if(o&&o.nodeGraphs)for(var s in t.additionalNodeGraphs={},o.nodeGraphs){var l=o.nodeGraphs[s];t.additionalNodeGraphs[s]=dd.nodeGraphFromExtGraph(l);for(let e=0;e<l.nodes.length;e++){var c,u=l.nodes[e];-1<uv.indexOf(u.type)&&(c=dd.nodeTexUniName(u.type,u.texture),r.push(this.assignTextureNode(t,c,u.texture)))}}}return $t(e.profile)&&(t.profile=e.profile),$t(e.renderSide)&&(t.side=n1[e.renderSide]),$t(e.useShadows)&&(t.receiveShadow=e.useShadows),$t(e.useCastShadows)&&(t.castShadow=e.useCastShadows),$t(e.depthWrite)&&(t.depthWrite=e.depthWrite),$t(e.depthTest)&&(t.depthTest=e.depthTest),$t(e.dithering)&&(t.dithering=e.dithering),$t(e.materialIndex)&&(t.materialIndex=e.materialIndex),!0===e.alphaToCoverage&&(t.alphaToCoverage=!0),$t(e.gtaoVisible)&&(t.gtaoVisible=e.gtaoVisible),delete t.metalness,delete t.roughness,Promise.all(r)}assignTextureNode(t,n,e){return this.parser.getDependency("texture",e).then(function(e){t.nodeTextures=t.nodeTextures||{},t.nodeTextures[n]=e})}assignTransparency(e,t){var n=e.extensions[this.name]||{};e.premultipliedAlpha=t==t1.BLEND,t==t1.BLEND&&($t(n.blendMode)?(n=n.blendMode,e.blending=ce,$t(n.blendEquation)&&(e.blendEquation=Kv[n.blendEquation]),$t(n.blendEquationAlpha)&&(e.blendEquationAlpha=Kv[n.blendEquationAlpha]),$t(n.srcRGB)&&(e.blendSrc=qv[n.srcRGB]),$t(n.dstRGB)&&(e.blendDst=qv[n.dstRGB]),$t(n.srcAlpha)&&(e.blendSrcAlpha=qv[n.srcAlpha]),$t(n.dstAlpha)&&(e.blendDstAlpha=qv[n.dstAlpha])):v1(e))}}class Gv{constructor(e){this.parser=e,this.name=pv.S8S_V3D_TEXTURE,this.textureLoaderRGBE=new Kg,this.textureLoaderRGBE.setCrossOrigin(this.parser.options.crossOrigin),this.textureLoaderRGBE.setRequestHeader(this.parser.options.requestHeader),this.textureLoaderXZ=new Xg,this.textureLoaderXZ.setCrossOrigin(this.parser.options.crossOrigin)}loadTexture(e){var t=this.name;const n=this.parser;var r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;t=i.extensions[t];if(!$t(t.source))return null;const a=r.images[t.source];let o=n.textureLoader;return"hdr"==(a.uri||"").split(".").pop()||"image/vnd.radiance"==a.mimeType?o=this.textureLoaderRGBE:"xz"!=(a.uri||"").split(".").pop()&&"application/x-xz"!=a.mimeType||(o=this.textureLoaderXZ),!a.uri||null!==(t=n.options.manager.getHandler(a.uri))&&(o=t),n.loadTextureImage(e,a,o)}extendTextureParams(e,t,n){var r=this.name;if(!t.extensions||!t.extensions[r])return null;t=t.extensions[r],r="linear"==t.colorSpace||"non-color"==t.colorSpace?pt:ft;e.encoding=r,(n instanceof Kg||n instanceof Xg)&&(e.minFilter=Ge),$t(t.anisotropy)&&(e.anisotropy=t.anisotropy),$t(t.uvTransform)&&(e.matrix=(new Xt).fromArray(t.uvTransform),e.matrixAutoUpdate=!1)}}class kv extends ku{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}}kv.prototype.beforeStart_=kv.prototype.copySampleValue_,kv.prototype.afterEnd_=kv.prototype.copySampleValue_,kv.prototype.interpolate_=function(e,t,n,r){const i=this.resultBuffer;var a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=r-t,r=(n-t)/c,n=r*r,t=n*r,u=e*l,d=u-l,h=-2*t+3*n,p=t-n,f=1-h,m=p-n+r;for(let e=0;e!==o;e++){var g=a[d+e+o],v=a[d+e+s]*c,A=a[u+e+o],_=a[u+e]*c;i[e]=f*g+m*v+h*A+p*_}return i};const Qv=new Sn;class Wv extends kv{interpolate_(e,t,n,r){r=super.interpolate_(e,t,n,r);return Qv.fromArray(r).normalize().toArray(r),r}}const Hv={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Yv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xv={9728:Ve,9729:Ge,9984:W,9985:Y,9986:H,9987:ke},jv={33071:ze,33648:Q,10497:k},Kv={32774:ue,32778:de,32779:he},qv={0:me,1:ge,768:ve,769:Ae,770:_e,771:xe,772:ye,773:be,774:Me,775:Ce,776:Se},Zv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Jv={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},$v={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences",intensity:"intensity"},e1={CUBICSPLINE:void 0,LINEAR:ct,STEP:lt},t1={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},n1={FRONT:Ne,BACK:Fe,DOUBLE:Oe};function r1(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Pu({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ne,receiveShadow:!0,castShadow:!0})),e.DefaultMaterial}function i1(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function a1(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("v3d.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function o1(n){let r="";var i=Object.keys(n).sort();for(let e=0,t=i.length;e<t;e++)r+=i[e]+":"+n[i[e]]+";";return r}function s1(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("v3d.GLTFLoader: Unsupported normalized accessor component type.")}}class l1{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.onProgress=t.onProgress||function(){},this.cache=new hv,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new uh(this.options.manager):this.textureLoader=new Od(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ld(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0),this.assignedMaterials=[]}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(n,e){const r=this,i=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(e){const t={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:r,userData:{}};i1(a,t,i),a1(t,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){n(t)})}).catch(e)}_markDefs(){const n=this.json.nodes||[];var r=this.json.skins||[];const i=this.json.meshes||[];for(let e=0,t=r.length;e<t;e++){var a=r[e].joints;for(let e=0,t=a.length;e<t;e++)n[a[e]].isBone=!0}for(let e=0,t=n.length;e<t;e++){var o=n[e];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(i[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),a=(e,t)=>{var n,r,i=this.associations.get(e);null!=i&&this.associations.set(t,i);for([n,r]of e.children.entries())a(r,t.children[n])};return a(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){var r=t(n[e]);if(r)return r}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let e=0;e<n.length;e++){var i=t(n[e]);i&&r.push(i)}return r}getDependency(e,t){var n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(n){let e=this.cache.get(n);if(!e){const r=this,t=this.json[n+("mesh"===n?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return r.getDependency(n,t)})),this.cache.add(n,e)}return e}loadBuffer(e){const a=this,o=this.json.buffers[e];if(o.type&&"arraybuffer"!==o.type)throw new Error("v3d.GLTFLoader: "+o.type+" buffer type is not supported.");if(void 0===o.uri&&0===e)return Promise.resolve(this.extensions[pv.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(e){let t,n;n=s.loadBinXZ?(t=rh.resolveURL(o.uri,s.path)+".xz",new Xg):(t=rh.resolveURL(o.uri,s.path),a.fileLoader);function r(e){a.onProgress&&(e=100*(.3+.7*e),a.onProgress(e))}let i=r;n instanceof Ld&&(i=function(e){e=e.lengthComputable?e.loaded/e.total:1;r(e)}),n.load(t,e,i)})}loadBufferView(e){const r=this.json.bufferViews[e];return this.getDependency("buffer",r.buffer).then(function(e){var t=r.byteLength||0,n=r.byteOffset||0;return e.slice(n,n+t)})}loadAccessor(e){const g=this,v=this.json,A=this.json.accessors[e];if(void 0===A.bufferView&&void 0===A.sparse)return Promise.resolve(null);const t=[];return void 0!==A.bufferView?t.push(this.getDependency("bufferView",A.bufferView)):t.push(null),void 0!==A.sparse&&(t.push(this.getDependency("bufferView",A.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",A.sparse.values.bufferView))),Promise.all(t).then(function(e){var t=e[0],n=Zv[A.type];const r=Yv[A.componentType];var i=r.BYTES_PER_ELEMENT,a=i*n,o=A.byteOffset||0,s=void 0!==A.bufferView?v.bufferViews[A.bufferView].byteStride:void 0,l=!0===A.normalized;let c,u;if(s&&s!==a){var d=Math.floor(o/s),a="InterleavedBuffer:"+A.bufferView+":"+A.componentType+":"+d+":"+A.count;let e=g.cache.get(a);e||(c=new r(t,d*s,A.count*s/i),e=new ll(c,s/i),g.cache.add(a,e)),u=new ul(e,n,o%s/i,l)}else c=null===t?new r(A.count*n):new r(t,o,A.count*n),u=new Hr(c,n,l);if(void 0!==A.sparse){i=Zv.SCALAR;const m=Yv[A.sparse.indices.componentType];var o=A.sparse.indices.byteOffset||0,l=A.sparse.values.byteOffset||0,h=new m(e[1],o,A.sparse.count*i),p=new r(e[2],l,A.sparse.count*n);null!==t&&(u=new Hr(u.array.slice(),u.itemSize,u.normalized));for(let e=0,t=h.length;e<t;e++){var f=h[e];if(u.setX(f,p[e*n]),2<=n&&u.setY(f,p[e*n+1]),3<=n&&u.setZ(f,p[e*n+2]),4<=n&&u.setW(f,p[e*n+3]),5<=n)throw new Error("v3d.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return u})}loadTexture(e){var t=this.json;const n=this.options;var r=t.textures[e],t=t.images[r.source];let i=this.textureLoader;return!t.uri||null!==(r=n.manager.getHandler(t.uri))&&(i=r),this.loadTextureImage(e,t,i)}loadTextureImage(n,t,i){const r=this,a=this.json,o=this.options,s=a.textures[n];var e=(t.uri||t.bufferView)+":"+s.sampler;if(this.textureCache[e])return this.textureCache[e];const l=self.URL||self.webkitURL;let c=t.uri||"",u=!1;if(void 0!==t.bufferView)c=r.getDependency("bufferView",t.bufferView).then(function(e){u=!0;e=new Blob([e],{type:t.mimeType});return c=l.createObjectURL(e),c});else if(void 0===t.uri)throw new Error("v3d.GLTFLoader: Image "+n+" is missing URI and bufferView");var d=Promise.resolve(c).then(function(r){return new Promise(function(n,e){let t=n;!0===i.isImageBitmapLoader&&(t=function(e){const t=new _n(e);t.needsUpdate=!0,n(t)}),i.load(rh.resolveURL(r,o.path),t,void 0,e)})}).then(function(e){if(e instanceof ArrayBuffer){const t=r.plugins[pv.S8S_V3D_TEXTURE];return t.textureLoaderRGBE.loadAsync(l.createObjectURL(new Blob([e],{type:"image/vnd.radiance"})))}return Promise.resolve(e)}).then(function(t){!0===u&&l.revokeObjectURL(c),t.flipY=!1,s.name&&(t.name=s.name);var e=(a.samplers||{})[s.sampler]||{};return t.magFilter=Xv[e.magFilter]||Ge,t.minFilter=Xv[e.minFilter]||ke,t.wrapS=jv[e.wrapS]||k,t.wrapT=jv[e.wrapT]||k,r._invokeAll(function(e){return e.extendTextureParams&&e.extendTextureParams(t,s,i)}),r.associations.set(t,{textures:n}),t}).catch(function(){return console.error("v3d.GLTFLoader: Couldn't load texture",c),new _n});return this.textureCache[e]=d}assignTexture(r,i,a){const o=this;return this.getDependency("texture",a.index).then(function(e){var t,n;return void 0===a.texCoord||0==a.texCoord||"aoMap"===i&&1==a.texCoord||console.warn("v3d.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+i+" not yet supported."),!o.extensions[pv.KHR_TEXTURE_TRANSFORM]||(t=void 0!==a.extensions?a.extensions[pv.KHR_TEXTURE_TRANSFORM]:void 0)&&(n=o.associations.get(e),e=o.extensions[pv.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),o.associations.set(e,n)),r[i]=e})}assignFinalMaterial(e,n,r){const t=e.geometry;let i=e.material;var a=void 0===t.attributes.tangent,o=void 0!==t.attributes.color&&!i.isMeshNodeMaterial,s=void 0===t.attributes.normal,l=i.isMeshNodeMaterial&&(i.nodeValue.length||i.nodeRGB.length),c=i.isMeshNodeMaterial&&i.hasNode("TEX_COORD_BL"),u=i.isMeshNodeMaterial&&0<Object.getOwnPropertyNames(n).length&&i.hasNode("UVMAP_BL"),d=i.isMeshNodeMaterial&&0<Object.getOwnPropertyNames(r).length&&(i.hasNode("ATTRIBUTE_BL")||i.hasNode("VERTEX_COLOR_BL"));if(e.isPoints){var h="PointsMaterial:"+i.uuid;let e=this.cache.get(h);e||(e=new PointsMaterial,Gr.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(h,e)),i=e}else if(e.isLine){var p="LineBasicMaterial:"+i.uuid;let e=this.cache.get(p);e||(e=new LineBasicMaterial,Gr.prototype.copy.call(e,i),e.color.copy(i.color),this.cache.add(p,e)),i=e}if(a||o||s||l||c||u||d){let e="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),a&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),s&&(e+="flat-shading:");p=It();l&&(e=p),c&&(e=p),u&&(e=p),d&&(e=p);let t=this.cache.get(e);t||(t=i.clone(),o&&(t.vertexColors=!0),s&&(t.flatShading=!0),a&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),t.isMeshNodeMaterial&&(Object.assign(t.nodeUVAliases,n),Object.assign(t.nodeVCAliases,r),t.updateNodeGraph()),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=i,this.assignedMaterials.includes(i)||this.assignedMaterials.push(i)}getMaterialType(){return Pu}loadMaterial(n){const r=this;var e=this.json;const i=this.extensions,a=e.materials[n];let o;const s={};e=a.extensions||{};const t=[];if(e[pv.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=i[pv.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=u.getMaterialType(),t.push(u.extendParams(s,a,r))}else if(e[pv.KHR_MATERIALS_UNLIT]){const d=i[pv.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),t.push(d.extendParams(s,a,r))}else{var l=a.pbrMetallicRoughness||{};s.color=new mn(1,1,1),s.opacity=1,Array.isArray(l.baseColorFactor)&&(e=l.baseColorFactor,s.color.fromArray(e),s.opacity=e[3]),void 0!==l.baseColorTexture&&t.push(r.assignTexture(s,"map",l.baseColorTexture)),s.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,s.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture&&(t.push(r.assignTexture(s,"metalnessMap",l.metallicRoughnessTexture)),t.push(r.assignTexture(s,"roughnessMap",l.metallicRoughnessTexture))),o=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(n)}),t.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(n,s)})))}!0===a.doubleSided&&(s.side=Oe);const c=a.alphaMode||t1.OPAQUE;return c===t1.BLEND?(s.transparent=!0,o!==dd&&(s.depthWrite=!1)):(s.transparent=!1,c===t1.MASK&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&o!==kr&&(t.push(r.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new Yt(1,1),void 0!==a.normalTexture.scale&&(l=a.normalTexture.scale,s.normalScale.set(l,l))),void 0!==a.occlusionTexture&&o!==kr&&(t.push(r.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&o!==kr&&(s.emissive=(new mn).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&o!==kr&&t.push(r.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(t).then(function(){let e;e=o===Rv?i[pv.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new o(s),a.name&&(e.name=a.name),e.map&&(e.map.encoding=ft),e.emissiveMap&&(e.emissiveMap.encoding=ft);const t=r.plugins[pv.S8S_V3D_MATERIALS];return e.isMeshNodeMaterial&&t.assignTransparency(e,c),e.isMeshStandardMaterial&&e.normalScale&&t&&$t(t.profile)&&"max"==t.profile&&(e.normalScale.y=-e.normalScale.y),a1(e,a),r.associations.set(e,{materials:n}),a.extensions&&i1(i,e,a),e})}createUniqueName(e){var t=e;let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(n){const r=this,i=this.extensions,a=this.primitiveCache;const o=[];for(let e=0,t=n.length;e<t;e++){var s=n[e],l=function(e){var t=e.extensions&&e.extensions[pv.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+o1(t.attributes):e.indices+":"+o1(e.attributes)+":"+e.mode,n}(s),c=a[l];if(c)o.push(c.promise);else{let e;e=s.extensions&&s.extensions[pv.KHR_DRACO_MESH_COMPRESSION]?function(t){return i[pv.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,r).then(function(e){return c1(e,t,r)})}(s):c1(new ci,s,r),a[l]={primitive:s,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(m){const g=this;var e=this.json;const v=this.extensions,A=e.meshes[m],_=A.primitives,n=[],x=$t(A.extensions)?A.extensions[pv.S8S_V3D_MESH]:void 0;for(let e=0,t=_.length;e<t;e++){var r=void 0===_[e].material?r1(this.cache):this.getDependency("material",_[e].material);n.push(r)}return n.push(g.loadGeometries(_)),Promise.all(n).then(function(e){var n=e.slice(0,e.length-1),r=e[e.length-1];const i=[];for(let t=0,e=r.length;t<e;t++){var a=r[t],o=_[t];let e;var s=n[t];if(o.mode===Hv.TRIANGLES||o.mode===Hv.TRIANGLE_STRIP||o.mode===Hv.TRIANGLE_FAN||void 0===o.mode)e=new(!0===A.isSkinnedMesh?Nl:Ei)(a,s),!0!==e.isSkinnedMesh||e.geometry.attributes.skinWeight.normalized||e.normalizeSkinWeights(),o.mode===Hv.TRIANGLE_STRIP?e.geometry=u1(e.geometry,1):o.mode===Hv.TRIANGLE_FAN&&(e.geometry=u1(e.geometry,2));else if(o.mode===Hv.LINES)if(x){const f=new Sg;f.fromBufferGeometry(a);var l=new Eg({color:$t(x.lineColor)?(new mn).fromArray(x.lineColor):new mn(1,1,1),lineWidth:$t(x.lineWidth)?x.lineWidth:1,sizeAttenuation:0});e=new Ei(f.geometry,l),e.userData.originalLineGeom=a}else e=new nc(a,s);else if(o.mode===Hv.LINE_STRIP)e=new $l(a,s);else if(o.mode===Hv.LINE_LOOP)e=new rc(a,s);else{if(o.mode!==Hv.POINTS)throw new Error("v3d.GLTFLoader: Primitive mode unsupported: "+o.mode);e=new cc(a,s)}0<Object.keys(e.geometry.morphAttributes).length&&function(n,r){if(n.updateMorphTargets(),void 0!==r.weights)for(let e=0,t=r.weights.length;e<t;e++)n.morphTargetInfluences[e]=r.weights[e];if(r.extras&&Array.isArray(r.extras.targetNames)){var i=r.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++)n.morphTargetDictionary[i[e]]=e}else console.warn("v3d.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(e,A),e.name=g.createUniqueName(A.name||"mesh_"+m),a1(e,A),o.extensions&&i1(v,e,o);const h={},p={};if(e.material.isMeshNodeMaterial&&x){if(x.uvLayers)for(var c in x.uvLayers)h[c]=m1(x.uvLayers[c]);if(x.colorLayers)for(var u in x.colorLayers)p[u]=g1(x.colorLayers[u])}g.assignFinalMaterial(e,h,p),i.push(e)}for(let e=0,t=i.length;e<t;e++)g.associations.set(i[e],{meshes:m,primitives:e});if(1===i.length)return i[0];const d=new js;g.associations.set(d,{meshes:m});for(let e=0,t=i.length;e<t;e++)i[e].name+="_"+e,i[e].isMaterialGeneratedMesh=!0,d.add(i[e]);return d})}loadCamera(e){let t;const n=this.json.cameras[e];e=n[n.type];if(e)return"perspective"===n.type?t=new Ni(Nt(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===n.type&&(t=new ia(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),n.name&&(t.name=n.name),a1(t,n),this._invokeOne(function(e){return e.extendCameraParams&&e.extendCameraParams(t,n)});console.warn("v3d.GLTFLoader: Missing camera parameters.")}loadSkin(e){e=this.json.skins[e];const t={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",e.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})}loadAnimation(b){const M=this.json.animations[b],n=[],r=[],i=[],a=[],o=[];for(let e=0,t=M.channels.length;e<t;e++){var s=M.channels[e],l=M.samplers[s.sampler],c=s.target,u=void 0!==c.node?c.node:c.id,d=void 0!==M.parameters?M.parameters[l.input]:l.input,s=void 0!==M.parameters?M.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),r.push(this.getDependency("accessor",d)),i.push(this.getDependency("accessor",s)),a.push(l),o.push(c)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(o),this.getDependencies("material")]).then(function(a){var n=a[0],r=a[1],i=a[2],o=a[3],s=a[4];const l=[];for(let e=0,t=n.length;e<t;e++){const g=n[e];var c=r[e],u=i[e],d=o[e];const v=s[e];if(void 0!==g){g.updateMatrix(),g.matrixAutoUpdate=!0;let n,r="";switch($v[v.path]){case $v.weights:n=xd;break;case $v.rotation:n=bd;break;case $v.translation:case $v.scale:n=Cd;break;case $v.intensity:n=xd;break;default:n=Cd;let e;-1<v.path.indexOf("nodeValue")?(e=v.path.match(/".*"/g)[0],r="material.nodeValue["+e+"]"):-1<v.path.indexOf("nodeRGB")&&(e=v.path.match(/".*"/g)[0],r="material.nodeRGB["+e+"]")}var h=g.name||g.uuid,p=void 0!==d.interpolation?e1[d.interpolation]:ct;const A=[];if($v[v.path]===$v.weights)g.traverse(function(e){e.morphTargetInfluences&&A.push(e.name||e.uuid)});else if(-1<v.path.indexOf("material")){const _=a[5];g.traverse(function(t){if(t.isMesh&&t.material.isMeshNodeMaterial){let e=!1;var n;e=!v.extras||(e=_[v.extras.material].name===t.material.name,n=v.path.match(/\["(.*)"\]/),e&&null!==n&&null!==t.material.findNodeByName(n[1])),e&&A.push(t.name||t.uuid)}})}else A.push(h);let i=u.array;if(u.normalized){var f=s1(i.constructor);const x=new Float32Array(i.length);for(let e=0,t=i.length;e<t;e++)x[e]=i[e]*f;i=x}for(let e=0,t=A.length;e<t;e++){const y=new n(A[e]+"."+(""!==r?r:$v[v.path]),c.array,i,p);"CUBICSPLINE"===d.interpolation&&(y.createInterpolant=function(e){const t=this instanceof bd?Wv:kv;return new t(this.times,this.values,this.getValueSize()/3,e)},y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(y)}}}var e=M.name||"animation_"+b;const t={clip:new Sd(e,void 0,l),nodeId:n[0].id,auto:!0,loop:2201,repetitions:1/0,startAt:0};e=$t(M.extensions)?M.extensions[pv.S8S_V3D_ANIMATION]:void 0;if(e){t.auto=e.auto;var m=e.repeatInfinite?1/0:e.repeatCount;switch(e.loop){case"ONCE":t.loop=2200;break;case"REPEAT":t.loop=2201,t.repetitions=m;break;case"PING_PONG":t.loop=2202,t.repetitions=m}t.startAt=e.offset}return t})}createNodeMesh(e){var t=this.json;const n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(n){if(n.isMesh)for(let e=0,t=r.weights.length;e<t;e++)n.morphTargetInfluences[e]=r.weights[e]}),t})}loadNode(i){var e=this.json;const t=this.extensions,a=this,o=e.nodes[i],s=o.name?a.createUniqueName(o.name):"";return function(){const t=[];var e=a._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(i)});return e&&t.push(e),void 0!==o.camera&&t.push(a.getDependency("camera",o.camera).then(function(e){return a._getNodeRef(a.cameraCache,o.camera,e)})),a._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(i)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(n){let r;if(r=!0===o.isBone?new Fl:1<n.length?new js:1===n.length?n[0]:new Tr,r!==n[0])for(let e=0,t=n.length;e<t;e++)r.add(n[e]);if(o.name&&(r.userData.name=o.name,r.name=s),a1(r,o),o.extensions&&i1(t,r,o),void 0!==o.matrix){const e=new rr;e.fromArray(o.matrix),r.applyMatrix4(e)}else void 0!==o.translation&&r.position.fromArray(o.translation),void 0!==o.rotation&&r.quaternion.fromArray(o.rotation),void 0!==o.scale&&r.scale.fromArray(o.scale);return a.associations.has(r)||a.associations.set(r,{}),a.associations.get(r).nodes=i,r}).then(function(n){return n.resolveMultiMaterial().forEach(t=>{a._invokeOne(function(e){if(t!==n)return e.extendNodeParams&&e.extendNodeParams(t,o)})}),a._invokeOne(function(e){return e.extendNodeParams&&e.extendNodeParams(n,o)})})}loadScene(e){var n=this.json,t=this.extensions,e=this.json.scenes[e];const i=this,r=new oa;e.name&&(r.name=i.createUniqueName(e.name)),a1(r,e),e.extensions&&i1(t,r,e);var a=e.nodes||[];const o=[];for(let e=0,t=a.length;e<t;e++)o.push(function o(e,t,s,l){const c=s.nodes[e];return l.getDependency("node",e).then(function(e){if(void 0===c.skin)return e;let s;return l.getDependency("skin",c.skin).then(function(e){s=e;const n=[];for(let e=0,t=s.joints.length;e<t;e++)n.push(l.getDependency("node",s.joints[e]));return Promise.all(n)}).then(function(o){return e.traverse(function(e){if(e.isMesh){const n=[],r=[];for(let e=0,t=o.length;e<t;e++){const i=o[e];if(i){n.push(i);const a=new rr;void 0!==s.inverseBindMatrices&&a.fromArray(s.inverseBindMatrices.array,16*e),r.push(a)}else console.warn('v3d.GLTFLoader: Joint "%s" could not be found.',s.joints[e])}e.bind(new Vl(n,r),e.matrixWorld)}}),e})}).then(function(n){t.add(n),(n.isDirectionalLight||n.isSpotLight)&&n.isFreeLight&&t.add(n.target);const r=[];if(c.children){const i=c.children;for(let e=0,t=i.length;e<t;e++){const a=i[e];r.push(o(a,n,s,l))}}return Promise.all(r)})}(a[e],r,n,i));return Promise.all(o).then(function(){return i.associations=(e=>{const n=new Map;for(var[t,r]of i.associations)(t instanceof Gr||t instanceof _n)&&n.set(t,r);return e.traverse(e=>{var t=i.associations.get(e);null!=t&&n.set(e,t)}),n})(r),r})}}function c1(n,e,r){var t,i=e.attributes;const a=[];for(const s in i){var o=Jv[s]||f1(s)||s.toLowerCase();o in n.attributes||a.push(function(e,t){return r.getDependency("accessor",e).then(function(e){n.setAttribute(t,e)})}(i[s],o))}return void 0===e.indices||n.index||(t=r.getDependency("accessor",e.indices).then(function(e){n.setIndex(e)}),a.push(t)),a1(n,e),function(e,t,n){var r=t.attributes;const i=new In;if(void 0!==r.POSITION){var a=n.json.accessors[r.POSITION],o=a.min,r=a.max;if(void 0!==o&&void 0!==r){i.set(new wn(o[0],o[1],o[2]),new wn(r[0],r[1],r[2])),a.normalized&&(a=s1(Yv[a.componentType]),i.min.multiplyScalar(a),i.max.multiplyScalar(a));var s=t.targets;if(void 0!==s){const h=new wn,p=new wn;for(let e=0,t=s.length;e<t;e++){var l,c,u=s[e];void 0!==u.POSITION&&(l=(c=n.json.accessors[u.POSITION]).min,u=c.max,void 0!==l&&void 0!==u?(p.setX(Math.max(Math.abs(l[0]),Math.abs(u[0]))),p.setY(Math.max(Math.abs(l[1]),Math.abs(u[1]))),p.setZ(Math.max(Math.abs(l[2]),Math.abs(u[2]))),c.normalized&&(c=s1(Yv[c.componentType]),p.multiplyScalar(c)),h.max(p)):console.warn("v3d.GLTFLoader: Missing min/max properties for accessor POSITION."))}i.expandByVector(h)}e.boundingBox=i;const d=new jn;i.getCenter(d.center),d.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=d}else console.warn("v3d.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(n,e,r),Promise.all(a).then(function(){return void 0!==e.targets?function(n,r,i){let a=!1,o=!1;for(let e=0,t=r.length;e<t;e++){var s=r[e];if(void 0!==s.POSITION&&(a=!0),void 0!==s.NORMAL&&(o=!0),a&&o)break}if(!a&&!o)return Promise.resolve(n);const l=[],c=[];for(let e=0,t=r.length;e<t;e++){var u,d=r[e];a&&(u=void 0!==d.POSITION?i.getDependency("accessor",d.POSITION):n.attributes.position,l.push(u)),o&&(d=void 0!==d.NORMAL?i.getDependency("accessor",d.NORMAL):n.attributes.normal,c.push(d))}return Promise.all([Promise.all(l),Promise.all(c)]).then(function(e){var t=e[0],e=e[1];return a&&(n.morphAttributes.position=t),o&&(n.morphAttributes.normal=e),n.morphTargetsRelative=!0,n})}(n,e.targets,r):n})}function u1(e,t){let n=e.getIndex();if(null===n){const s=[];var r=e.getAttribute("position");if(void 0===r)return console.error("v3d.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)s.push(e);e.setIndex(s),n=e.getIndex()}var i=n.count-2;const a=[];if(2===t)for(let e=1;e<=i;e++)a.push(n.getX(0)),a.push(n.getX(e)),a.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(a.push(n.getX(e)),a.push(n.getX(e+1)),a.push(n.getX(e+2))):(a.push(n.getX(e+2)),a.push(n.getX(e+1)),a.push(n.getX(e)));a.length/3!=i&&console.error("v3d.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(a),o}function d1(e,t,n){e=n.indexOf(e);-1<e&&n.splice(e,1),Array.isArray(t)?t.forEach(e=>{n.push(e)}):n.push(t)}function h1(t,e,n){const r=n.extensions||{};Array.isArray(e)?e.forEach(e=>{r[e]=r[t]}):r[e]=r[t],delete r[t]}function p1(e){console.warn(`Deprecated '${e}' extension found, please reexport your scene file`)}function f1(e){return-1<e.indexOf("TEXCOORD_")?m1(e):-1<e.indexOf("COLOR_")?g1(e):""}function m1(e){return"TEXCOORD_0"==e?"uv":"uv"+String(Number(e.split("TEXCOORD_")[1])+1)}function g1(e){return"COLOR_0"==e?"color":"color"+String(Number(e.split("COLOR_")[1])+1)}function v1(e){e.blending=ce,e.blendEquation=ue,e.blendSrc=ge,e.blendDst=xe}const A1=new mn;class _1 extends t{constructor(e,t,n=512,r=512){super(),this.scene=e,this.camera=t,this.width=n,this.height=r,this.distance=.1,this.factor=1,this.precision=1,this.bentNormals=!1,this.bounceApprox=!1,this.noiseTexture=this.createNoiseTexture(),this.fsQuad=new dg(null);r=new Zs;r.type=He,this.renderTargetNormalDepth=new bn(this.width,this.height,{format:Ke,depthTexture:r,depthBuffer:!0}),this.renderTargetGTAO=new bn(this.width,this.height),this.renderTargetBlurX=new bn(this.width,this.height),this.renderTarget=new bn(this.width,this.height),this.materialNormal=new Ou({}),this.materialGTAO=new Pi({type:"GTAO",defines:{ORTHO_CAMERA:0,CALC_BENT_NORMALS:0},extensions:{derivatives:!0},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},occlDistance:{value:.1},factor:{value:1},occlPrecision:{value:1},bounceApprox:{value:0},mainCameraProjMat:{value:new rr},resolution:{value:new Yt}},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_gtao_frag}),this.materialBlur=new Pi({type:"GTAOBlur",defines:{},uniforms:{tDiffuse:{value:null},tNormal:{value:null},direction:{value:new Yt},resolution:{value:new Yt}},customPrepTokens:{BLUR_RADIUS_PX:2},vertexShader:Ki.pp_plane_vert,fragmentShader:Ki.pp_gtao_blur_frag}),this._layerMasks={}}setCamera(e){this.camera=e}setSize(e,t){this.width=e,this.height=t,this.renderTargetNormalDepth.setSize(e,t),this.renderTargetGTAO.setSize(e,t),this.renderTargetBlurX.setSize(e,t),this.renderTarget.setSize(e,t),this.materialGTAO.uniforms.mainCameraProjMat.value.copy(this.camera.projectionMatrix),this.materialGTAO.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this.materialBlur.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height)}dispose(){this.dispatchEvent({type:"dispose"}),this.renderTargetNormalDepth.dispose(),this.renderTargetGTAO.dispose(),this.renderTargetBlurX.dispose(),this.renderTarget.dispose(),this.materialNormal.dispose(),this.materialGTAO.dispose(),this.materialBlur.dispose(),this.noiseTexture.dispose()}_saveLayers(){this.scene.traverse(e=>this._layerMasks[e.id]=e.layers.mask)}_setupLayers(){this.scene.traverse(e=>{e.layers.disableAll();var t=e instanceof Ei&&e.material&&!e.material.gtaoVisible,n=e instanceof Ei&&e.material&&e.material.isMeshNodeMaterial&&(0<e.material.alphaTest||e.material.alphaToCoverage);t?e.layers.enable(0):n?e.layers.enable(1):e.layers.enable(2)})}_restoreLayers(){this.scene.traverse(e=>e.layers.mask=this._layerMasks[e.id])}_setupNodeAlphaClipHashMaterials(){this.scene.traverse(e=>{e instanceof Ei&&e.material&&e.material.isMeshNodeMaterial&&(e.material.defines.NORMAL_OUTPUT=Number(0<e.material.alphaTest||e.material.alphaToCoverage),e.material.needsUpdate=!0)})}_restoreNodeAlphaClipHashMaterials(){this.scene.traverse(e=>{e instanceof Ei&&e.material&&e.material.isMeshNodeMaterial&&(e.material.defines.NORMAL_OUTPUT=0,e.material.needsUpdate=!0)})}render(e){this._saveLayers(),this._setupLayers(),this.camera.layers.disableAll(),this.camera.layers.enable(1),this._setupNodeAlphaClipHashMaterials(),this._renderOverride(e,null,this.renderTargetNormalDepth,8355839,1,!0),this._restoreNodeAlphaClipHashMaterials(),this.camera.layers.disableAll(),this.camera.layers.enable(2),this._renderOverride(e,this.materialNormal,this.renderTargetNormalDepth,null,null,!0),this._restoreLayers(),this.materialGTAO.defines.ORTHO_CAMERA=this.camera.isOrthographicCamera?1:0,this.materialGTAO.defines.CALC_BENT_NORMALS=this.bentNormals?1:0,this.materialGTAO.needsUpdate=!0,this.materialGTAO.uniforms.tNormal.value=this.renderTargetNormalDepth.texture,this.materialGTAO.uniforms.tDepth.value=this.renderTargetNormalDepth.depthTexture,this.materialGTAO.uniforms.tNoise.value=this.noiseTexture,this.materialGTAO.uniforms.occlDistance.value=this.distance,this.materialGTAO.uniforms.factor.value=this.factor,this.materialGTAO.uniforms.occlPrecision.value=this.precision,this.materialGTAO.uniforms.bounceApprox.value=this.bounceApprox,this.materialGTAO.uniforms.mainCameraProjMat.value.copy(this.camera.projectionMatrix),this.materialGTAO.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this._renderPass(e,this.materialGTAO,this.renderTargetGTAO),this.materialBlur.uniforms.tDiffuse.value=this.renderTargetGTAO.texture,this.materialBlur.map=this.renderTargetGTAO.texture,this.materialBlur.uniforms.tNormal.value=this.renderTargetNormalDepth.texture,this.materialBlur.uniforms.direction.value.set(1,0),this.materialBlur.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this._renderPass(e,this.materialBlur,this.renderTargetBlurX),this.materialBlur.uniforms.tDiffuse.value=this.renderTargetBlurX.texture,this.materialBlur.map=this.renderTargetBlurX.texture,this.materialBlur.uniforms.direction.value.set(0,1),this.materialBlur.uniforms.resolution.value.set(this.renderTargetBlurX.width,this.renderTargetBlurX.height),this._renderPass(e,this.materialBlur,this.renderTarget)}_renderOverride(e,t,n,r,i,a){var o=e.getRenderTarget(),s=e.getClearColor(A1),l=e.getClearAlpha(),c=e.autoClear,u=this.scene.background;e.setRenderTarget(n),null!=r&&(e.setClearColor(r),e.setClearAlpha(null!=i?i:0),e.clear()),e.autoClear=!1,a&&(this.scene.background=null),t&&(this.scene.overrideMaterial=t),e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.setRenderTarget(o),e.setClearColor(s),e.setClearAlpha(l),e.autoClear=c,this.scene.background=u}_renderPass(e,t,n,r,i){var a=e.getRenderTarget(),o=e.getClearColor(A1),s=e.getClearAlpha(),l=e.autoClear;e.setRenderTarget(n),null!=r&&(e.setClearColor(r),e.setClearAlpha(null!=i?i:0),e.clear()),e.autoClear=!1,this.fsQuad.material=t,this.fsQuad.render(e),e.setRenderTarget(a),e.setClearColor(o),e.setClearAlpha(s),e.autoClear=l}createNoiseTexture(){var t=new Uint8Array([101,192,145,80,53,136,86,207,229,131,240,6,58,41,171,13,199,63,175,128,113,55,246,66,115,213,157,59,243,114,68,169,255,60,216,5,200,37,250,65,170,48,153,108,125,211,137,29,120,82,38,213,25,198,15,150,33,131,173,16,140,180,9,206,134,20,117,176,99,222,124,190,95,33,198,221,86,68,241,157,227,142,253,96,72,135,169,102,204,253,89,195,50,233,94,38,185,86,235,72,149,163,25,2,146,75,254,14,164,189,0,100,49,187,162,8,181,222,240,52,7,73,41,109,210,123,76,150,226,161,44,11,242,51,107,232,212,116,177,54,141,37,207,77,115,19,59,235,110,42,83,122,160,184,224,148,2,164,248,24,203,109,129,192,208,138,83,182,61,132,28,229,96,121,224,173,248,197,88,127,147,29,193,210,139,96,237,30,63,191,102,54,69,178,32,93,63,170,36,247,17,201,80,155,245,18,60,133,151,32,219,206,165,67,230,20,57,12,171,128,84,221,139,13,236,146,220,252,20,120,222,150,99,166,43,108,196,183,89,45,9,107,74,49,4,100,175,117,246,71,198,113,241,39,174,119,46,82,1,157,105,195,72,9,127,239,217,6,69,145,211,166,230,181,240,136,190,251,87,155,35,219,143,50,22,159,213,92,191,127,212,41,135,237,50,206,88,58,176,118,36,234,27,114,64,93,157,119,21,214,45,129,187,105,92,208,182,66,6,249,27,167,62,185,78,172,29,160,188,25,139,249,161,84,130,254,203,14,37,226,59,143,77,238,0,166,18,254,79,133,103,153,205,113,94,246,12,216,100,116,227,76,209,48,97,186,1,53,144,192,82,169,108,179,28,198,65,228,42,151,122,197,233,53,74,222,24,146,123,56,141,255,3,151,106,20,200,220,73,174,104,216,131,248,7,209,156,86,112,136,177,58,223,11,36,140,241,8,195,178,232,85,200,43,65,180,240,133,61,149,120,231,22,46,71,30,92,230,121,52,242,215,97,26,110,186,89,172,158,102,50,70,34,156,15,189,126,91,34,168,10,245,39,91,163,243,152,202,140,42,188,17,163,8,203,77,156,237,63,118,32,130,251,165,112,208,98,235,161,213,228,81,110,194,178,14,125,185,111,61,173,103,253,71,144,39,125,250,45,207,15,217,177,202,88,1,226,132,75,26,56,12,119,203,46,137,66,209,77,220,3,238,19,80,129,218,179,90,193,168,132,98,146,81,19,235,142,59,183,44,250,174,104,144,69,155,251,97,230,145,33,99,49,159,212,196,31,56,110,225,22,62,2,183,245,55,123,40,106,215,17,150,116,218,194,238,31,186,0,23,55,162,241,194,135,87,118,147,236,4,158,244,75,117,228,35,109,194,67,155,78,168,199,91,64,8,135,47,88,169,212,129,181,111,11,65,170,227,40,68,176,95,201,46,142,209,154,90,165,218,255,188,232,27,121,244,35,163,79,206,124,242,103,72,223,83,204,123,25,247,10,191,111,136,26,85,187,18,236,51,134,7,144,13,99,48,138,227,190,101,223,24,153,60,41,149,30,255,45,152,184,103,78,162,51,252,217,128,171,104,70,197,30,84,114,57,176,205,70,4,148,54,253,181,113,6,231,191,134,172,95,220,56,211,141,233,205,16,66,40,224,5,122,243,179,211,226,127,247,158,85,111,174,126,15,73,202,167,87,215,17,116,3,71,130,19,35,90,124,154,182,98,248,148,57,156,96,43,73,196,34,16,218,237,42,208,94,143,38,247,122,67,52,201,234,164,249,177,199,61,1,108,76,167,31,204,80,231,22,170,0,147,93,120,183,64,28,161,239,57,185,105,28,159,139,184,106,40,81,114,145,242,219,190,239,53,138,112,11,187,133,107,204,239,168,54,141,102,193,81,221,134,9,216,78,229,244,90,23,153,225,10,95,160,43,132,23,214,195,89,47,215,252,62,38,82,228,21,214,251,2,151,109,21,175,197,149,44,5,173,64,210,52,196,69,29,172,83,118,13,154,236,175,119,26,159,137,112,189,44,131,75,171,121,49,232,92,126,62,101,205,130,117,250,138,180,125,207,254,58,225,97,67,37,142,74,98,182,210,7,68,152,202,94,34,243,200,70,39,252,166,16,224,188,32,84,21,100,231,12,106,148,199,178,249,164,5,229,55,245,87,165,234,105,14,225,60,184,140,158,214,27,115,143,74,51,162,147,238,47,76,167,36,137,3,48,126,104,201,189,128,18,47,124,31,244,180,160,115,23,10,101,79,179,193,233,93,246,107,217,4,192,154,221,91,186,234,79,24,219,85,33,152,223]),n=new Uint8Array([7,87,145,233,57,15,124,219,7,163,132,35,222,160,41,99,10,23,228,253,53,207,65,214,94,146,248,134,214,15,97,230,201,181,41,105,189,206,171,100,146,78,188,106,177,87,141,232,198,122,70,178,149,26,124,174,16,55,115,35,70,179,158,111,74,241,122,159,29,90,47,242,23,229,213,16,245,72,26,183,58,136,205,43,86,239,139,226,77,188,203,86,224,144,50,30,135,62,11,218,255,68,156,185,59,121,91,49,199,152,219,109,243,162,14,221,113,192,3,100,42,152,233,168,22,123,251,210,153,191,99,173,139,114,2,133,201,32,169,135,64,118,1,47,89,31,102,76,154,35,63,164,255,127,9,62,106,187,4,91,44,222,17,80,39,209,237,82,107,251,148,11,231,174,208,130,194,171,234,184,248,121,216,199,110,28,212,137,240,77,164,232,25,128,247,150,57,193,20,160,44,211,75,191,96,37,81,254,147,66,8,140,54,21,177,89,74,51,175,93,39,199,55,115,84,202,104,179,230,124,97,222,64,177,27,111,239,158,17,57,105,219,42,209,95,132,231,13,144,244,194,157,226,18,143,180,66,166,48,5,74,32,169,142,7,241,128,52,216,137,185,228,26,124,84,166,189,71,38,158,221,115,1,65,123,102,250,216,34,242,140,113,212,188,249,85,118,197,156,89,5,70,116,167,202,153,240,114,4,246,203,100,46,185,84,31,209,173,6,130,196,22,225,91,155,61,16,49,103,229,36,206,173,249,46,92,12,73,33,223,142,60,172,126,22,234,135,246,151,75,52,97,161,79,182,12,235,132,207,150,184,20,78,143,101,28,196,235,134,178,53,195,24,108,82,215,150,55,168,110,43,189,233,144,207,59,125,44,168,108,34,220,69,166,244,58,225,125,149,63,213,104,253,93,155,184,11,250,73,96,201,8,218,88,14,117,223,105,247,193,71,88,254,122,3,132,191,113,10,181,40,83,0,162,127,41,210,235,122,36,195,18,228,65,131,176,253,38,19,165,0,146,27,203,178,54,96,234,43,159,90,218,245,112,191,229,18,79,66,137,51,160,180,141,118,164,30,101,154,71,137,94,217,56,238,134,17,153,200,80,29,204,67,23,155,52,172,33,145,198,175,7,223,103,87,244,41,79,236,204,51,186,81,199,176,112,77,224,40,110,170,223,144,251,174,131,98,205,73,121,247,97,238,116,29,204,62,2,213,183,145,24,125,241,228,45,31,129,160,92,188,246,62,6,102,50,116,15,240,140,10,218,59,45,151,83,167,255,130,157,107,55,92,219,110,5,61,147,252,8,212,51,12,140,75,126,183,215,83,194,43,226,88,165,109,187,21,215,68,39,192,20,239,198,12,68,174,159,99,121,192,70,231,177,119,209,237,19,154,33,232,163,65,180,29,200,129,4,231,135,182,98,147,76,118,165,136,248,40,211,14,85,169,107,25,151,100,36,164,197,92,58,136,2,123,106,148,252,75,210,162,53,120,9,233,217,46,28,226,83,128,195,245,224,38,141,205,61,249,86,48,227,114,255,186,207,77,236,16,56,39,102,85,30,247,203,60,87,179,103,186,56,152,22,180,131,53,236,81,15,190,134,175,8,72,147,24,99,48,215,192,172,139,240,196,149,108,168,17,127,157,252,1,206,114,74,161,98,3,186,156,120,221,27,108,211,129,40,170,242,158,131,91,115,225,20,178,71,45,222,142,197,36,66,145,93,234,34,198,67,217,109,243,45,67,161,237,54,195,224,85,112,6,32,69,155,9,64,123,212,3,94,242,76,113,214,25,170,49,220,119,148,28,170,90,10,200,143,80,95,153,18,64,202,175,220,250,42,208,96,163,254,133,185,21,52,230,190,126,244,138,13,86,254,58,138,211,125,179,251,34,2,183,248,126,143,54,187,78,136,235,193,50,32,82,117,173,161,98,9,82,63,105,187,19,205,37,230,76,21,104,60,167,119,214,106,37,227,13,101,120,167,25,109,146,227,201,60,238,38,148,206,181,42,163,236,176,128,107,154,184,50,225,208,133,232,49,73,165,90,239,152,204,0,89,182,72,11,156,101,217,14,130,252,111,227,5,72,95,47,196,0,245,94,149,13,84,27,150,193,19,181,68,30,48,243,61,221,127,246,24,138,190,69,88,57,26,141,210,151,220,249,67,117,166,35,194,112,176,202,95,237,139,208,111,129,216,190,142,37,171,197,81,47,119,229,159,200,171,79,120,33,133,169,23,213,80,138,238,69,44,253,63,117,4,56,250,172,78,157,93,116,6,104,162,241,31,182,1,103,46,243,189,59]);const r=new Uint8Array(4096);for(let e=0;e<1024;e++)r[4*e]=t[e],r[4*e+1]=n[e],r[4*e+2]=0,r[4*e+3]=0;const e=new Ol(r,32,32,Ke,Qe);return e.name="GTAONoiseTexture",e.wrapS=k,e.wrapT=k,e.needsUpdate=!0,e}}class x1{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:n,msg:t,transfer:r}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(t,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(n,r){return new Promise(e=>{var t=this._getIdleWorker();-1!==t?(this._initWorker(t),this.workerStatus|=1<<t,this.workersResolve[t]=e,this.workers[t].postMessage(n,r)):this.queue.push({resolve:e,msg:n,transfer:r})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const y1=new WeakMap;let b1=0;class M1 extends Id{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new x1,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('v3d.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}init(){if(!this.transcoderPending){const n=new Ld(this.manager);n.setPath(this.transcoderPath),n.setWithCredentials(this.withCredentials);var e=n.loadAsync("basis_transcoder.js");const r=new Ld(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);var t=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,t]).then(([e,t])=>{const n=M1.BasisWorker.toString();e=["/* constants */","let _EngineFormat = "+JSON.stringify(M1.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(M1.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(M1.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([e])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{const e=new Worker(this.workerSourceURL);var t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),0<b1&&console.warn("v3d.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),b1++}return this.transcoderPending}load(e,n,t,r){if(null===this.workerConfig)throw new Error("v3d.KTX2Loader: Missing initialization with `.detectSupport(renderer)`.");const i=new Ld(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const a=new pc;return i.load(e,e=>{if(y1.has(e)){const t=y1.get(e);return t.promise.then(n).catch(r)}this._createTexture([e]).then(function(e){a.copy(e),a.needsUpdate=!0,n&&n(a)}).catch(r)},t,r),a}_createTextureFrom(e){var{mipmaps:t,width:n,height:r,format:i,type:a,error:o,dfdTransferFn:s,dfdFlags:e}=e;if("error"===a)return Promise.reject(o);const l=new pc(t,n,r,i,Qe);return l.minFilter=1===t.length?Ge:ke,l.magFilter=Ge,l.generateMipmaps=!1,l.needsUpdate=!0,l.encoding=2===s?ft:pt,l.premultiplyAlpha=!!(1&e),l}_createTexture(e,t={}){const n=t;t=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e)).then(e=>this._createTextureFrom(e.data));return y1.set(e[0],{promise:t}),t}dispose(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),b1--,this}}M1.BasisFormat={ETC1S:0,UASTC_4x4:1},M1.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},M1.EngineFormat={RGBAFormat:Ke,RGBA_ASTC_4x4_Format:F,RGBA_BPTC_Format:st,RGBA_ETC2_EAC_Format:P,RGBA_PVRTC_4BPPV1_Format:E,RGBA_S3TC_DXT5_Format:C,RGB_ETC1_Format:L,RGB_ETC2_Format:B,RGB_PVRTC_4BPPV1_Format:S,RGB_S3TC_DXT1_Format:y},M1.BasisWorker=function(){let f,n,m;const g=_EngineFormat,v=_TranscoderFormat,A=_BasisFormat;self.addEventListener("message",function(e){const l=e.data;switch(l.type){case"init":f=l.config,t=l.transcoderBinary,n=new Promise(e=>{m={wasmBinary:t,onRuntimeInitialized:e},BASIS(m)}).then(()=>{m.initializeBasis(),void 0===m.KTX2File&&console.warn("v3d.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":n.then(()=>{try{var{width:e,height:t,hasAlpha:n,mipmaps:r,format:i,dfdTransferFn:a,dfdFlags:o}=function(e){const t=new m.KTX2File(new Uint8Array(e));function n(){t.close(),t.delete()}if(!t.isValid())throw n(),new Error("v3d.KTX2Loader:    Invalid or unsupported .ktx2 file");var r=t.isUASTC()?A.UASTC_4x4:A.ETC1S,i=t.getWidth(),a=t.getHeight(),o=t.getLevels(),s=t.getHasAlpha(),l=t.getDFDTransferFunc(),e=t.getDFDFlags(),{transcoderFormat:c,engineFormat:r}=function(t,n,r,i){let a,o;var s=t===A.ETC1S?_:x;for(let e=0;e<s.length;e++){const l=s[e];if(f[l.if]&&(l.basisFormat.includes(t)&&!(i&&l.transcoderFormat.length<2)&&(!l.needsPowerOfTwo||y(n)&&y(r))))return a=l.transcoderFormat[i?1:0],o=l.engineFormat[i?1:0],{transcoderFormat:a,engineFormat:o}}return console.warn("v3d.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),a=v.RGBA32,o=g.RGBAFormat,{transcoderFormat:a,engineFormat:o}}(r,i,a,s);if(!i||!a||!o)throw n(),new Error("v3d.KTX2Loader:    Invalid texture");if(!t.startTranscoding())throw n(),new Error("v3d.KTX2Loader: .startTranscoding failed");const u=[];for(let e=0;e<o;e++){var d=t.getImageLevelInfo(e,0,0),h=d.origWidth,p=d.origHeight,d=new Uint8Array(t.getImageTranscodedSizeInBytes(e,0,0,c));if(!t.transcodeImage(d,e,0,0,c,0,-1,-1))throw n(),new Error("v3d.KTX2Loader: .transcodeImage failed.");u.push({data:d,width:h,height:p})}return n(),{width:i,height:a,hasAlpha:s,mipmaps:u,format:r,dfdTransferFn:l,dfdFlags:e}}(l.buffers[0]);const s=[];for(let e=0;e<r.length;++e)s.push(r[e].data.buffer);self.postMessage({type:"transcode",id:l.id,width:e,height:t,hasAlpha:n,mipmaps:r,format:i,dfdTransferFn:a,dfdFlags:o},s)}catch(e){console.error(e),self.postMessage({type:"error",id:l.id,error:e.message})}})}var t});const e=[{if:"astcSupported",basisFormat:[A.UASTC_4x4],transcoderFormat:[v.ASTC_4x4,v.ASTC_4x4],engineFormat:[g.RGBA_ASTC_4x4_Format,g.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[A.ETC1S,A.UASTC_4x4],transcoderFormat:[v.BC7_M5,v.BC7_M5],engineFormat:[g.RGBA_BPTC_Format,g.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[A.ETC1S,A.UASTC_4x4],transcoderFormat:[v.BC1,v.BC3],engineFormat:[g.RGB_S3TC_DXT1_Format,g.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[A.ETC1S,A.UASTC_4x4],transcoderFormat:[v.ETC1,v.ETC2],engineFormat:[g.RGB_ETC2_Format,g.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[A.ETC1S,A.UASTC_4x4],transcoderFormat:[v.ETC1],engineFormat:[g.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[A.ETC1S,A.UASTC_4x4],transcoderFormat:[v.PVRTC1_4_RGB,v.PVRTC1_4_RGBA],engineFormat:[g.RGB_PVRTC_4BPPV1_Format,g.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],_=e.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),x=e.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function y(e){return e<=2||0==(e&e-1)&&0!==e}};class C1{static fromCubeTexture(r){let i=0;const a=new wn,o=new wn,s=new mn;var l=[0,0,0,0,0,0,0,0,0],e=new eh;const c=e.coefficients;for(let n=0;n<6;n++){var t=r.image[n],u=t.width,d=t.height;const _=document.createElement("canvas");_.width=u,_.height=d;const x=_.getContext("2d");x.drawImage(t,0,0,u,d);var d=x.getImageData(0,0,u,d),h=d.data,p=d.width,f=2/p;for(let e=0,t=h.length;e<t;e+=4){s.setRGB(h[e]/255,h[e+1]/255,h[e+2]/255),S1(s,r.encoding);var m=e/4,g=(m%p+.5)*f-1,v=1-(Math.floor(m/p)+.5)*f;switch(n){case 0:a.set(-1,v,-g);break;case 1:a.set(1,v,g);break;case 2:a.set(-g,1,-v);break;case 3:a.set(-g,-1,v);break;case 4:a.set(-g,v,1);break;case 5:a.set(g,v,-1)}var m=a.lengthSq(),A=4/(Math.sqrt(m)*m);i+=A,o.copy(a).normalize(),eh.getBasisAt(o,l);for(let e=0;e<9;e++)c[e].x+=l[e]*s.r*A,c[e].y+=l[e]*s.g*A,c[e].z+=l[e]*s.b*A}}var n=4*Math.PI/i;for(let e=0;e<9;e++)c[e].x*=n,c[e].y*=n,c[e].z*=n;return new th(e)}static fromCubeRenderTarget(e,r){let i=0;const a=new wn,o=new wn,s=new mn;var l=[0,0,0,0,0,0,0,0,0],t=new eh;const c=t.coefficients;var u=r.texture.type;for(let n=0;n<6;n++){var d=r.width;const A=u===Xe?Uint16Array:u===Ye?Float32Array:Uint8Array;var h=new A(d*d*4);e.readRenderTargetPixels(r,0,0,d,d,h,n);var p=2/d;for(let e=0,t=h.length;e<t;e+=4){u===Xe?s.setRGB(Sp.fromHalfFloat(h[e]),Sp.fromHalfFloat(h[e+1]),Sp.fromHalfFloat(h[e+2])):u===Ye?s.setRGB(h[e],h[e+1],h[e+2]):s.setRGB(h[e]/255,h[e+1]/255,h[e+2]/255),S1(s,r.texture.encoding);var f=e/4,m=(f%d+.5)*p-1,g=1-(Math.floor(f/d)+.5)*p;switch(n){case 0:a.set(1,g,-m);break;case 1:a.set(-1,g,m);break;case 2:a.set(m,1,-g);break;case 3:a.set(m,-1,g);break;case 4:a.set(m,g,1);break;case 5:a.set(-m,g,-1)}var f=a.lengthSq(),v=4/(Math.sqrt(f)*f);i+=v,o.copy(a).normalize(),eh.getBasisAt(o,l);for(let e=0;e<9;e++)c[e].x+=l[e]*s.r*v,c[e].y+=l[e]*s.g*v,c[e].z+=l[e]*s.b*v}}var n=4*Math.PI/i;for(let e=0;e<9;e++)c[e].x*=n,c[e].y*=n,c[e].z*=n;return new th(t)}}function S1(e,t){switch(t){case ft:e.convertSRGBToLinear();break;case pt:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return e}function w1(e,t,n,r,i){this._domElement=e,this._keyCode=t,this._callback=n,this._repeats=r,this._period=i,this._timer=0,this._counter=0,this._keydownCb=function(e){e.keyCode==this._keyCode&&(this._timer||(this._timer=window.setTimeout(function(){this._counter=0,this._timer=null}.bind(this),1e3*i)),++this._counter>=r&&(this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._counter=0,this._callback()))}.bind(this),this._domElement.addEventListener("keydown",this._keydownCb,!1)}function E1(e){this.data=void 0!==e?e:null,this.useHDR=!1}Object.assign(w1.prototype,{dispose:function(){this._domElement.removeEventListener("keydown",this._keydownCb,!1),this._timer&&window.clearTimeout(this._timer)}}),Object.assign(E1.prototype,{isSceneBackground:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(e){null===e.data?this.data=null:e.data.isColor?this.data=e.data.clone():e.data.isCubeTexture||e.data.isTexture?(this.data=e.data.clone(),this.data.needsUpdate=!0):e.data.isWebGLCubeRenderTarget?(this.data=e.data.clone(),this.data.texture.needsUpdate=!0):this.data=e.data,this.useHDR=e.useHDR},toJSON:function(e){const t={metadata:{version:4.5,type:"SceneBackground",generator:"SceneBackground.toJSON"}};return null!==this.data&&(t.data=this.data.toJSON(e)),t}});const T1={createMultiMaterialObject:function(n,r){const i=new js;for(let e=0,t=r.length;e<t;e++)i.add(new Ei(n,r[e]));return i},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){e.applyMatrix((new rr).copy(n.matrixWorld).invert()),t.remove(e),n.add(e)},getMaterialByName:function(e,t){t=this.getMaterialsByName(e,t);return t.length?t[0]:null},getMaterialsByName:function(e,t){const n=[];return null!==e.scene&&(e.scene.traverse(function(e){e.material&&e.material.name===t&&-1===n.indexOf(e.material)&&n.push(e.material)}),null!==(e=e.scene.worldMaterial)&&e.name===t&&-1===n.indexOf(e)&&n.push(e)),n},getAnimationActionByName:function(t,n){for(let e=0;e<t.actions.length;e++){const r=t.actions[e];if(r.getClip().name==n)return r}return null},checkActionIsUsed:function(n,e){return Boolean(e._propertyBindings.find(function(e){const t=e.binding.node;return t&&t.findRoot()===n}))},createEnvironmentMaterial:function(e,t,n){const r=new Wu.DiGraph(6),i={};if(r.node(0).originData={name:"Light Path",type:"LIGHT_PATH_BL",inputs:[],outputs:[0,0,0,0,0,0,0,0,0,0,0,0,0],is_active_output:!1},r.node(1).originData={name:"Lighting Texture",type:"TEX_ENVIRONMENT_BL",projection:"EQUIRECTANGULAR",inputs:[[0,0,0]],outputs:[[0,0,0,0]],texture:0,is_active_output:!1},i[dd.nodeTexUniName("TEX_ENVIRONMENT_BL",0)]=t,n instanceof mn){const a=[0,0,0,0];a[0]=n.r,a[1]=n.g,a[2]=n.b,a[3]=1,r.node(2).originData={name:"Background Color",type:"RGB_BL",inputs:[],outputs:[a],is_active_output:!1}}else r.node(2).originData={name:"Background Texture",type:"TEX_ENVIRONMENT_BL",projection:"EQUIRECTANGULAR",inputs:[[0,0,0]],outputs:[[0,0,0,0]],texture:1,is_active_output:!1},i[dd.nodeTexUniName("TEX_ENVIRONMENT_BL",1)]=n;return r.node(3).originData={name:"Mix",type:"MIX_RGB_BL",blendType:"MIX",inputs:[0,[0,0,0,0],[0,0,0,0]],outputs:[[0,0,0,0]],is_active_output:!1},r.node(4).originData={name:"Background",type:"BACKGROUND_BL",inputs:[[0,0,0,0],1],outputs:[[0,0,0,0]],is_active_output:!1},r.node(5).originData={name:"Output",type:"OUTPUT_WORLD_BL",inputs:[[0,0,0,0],[0,0,0,0]],outputs:[],is_active_output:!0},hd(r,0,0,3,0),hd(r,1,0,3,1),hd(r,2,0,3,2),hd(r,3,0,4,0),hd(r,4,0,5,0),new dd({name:e,nodeGraph:r,nodeTextures:i})},calcSceneBox:function(e){const t=new In;return t.expandByObject(e),t},createDefaultCamera:function(e,t){var n=new wn,r=2*e.getSize(n).length();const i=new Ni(45,t,r/1e4,r);return i.position.copy(e.max).multiplyScalar(2),i.lookAt(e.getCenter(n)),i},assignDefaultControls:function(e,t){var n=new Tr;t.getCenter(n.position),e.controls=new cv,e.controls.orbitMinDistance=e.near,e.controls.orbitMaxDistance=e.far,e.controls.orbitTarget=n}};function I1(){var n=0,r=document.createElement("div");function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";n=e}r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),t(++n%r.children.length)},!1);var i,a=(performance||Date).now(),o=a,s=0,l=e(new I1.Panel("FPS","#0ff","#002")),c=e(new I1.Panel("MS","#0f0","#020"));return self.performance&&self.performance.memory&&(i=e(new I1.Panel("MB","#f08","#201"))),t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e,t=(performance||Date).now();return c.update(t-a,200),o+1e3<=t&&(l.update(1e3*s/(t-o),100),o=t,s=0,i&&(e=performance.memory,i.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576))),t},update:function(){a=this.end()},domElement:r,setMode:t}}I1.Panel=function(n,r,i){var a=1/0,o=0,s=Math.round,l=s(window.devicePixelRatio||1),c=80*l,e=48*l,u=3*l,d=2*l,h=3*l,p=15*l,f=74*l,m=30*l,g=document.createElement("canvas");g.width=c,g.height=e,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*l+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,c,e),v.fillStyle=r,v.fillText(n,u,d),v.fillRect(h,p,f,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(h,p,f,m),{dom:g,update:function(e,t){a=Math.min(a,e),o=Math.max(o,e),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,c,p),v.fillStyle=r,v.fillText(s(e)+" "+n+" ("+s(a)+"-"+s(o)+")",u,d),v.drawImage(g,h+l,p,f-l,m,h,p,f-l,m),v.fillRect(h+f-l,p,l,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(h+f-l,p,l,s((1-e/t)*m))}}};const R1=["toneMapping","toneMappingMidTones","toneMappingPhysicalScale","toneMappingBrightness","toneMappingContrast","toneMappingChromaticAdaptation","toneMappingWhiteColor","toneMappingColorDifferentiation","toneMappingExteriorDaylight","toneMappingWhiteBalance","toneMappingHighlights","toneMappingShadows","toneMappingSaturation","toneMappingAperture","toneMappingShutter","toneMappingISO","toneMappingVignetting"];function L1(e,t,n){return 2*Tt*Math.atan(Math.tan(Et*e/2)*t/n)}class B1 extends t{constructor(e,t,n){super(),this.container=e instanceof HTMLElement?e:document.getElementById(e),rl.checkWebGL()?(this.scene=null,this.camera=null,this.clock=new _h,this.mixer=null,this.renderCallbacks=[],this.compileCallbacks=[],this.elapsed=0,this.frame=0,this.preloader=n,this.worldCubemapRes=1024,this._pmremMaxTileSize=256,this._lightProbeCubemapRes=64,this.xrSession=null,this.xrControllers=[],void 0===(t=t||{}).alpha&&(t.alpha=!1),void 0===t.depth&&(t.depth=!0),void 0===t.stencil&&(t.stencil=!0),void 0===t.antialias&&(t.antialias=!0),void 0===t.premultipliedAlpha&&(t.premultipliedAlpha=!0),void 0===t.preserveDrawingBuffer&&(t.preserveDrawingBuffer=!1),rl.isSafariWithMultisamplingBug()&&(console.warn("v3d.App: disabling buggy context AA on Safari 15.4/15.5"),t.antialias=!1),this.renderer=new il(t),Ng.prepareRenderer(this.renderer),this.clearBkgOnLoad=!1,this.frameRateDivider=1,this.enableRender=!0,this.disableRenderTrigger=0,this.ssaaOnPause=!1,this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.outputEncoding=ft,this.container.appendChild(this.renderer.domElement),this.container.classList.add("v3d-container"),this.renderer.domElement.classList.add("v3d-canvas"),this.container.setAttribute("translate","no"),this.loader=new dv,t=(new M1).setTranscoderPath(on()).detectSupport(this.renderer),this.loader.setKTX2Loader(t),ci.prototype.computeBoundsTree=sm,ci.prototype.disposeBoundsTree=lm,Ei.prototype.raycast=om,this.actions=[],this.materials={push:function(){}},this.updateMaterials=function(){},this._envIBLMode=0,this._envLightProbe=null,this._resizeCb=null,this._loadSceneURL="",this._loadingTime=0,this._backgroundSave=null,this._postprocessingSave=null,this.stats=null,Dg.drawWatermark(this),Dg.addToAppList(this),this.worldMaterial=null):rl.showWebGLErrorMessage(this.container)}_updateRendererFromGLTF(t){const e=this;var n=rl.checkHalfFloatTex(this.renderer,!0);if(t.renderer.shadowMap?(this.renderer.shadowMap.enabled=t.renderer.shadowMap.enabled,this.renderer.shadowMap.type=t.renderer.shadowMap.type,n||this.renderer.shadowMap.type!==te||(this.renderer.shadowMap.type=J,t.scene.traverse(function(e){e.isLight&&e.castShadow&&e.shadow&&(e.shadow.bias/=100,e.shadow.isDirectionalLightShadowCSM&&(e.shadow.radius*=100/e.shadow.mapSize.x/2,e.shadow=(new Xd).copy(e.shadow),e.shadow.camera.updateProjectionMatrix()))}))):(this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=J),t.renderer.physicallyCorrectLights&&(this.renderer.physicallyCorrectLights=!0),this.aaMethod=t.renderer.aaMethod||"AUTO",this.useHDR=Boolean(t.renderer.useHDR&&n),this.renderer.unitsScaleFactor=t.renderer.unitsScaleFactor,t.renderer.toneMapping)for(let e=0;e<R1.length;e++){var r=R1[e];$t(t.renderer[r])&&(this.renderer[r]=t.renderer[r])}void 0!==t.renderer.pmremMaxTileSize&&(this._pmremMaxTileSize=t.renderer.pmremMaxTileSize),void 0!==t.renderer.iblEnvironmentMode&&(this._envIBLMode=t.renderer.iblEnvironmentMode),void 0!==t.renderer.esmDistanceScale&&(this.renderer.shadowMap.esmDistanceScale=t.renderer.esmDistanceScale),t.scene.traverse(function(t){t.hidpiCompositing&&(t.traverse(e=>{t.isMesh&&e.layers.set(7)}),e.useHiDPIRenderPass=!0,e.renderer.setPixelRatio(window.devicePixelRatio))}),e.useHiDPIRenderPass&&t.scene.traverse(function(e){e.isLight&&e.layers.enable(7)})}_updateMeshesRaycastFromGLTF(e){e.scene&&e.scene.traverse(function(e){const t=e.geometry;e.isMesh&&(!t.computeBoundsTree||0!==Object.keys(t.morphAttributes).length||t.attributes.position.isInterleavedBufferAttribute||t.index&&t.index.isInterleavedBufferAttribute||t.computeBoundsTree({verbose:!1}))})}_prepareReflProbesFromGLTF(e){e.scene&&e.scene.traverse(e=>{var t;e.isCubeReflectionProbe?this._prepareEnvMapProbe(e):!e.isPlaneReflectionProbe||0<(t=this._checkMSAA(this.renderer,4))&&e.makeMultisampleRenderTarget(t)})}_prepareEnvMapProbe(e){switch(e.setSize(this._pmremMaxTileSize),this._envIBLMode){case 0:e.onUpdate=e=>this.generateRTargetPMREM(e);break;case 1:break;case 2:e.onUpdate=()=>null}}_prepareReflProbesEncoding(e,t){e.traverse(e=>{(e.isCubeReflectionProbe||e.isPlaneReflectionProbe)&&e.setEncoding(t)})}_prepareEnvMapProbeWorld(){const e=new oa;e.worldMaterial=this.scene.worldMaterial,null===this.scene.worldEnvMapProbe&&(this.scene.worldEnvMapProbe=new kg(this._pmremMaxTileSize),this.scene.worldEnvMapProbe.influenceType=0,this.scene.worldEnvMapProbe.parallaxType=0);const t=this.scene.worldEnvMapProbe;switch(this._envIBLMode){case 0:t.onUpdate=e=>this.generateRTargetPMREM(e);break;case 1:case 2:t.onUpdate=e=>{const t=e.clone();t.setSize(this._lightProbeCubemapRes,this._lightProbeCubemapRes),rl.checkHalfFloatReadPixels(this.renderer)?t.texture.type=Xe:rl.checkFloatReadPixels(this.renderer)?t.texture.type=Ye:(console.warn("v3d.App: Target platform does not support reading pixels in float format, expect quality loss."),t.texture.type=Qe),t.texture.format=Ke,t.texture.encoding=pt;const n=new og(e.texture);return n.render(this.renderer,t),n.dispose(),this._disposeEnvLightProbe(),this._envLightProbe=C1.fromCubeRenderTarget(this.renderer,t),this.scene.add(this._envLightProbe),t.dispose(),1===this._envIBLMode?e:null}}t.update(e,this.renderer),this.renderer.compatSettings.useSpecEnvBlenderApprox=0===this._envIBLMode}_updateMaterialsFromGLTF(e){const n=this;e.scene&&e.scene.traverse(function(e){const t=e.material;t&&n.useHDR&&(t.useHDR=!0,t.useFloatTex=rl.checkFloatTex(n.renderer,!0),t.isMeshNodeMaterial&&t.updateNodeGraph())})}_updateAnimationsFromGLTF(e,r){const i=this;!i.mixer&&e.animations&&e.animations.length&&(i.mixer=new Vh(i.scene)),(e.animations||[]).forEach(function(t){var n=r.getObjectById(t.nodeId);if(n){let e;e=n.id==r.id||""!==n.name&&"root"!==n.name&&"."!==n.name&&n.name!==r.name&&n.name!==r.uuid?i.mixer.clipAction(t.clip,r):i.mixer.clipAction(t.clip,n),e.setLoop(t.loop,t.repetitions),e.startAt(t.startAt+i.mixer.time),e.clampWhenFinished=!0,t.auto?e.play():(e.stop(),e.paused=!0),i.actions.push(e)}})}_traverseSceneForTexUniforms(e,n){e.traverse(function(t){if(t.material){const e=Array.isArray(t.material)?t.material:[t.material];e.forEach(function(e){void 0!==e.program&&n(t,e,e.program.getTexUniformCount())})}})}_checkMSAA(e,t){return Math.min(t,e.capabilities.maxSamples)}_precompileSceneAsync(e,t,n,r){const i=this,a=i.compileCallbacks;for(let e=0;e<a.length;e++)a[e](i);const o=i.renderer.getRenderTarget();i.renderer.setRenderTarget(n),i.renderer.compileAsync(e,t,function(e){1<=e&&i.renderer.setRenderTarget(o),r&&r(100*e)})}_handleAlphaToCoverage(n){this.scene.traverse(function(e){const t=e.material;t&&t.alphaToCoverage&&(0<n?(t.transparent=!1,t.premultipliedAlpha=!1,t.blending=ie):t.alphaToCoverage=!1)})}assignClippingPlanes(e){let n=[],r=[],i=[],a=-1e3;e.traverse(function(t){t.isClippingPlaneObject&&(n.push(t),r.push(t.plane),e.traverse(function(e){t.needsClippingPlane(e)&&t.assignToObject(e,a++)}),i.push(a++))});for(let e=0;e<n.length;e++){const t=n[e];t.crossSection&&t.createCrossSectionPlane(r,i[e])}n.length&&(this.renderer.localClippingEnabled=!0,this.postprocessing&&this.postprocessing.composer.setStencil(!0))}updateConstraints(e){const r=this;e.traverse(function(t){for(let e=0;e<t.constraints.length;e++){const n=t.constraints[e];n.isCanvasBreakpointsConstraint&&(n.appInstance=r)}})}load(e,t,n,r){console.warn("v3d.App.load has been deprecated. Use v3d.App.loadScene instead.");const i=this;i.loadScene(e,function(e){t(e),r&&i.run()},null,n)}loadScene(e,i,a,t){const o=this;o.renderer?(o._loadSceneURL=e,o._loadingTime=performance.now(),o.preloader&&o.preloader.onUpdate(0),this.loader.load(e,function(t){o.scene=t.scene||new oa;let e=null;t.cameras&&t.cameras.length?o.camera=t.cameras[0]:(e=T1.calcSceneBox(o.scene),o.camera=T1.createDefaultCamera(e,o.container.offsetWidth/o.container.offsetHeight),o.scene.add(o.camera)),o.camera.controls||(e=e||T1.calcSceneBox(o.scene),T1.assignDefaultControls(o.camera,T1.calcSceneBox(o.scene)),o.camera.viewportFit.type=1),o._updateRendererFromGLTF(t),o._prepareReflProbesFromGLTF(t),o._updateMaterialsFromGLTF(t),o._updateAnimationsFromGLTF(t,o.scene);var n=t.world.material;n&&(o.scene.background=new E1,o.scene.worldMaterial=n,o.updateEnvironment(n),o.worldMaterial=n),o.initPostprocessing(),o.assignClippingPlanes(o.scene),o.updateConstraints(o.scene),o.onResize&&o.onResize(),o.scene.updateMatrixWorld(),o.scene.visible=!1,o.scene.disableChildRendering=!0;function r(){o.scene&&o._traverseSceneForTexUniforms(o.scene,function(e,t,n){8<n&&console.warn(`v3d.App: Material "${t.name}" on object `+`"${e.name}" exceeds iOS limit of `+"8 textures "+`(has ${n}).`)}),o.removeEventListener("firstFrameRendered",r)}n=o.postprocessing?o.postprocessing.composer.renderTarget1:null;o._precompileSceneAsync(o.scene,o.camera,n,function(e){e=60+.4*e;a&&a(e),o.preloader&&o.preloader.onUpdate(e),100<=e&&(o._updateMeshesRaycastFromGLTF(t),o.addEventListener("firstFrameRendered",r),i&&setTimeout(function(){o.scene.visible=!0,o.scene.disableChildRendering=!1,o.updateReflectionProbes(o.scene),o._loadingTime=performance.now()-o._loadingTime,o.dispatchEvent({type:"loadSceneEnd"}),i(o.scene)},16))}),o.clearBkgOnLoad&&(o.scene.background=null),o._tripleP=new w1(window,G0.P,function(){Dg.printPerformanceInfo(o,1)},3,1),o._tripleF=new w1(window,G0.F,function(){o.stats?o.hideFPS():o.showFPS()},3,1),o._tripleH=new w1(window,G0.H,function(){o.enableRender?o.disableRendering():o.enableRendering()},3,1)},function(e){e*=.6;a&&a(e),o.preloader&&o.preloader.onUpdate(e)},function(e){console.error(e),t&&t(e)}),window.removeEventListener("resize",this._resizeCb,!1),this._resizeCb=function(){o.onResize&&o.onResize()},window.addEventListener("resize",this._resizeCb,!1)):t&&t("WebGL not found")}appendScene(e,a,o,t,s,l){const c=this;c.renderer?(void 0===s&&(s=!0),void 0===l&&(l=!0),c.preloader&&c.preloader.onUpdate(0),this.loader.load(e,function(t){const n=t.scene||new oa,r=[];n.traverse(function(e){(e.isCamera&&!s||e.isLight&&!l)&&r.push(e)}),r.forEach(function(e){c.unload(e)}),c.scene&&(c.scene.add(n),c._prepareReflProbesFromGLTF(t),c._updateMaterialsFromGLTF(t),c._updateAnimationsFromGLTF(t,n),c.scene.updateMatrixWorld());var e=c.postprocessing?c.postprocessing.composer.renderTarget1:null,i=c.scene||n;c.assignClippingPlanes(i),c.updateConstraints(i),n.visible=!1,n.disableChildRendering=!0,c._precompileSceneAsync(i,c.camera||new Di,e,function(e){e=60+.4*e;o&&o(e),c.preloader&&c.preloader.onUpdate(e),100<=e&&(c._updateMeshesRaycastFromGLTF(t),c._traverseSceneForTexUniforms(n,function(e,t,n){8<n&&console.warn(`v3d.App: Material "${t.name}" on object `+`"${e.name}" exceeds iOS limit of `+"8 textures "+`(has ${n}).`)}),a&&setTimeout(function(){n.visible=!0,n.disableChildRendering=!1,c.updateReflectionProbes(c.scene),a(n)},16))})},function(e){e*=.6;o&&o(e),c.preloader&&c.preloader.onUpdate(e)},function(e){console.error(e),t&&t(e)})):t&&t("WebGL not found")}unload(e){const t=this;function r(e){if(e.isAnnotation)e.dispose();else if(e.isLight&&e.shadow&&e.shadow.isLightShadow)e.shadow.dispose();else if(e.isCamera&&e.controls&&e.controls.orbitTarget)r(e.controls.orbitTarget);else if(e.isScene){const t=e.worldMaterial;null!==t&&(um.disposeTextures(t),t.dispose()),null!==e.worldEnvMapProbe&&(e.worldEnvMapProbe.dispose(),e.worldEnvMapProbe=null)}else if(e.isMesh){e.geometry.dispose(),e.geometry.disposeBoundsTree&&e.geometry.disposeBoundsTree();const n=e.material;um.disposeTextures(n),n.dispose()}}if((e=e||t.scene)===t.scene){if(t.scene&&(t.scene.traverse(r),t.disposeEnvironment()),t.scene=null,t.controls&&t.controls.dispose&&t.controls.dispose(),t.controls=null,t.camera=null,t.mixer&&(t.mixer.stopAllAction(),t.actions.forEach(function(e){t.mixer.uncacheAction(e.getClip(),e.getRoot())})),t.mixer=null,t.actions=[],t.postprocessing){if(t.postprocessing.composer)for(var n in t.postprocessing){const i=t.postprocessing[n];(i instanceof lg||i instanceof Qg)&&i.dispose()}t.disablePostprocessing()}t.postprocessing=null,dg.dispose(),t.renderer&&t.renderer.disposeInternalCaches(),t._tripleP&&t._tripleP.dispose(),t._tripleF&&t._tripleF.dispose(),t._tripleH&&t._tripleH.dispose(),t.useHiDPIRenderPass=!1,t.renderer.setPixelRatio(1)}else if(t.scene&&(e.traverse(r),e.parent&&e.parent.remove(e)),t.mixer)for(let e=t.actions.length-1;0<=e;e--){const a=t.actions[e];T1.checkActionIsUsed(t.scene,a)||(a.stop(),t.mixer.uncacheAction(a.getClip(),a.getRoot()),t.actions.splice(e,1))}}dispose(){this.scene&&this.unload(),this.renderer&&(this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderer.domElement.parentElement===this.container&&this.container.removeChild(this.renderer.domElement)),this.renderer=null,window.removeEventListener("resize",this._resizeCb,!1),Dg.removeFromAppList(this),wd.clear(),this.dispatchEvent({type:"dispose"})}getWidth(){return this.container.offsetWidth}getHeight(){return this.container.offsetHeight}onResize(){this.enableRender&&!this.ssaaOnPause||(this.enableRendering(),this.disableRendering(1));const t=this.getWidth(),n=this.getHeight();if(this.renderer.setSize(t,n),this.postprocessing&&(this.postprocessing.gtaoGenerator&&this.postprocessing.gtaoGenerator.setSize(t,n),this.postprocessing.composer.setSize(t,n)),this.scene){this.scene.traverse(e=>{e.isPlaneReflectionProbe&&e.setSize(t,n)});var r=t/n;const s=this.camera;if(s.isPerspectiveCamera){var e=s.aspect<s.viewportFit.initialAspect,i=r<s.viewportFit.initialAspect;switch(s.viewportFit.type){case 1:s.aspect=r;break;case 2:s.fov=L1(s.fov,s.aspect,r),s.aspect=r;break;case 3:e&&i?s.fov=L1(s.fov,s.aspect,r):e&&!i?s.fov=L1(s.fov,s.aspect,s.viewportFit.initialAspect):!e&&i&&(s.fov=L1(s.fov,s.viewportFit.initialAspect,r)),s.aspect=r;break;case 5:e&&i?s.fov=L1(s.fov,s.aspect,r):e&&!i?s.fov=L1(s.fov,s.viewportFit.initialAspect,r):!e&&i&&(s.fov=L1(s.fov,s.aspect,r)),s.aspect=r;break;case 4:e||i?(e&&!i||!e&&i)&&(s.fov=L1(s.fov,s.aspect,s.viewportFit.initialAspect)):s.fov=L1(s.fov,s.aspect,r),s.aspect=r}}else if(s.isOrthographicCamera){let e,t;switch(s.viewportFit.type){case 1:e=s.top*r,s.left=-e,s.right=e;break;case 2:t=s.right/r,s.bottom=-t,s.top=t;break;case 3:var a=(s.right-s.left)/(s.top-s.bottom)<s.viewportFit.initialAspect,o=r<s.viewportFit.initialAspect;e=a&&o?s.right:a&&!o?s.right*r/s.viewportFit.initialAspect:!a&&o?s.top*s.viewportFit.initialAspect:s.top*r,s.left=-e,s.right=e,s.bottom=-e/r,s.top=e/r;break;case 4:t=s.right/r,s.bottom=-t,s.top=t;break;case 5:e=s.top*r,s.left=-e,s.right=e}}s.updateProjectionMatrix()}}run(){this.preloader&&(this.preloader.onFinish(),this.preloader=null),this.animate()}animate(){const r=this;r.renderer.setAnimationLoop(function(){r.stats&&r.stats.begin();var t=r.clock.getDelta();r.elapsed=t,r.mixer&&r.mixer.update(t),r.controls&&!r.xrSession&&r.controls.update(t);const n=r.renderCallbacks;for(let e=0;e<n.length;e++)n[e](t,r.clock.elapsedTime);r.frame%r.frameRateDivider==0&&r.enableRender&&(r.render(),0===r.frame&&r.dispatchEvent({type:"firstFrameRendered"})),r.frame++,r.disableRenderTrigger&&0==--r.disableRenderTrigger&&(r.enableRender=!1),r.stats&&r.stats.end()})}enableRendering(){this.disableRenderTrigger=0,this.enableRender=!0,this.ssaaOnPause&&this.enableSSAA(0,!0)}disableRendering(e){((e=e||0)||this.ssaaOnPause)&&this.enableRender&&0==this.disableRenderTrigger?(this.disableRenderTrigger=this.ssaaOnPause?32:e,this.ssaaOnPause&&this.enableSSAA(4,!0)):0==e&&(this.enableRender=!1)}setFrameRateDivider(e){this.frameRateDivider=e}render(){this.dispatchEvent({type:"onBeforeRender"});var e,t,n=!!this.scene&&!!this.camera;if(n&&this.scene.traverse(e=>{e.isPlaneReflectionProbe&&e.update(this.scene,this.camera,this.renderer)}),this.renderer.gtaoMapEnabled=!0,this.postprocessing){const r=this.postprocessing.gtaoGenerator;r&&r.render(this.renderer);const i=this.postprocessing.composer;i.render(this.elapsed)}else n&&this.renderer.render(this.scene,this.camera);n&&this.useHiDPIRenderPass&&(e=this.camera.layers.mask,t=this.scene.background,n=this.renderer.autoClear,this.scene.background=null,this.camera.layers.set(7),this.renderer.autoClear=!1,this.renderer.clearDepth(),this.renderer.render(this.scene,this.camera),this.camera.layers.mask=e,this.scene.background=t,this.renderer.autoClear=n),this.renderer.gtaoMapEnabled=!1,this.dispatchEvent({type:"onAfterRender"})}enableControls(e){const t=this.camera;if(t.controls){if(!this.controls||t!==this.controls.object||!(this.controls instanceof ag&&"ORBIT"===t.controls.type||this.controls instanceof X0&&"FLYING"===t.controls.type||this.controls instanceof H0&&"FIRST_PERSON"===t.controls.type))switch(this.controls&&this.controls.dispose(),t.controls.type){case"ORBIT":this.controls=new ag(t,e||this.renderer.domElement);break;case"FLYING":this.controls=new X0(t,this.renderer.domElement);break;case"FIRST_PERSON":this.controls=new H0(t,this.renderer.domElement);break;default:this.controls=null}this.controls&&(t.controls.assignToControls(this.controls,this.scene),this.controls.update())}}setCamera(t){if(this.camera=t,this.postprocessing){const n=this.postprocessing.composer.passes;for(let e=0;e<n.length;e++)n[e].setCamera(t);this.postprocessing.renderPass&&this.postprocessing.renderPass.setCamera(t),this.postprocessing.ssaaRenderPass&&this.postprocessing.ssaaRenderPass.setCamera(t),this.postprocessing.gtaoGenerator&&this.postprocessing.gtaoGenerator.setCamera(t)}this.enableControls(),this.onResize()}getCamera(e=!1){return e&&this.camera&&this.renderer&&this.renderer.xr.enabled&&this.renderer.xr.isPresenting?this.renderer.xr.getCamera(this.camera):this.camera}cleanup(){if(console.warn("v3d.App.cleanup has been deprecated. Use v3d.App.unload or v3d.App.dispose instead."),this.container)for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild);this.loader&&this.mixer&&this.mixer.stopAllAction()}initPostprocessing(){(this.scene.postprocessing&&this.scene.postprocessing.length||this.useHDR||this.useHiDPIRenderPass||"AUTO"!=this.aaMethod)&&this.enablePostprocessing(this.scene.postprocessing||[]),this.postprocessing||this._handleAlphaToCoverage(this.renderer.getContextAttributes().antialias?4:0)}enablePostprocessing(t){const c={format:Ke,stencilBuffer:!1};this.useHDR?(c.type=Xe,c.encoding=pt):(c.type=Qe,c.encoding=ft),this._prepareReflProbesEncoding(this.scene,c.encoding);let u;if(this.postprocessing)u=this.postprocessing.composer;else{this.postprocessing={};var n=new Ig(this.scene,this.camera);this.postprocessing.renderPass=n;let e=0;switch(this.aaMethod){case"AUTO":case"MSAA4":e=this._checkMSAA(this.renderer,4);break;case"MSAA8":e=this._checkMSAA(this.renderer,8);break;case"MSAA16":e=this._checkMSAA(this.renderer,16)}rl.checkSwiftShader(this.renderer)&&(console.warn("v3d.App: disabling buggy multisampling on SwiftShader renderer"),e=0),rl.isSafariWithMultisamplingBug()&&(console.warn("v3d.App: disabling buggy multisampling on Safari 15.4/15.5"),e=0);let t;e?(t=new Cn(this.getWidth(),this.getHeight(),c),t.samples=e):t=new bn(this.getWidth(),this.getHeight(),c),t.texture.name="EffectComposer.rt1",u=new Qg(this.renderer,t),u.addPass(n),this.postprocessing.composer=u;var r=this.renderer.getContextAttributes().alpha,n=0==e&&"NONE"!=this.aaMethod;const i=new Bg;if(n&&!r&&(i.material.defines.ALPHA_AS_LUMA=1),u.addPass(i),this.postprocessing.toneMapPass=i,n){const a=new vg(this.scene,this.camera);this.useHDR&&!r&&(a.material.defines.FXAA_GREEN_AS_LUMA=0),u.addPass(a),this.postprocessing.fxaaPass=a}this._handleAlphaToCoverage(e)}t.length&&this.postprocessing.copyPass&&(u.passes.splice(u.passes.indexOf(this.postprocessing.copyPass),1),this.postprocessing.copyPass=null);for(let e=0;e<t.length;e++){var d,h=t[e];let l=u.passes.length-1;switch(u.passes[l]instanceof vg&&l--,h.type){case"afterimage":var p=h.damp;let e;this.postprocessing.afterimagePass?(e=this.postprocessing.afterimagePass,e.damp=p):(e=new hg(new Yt(this.getWidth(),this.getHeight()),p,c),u.insertPass(e,l),this.postprocessing.afterimagePass=e);break;case"bloom":var f=h.strength,p=h.radius,m=h.threshold;let t;this.postprocessing.bloomPass?(t=this.postprocessing.bloomPass,t.strength=f,t.radius=p,t.threshold=m):(t=new pg(new Yt(this.getWidth(),this.getHeight()),f,p,m,c),u.insertPass(t,l),this.postprocessing.bloomPass=t);break;case"brightnessContrast":let n;this.postprocessing.brightnessContrastPass?n=this.postprocessing.brightnessContrastPass:(n=new gg,u.insertPass(n,l),this.postprocessing.brightnessContrastPass=n),n.brightness=h.brightness,n.contrast=h.contrast;break;case"dof":let r;this.postprocessing.bokehPass?r=this.postprocessing.bokehPass:(r=new fg(this.scene,this.camera,{width:this.getWidth(),height:this.getHeight()}),u.insertPass(r,l),this.postprocessing.bokehPass=r),r.focus=h.focus,r.aperture=h.aperture,r.maxblur=h.maxblur,r.depthLeakThreshold=h.depthLeakThreshold;break;case"grayscale":this.postprocessing.grayscalePass||(m=new Ag,u.insertPass(m,l),this.postprocessing.grayscalePass=m);break;case"gtao":case"ao":if(!rl.checkDepthTex(this.renderer)){console.warn("v3d.App: disabling GTAO since your hardware does not support depth textures");break}let i=this.postprocessing.gtaoGenerator;if(!i){i=this.postprocessing.gtaoGenerator=new _1(this.scene,this.camera,this.getWidth(),this.getHeight());const g=e=>{i.removeEventListener("dispose",g),this.renderer.disposeGTAO()};i.addEventListener("dispose",g),this.renderer.gtaoMap=i.renderTarget.texture}i.distance=h.distance,i.factor=h.factor,i.precision=h.precision,i.bentNormals=null!=(d=h.bentNormals)&&d,i.bounceApprox=h.bounceApprox;break;case"outline":let a;this.postprocessing.outlinePass?a=this.postprocessing.outlinePass:(a=new Tg(new Yt(this.getWidth(),this.getHeight()),this.scene,this.camera),u.insertPass(a,l),this.postprocessing.outlinePass=a),a.edgeStrength=h.edgeStrength,a.edgeGlow=h.edgeGlow,a.edgeThickness=h.edgeThickness,a.pulsePeriod=h.pulsePeriod,a.visibleEdgeColor.fromArray(h.visibleEdgeColor),a.hiddenEdgeColor.fromArray(h.hiddenEdgeColor),void 0===h.renderHiddenEdge?(d=0===h.hiddenEdgeColor[0]&&0===h.hiddenEdgeColor[1]&&0===h.hiddenEdgeColor[2],a.hiddenEdgeColor.setW(Number(!d))):a.hiddenEdgeColor.setW(Number(h.renderHiddenEdge));break;case"ssr":if(!rl.checkHalfFloatTex(this.renderer,!1)){console.warn("v3d.App: disabling SSR since your hardware does not support half float textures");break}let o=!1;$t(h.useRefract)&&(o=h.useRefract);let s;(o?this.postprocessing.ssrPassRefract:this.postprocessing.ssrPassReflect)?s=o?this.postprocessing.ssrPassRefract:this.postprocessing.ssrPassReflect:(s=new Lg(this.scene,this.camera),u.insertPassAfter(s,[this.postprocessing.renderPass,this.postprocessing.ssrPassRefract,this.postprocessing.ssrPassReflect]),o?this.postprocessing.ssrPassRefract=s:this.postprocessing.ssrPassReflect=s),s.useRefract=o,$t(h.objects)&&(s.objects=h.objects),$t(h.intensity)&&(s.intensity=h.intensity),$t(h.steps)&&(s.steps=h.steps),$t(h.stride)&&(s.stride=h.stride),$t(h.binarySearchSteps)&&(s.binarySearchSteps=h.binarySearchSteps),$t(h.renderTargetScale)&&(s.renderTargetScale=h.renderTargetScale),$t(h.thickness)&&(s.thickness=h.thickness),$t(h.maxDistance)&&(s.maxDistance=h.maxDistance),$t(h.jitter)&&(s.jitter=h.jitter),$t(h.renderAfter)&&(s.renderAfter=h.renderAfter),$t(h.simpleRefraction)&&(s.simpleRefraction=h.simpleRefraction),this.onResize&&this.onResize();break;default:console.error(`v3d.App: wrong postprocessing effect "${h.type}"`)}}1==u.passes.length&&(r=new mg(Zi.copy),u.passes.push(r),this.postprocessing.copyPass=r)}disablePostprocessing(e,t){if(this.postprocessing){const r=this.postprocessing.gtaoGenerator;!t&&r&&(r.dispose(),this.postprocessing.gtaoGenerator=null);const i=["afterimagePass","bloomPass","brightnessContrastPass","bokehPass","grayscalePass","ssrPassReflect","ssrPassRefract"];e||i.push("outlinePass");const a=this.postprocessing.composer;for(let e=0;e<i.length;e++){var n=i[e];this.postprocessing[n]&&(a.passes.splice(a.passes.indexOf(this.postprocessing[n]),1),this.postprocessing[n].dispose(),this.postprocessing[n]=null)}"AUTO"!=this.aaMethod||1!=a.passes.length||this.postprocessing.gtaoGenerator?1==a.passes.length&&(e=new mg(Zi.copy),a.passes.push(e),this.postprocessing.copyPass=e):(this.postprocessing.renderPass.dispose(),this.postprocessing.composer.dispose(),this.postprocessing=null)}}enableSSAA(t,n){if(this.postprocessing||this.enablePostprocessing([]),this.postprocessing&&!(0<t&&(this.postprocessing.ssrPassRefract||this.postprocessing.ssrPassReflect))){const r=this;this.scene.traverse(function(e){e.isAnnotationControl&&(e.update(r.camera),e.doUpdate=!Boolean(t))});const i=this.postprocessing.composer;if(0<t&&i.passes[0]instanceof Ig){let e;this.postprocessing.ssaaRenderPass?e=this.postprocessing.ssaaRenderPass:(e=new Rg(this.scene,this.camera),this.postprocessing.ssaaRenderPass=e,n&&e.addEventListener("iteration",function(e){e.frame==t*t-1&&(i.enableAllPasses(),i.renderToScreen=!0,i.passes[i.passes.length-1].renderToScreen=!0,r.disableRenderTrigger=1)})),e.sampleLevel=t||4,i.passes[0]=e,this.postprocessing.fxaaPass&&i.passes.splice(i.passes.length-1,1),n&&(e.iterative=!0,e.iterativeFrame=0,i.disableAllPasses(),i.renderToScreen=!1,e.enabled=!0)}else 0<t?(i.passes[0].sampleLevel=t||4,n&&(ssaaRenderPass.iterative=!0,ssaaRenderPass.iterativeFrame=0,i.disableAllPasses(),i.renderToScreen=!1,ssaaRenderPass.enabled=!0)):0==t&&i.passes[0]instanceof Rg&&(i.passes[0]=this.postprocessing.renderPass,this.postprocessing.fxaaPass&&i.passes.push(this.postprocessing.fxaaPass),i.enableAllPasses(),i.renderToScreen=!0)}}updateEnvironment(e){var t=this.renderer.xr.enabled;this.renderer.xr.enabled=!1,this.disposeEnvironment(),e.useHDR=!0,null!==this.scene.background&&this.scene.background.isSceneBackground&&(this.scene.background.data=Fg.renderWorldNodeMatToCubemap(this.renderer,e,this.worldCubemapRes,{encoding:ft,format:Ke,generateMipmaps:!0,minFilter:ke,type:Xe}),this.scene.background.useHDR=this.useHDR),0===this._envIBLMode&&new ba(this.renderer,this._pmremMaxTileSize,!0).compileCubemapShader(),this._prepareEnvMapProbeWorld(),this.renderer.xr.enabled=t}disposeEnvironment(){this._disposeEnvLightProbe();let e=this.scene.background;e&&(e.isSceneBackground&&(e=e.data),e&&(e.isTexture||e.isWebGLRenderTarget)&&e.dispose())}_disposeEnvLightProbe(){null!==this._envLightProbe&&(this.scene.remove(this._envLightProbe),this._envLightProbe=null)}updateReflectionProbes(e){e.traverse(e=>{e.isCubeReflectionProbe&&e.update(this.scene,this.renderer)})}updateObjectMaterialEnv(e){console.warn("v3d.App.updateObjectMaterialEnv has been deprecated: not needed anymore")}generateRTargetPMREM(e){if(!e.isWebGLCubeRenderTarget)return null;const t=new ba(this.renderer,this._pmremMaxTileSize,!0);t.flipCubemapX=!1;e=t.fromCubeRenderTarget(e,{encoding:pt});return t.dispose(),e}initWebXR(r,i,a,e,n,o){a=a||function(){},e=e||function(){},n=n||function(){},o=o||{};const s=this;function l(e){s.xrSession.removeEventListener("end",l),s.renderer.xr.setSession(null),n();for(let e=0;e<s.xrControllers.length;e++){var t=s.xrControllers[e];s.scene.remove(t)}s.xrControllers=[],s.xrSession=null,s._backgroundSave&&(s.scene.background=s._backgroundSave,s._backgroundSave=null),s.postprocessing=s._postprocessingSave,s._postprocessingSave=null,s.onResize()}function c(e){var t=e.data;const n=e.target;if("tracked-pointer"==t.targetRayMode){var r=(new ci).setFromPoints([new wn(0,0,0),new wn(0,0,-1)]);const i=new $l(r);i.name=n.name+"_RAY",i.scale.z=5,n.add(i)}else if("gaze"==t.targetRayMode){r=(new Od).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAIQXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZhZltw2DEX/uYosQSQ4LofjOdlBlp8LSqquHt12nD+X3JIKYpEg3sMDZDP/+XuZv/iIOGd8SDmWGA8+vvjiKjf5OD91n+3h93l//PWI76/s5vHAYRKucn7N8bJP7I7x7rL3a56KPTxNVOb1oL1+UK+JXL4WuOz3QmLPBY5rYlOvicRdK18utnNbRyw5PW+hX+PX9XyHgT+jJy/JxRBt8py9O1KKhfvsDp+I21BHV3dFfxfaNdGb7+Ye6vDJTbFycM7qoeC+FKmi93rGaSzCvUjY53J6ClrOHIn7csf1689Xnpvb9QvyV5A+7uwn9iekzQ7o/UDeIBQf1w/tNrzYzTOkG7enlWN8rPzKnufRXu35Rk3/1hp5rXnurvrIluO1qXsr+45xTaO1fxU5En/hyBpsPQpHJiU6PBqQrHF0W6wDxmW9HbbaZee+dttx0bvpElfnuhPbDcYMGMX1DbfXwy6XAH5IBvgOHQSre/hi97JlL9dtZuFhs4E9lsksP/lPh/nOoLU0oaw98iNW+OU00/BCkbPWHJZhIGLXFdSwA3wfbz+Kq4Bg2GHObLAeTWcA/hbsC7lkAy0MDFzPBLZpXBMQIjwIOGMFBI5oJdhoj4SwJWsJZAagiutOvGvAYkNwAyedF4mAQxawNr9Jdg91wZ1mhBAggkQjCWxITcDyPsCf5DMcqkGCDyHEkEIOJdQoUTMsxhRVUWuS5FNIMaWUU0nVZMk+hxxzyjmXXIsrguKGQj6WXEqplUUrM1d+XRlQa3NNmm+hxZZabqXV7kyX7nvosaeee+l1uCGDPB5xpJFHGXXaCZWmn2HGmWaeZdYF1ZYsv8KKK628iln1gdoF67vjJ1CzF2puI6UD0wM1rCndU1iVk6CYgZjzFsCTImDFOKeYHdl67xQ5xewoTkXQ4WRQcIZVxEDQT+vCsg/sXpALRuLvwc0AhPsdyBmF7hvIvcftI9RG3YVONkKahhrUQ8i+VdbM1eWqlfLLq/nRgO9e/0z0Z6LfNtEKlJIcBGEJdi4Y3YtQv/vMn9hbb2uO2qngQp1HkExeIqtF6sbqOjSLnimwjeScNfUo89iTZO/b7GHNot9iXc1v+ypRmpg4x9DZbZ/owSyht5CoP3X52YZQTUprFa0ItmIdx22xPvAvogdcVPyXdoNjrZpJ4+lZTtdDaj62hxnWigOhXduzQx+mQvaPZrNbk99ZfVDsDIMlgtBQLro75kMVI3Xb63P8HRXr6s2O0hI7YuI8TZLWlq8z1NZmxkfWRLdoCMcQIVAj5kCbeFkOhcg11PO8o7M6r+Z4Y/iJq4KdFVJt3w261qI9nXagWtvw6cKp96g4ZMIw/NZERidb2NYSDUzpabXiF3EzpaKqdZNqZSuTXqnN0CtBntdNmZYJStprx7kgxZCka/XWsc9qwzRVdkRnFEWjy8mRQDknXhkExoYgj6QNm96PWsKsM8EoejmdKOblTRMIQOt3ucsgJUigEUldCH5vJRCMcd1I1wWdMmKMNfyqcepalKOCefgzY9iGzOJ/Jd3Mhw9aLbrhTCyntQ44IOYBgdocpAPBbbGP1siF1bRxHYNyFKjJcD0EaAQs0EU0zcCEBBDNiuQn3CFPANTv3epZWd+CRs2zU7Og7coEZKcArFQGA8BOU5faUL/I3J0OuVAw2xqHzAHbywZiudFiNEM9XIMa3edcw7USP5WUzT5RLsA6JZ9SD/K07JoZAFUiPmdQak0CPlGYa/MptVDJT20yYguxkIT0DXQKexSrkjpz8QhlimYmdYF13enoS7Lj9CkCxcXzCa7Esl8AQBq6rDabFASNxDfMWcgaRzTRgIFeBRmje5n4GAJmnGIHE2qUtOBqhOpzOhnrHtCJiJnTPoAA9FmVwgzCETw7yqmHPwbBfIbCOxC6jSogCHVjYzWhLEk1KTQonoYhUIEbIQd4p42Wliu5ngJtT8Le6LXS6CdV5xIA+p3l6GY+dKCrHMp8mK0bSBPGK/WJ/d4U1PdiM3WhDiU9dQCRH6o4sxerpKcUyJGASZrjLVvTQ/XiJ0sAAj9ayPYW+8IbpLzW/3KkLUIvEnQKEG6FLW3OF3aksFMFtoZp+I0+giNUtd4xUutm3LTnZxLXmFQ5el3WkFEIPtPMorRGG2sfslIJ8NIaqxnbBKp7ckpOgDThLLn1kBGbnmRkvcgIlH+WkbLIoOC1LCAksc5RuviYqfE0yZeFd/2vomk+DSfceh1PLZ5k35uI3vXUvC+oKlTrUVBJ56eSyhJ5flhTzS8U1Q+v5ptF9aXK7ZuWNaXDJshY1S4xofutu27qtutxVSPSrffPqhGj39Ujan+5K9IXxXq+FPp3UhsAdw3TwQG5G3aWmEBohrt4qthpkCbBz4ntlcQXXreum5R1sbAXHs2QldBo9LOroE+gIaj52mBwabjzC2+lX17NjwbodeuhtFsPof1Q0UMOyTI0EO45g2lqG8k2i809EsB4quEkUrK1cKgW8mZb+UkcIAdcUXKyI9scHR1MY6I3jzUIZ2ODum6EgoaiEIrp9/YJmYP0QbMBnHLaCW2meqzsfm6AyYtX7S+id3W/vKle3e/OPRojdI/oDyOdRFVlrAORRx/igFKtQDte/oV654VGuvIKzMM2eCFuVB4SbD3CppXcXFE7i8guPY8i0l5XcpVqGsNjp1bjzGyCNLRgySyT5TY9R2fu2joo2cRhR6bsdCYa8P8MEJnzEqJpHiH6KEA6wXcCRHzMrwRovzykVEY/b/U/r81981+vfyb6M9H/MBF5RKaafwEjmLcIrlR0mgAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+MCAwojJyJFeN4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAd0lEQVR42u3YUQqAIBAFwLUDdf9zdCH7lwwEI2VnPkWQfWCvigAAAAAAgDTK1wecNWq7dpX+uaP7lw7gaZi3oUb3z3BkvwICEIAW+KcFRte3DWBGO7gCAhCAAHZ9FY6IpC3QG963gGeAAASgBRb6IwQAAAAAQCY34QUtIL9dJTwAAAAASUVORK5CYII="),r=new dl({map:r,sizeAttenuation:!1});const a=new Sl(r);a.name=n.name+"_RETICLE",a.scale.multiplyScalar(.1),a.position.z=-5,n.add(a)}n.userData.inputSource=t}function u(e){const t=e.target;for(let e=t.children.length-1;0<=e;e--){const n=t.children[e];-1<n.name.indexOf(t.name)&&(n.geometry.dispose(),n.material.dispose(),t.remove(n))}}const t={optionalFeatures:[i]};"immersive-ar"==r&&(t.optionalFeatures.push("hit-test"),o.domOverlay&&(t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:s.container})),navigator.xr.requestSession(r,t).then(function(e){s._postprocessingSave=s.postprocessing,s.postprocessing=null,s.renderer.xr.setReferenceSpaceType(i),(s.xrSession=e).addEventListener("end",l);var t="immersive-vr"==r?2:1;for(let e=0;e<t;e++){const n=s.renderer.xr.getController(e);s.scene.add(n),s.xrControllers.push(n),n.addEventListener("connected",c),n.addEventListener("disconnected",u)}"immersive-vr"!=r&&(s._backgroundSave=s.scene.background,s.scene.background=null),s.renderer.xr.enabled=!0,s.renderer.xr.setSession(e),o.domOverlay&&s.renderer.xr.addEventListener("sessionstart",function(){setTimeout(function(){s.renderer.domElement.style.width=s.getWidth()+"px",s.renderer.domElement.style.height=s.getHeight()+"px"},300)}),a()}).catch(e)}endWebXR(){this.xrSession&&this.xrSession.end()}printPerformanceInfo(e){Dg.printPerformanceInfo(this,e)}showFPS(){if(this.container){this.hideFPS();const e=new I1;e.showPanel(0),this.container.appendChild(e.dom),this.stats=e}}hideFPS(){this.container&&this.stats&&(this.container.removeChild(this.stats.dom),this.stats=null)}}var P1,D1,N1,F1={calcCameraZoomToObjectsParams:(D1=new In,N1=new jn,function(e,t,n,r){var i=D1.makeEmpty();t.forEach(function(e){i.expandByObject(e)});t=i.getBoundingSphere(N1);F1.calcCameraZoomToSphereParams(e,t,n,r)}),calcCameraZoomToSphereParams:(P1=new wn,function(e,t,n,r){var i=Dt(e.fov/2);e.aspect<1&&(i=Math.atan(e.aspect*Math.tan(i)));i=t.radius/Math.sin(i),e=e.getWorldDirection(P1);n.copy(t.center).addScaledVector(e,-i),r.copy(t.center)})},O1={normalizeDialectOptions:function(e){var t,n={delimiter:",",doublequote:!0,lineterminator:"\n",quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(t in e)n[t.toLowerCase()]=e[t];return n},parse:function(e,t){t&&t.lineterminator||(e=O1.normalizeLineTerminator(e,t));var n=O1.normalizeDialectOptions(t);e=O1.chomp(e,n.lineterminator);for(var r,i=!1,a=!1,o="",s=[],l=[],c=function(e){var t=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")};return!0!==a&&(""===e?e=null:!0===n.skipinitialspace&&(e=t(e)),/^\d+$/.test(e)?e=parseInt(e,10):/^\d*\.\d+$|^\d+\.\d*$/.test(e)&&(e=parseFloat(e,10))),e},u=0;u<e.length;u+=1)r=e.charAt(u),!1!==i||r!==n.delimiter&&r!==n.lineterminator?r!==n.quotechar?o+=r:i?e.charAt(u+1)===n.quotechar?(o+=n.quotechar,u+=1):i=!1:a=i=!0:(o=c(o),s.push(o),r===n.lineterminator&&(l.push(s),s=[]),o="",a=!1);return o=c(o),s.push(o),l.push(s),l=n.skipinitialrows?l.slice(n.skipinitialrows):l},normalizeLineTerminator:function(e,t){return(t=t||{}).lineterminator?e:e.replace(/(\r\n|\n|\r)/gm,"\n")},chomp:function(e,t){return e.charAt(e.length-t.length)!==t?e:e.substring(0,e.length-t.length)}};const U1=new wn(1,0,0),z1=new wn,V1=new wn,G1=new Sn;class k1 extends Ei{constructor(e,t){e=void 0!==e?e:new mn(1,0,0),t=void 0!==t?t:2;const n=new yg;n.setGeometry([0,0,0,U1.x,U1.y,U1.z]);t=new Eg({color:e,lineWidth:t,sizeAttenuation:0});super(n.geometry,t),this.elemHTML=null,this.offset=5}onBeforeRender(n,e,r,t,i,a){if(super.onBeforeRender(),this.elemHTML){var o=n.domElement.offsetHeight,s=n.domElement.offsetWidth,l=this.elemHTML.getBoundingClientRect(),c=(l.left+l.right)/2,u=(l.top+l.bottom)/2,d=this.getWorldPosition(z1).project(r),h=(d.x+1)/2*s,p=(1-d.y)/2*o,n=(u-p)/(c-h),d=(l.height+2*this.offset)/(l.width+2*this.offset);let e,t;Math.abs(n)>d?(t=u<p?Math.min(l.bottom+this.offset,p):Math.max(l.top-this.offset,p),e=(t-p)/n+h):(e=h<c?Math.max(l.left-this.offset,h):Math.min(l.right+this.offset,h),t=(e-h)*n+p);s=2*e/s-1,o=1-2*t/o;const f=V1.set(s,o,-1);f.unproject(r),this.parent&&this.parent.worldToLocal(f);r=f.length();this.scale.setScalar(r),f.normalize();r=G1.setFromUnitVectors(U1,f);this.setRotationFromQuaternion(r),this.updateMatrixWorld()}}}function Q1(){}function W1(e){for(var t in Q1.call(this),e){var n=e[t];"container"===t&&(void 0===n?this.container=document.body:n instanceof HTMLElement?this.container=n:this.container=document.getElementById(n))}this.bar=document.createElement("div"),this.bar.setAttribute("class","v3d-simple-preloader-bar"),this.logo=document.createElement("div"),this.logo.setAttribute("class","v3d-simple-preloader-logo"),this.logoCont=document.createElement("div"),this.logoCont.setAttribute("id","v3d_preloader_container"),this.logoCont.setAttribute("class","v3d-simple-preloader-container"),this.background=document.createElement("div"),this.background.setAttribute("class","v3d-simple-preloader-background"),this.background.appendChild(this.logoCont),this.logoCont.appendChild(this.logo),this.logoCont.appendChild(this.bar),this.container.appendChild(this.background),"none"==getComputedStyle(this.logo).backgroundImage&&this.logo.setAttribute("style",'background-image: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiCiAgIGlkPSJzdmcyNzc1IgogICB2ZXJzaW9uPSIxLjEiCiAgIHZpZXdCb3g9IjAgMCAyOS4xMDQxNjYgMzEuNzUwMDAxIgogICBoZWlnaHQ9IjEyMCIKICAgd2lkdGg9IjExMCI+CiAgPGRlZnMKICAgICBpZD0iZGVmczI3NjkiPgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgIHkyPSI1My44MDY2MTgiCiAgICAgICB4Mj0iMTkzLjc4NDciCiAgICAgICB5MT0iNzguNjg5NDA3IgogICAgICAgeDE9IjE3Mi45MTMzNiIKICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDMwNzktOCIKICAgICAgIHhsaW5rOmhyZWY9IiNsaW5lYXJHcmFkaWVudDMwNzciCiAgICAgICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEuMTY0NzU5NCwwLDAsMS4xNTgzOTgyLC0xOTcuMTUzMTksMjAzLjUxNjUxKSIgLz4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50MzA3NyI+CiAgICAgIDxzdG9wCiAgICAgICAgIGlkPSJzdG9wMzA3MyIKICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojMDA0OGE1O3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcAogICAgICAgICBpZD0ic3RvcDMwNzUiCiAgICAgICAgIG9mZnNldD0iMSIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzRiODZkMTtzdG9wLW9wYWNpdHk6MSIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTI3NzIiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMjY1LjI0OTk2KSIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZGlzcGxheTppbmxpbmU7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50MzA3OS04KTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC45MjA0NTI2NTtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0ibSAxNC42MjI3OTMsMjY1LjI1MDA0IGMgLTEuNjgyMTUsLTAuMDA3IC0zLjM2OTMsMS4xMDUxMSAtNy4yODAyNDk3LDMuMzI3ODYgLTcuODIxOTEwMDcsNC40NDU1IC03LjI4MTA3MDA3LDMuNTIzMzggLTcuMzIwOTcwMDcsMTIuNDgzMDkgLTAuMDM5OSw4Ljk1OTcxIC0wLjU3MjQ3LDguMDMyODUgNy4yMDk1NTAwNywxMi41NDcwNyA3Ljc4MTk4OTcsNC41MTQyNCA2LjcwODYwOTcsNC41MDk1IDE0LjUzMDQ5OTcsMC4wNjM5IDcuODIxOTEsLTQuNDQ1NDkgNy4yODEwNjIsLTMuNTIzMzcgNy4zMjA5NzEsLTEyLjQ4MzA5IDAuMDM5OSwtOC45NTk3MSAwLjU3MjQ1OCwtOC4wMzI4NSAtNy4yMDk1NTEsLTEyLjU0NzA3IC0zLjg5MSwtMi4yNTcxMiAtNS41NjgxMiwtMy4zODQ0NSAtNy4yNTAyNSwtMy4zOTE4NiB6IG0gLTAuMDEzMywyLjg1MTY3IGMgMS42OTU5NCwwLjAwNyAzLjM4ODMzLDAuODEyODEgNi4xNjAxNiwyLjQyMDY5IDUuNTQzNjIsMy4yMTU3OCA2LjE1MTkzMSw0LjI3NDM4IDYuMTIzNDkxLDEwLjY1Njk2IC0wLjAyODQsNi4zODI2IC0wLjY0NjEwMSw3LjQzNTc2IC02LjIxODE1MSwxMC42MDI1OCAtNS41NzIwMywzLjE2NjgxIC02Ljc5OCwzLjE2MTM5IC0xMi4zNDE2Mzk3LC0wLjA1NDMgLTUuNTQzNjEsLTMuMjE1NzcgLTYuMTUxODksLTQuMjc0MzcgLTYuMTIzNDksLTEwLjY1Njk2IDAuMDI4NiwtNi4zODI1OCAwLjY0NjEsLTcuNDM1NzUgNi4yMTgxNiwtMTAuNjAyNTggMi43ODYwMjk3LC0xLjU4MzQgNC40ODU1Mzk3LC0yLjM3Mzc3IDYuMTgxNDY5NywtMi4zNjYzIHogbSAtMC4xNTUzNywxLjYxNzY5IGMgLTIuNzEzOTEsMC4wMzQxIC01LjcyNDk5OTcsMy4wNzAwOCAtNy4yODkzNTk3LDYuMDc1NDkgLTEuNTg5MjEsMy4wNTMxMSAtMi40OTg1Miw1Ljk0NDU2IC0yLjEyNDA1LDkuNjU3NTEgMC4xNjMwNywxLjYxNjU0IDEuNzEwODIsMy42Nzk4NCAzLjU2Mzc2LDQuNzE0MjYgLTAuMzkzODIsLTMuMjA2MiAtMC4xNzIsLTYuMzQzMDUgMC41NDM5NjEsLTguOTQ2OTIgMC43MTU5NTksLTIuNjAzODcgMi44NTI5Nzg3LC02LjgyODgxIDUuMzc2MjQ4NywtNi44MjMxNiAyLjUyMzMxLDAuMDA2IDQuNjYwMjcsNC4yMjcwNCA1LjM3NjIyLDYuODMwODkgMC43MTU5MywyLjYwMzg4IDAuOTM3NzcsNS43NDA3NSAwLjU0Mzk0LDguOTQ2OTQgMS44NTI5NCwtMS4wMzQ0MyAzLjQwMDcxLC0zLjA5Nzc4IDMuNTYzNzcsLTQuNzE0MzEgMC4zNzQ0OCwtMy43MTI5OCAtMC41MzQ3MSwtNi42MDQyNyAtMi4xMjM5MywtOS42NTc0IC0xLjU1ODkzLC0yLjk5NDk4IC00LjU1NDY1LC02LjAxOTg4IC03LjMwMTU1LC02LjA4MjY2IC0wLjA0MzEsLTkuOGUtNCAtMC4wODYsLTkuOGUtNCAtMC4xMjg5NywtNi4xZS00IHogbSAwLjEzMjY3LDguOTE4NDEgYSAyLjQ5MTI2MzEsMi40Nzc2NTczIDAgMCAwIC0xLjE5NzM0LDAuMjkxNTIgMi40OTEyNjMxLDIuNDc3NjU3MyAwIDAgMCAtMS4wMjUzNCwzLjM1MjI5IDIuNDkxMjYzMSwyLjQ3NzY1NzMgMCAwIDAgMy4zNzA2OSwxLjAxOTcxIDIuNDkxMjYzMSwyLjQ3NzY1NzMgMCAwIDAgMS4wMjUzNCwtMy4zNTIyOCAyLjQ5MTI2MzEsMi40Nzc2NTczIDAgMCAwIC0yLjE3MzM1LC0xLjMxMTI0IHoiCiAgICAgICBpZD0icGF0aDYwNDctMiIgLz4KICA8L2c+Cjwvc3ZnPgo=");'),this.clock=new _h}k1.prototype.isLineHTML=!0,Object.assign(Q1.prototype,{onUpdate:function(e){},onFinish:function(){}}),W1.prototype=Object.assign(Object.create(Q1.prototype),{constructor:W1,onUpdate:function(e){e=Math.round(e),this.bar.style.width=e+"%"},onFinish:function(){this.container.removeChild(this.background)}});function H1(){}function Y1(t){let n,r,i,a=0;for(let e=0;e<t.length;++e){var o=t[e];if(o.isInterleavedBufferAttribute)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===n&&(n=o.array.constructor),n!==o.array.constructor)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=o.normalized),i!==o.normalized)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=o.array.length}const s=new n(a);let l=0;for(let e=0;e<t.length;++e)s.set(t[e].array,l),l+=t[e].array.length;return new Hr(s,r,i)}Object.assign(H1.prototype,{_logicFileLoadError:function(e){const t=new Error(e);return t.name="LogicFileLoadError",t},_editorLoadError:function(e){const t=new Error(e);return t.name="EditorLoadError",t},_getLogicPromise:function(n){const r=this;return new Promise(function(e,t){Dg.loadScript(n,document.body,function(){e()},function(){t(r._logicFileLoadError("Unable to load the logic file: '"+n+"'."))})})},_getEditorPromise:function(n,e){const r=this;return new Promise(function(e,t){Dg.loadScript(n,document.body,function(){e()},function(){t(r._editorLoadError("Unable to load the Puzzles Editor: '"+n+"'."))})})},_getLogicViaEditorPromise:function(a,o){const s=this;return new Promise(function(t,n){const e=rn();if(e.v3d&&e.v3d.PE){const r=o.split(".");r[r.length-1]="xml";const i=r.join(".");e.v3d.PE.init(a,i,function(e){e?t():n(s._logicFileLoadError("Unable to load the Puzzles Editor's XML logic file: '"+i+"'."))})}else n(s._editorLoadError("Unable to load Puzzles' logic. The Puzzles Editor isn't loaded."))})},_getAmmoJSPromise:function(){return"function"==typeof window.Ammo?new Promise(function(e,t){window.Ammo().then(function(){window.Ammo=Ammo,e()})}):Promise.resolve()},loadLogic:function(e,t,n){const r=this;this._getLogicPromise(e).then(function(){return r._getAmmoJSPromise()}).then(function(){t&&t()},function(e){console.error(e),n&&n(e)})},loadEditorWithLogic:function(e,t,n,r){const i=this;i._getEditorPromise(e+"puzzles.min.js").then(function(){return i._getLogicViaEditorPromise(e,t)}).catch(function(e){return"LogicFileLoadError"===e.name?Promise.resolve():Promise.reject(e)}).then(function(){return i._getAmmoJSPromise()}).then(function(){n&&n()}).catch(function(e){console.error(e),r&&r(e)})}});xa=Object.freeze({__proto__:null,computeTangents:function(e){e.computeTangents(),console.warn("v3d.BufferGeometryUtils: .computeTangents() has been removed. Use BufferGeometry.computeTangents() instead.")},mergeBufferGeometries:function(n,r=!1){var i=null!==n[0].index;const a=new Set(Object.keys(n[0].attributes)),o=new Set(Object.keys(n[0].morphAttributes)),s={},l={};var c=n[0].morphTargetsRelative;const u=new ci;let d=0;for(let t=0;t<n.length;++t){var h=n[t];let e=0;if(i!=(null!==h.index))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const m in h.attributes){if(!a.has(m))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+'. All geometries must have compatible attributes; make sure "'+m+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[m]&&(s[m]=[]),s[m].push(h.attributes[m]),e++}if(e!==a.size)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". Make sure all geometries have the same number of attributes."),null;if(c!==h.morphTargetsRelative)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in h.morphAttributes){if(!o.has(g))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[g]&&(l[g]=[]),l[g].push(h.morphAttributes[g])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(h.userData),r){let e;if(i)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}u.addGroup(d,e,t),d+=e}}if(i){let t=0;const v=[];for(let e=0;e<n.length;++e){const A=n[e].index;for(let e=0;e<A.count;++e)v.push(A.getX(e)+t);t+=n[e].attributes.position.count}u.setIndex(v)}for(const t in s){var e=Y1(s[t]);if(!e)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;u.setAttribute(t,e)}for(const _ in l){var p=l[_][0].length;if(0===p)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[_]=[];for(let t=0;t<p;++t){const x=[];for(let e=0;e<l[_].length;++e)x.push(l[_][e][t]);var f=Y1(x);if(!f)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+_+" morphAttribute."),null;u.morphAttributes[_].push(f)}}return u},mergeBufferAttributes:Y1,interleaveAttributes:function(n){let r,i=0,a=0;for(let e=0,t=n.length;e<t;++e){var o=n[e];if(void 0===r&&(r=o.array.constructor),r!==o.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=o.array.length,a+=o.itemSize}var s=new ll(new r(i),a);let l=0;const c=[];var u=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"];for(let e=0,t=n.length;e<t;e++){const f=n[e];var h=f.itemSize,p=f.count;const m=new ul(s,h,l,f.normalized);c.push(m),l+=h;for(let t=0;t<p;t++)for(let e=0;e<h;e++)m[d[e]](t,f[u[e]](t))}return c},estimateBytesUsed:function(e){let t=0;for(const i in e.attributes){var n=e.getAttribute(i);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var r=e.getIndex();return t+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0,t},mergeVertices:function(r,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},i=r.getIndex();var n=r.getAttribute("position"),a=(i||n).count;let o=0;var s=Object.keys(r.attributes);const l={},c={},u=[];var d=["getX","getY","getZ","getW"];for(let e=0,t=s.length;e<t;e++){var h=s[e];l[h]=[];var p=r.morphAttributes[h];p&&(c[h]=new Array(p.length).fill().map(()=>[]))}var e=Math.log10(1/e),f=Math.pow(10,e);for(let e=0;e<a;e++){var m=i?i.getX(e):e;let n="";for(let e=0,t=s.length;e<t;e++){var g=s[e];const S=r.getAttribute(g);var v=S.itemSize;for(let e=0;e<v;e++)n+=~~(S[d[e]](m)*f)+","}if(n in t)u.push(t[n]);else{for(let e=0,t=s.length;e<t;e++){var A=s[e];const w=r.getAttribute(A),E=r.morphAttributes[A];var _=w.itemSize;const T=l[A],I=c[A];for(let e=0;e<_;e++){var x=d[e];if(T.push(w[x](m)),E)for(let e=0,t=E.length;e<t;e++)I[e].push(E[e][x](m))}}t[n]=o,u.push(o),o++}}const y=r.clone();for(let e=0,t=s.length;e<t;e++){var b=s[e];const R=r.getAttribute(b);var M=new R.array.constructor(l[b]),M=new Hr(M,R.itemSize,R.normalized);if(y.setAttribute(b,M),b in c)for(let e=0;e<c[b].length;e++){const L=r.morphAttributes[b][e];var C=new L.array.constructor(c[b][e]),C=new Hr(C,L.itemSize,L.normalized);y.morphAttributes[b][e]=C}}return y.setIndex(u),y},toTrianglesDrawMode:function(e,n){if(0===n)return console.warn("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2!==n&&1!==n)return console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",n),e;{let t=e.getIndex();if(null===t){const s=[];var r=e.getAttribute("position");if(void 0===r)return console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)s.push(e);e.setIndex(s),t=e.getIndex()}var i=t.count-2;const a=[];if(2===n)for(let e=1;e<=i;e++)a.push(t.getX(0)),a.push(t.getX(e)),a.push(t.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(a.push(t.getX(e)),a.push(t.getX(e+1)),a.push(t.getX(e+2))):(a.push(t.getX(e+2)),a.push(t.getX(e+1)),a.push(t.getX(e)));a.length/3!=i&&console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(a),o.clearGroups(),o}},computeMorphedAttributes:function(e){if(!0!==e.geometry.isBufferGeometry)return console.error("v3d.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const h=new wn,p=new wn,f=new wn,m=new wn,g=new wn,v=new wn,A=new wn,_=new wn,x=new wn;function t(e,t,n,r,i,a,o,s,l){h.fromBufferAttribute(n,a),p.fromBufferAttribute(n,o),f.fromBufferAttribute(n,s);var c=e.morphTargetInfluences;if(t.morphTargets&&r&&c){A.set(0,0,0),_.set(0,0,0),x.set(0,0,0);for(let e=0,t=r.length;e<t;e++){var u=c[e],d=r[e];0!==u&&(m.fromBufferAttribute(d,a),g.fromBufferAttribute(d,o),v.fromBufferAttribute(d,s),i?(A.addScaledVector(m,u),_.addScaledVector(g,u),x.addScaledVector(v,u)):(A.addScaledVector(m.sub(h),u),_.addScaledVector(g.sub(p),u),x.addScaledVector(v.sub(f),u)))}h.add(A),p.add(_),f.add(x)}e.isSkinnedMesh&&(e.boneTransform(a,h),e.boneTransform(o,p),e.boneTransform(s,f)),l[3*a+0]=h.x,l[3*a+1]=h.y,l[3*a+2]=h.z,l[3*o+0]=p.x,l[3*o+1]=p.y,l[3*o+2]=p.z,l[3*s+0]=f.x,l[3*s+1]=f.y,l[3*s+2]=f.z}var n=e.geometry,r=e.material;let i,a,o;const s=n.index;var l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,d=n.attributes.normal,y=n.morphAttributes.position,b=n.groups,M=n.drawRange;let C,S,w,E,T,I,R,L;var B=new Float32Array(l.count*l.itemSize),P=new Float32Array(d.count*d.itemSize);if(null!==s)if(Array.isArray(r))for(C=0,w=b.length;C<w;C++)for(T=b[C],I=r[T.materialIndex],R=Math.max(T.start,M.start),L=Math.min(T.start+T.count,M.start+M.count),S=R,E=L;S<E;S+=3)i=s.getX(S),a=s.getX(S+1),o=s.getX(S+2),t(e,I,l,c,u,i,a,o,B),t(e,I,d,y,u,i,a,o,P);else for(R=Math.max(0,M.start),L=Math.min(s.count,M.start+M.count),C=R,w=L;C<w;C+=3)i=s.getX(C),a=s.getX(C+1),o=s.getX(C+2),t(e,r,l,c,u,i,a,o,B),t(e,r,d,y,u,i,a,o,P);else if(void 0!==l)if(Array.isArray(r))for(C=0,w=b.length;C<w;C++)for(T=b[C],I=r[T.materialIndex],R=Math.max(T.start,M.start),L=Math.min(T.start+T.count,M.start+M.count),S=R,E=L;S<E;S+=3)i=S,a=S+1,o=S+2,t(e,I,l,c,u,i,a,o,B),t(e,I,d,y,u,i,a,o,P);else for(R=Math.max(0,M.start),L=Math.min(l.count,M.start+M.count),C=R,w=L;C<w;C+=3)i=C,a=C+1,o=C+2,t(e,r,l,c,u,i,a,o,B),t(e,r,d,y,u,i,a,o,P);return{positionAttribute:l,normalAttribute:d,morphedPositionAttribute:new ei(B,3),morphedNormalAttribute:new ei(P,3)}},batchMeshes:function(n,e){const r={};for(let t=0;t<n.length;t++){var i=n[t],a=i.geometry,o=i.material;let e=[];e.push(o.name),e.push(i.visible),e.push(i.disableChildRendering),e.push(i.castShadow),e.push(i.receiveShadow),e.push(i.renderOrder),e=e.concat(i.groupNames);o=Object.keys(a.attributes);e=e.concat(o);a=Object.keys(a.morphAttributes);e=e.concat(a),e=e.join(),r[e]=r[e]||[],-1==r[e].indexOf(i)&&r[e].push(i)}for(var s in r){const n=r[s];if(!(n.length<2)){const u=[];let t=!0;for(let e=0;e<n.length;e++){const h=n[e],p=h.geometry;h.updateMatrixWorld(),u.push(p.clone().applyMatrix4(h.matrixWorld)),p.boundsTree||(t=!1)}var l=n[0],c=l.material,s=`${c.name}_x${n.length}_batch`;const d=this.mergeBufferGeometries(u);if(d){const f=new Ei(d,c);f.name=s,f.visible=l.visible,f.disableChildRendering=l.disableChildRendering,f.castShadow=l.castShadow,f.receiveShadow=l.receiveShadow,f.renderOrder=l.renderOrder,f.groupNames=l.groupNames;for(let e=0;e<n.length;e++){const m=n[e];m.parent.remove(m)}t&&d.computeBoundsTree({verbose:!1}),console.log("Adding batch object:",s),e.add(f)}else console.warn("Failed to create batch object:",s)}}}});function X1(e){Ei.call(this),this.type="CubeTextureHelper",this.geometry=new Ii(2,2,2,1,1,1),this.geometry.computeBoundingSphere(),this.material=new kr,this.material.envMap=e}(X1.prototype=Object.create(Ei.prototype)).constructor=X1;class j1 extends Tr{constructor(e){super(),this.doUpdate=!0,this.projected=new wn,this.container=e,this.updatedCallback=null}clone(){return new this.constructor(this.container).copy(this)}update(e){var t,n,r,i;this.doUpdate&&(t=this.projected,this.getWorldPosition(t).project(e),n=this.container.offsetWidth,i=this.container.offsetHeight,r=(.5+t.x/2)*n,e=(.5-t.y/2)*i,t.x=r,t.y=e,i=t.z<=1&&0<=r&&r<=n&&0<=e&&e<=i,this.visible=i,this.updatedCallback&&this.updatedCallback(t.x,t.y,i))}}j1.prototype.isAnnotationControl=!0;var K1=new Js,q1=new wn,Z1=new wn,J1=new wn;class $1 extends j1{constructor(e,t,n){super(e),this.type="Annotation",this.character=t,this.dialogContents=n,this.annotation=document.createElement("div"),this.annotation.innerHTML=t,this.annotation.className="v3d-annotation",this.container.appendChild(this.annotation),this.annotationDialogVisible=!1,this.annotationDialog=document.createElement("div"),this.annotationDialog.innerHTML=n,this.annotationDialog.className="v3d-annotation-dialog",this.annotation.appendChild(this.annotationDialog),this.fadeObscured=!0,this.obscured=!1,this.text=this.dialogContents,this.annotationText=this.annotationDialog;var r=!1,i=this;function a(e){e.target==i.annotation?0==i.annotationDialog.innerHTML.length||i.obscured||(i.annotationDialogVisible=!i.annotationDialogVisible,i.annotationDialog.style.visibility=i.annotationDialogVisible?"visible":"hidden",i.annotationDialogVisible?i.annotation.style.zIndex="2":i.annotation.style.zIndex="1"):-1<e.target.className.indexOf("v3d-annotation")&&(i.annotationDialogVisible=!1,i.annotationDialog.style.visibility="hidden",i.annotation.style.zIndex=i.obscured?"auto":"1")}this._touchstartCb=function(e){a(e),r=!0},document.body.addEventListener("touchstart",this._touchstartCb,!1),this._mousedownCb=function(e){r||a(e),r=!1},document.body.addEventListener("mousedown",this._mousedownCb,!1)}raycast(){}clone(){return new this.constructor(this.container,this.character,this.dialogContents).copy(this)}update(e){super.update(e);var t=this.projected,n=this.annotation;n.style.transform="translate("+t.x+"px, "+t.y+"px)",n.style.visibility=this.visible?"visible":"hidden",this.annotationDialog.style.visibility=this.visible&&this.annotationDialogVisible?"visible":"hidden",this.fadeObscured&&(e.getWorldPositionNU(q1),this.getWorldPositionNU(Z1),J1.copy(Z1).sub(q1).normalize(),K1.set(q1,J1),K1.far=q1.distanceTo(Z1),1<(e=K1.intersectObject(this.findRoot(),!0)).length||1==e.length&&e[0].object!=this.parent?(n.classList.add("v3d-annotation-transparent"),this.obscured=!0,n.style.zIndex="auto",this.annotationDialog.style.visibility="hidden"):(n.classList.remove("v3d-annotation-transparent"),n.style.zIndex="visible"==this.annotationDialog.style.visibility?"2":"1",this.obscured=!1))}setDialogVisibility(e){e?(this.annotationDialogVisible=!0,this.annotationDialog.style.visibility="visible",this.annotation.style.zIndex="2"):(this.annotationDialogVisible=!1,this.annotationDialog.style.visibility="hidden",this.annotation.style.zIndex="1")}dispose(){var e=this.annotation.parentElement;e&&e.removeChild(this.annotation),document.body.removeEventListener("touchstart",this._touchstartCb,!1),document.body.removeEventListener("mousedown",this._mousedownCb,!1)}}$1.prototype.isAnnotation=!0;var eA,tA,_a={translateVRCamera:function(){var i=new wn;new rr;return function(e,t,n){var r=e.parent;r&&!r.isScene&&(i.copy(t).applyQuaternion(e.quaternion).applyQuaternion(r.quaternion),r.position.add(i.multiplyScalar(n)))}}(),rotateVRCamera:(eA=new Sn,tA=new Sn,function(e,t,n){var r=e.parent;r&&!r.isScene&&(eA.setFromAxisAngle(t,n),eA.premultiply(e.quaternion),eA.premultiply(r.quaternion),r.quaternion.multiplyQuaternions(eA,tA.copy(e.quaternion).invert()))})};class nA{constructor(){this.pluginCallbacks=[],this.register(function(e){return new dA(e)}),this.register(function(e){return new hA(e)}),this.register(function(e){return new pA(e)}),this.register(function(e){return new mA(e)}),this.register(function(e){return new gA(e)}),this.register(function(e){return new fA(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){"object"==typeof n&&(console.warn("v3d.GLTFExporter: parse() expects options as the fourth argument now."),r=n);const i=new uA,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](i));i.setPlugins(a),i.write(e,t,r).catch(n)}parseAsync(n,r){const i=this;return new Promise(function(e,t){i.parse(n,e,t,r)})}}const rA={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},iA={};iA[Ve]=rA.NEAREST,iA[W]=rA.NEAREST_MIPMAP_NEAREST,iA[H]=rA.NEAREST_MIPMAP_LINEAR,iA[Ge]=rA.LINEAR,iA[Y]=rA.LINEAR_MIPMAP_NEAREST,iA[ke]=rA.LINEAR_MIPMAP_LINEAR,iA[ze]=rA.CLAMP_TO_EDGE,iA[k]=rA.REPEAT,iA[Q]=rA.MIRRORED_REPEAT;const aA={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function oA(e,n){return e.length===n.length&&e.every(function(e,t){return e===n[t]})}function sA(e){return 4*Math.ceil(e/4)}function lA(t,n=0){var r=sA(t.byteLength);if(r===t.byteLength)return t;{const i=new Uint8Array(r);if(i.set(new Uint8Array(t)),0!==n)for(let e=t.byteLength;e<r;e++)i[e]=n;return i.buffer}}let cA=null;class uA{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"v3d.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,l,t){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},t),0<this.options.animations.length&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);var n=this.buffers;const c=this.json;t=this.options;e=this.extensionsUsed,n=new Blob(n,{type:"application/octet-stream"}),e=Object.keys(e);if(0<e.length&&(c.extensionsUsed=e),c.buffers&&0<c.buffers.length&&(c.buffers[0].byteLength=n.size),!0===t.binary){const u=new window.FileReader;u.readAsArrayBuffer(n),u.onloadend=function(){var e=lA(u.result);const t=new DataView(new ArrayBuffer(8));t.setUint32(0,e.byteLength,!0),t.setUint32(4,5130562,!0);var n=lA(function(n){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(n).buffer;const r=new Uint8Array(new ArrayBuffer(n.length));for(let e=0,t=n.length;e<t;e++){var i=n.charCodeAt(e);r[e]=255<i?32:i}return r.buffer}(JSON.stringify(c)),32);const r=new DataView(new ArrayBuffer(8));r.setUint32(0,n.byteLength,!0),r.setUint32(4,1313821514,!0);var i=new ArrayBuffer(12);const a=new DataView(i);a.setUint32(0,1179937895,!0),a.setUint32(4,2,!0);var o=12+r.byteLength+n.byteLength+t.byteLength+e.byteLength;a.setUint32(8,o,!0);e=new Blob([i,r,n,t,e],{type:"application/octet-stream"});const s=new window.FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){l(s.result)}}}else if(c.buffers&&0<c.buffers.length){const r=new window.FileReader;r.readAsDataURL(n),r.onloadend=function(){var e=r.result;c.buffers[0].uri=e,l(c)}}else l(c)}serializeUserData(t,e){if(0!==Object.keys(t.userData).length){var n=this.options;const r=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(t.userData));if(n.includeCustomExtensions&&i.gltfExtensions){void 0===e.extensions&&(e.extensions={});for(const a in i.gltfExtensions)e.extensions[a]=i.gltfExtensions[a],r[a]=!0;delete i.gltfExtensions}0<Object.keys(i).length&&(e.extras=i)}catch(e){console.warn("v3d.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+e.message)}}}getUID(e){return this.uids.has(e)||this.uids.set(e,this.uid++),this.uids.get(e)}isNormalizedNormalAttribute(n){const e=this.cache;if(e.attributesNormalized.has(n))return!1;const r=new wn;for(let e=0,t=n.count;e<t;e++)if(5e-4<Math.abs(r.fromBufferAttribute(n,e).length()-1))return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new wn;for(let e=0,t=n.count;e<t;e++)r.fromBufferAttribute(n,e),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),n.setXYZ(e,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildORMTexture(e){var t=null==(i=e.aoMap)?void 0:i.image,n=null==(r=e.roughnessMap)?void 0:r.image,r=null==(i=e.metalnessMap)?void 0:i.image;if(t===n&&n===r)return t;if(t||n||r){var e=Math.max((null==t?void 0:t.width)||0,(null==n?void 0:n.width)||0,(null==r?void 0:r.width)||0),i=Math.max((null==t?void 0:t.height)||0,(null==n?void 0:n.height)||0,(null==r?void 0:r.height)||0);const l=document.createElement("canvas");l.width=e,l.height=i;const c=l.getContext("2d");c.fillStyle="#ffffff",c.fillRect(0,0,e,i);const u=c.getImageData(0,0,e,i);if(t){c.drawImage(t,0,0,e,i);var a=c.getImageData(0,0,e,i).data;for(let e=0;e<a.length;e+=4)u.data[e]=a[e]}if(n){c.drawImage(n,0,0,e,i);var o=c.getImageData(0,0,e,i).data;for(let e=1;e<o.length;e+=4)u.data[e]=o[e]}if(r){c.drawImage(r,0,0,e,i);var s=c.getImageData(0,0,e,i).data;for(let e=2;e<s.length;e+=4)u.data[e]=s[e]}return c.putImageData(u,0,0),new _n(l)}}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(r,i,e,t,n){const a=this.json;a.bufferViews||(a.bufferViews=[]);let o;o=i===rA.UNSIGNED_BYTE?1:i===rA.UNSIGNED_SHORT?2:4;var s=sA(t*r.itemSize*o);const l=new DataView(new ArrayBuffer(s));let c=0;for(let n=e;n<e+t;n++)for(let t=0;t<r.itemSize;t++){let e;4<r.itemSize?e=r.array[n*r.itemSize+t]:0===t?e=r.getX(n):1===t?e=r.getY(n):2===t?e=r.getZ(n):3===t&&(e=r.getW(n)),i===rA.FLOAT?l.setFloat32(c,e,!0):i===rA.UNSIGNED_INT?l.setUint32(c,e,!0):i===rA.UNSIGNED_SHORT?l.setUint16(c,e,!0):i===rA.UNSIGNED_BYTE&&l.setUint8(c,e),c+=o}const u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:s};return void 0!==n&&(u.target=n),n===rA.ARRAY_BUFFER&&(u.byteStride=r.itemSize*o),this.byteOffset+=s,a.bufferViews.push(u),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,a=i.json;return a.bufferViews||(a.bufferViews=[]),new Promise(function(n){const r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=lA(r.result),t={buffer:i.processBuffer(e),byteOffset:i.byteOffset,byteLength:e.byteLength};i.byteOffset+=e.byteLength,n(a.bufferViews.push(t)-1)}})}processAccessor(e,t,n,r){var i=this.options;const a=this.json;let o;if(e.array.constructor===Float32Array)o=rA.FLOAT;else if(e.array.constructor===Uint32Array)o=rA.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=rA.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("v3d.GLTFExporter: Unsupported bufferAttribute component type.");o=rA.UNSIGNED_BYTE}if(void 0===n&&(n=0),void 0===r&&(r=e.count),i.truncateDrawRange&&void 0!==t&&null===t.index&&(i=n+r,s=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count,n=Math.max(n,t.drawRange.start),(r=Math.min(i,s)-n)<0&&(r=0)),0===r)return null;var s=function(r,e,t){const i={min:new Array(r.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(r.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let t=0;t<r.itemSize;t++){let e;4<r.itemSize?e=r.array[n*r.itemSize+t]:0===t?e=r.getX(n):1===t?e=r.getY(n):2===t?e=r.getZ(n):3===t&&(e=r.getW(n)),i.min[t]=Math.min(i.min[t],e),i.max[t]=Math.max(i.max[t],e)}return i}(e,n,r);let l;void 0!==t&&(l=e===t.index?rA.ELEMENT_ARRAY_BUFFER:rA.ARRAY_BUFFER);n=this.processBufferView(e,o,n,r,l);const c={bufferView:n.id,byteOffset:n.byteOffset,componentType:o,count:r,max:s.max,min:s.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(c)-1}processImage(t,e,n){const r=this,i=r.cache,a=r.json;var o=r.options;const s=r.pending;i.images.has(t)||i.images.set(t,{});const l=i.images.get(t),c=e===Ke?"image/png":"image/jpeg";var u=c+":flipY/"+n.toString();if(void 0!==l[u])return l[u];a.images||(a.images=[]);const d={mimeType:c};if(o.embedImages){const h=cA=cA||document.createElement("canvas");h.width=Math.min(t.width,o.maxTextureSize),h.height=Math.min(t.height,o.maxTextureSize);const p=h.getContext("2d");if(!0===n&&(p.translate(0,h.height),p.scale(1,-1)),"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)p.drawImage(t,0,0,h.width,h.height);else{e!==Ke&&console.error("GLTFExporter: Only RGBAFormat is supported."),(t.width>o.maxTextureSize||t.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const f=new Uint8ClampedArray(t.height*t.width*4);for(let e=0;e<f.length;e+=4)f[e+0]=t.data[e+0],f[e+1]=t.data[e+1],f[e+2]=t.data[e+2],f[e+3]=t.data[e+3];p.putImageData(new ImageData(f,t.width,t.height),0,0)}!0===o.binary?s.push(new Promise(function(t){h.toBlob(function(e){r.processBufferViewImage(e).then(function(e){d.bufferView=e,t()})},c)})):d.uri=h.toDataURL(c)}else d.uri=t.src;o=a.images.push(d)-1;return l[u]=o}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);e={magFilter:iA[e.magFilter],minFilter:iA[e.minFilter],wrapS:iA[e.wrapS],wrapT:iA[e.wrapT]};return t.samplers.push(e)-1}processTexture(t){const e=this.cache,n=this.json;if(e.textures.has(t))return e.textures.get(t);n.textures||(n.textures=[]);const r={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY)};t.name&&(r.name=t.name),this._invokeAll(function(e){e.writeTexture&&e.writeTexture(t,r)});var i=n.textures.push(r)-1;return e.textures.set(t,i),i}processMaterial(t){const e=this.cache,n=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: v3d.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};!0!==t.isMeshStandardMaterial&&!0!==t.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var i=t.color.toArray().concat([t.opacity]);oA(i,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=i),t.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=t.metalness,r.pbrMetallicRoughness.roughnessFactor=t.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5);var a=this.buildORMTexture(t);if((t.metalnessMap||t.roughnessMap)&&(i={index:this.processTexture(a)},this.applyTextureTransform(i,t.metalnessMap||t.roughnessMap),r.pbrMetallicRoughness.metallicRoughnessTexture=i),t.map&&(o={index:this.processTexture(t.map)},this.applyTextureTransform(o,t.map),r.pbrMetallicRoughness.baseColorTexture=o),t.emissive){const s=t.emissive.clone().multiplyScalar(t.emissiveIntensity);var o=Math.max(s.r,s.g,s.b);1<o&&(s.multiplyScalar(1/o),console.warn("v3d.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),0<o&&(r.emissiveFactor=s.toArray()),t.emissiveMap&&(o={index:this.processTexture(t.emissiveMap)},this.applyTextureTransform(o,t.emissiveMap),r.emissiveTexture=o)}if(t.normalMap){const l={index:this.processTexture(t.normalMap)};t.normalScale&&1!==t.normalScale.x&&(l.scale=t.normalScale.x),this.applyTextureTransform(l,t.normalMap),r.normalTexture=l}if(t.aoMap){const c={index:this.processTexture(a),texCoord:1};1!==t.aoMapIntensity&&(c.strength=t.aoMapIntensity),this.applyTextureTransform(c,t.aoMap),r.occlusionTexture=c}t.transparent?r.alphaMode="BLEND":0<t.alphaTest&&(r.alphaMode="MASK",r.alphaCutoff=t.alphaTest),t.side===Oe&&(r.doubleSided=!0),""!==t.name&&(r.name=t.name),this.serializeUserData(t,r),this._invokeAll(function(e){e.writeMaterial&&e.writeMaterial(t,r)});a=n.materials.push(r)-1;return e.materials.set(t,a),a}processMesh(n){const r=this.cache,e=this.json,i=[n.geometry.uuid];if(Array.isArray(n.material))for(let e=0,t=n.material.length;e<t;e++)i.push(n.material[e].uuid);else i.push(n.material.uuid);var t=i.join(":");if(r.meshes.has(t))return r.meshes.get(t);const a=n.geometry;let o;if(o=n.isLineSegments?rA.LINES:n.isLineLoop?rA.LINE_LOOP:n.isLine?rA.LINE_STRIP:n.isPoints?rA.POINTS:n.material.wireframe?rA.LINES:rA.TRIANGLES,!0!==a.isBufferGeometry)throw new Error("v3d.GLTFExporter: Geometry is not of type v3d.BufferGeometry.");const s={},l={},c=[],u=[];var d,h={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=a.getAttribute("normal");void 0===p||this.isNormalizedNormalAttribute(p)||(console.warn("v3d.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let f=null;for(d in a.attributes)if("morph"!==d.substr(0,5)){var m,g=a.attributes[d];d=h[d]||d.toUpperCase();const y=/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/;y.test(d)||(d="_"+d),r.attributes.has(this.getUID(g))?l[d]=r.attributes.get(this.getUID(g)):(f=null,m=g.array,"JOINTS_0"!==d||m instanceof Uint16Array||m instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new Hr(new Uint16Array(m),g.itemSize,g.normalized)),null!==(m=this.processAccessor(f||g,a))&&(l[d]=m,r.attributes.set(this.getUID(g),m)))}if(void 0!==p&&a.setAttribute("normal",p),0===Object.keys(l).length)return null;if(void 0!==n.morphTargetInfluences&&0<n.morphTargetInfluences.length){const b=[],M=[],C={};if(void 0!==n.morphTargetDictionary)for(const S in n.morphTargetDictionary)C[n.morphTargetDictionary[S]]=S;for(let t=0;t<n.morphTargetInfluences.length;++t){const w={};let e=!1;for(const E in a.morphAttributes)if("position"===E||"normal"===E){const T=a.morphAttributes[E][t];var v=E.toUpperCase();const I=a.attributes[E];if(r.attributes.has(this.getUID(T)))w[v]=r.attributes.get(this.getUID(T));else{const R=T.clone();if(!a.morphTargetsRelative)for(let e=0,t=T.count;e<t;e++)R.setXYZ(e,T.getX(e)-I.getX(e),T.getY(e)-I.getY(e),T.getZ(e)-I.getZ(e));w[v]=this.processAccessor(R,a),r.attributes.set(this.getUID(I),w[v])}}else e||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),e=!0);u.push(w),b.push(n.morphTargetInfluences[t]),void 0!==n.morphTargetDictionary&&M.push(C[t])}s.weights=b,0<M.length&&(s.extras={},s.extras.targetNames=M)}p=Array.isArray(n.material);if(p&&0===a.groups.length)return null;var A=p?n.material:[n.material],_=p?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let t=0,e=_.length;t<e;t++){const L={mode:o,attributes:l};if(this.serializeUserData(a,L),0<u.length&&(L.targets=u),null!==a.index){let e=this.getUID(a.index);void 0===_[t].start&&void 0===_[t].count||(e+=":"+_[t].start+":"+_[t].count),r.attributes.has(e)?L.indices=r.attributes.get(e):(L.indices=this.processAccessor(a.index,a,_[t].start,_[t].count),r.attributes.set(e,L.indices)),null===L.indices&&delete L.indices}var x=this.processMaterial(A[_[t].materialIndex]);null!==x&&(L.material=x),c.push(L)}s.primitives=c,e.meshes||(e.meshes=[]),this._invokeAll(function(e){e.writeMesh&&e.writeMesh(n,s)});p=e.meshes.push(s)-1;return r.meshes.set(t,p),p}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);var n=e.isOrthographicCamera;const r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:Dt(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,i){const t=this.json,a=this.nodeMap;t.animations||(t.animations=[]);var o=(e=nA.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks;const s=[],l=[];for(let r=0;r<o.length;++r){const d=o[r];var c=Oh.parseTrackName(d.name);let e=Oh.findNode(i,c.nodeName);var u=aA[c.propertyName];if("bones"===c.objectName&&(e=!0===e.isSkinnedMesh?e.skeleton.getBoneByName(c.objectIndex):void 0),!e||!u)return console.warn('v3d.GLTFExporter: Could not export animation track "%s".',d.name),null;let t=d.values.length/d.times.length;u===aA.morphTargetInfluences&&(t/=e.morphTargetInfluences.length);let n;!0===d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(n="CUBICSPLINE",t/=3):n=d.getInterpolation()===lt?"STEP":"LINEAR",l.push({input:this.processAccessor(new Hr(d.times,1)),output:this.processAccessor(new Hr(d.values,t)),interpolation:n}),s.push({sampler:l.length-1,target:{node:a.get(e),path:u}})}return t.animations.push({name:e.name||"clip_"+t.animations.length,samplers:l,channels:s}),t.animations.length-1}processSkin(t){const e=this.json,n=this.nodeMap,r=e.nodes[n.get(t)];var i=t.skeleton;if(void 0===i)return null;var a=t.skeleton.bones[0];if(void 0===a)return null;const o=[];var s=new Float32Array(16*i.bones.length);const l=new rr;for(let e=0;e<i.bones.length;++e)o.push(n.get(i.bones[e])),l.copy(i.boneInverses[e]),l.multiply(t.bindMatrix).toArray(s,16*e);return void 0===e.skins&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new Hr(s,16)),joints:o,skeleton:n.get(a)}),r.skin=e.skins.length-1}processNode(n){const e=this.json;var t,r,i=this.options;const a=this.nodeMap;let o=!1;if(i.onlyVisible&&!n.visible&&(n.traverse(function(e){e.visible&&(o=!0)}),!o))return null;e.nodes||(e.nodes=[]);const s={};if(i.trs?(t=n.quaternion.toArray(),i=n.position.toArray(),r=n.scale.toArray(),oA(t,[0,0,0,1])||(s.rotation=t),oA(i,[0,0,0])||(s.translation=i),oA(r,[1,1,1])||(s.scale=r)):(n.matrixAutoUpdate&&n.updateMatrix(),!1===oA(n.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(s.matrix=n.matrix.elements)),""!==n.name&&(s.name=String(n.name)),this.serializeUserData(n,s),(n.isMesh||n.isLine||n.isPoints)&&!o?null!==(r=this.processMesh(n))&&(s.mesh=r):n.isCamera&&!o&&(s.camera=this.processCamera(n)),n.isSkinnedMesh&&!o&&this.skins.push(n),0<n.children.length){const u=[];for(let e=0,t=n.children.length;e<t;e++){var l=n.children[e];const c=this.processNode(l);null!==c&&u.push(c)}0<u.length&&(s.children=u)}this._invokeAll(function(e){e.writeNode&&e.writeNode(n,s)});const c=e.nodes.push(s)-1;return a.set(n,c),c}processScene(n){const e=this.json;var r=this.options;e.scenes||(e.scenes=[],e.scene=0);const t={};""!==n.name&&(t.name=n.name),e.scenes.push(t);const i=[];for(let e=0,t=n.children.length;e<t;e++){var a=n.children[e];!a.visible&&!1!==r.onlyVisible||null!==(a=this.processNode(a))&&i.push(a)}0<i.length&&(t.nodes=i),this.serializeUserData(n,t)}processObjects(t){const n=new oa;n.name="AuxScene";for(let e=0;e<t.length;e++)n.children.push(t[e]);this.processScene(n)}processInput(t){var n=this.options;t=t instanceof Array?t:[t],this._invokeAll(function(e){e.beforeParse&&e.beforeParse(t)});const r=[];for(let e=0;e<t.length;e++)t[e]instanceof oa?this.processScene(t[e]):r.push(t[e]);0<r.length&&this.processObjects(r);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let e=0;e<n.animations.length;++e)this.processAnimation(n.animations[e],t[0]);this._invokeAll(function(e){e.afterParse&&e.afterParse(t)})}_invokeAll(n){for(let e=0,t=this.plugins.length;e<t;e++)n(this.plugins[e])}}class dA{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(e.isLight)if(e.isDirectionalLight||e.isPointLight||e.isSpotLight){var n=this.writer;const r=n.json,i=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",0<e.distance&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",0<e.distance&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("v3d.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("v3d.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);const o=r.extensions[this.name].lights;o.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}else console.warn("v3d.GLTFExporter: Only directional, point, and spot lights are supported.",e)}}class hA{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(e.isMeshBasicMaterial){const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}}class pA{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(e.isGLTFSpecularGlossinessMaterial){const r=this.writer,i=r.extensionsUsed,a={};t.pbrMetallicRoughness.baseColorFactor&&(a.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var n=[1,1,1];e.specular.toArray(n,0),a.specularFactor=n,a.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(a.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap&&(n={index:r.processTexture(e.specularMap)},r.applyTextureTransform(n,e.specularMap),a.specularGlossinessTexture=n),t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}}class fA{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(e.isMeshPhysicalMaterial){const i=this.writer,a=i.extensionsUsed,o={};var n,r;o.clearcoatFactor=e.clearcoat,e.clearcoatMap&&(n={index:i.processTexture(e.clearcoatMap)},i.applyTextureTransform(n,e.clearcoatMap),o.clearcoatTexture=n),o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap&&(r={index:i.processTexture(e.clearcoatRoughnessMap)},i.applyTextureTransform(r,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=r),e.clearcoatNormalMap&&(r={index:i.processTexture(e.clearcoatNormalMap)},i.applyTextureTransform(r,e.clearcoatNormalMap),o.clearcoatNormalTexture=r),t.extensions=t.extensions||{},t.extensions[this.name]=o,a[this.name]=!0}}}class mA{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){const r=this.writer,i=r.extensionsUsed,a={};var n;a.transmissionFactor=e.transmission,e.transmissionMap&&(n={index:r.processTexture(e.transmissionMap)},r.applyTextureTransform(n,e.transmissionMap),a.transmissionTexture=n),t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}}class gA{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){const r=this.writer,i=r.extensionsUsed,a={};var n;a.thicknessFactor=e.thickness,e.thicknessMap&&(n={index:r.processTexture(e.thicknessMap)},r.applyTextureTransform(n,e.thicknessMap),a.thicknessTexture=n),a.attenuationDistance=e.attenuationDistance,a.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}}nA.Utils={insertKeyframe:function(t,n){var r=t.getValueSize();const i=new t.TimeBufferType(t.times.length+1),a=new t.ValueBufferType(t.values.length+r),o=t.createInterpolant(new t.ValueBufferType(r));let s;if(0===t.times.length){i[0]=n;for(let e=0;e<r;e++)a[e]=0;s=0}else if(n<t.times[0]){if(Math.abs(t.times[0]-n)<.001)return 0;i[0]=n,i.set(t.times,1),a.set(o.evaluate(n),0),a.set(t.values,r),s=0}else if(n>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-n)<.001)return t.times.length-1;i[i.length-1]=n,i.set(t.times,0),a.set(t.values,0),a.set(o.evaluate(n),t.values.length),s=i.length-1}else for(let e=0;e<t.times.length;e++){if(Math.abs(t.times[e]-n)<.001)return e;if(t.times[e]<n&&t.times[e+1]>n){i.set(t.times.slice(0,e+1),0),i[e+1]=n,i.set(t.times.slice(e+1),e+2),a.set(t.values.slice(0,(e+1)*r),0),a.set(o.evaluate(n),(e+1)*r),a.set(t.values.slice((e+1)*r),(e+2)*r),s=e+1;break}}return t.times=i,t.values=a,s},mergeMorphTargetTracks:function(e,t){const r=[],i={};var a=e.tracks;for(let e=0;e<a.length;++e){let n=a[e];var o=Oh.parseTrackName(n.name),s=Oh.findNode(t,o.nodeName);if("morphTargetInfluences"===o.propertyName&&void 0!==o.propertyIndex){if(n.createInterpolant!==n.InterpolantFactoryMethodDiscrete&&n.createInterpolant!==n.InterpolantFactoryMethodLinear){if(n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("v3d.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("v3d.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),n=n.clone(),n.setInterpolation(ct)}var l=s.morphTargetInfluences.length,c=s.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("v3d.GLTFExporter: Morph target name not found: "+o.propertyIndex);let t;if(void 0!==i[s.uuid]){const d=n.createInterpolant(new n.ValueBufferType(1));t=i[s.uuid];for(let e=0;e<t.times.length;e++)t.values[e*l+c]=d.evaluate(t.times[e]);for(let e=0;e<n.times.length;e++){var u=this.insertKeyframe(t,n.times[e]);t.values[u*l+c]=n.values[e]}}else{t=n.clone();const h=new t.ValueBufferType(l*t.times.length);for(let e=0;e<t.times.length;e++)h[e*l+c]=t.values[e];t.name=(o.nodeName||"")+".morphTargetInfluences",t.values=h,i[s.uuid]=t,r.push(t)}}else r.push(n)}return e.tracks=r,e}};"undefined"!=typeof __V3D_DEVTOOLS__&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:De}})),"undefined"!=typeof window&&(window.__V3D__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__V3D__=De);const vA=rn();if(vA.v3d&&(vA.THREE=vA.v3d),"undefined"!=typeof document){const AA=document.createElement("style");AA.appendChild(document.createTextNode(".v3d-container {\n    \n    overflow: hidden;\n    z-index: 0;\n}\n.v3d-canvas {\n    \n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    \n    z-index: -1;\n}\n.v3d-simple-preloader-background {\n    background-color: #fff;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 1;\n    height: 100%;\n    width: 100%;\n}\n.v3d-simple-preloader-container {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin-top: -90px;\n    margin-left: -90px;\n    width: 180px;\n    height: 180px;\n}\n.v3d-simple-preloader-bar {\n    background: linear-gradient(90deg, #1458ae, #4388e0);\n    width: 0%;\n    height: 3px;\n    margin: 15px -1px;\n    border: 1px solid;\n    border-radius: 5px;\n    border-color: #2b70c7;\n}\n.v3d-simple-preloader-logo {\n    width: 110px;\n    height: 120px;\n    background-repeat: no-repeat;\n    margin: 20px auto;\n}\n.v3d-annotation {\n    position: absolute;\n    top: -16px;\n    left: -16px;\n    width: auto;\n    min-width: 14px;\n    height: 26px;\n    padding: 2px 8px;\n    border: 1px solid #fff;\n    border-radius: 18px;\n    font-size: 16px;\n    font-family: sans-serif;\n    line-height: 26px;\n    color: #fff;\n    text-align: center;\n    user-select: none;\n    background: rgba(0, 0, 0, 0.8);\n}\n.v3d-annotation-transparent {\n    opacity: 0.5;\n}\n.v3d-annotation-dialog {\n    position: absolute;\n    top: 0;\n    left: 0;\n    margin-left: 15px;\n    margin-top: 31px;\n    font-family: sans-serif;\n    user-select: none;\n    padding: 1em;\n    min-width: 200px;\n    color: #fff;\n    background: rgba(0, 0, 0, 0.8);\n    border-radius: .5em;\n    font-size: 12px;\n    line-height: 1.2;\n    transition: opacity .5s;\n    visibility: hidden;\n}\n.v3d-webgl-error {\n    color: #015fb1;\n    background-color: white;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin-top: -44px;\n    margin-left: -256px;\n    text-align: center;\n    border-style: solid;\n    border-width: 3px;\n    border-radius: 8px;\n    border-color: #015fb1;\n    font-size: 20px;\n    font-family: sans-serif;\n    padding: 10px;\n    line-height: 30px;\n    z-index: 10;\n}\n@media only screen and (max-width: 540px) {\n    .v3d-webgl-error {\n        top: 50%;\n        left: 10px;\n        right: 10px;\n        margin-top: -58px;\n        margin-left: 0px;\n    }\n}\n.v3d-webgl-error-link {\n    color: #015fb1;\n}\n.v3d-device-motion-permissions-dialog {\n    z-index: 1;\n    position: absolute;\n    width: 100%;\n    background-color: #f00;\n    color: #000;\n    text-align: center;\n    padding: 10px;\n}\n")),document.head.insertBefore(AA,document.head.firstChild)}e.ACESFilmicToneMapping=4,e.AVERAGE=1,e.AddEquation=ue,e.AddOperation=2,e.AdditiveAnimationBlendMode=2501,e.AdditiveBlending=oe,e.AlphaFormat=p,e.AlwaysDepth=Ee,e.AlwaysStencilFunc=519,e.AmbientLight=Zd,e.AmbientLightProbe=mh,e.AnimationClip=Sd,e.AnimationLoader=Bd,e.AnimationMixer=Vh,e.AnimationObjectGroup=Uh,e.AnimationUtils=md,e.Annotation=$1,e.AnnotationControl=j1,e.App=B1,e.AppUtils=Dg,e.ArcCurve=Ec,e.ArrayCamera=Xs,e.ArrowHelper=xp,e.Audio=wh,e.AudioAnalyser=Lh,e.AudioContext=hh,e.AudioListener=Sh,e.AudioLoader=ph,e.AxesHelper=yp,e.AxisHelper=function(e){return console.warn("v3d.AxisHelper has been renamed to v3d.AxesHelper."),new yp(e)},e.BackSide=Fe,e.BasicDepthPacking=3200,e.BasicShadowMap=q,e.BilinearShadowMap=re,e.BinaryTextureLoader=function(e){return console.warn("v3d.BinaryTextureLoader has been renamed to v3d.DataTextureLoader."),new Fd(e)},e.BlenderTextBufferGeometry=Iu,e.BlenderTextGeometry=Iu,e.BloomPass=pg,e.BokehPass=fg,e.Bone=Fl,e.BooleanKeyframeTrack=Ad,e.BoundingBoxHelper=function(e,t){return console.warn("v3d.BoundingBoxHelper has been deprecated. Creating a v3d.BoxHelper instead."),new mp(e,t)},e.Box2=Hh,e.Box3=In,e.Box3Helper=gp,e.BoxBufferGeometry=Ii,e.BoxGeometry=Ii,e.BoxHelper=mp,e.BrightnessContrastPass=gg,e.BufferAttribute=Hr,e.BufferGeometry=ci,e.BufferGeometryLoader=ah,e.BufferGeometryUtils=xa,e.ByteType=a,e.CENTER=0,e.CSVParser=O1,e.Cache=wd,e.Camera=Di,e.CameraHelper=class extends nc{constructor(e){const t=new ci;var n=new Xl({color:16777215,vertexColors:!0,toneMapped:!1});const r=[],i=[],a={};var o=new mn(16755200),s=new mn(16711680),l=new mn(43775),c=new mn(16777215),u=new mn(3355443);function d(e,t,n){h(e,n),h(t,n)}function h(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}d("n1","n2",o),d("n2","n4",o),d("n4","n3",o),d("n3","n1",o),d("f1","f2",o),d("f2","f4",o),d("f4","f3",o),d("f3","f1",o),d("n1","f1",o),d("n2","f2",o),d("n3","f3",o),d("n4","f4",o),d("p","n1",s),d("p","n2",s),d("p","n3",s),d("p","n4",s),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",c),d("p","c",u),d("cn1","cn2",u),d("cn3","cn4",u),d("cf1","cf2",u),d("cf3","cf4",u),t.setAttribute("position",new ei(r,3)),t.setAttribute("color",new ei(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){const e=this.geometry;var t=this.pointMap;hp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),pp("c",t,e,hp,0,0,-1),pp("t",t,e,hp,0,0,1),pp("n1",t,e,hp,-1,-1,-1),pp("n2",t,e,hp,1,-1,-1),pp("n3",t,e,hp,-1,1,-1),pp("n4",t,e,hp,1,1,-1),pp("f1",t,e,hp,-1,-1,1),pp("f2",t,e,hp,1,-1,1),pp("f3",t,e,hp,-1,1,1),pp("f4",t,e,hp,1,1,1),pp("u1",t,e,hp,.7,1.1,-1),pp("u2",t,e,hp,-.7,1.1,-1),pp("u3",t,e,hp,0,2,-1),pp("cf1",t,e,hp,-1,0,1),pp("cf2",t,e,hp,1,0,1),pp("cf3",t,e,hp,0,-1,1),pp("cf4",t,e,hp,0,1,1),pp("cn1",t,e,hp,-1,0,-1),pp("cn2",t,e,hp,1,0,-1),pp("cn3",t,e,hp,0,-1,-1),pp("cn4",t,e,hp,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CameraUtils=F1,e.CanvasBreakpointsConstraint=O0,e.CanvasFitConstraint=F0,e.CanvasRenderer=function(){console.error("v3d.CanvasRenderer has been removed")},e.CanvasTexture=fc,e.CatmullRomCurve3=Pc,e.ChildOfConstraint=mm,e.CineonToneMapping=3,e.CircleBufferGeometry=mc,e.CircleGeometry=mc,e.ClampToEdgeWrapping=ze,e.ClearMaskPass=xg,e.Clock=_h,e.Color=mn,e.ColorKeyframeTrack=_d,e.Compat=Ng,e.CompressedTexture=pc,e.CompressedTextureLoader=Pd,e.ConeBufferGeometry=vc,e.ConeGeometry=vc,e.Constraint=dm,e.CopyLocationConstraint=_m,e.CopyRotationConstraint=Cm,e.CopyScaleConstraint=Tm,e.CopyTransformsConstraint=Dm,e.CubeCamera=Fi,e.CubeCopy=og,e.CubeReflectionMapping=T,e.CubeReflectionProbe=kg,e.CubeRefractionMapping=I,e.CubeTexture=Oi,e.CubeTextureHelper=X1,e.CubeTextureLoader=Nd,e.CubeUVReflectionMapping=D,e.CubeUVRefractionMapping=N,e.CubicBezierCurve=Oc,e.CubicBezierCurve3=Uc,e.CubicInterpolant=gd,e.CullFaceBack=j,e.CullFaceFront=K,e.CullFaceFrontBack=3,e.CullFaceNone=X,e.Curve=Sc,e.CurvePath=Hc,e.CustomBlending=ce,e.CustomToneMapping=5,e.CylinderBufferGeometry=gc,e.CylinderGeometry=gc,e.Cylindrical=class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},e.DampedTrackConstraint=Hm,e.DataTexture=Ol,e.DataTexture2DArray=za,e.DataTexture3D=Ha,e.DataTextureLoader=Fd,e.DataUtils=Sp,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=xt,e.DefaultLoadingManager=Td,e.DepthFormat=qe,e.DepthStencilFormat=Ze,e.DepthTexture=Zs,e.Detector=rl,e.DirectionalLight=qd,e.DirectionalLightHelper=up,e.DiscreteInterpolant=Qu,e.DodecahedronBufferGeometry=_c,e.DodecahedronGeometry=_c,e.DoubleSide=Oe,e.DstAlphaFactor=ye,e.DstColorFactor=Me,e.DynamicBufferAttribute=function(e,t){return console.warn("v3d.DynamicBufferAttribute has been removed. Use new v3d.BufferAttribute().setUsage(v3d.DynamicDrawUsage) instead."),new Hr(e,t).setUsage(n)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=n,e.DynamicReadUsage=35049,e.ESMDistancePacking=gt,e.ESMShadowMap=te,e.EdgesGeometry=Cc,e.EdgesHelper=function(e,t){return console.warn("v3d.EdgesHelper has been removed. Use v3d.EdgesGeometry instead."),new nc(new Cc(e.geometry),new Xl({color:void 0!==t?t:16777215}))},e.EffectComposer=Qg,e.EllipseCurve=wc,e.EqualDepth=Re,e.EqualStencilFunc=514,e.EquiCube=sg,e.EquirectangularReflectionMapping=l,e.EquirectangularRefractionMapping=c,e.Euler=pr,e.EventDispatcher=t,e.ExtrudeBufferGeometry=fu,e.ExtrudeGeometry=fu,e.FXAAPass=vg,e.FaceColors=1,e.FileLoader=Ld,e.FilmicBlenderToneMapping=8,e.FirstPersonControls=H0,e.FixOrthoZoomConstraint=R0,e.FlatShading=1,e.Float16BufferAttribute=$r,e.Float32Attribute=function(e,t){return console.warn("v3d.Float32Attribute has been removed. Use new v3d.Float32BufferAttribute() instead."),new ei(e,t)},e.Float32BufferAttribute=ei,e.Float64Attribute=function(e,t){return console.warn("v3d.Float64Attribute has been removed. Use new v3d.Float64BufferAttribute() instead."),new ti(e,t)},e.Float64BufferAttribute=ti,e.FloatType=Ye,e.FloorConstraint=Zm,e.FlyingControls=X0,e.Fog=sl,e.FogExp2=ol,e.Font=rv,e.FontLoader=function(){console.error("v3d.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},e.FramebufferTexture=hc,e.FrontSide=Ne,e.Frustum=Hi,e.GLBufferAttribute=Qh,e.GLSL1="100",e.GLSL3=yt,e.GLTFExporter=nA,e.GLTFLoader=dv,e.GTAOMapGenerator=_1,e.GraphUtils=Wu,e.GrayscalePass=Ag,e.GreaterDepth=Be,e.GreaterEqualDepth=Le,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=op,e.Group=js,e.HalfFloatType=Xe,e.HemisphereLight=zd,e.HemisphereLightHelper=ap,e.HemisphereLightProbe=fh,e.IBLEnvironmentPMREM=0,e.IBLEnvironmentProbe=2,e.IBLEnvironmentProbeCubemap=1,e.IcosahedronBufferGeometry=gu,e.IcosahedronGeometry=gu,e.ImageBitmapLoader=uh,e.ImageLoader=Dd,e.ImageUtils=vn,e.ImmediateRenderObject=function(){console.error("v3d.ImmediateRenderObject has been removed.")},e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=_t,e.InstancedBufferAttribute=Gl,e.InstancedBufferGeometry=ih,e.InstancedInterleavedBuffer=kh,e.InstancedMesh=Yl,e.Int16Attribute=function(e,t){return console.warn("v3d.Int16Attribute has been removed. Use new v3d.Int16BufferAttribute() instead."),new Kr(e,t)},e.Int16BufferAttribute=Kr,e.Int32Attribute=function(e,t){return console.warn("v3d.Int32Attribute has been removed. Use new v3d.Int32BufferAttribute() instead."),new Zr(e,t)},e.Int32BufferAttribute=Zr,e.Int8Attribute=function(e,t){return console.warn("v3d.Int8Attribute has been removed. Use new v3d.Int8BufferAttribute() instead."),new Yr(e,t)},e.Int8BufferAttribute=Yr,e.IntType=u,e.InterleavedBuffer=ll,e.InterleavedBufferAttribute=ul,e.Interpolant=ku,e.InterpolateDiscrete=lt,e.InterpolateLinear=ct,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("v3d.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=vd,e.Keys=G0,e.LOD=Il,e.LatheBufferGeometry=vu,e.LatheGeometry=vu,e.Layers=fr,e.LensFlare=function(){console.error("v3d.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=Te,e.LessEqualDepth=Ie,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=Ud,e.LightProbe=th,e.LightProbeGenerator=C1,e.LimitDistanceConstraint=n0,e.LimitLocationConstraint=r0,e.LimitRotationConstraint=a0,e.LimitScaleConstraint=o0,e.Line=$l,e.Line3=jh,e.LineBasicMaterial=Xl,e.LineCurve=zc,e.LineCurve3=Vc,e.LineDashedMaterial=Vu,e.LineHTML=k1,e.LineLoop=rc,e.LinePieces=1,e.LineSegments=nc,e.LineStrip=0,e.LinearDepthPacking=3202,e.LinearEncoding=pt,e.LinearFilter=Ge,e.LinearInterpolant=ed,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=ke,e.LinearMipmapNearestFilter=Y,e.LinearToneMapping=1,e.Loader=Id,e.LoaderUtils=rh,e.LoadingManager=Ed,e.LockedTrackConstraint=v0,e.LogarithmicMaxToneMapping=6,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=g,e.LuminanceFormat=m,e.MOD_SUITE=Mt,e.MOUSE=$,e.MaskPass=_g,e.Material=Gr,e.MaterialLoader=nh,e.MaterialUtils=um,e.Math=Ht,e.MathUtils=Ht,e.Matrix3=Xt,e.Matrix4=rr,e.MaxEquation=fe,e.Mesh=Ei,e.MeshBVH=Zf,e.MeshBasicMaterial=kr,e.MeshDepthMaterial=ws,e.MeshDistanceMaterial=Es,e.MeshFaceMaterial=function(e){return console.warn("v3d.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=Uu,e.MeshLine=yg,e.MeshLineIndexed=Sg,e.MeshLineMaterial=Eg,e.MeshMaskMaterial=Gu,e.MeshMatcapMaterial=zu,e.MeshNodeMaterial=dd,e.MeshNormalMaterial=Ou,e.MeshPhongMaterial=Nu,e.MeshPhysicalMaterial=Du,e.MeshStandardMaterial=Pu,e.MeshToonMaterial=Fu,e.MinEquation=pe,e.MirroredRepeatWrapping=Q,e.MixOperation=1,e.MultiMaterial=function(e=[]){return console.warn("v3d.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e},e.MultiplyBlending=le,e.MultiplyOperation=0,e.NearestFilter=Ve,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=H,e.NearestMipmapNearestFilter=W,e.NeverDepth=we,e.NeverStencilFunc=512,e.NoBlending=ie,e.NoColors=0,e.NoToneMapping=Ue,e.NormalAnimationBlendMode=2500,e.NormalBlending=ae,e.NotEqualDepth=Pe,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=xd,e.Object3D=Tr,e.ObjectLoader=oh,e.ObjectSpaceNormalMap=At,e.OctahedronBufferGeometry=Au,e.OctahedronGeometry=Au,e.OneFactor=ge,e.OneMinusDstAlphaFactor=be,e.OneMinusDstColorFactor=Ce,e.OneMinusSrcAlphaFactor=xe,e.OneMinusSrcColorFactor=Ae,e.OrbitControls=ag,e.OrthographicCamera=ia,e.OutlinePass=Tg,e.PCFShadowMap=Z,e.PCFShadowMapPoissonDisk=ne,e.PCFSoftShadowMap=J,e.PMREMGenerator=ba,e.ParametricGeometry=function(){return console.error("v3d.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new ci},e.Particle=function(e){return console.warn("v3d.Particle has been renamed to v3d.Sprite."),new Sl(e)},e.ParticleBasicMaterial=function(e){return console.warn("v3d.ParticleBasicMaterial has been renamed to v3d.PointsMaterial."),new ic(e)},e.ParticleSystem=function(e,t){return console.warn("v3d.ParticleSystem has been renamed to v3d.Points."),new cc(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("v3d.ParticleSystemMaterial has been renamed to v3d.PointsMaterial."),new ic(e)},e.Pass=lg,e.Path=Yc,e.PerspectiveCamera=Ni,e.PhysicalMaxToneMapping=7,e.Plane=ki,e.PlaneBufferGeometry=ji,e.PlaneGeometry=ji,e.PlaneHelper=class extends $l{constructor(e,t=1,n=16776960){const r=new ci;r.setAttribute("position",new ei([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Xl({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const i=new ci;i.setAttribute("position",new ei([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),i.computeBoundingSphere(),this.add(new Ei(i,new kr({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Fe:Ne,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},e.PointCloud=function(e,t){return console.warn("v3d.PointCloud has been renamed to v3d.Points."),new cc(e,t)},e.PointCloudMaterial=function(e){return console.warn("v3d.PointCloudMaterial has been renamed to v3d.PointsMaterial."),new ic(e)},e.PointLight=Yd,e.PointLightHelper=tp,e.Points=cc,e.PointsMaterial=ic,e.PolarGridHelper=class extends nc{constructor(t=10,n=16,r=8,i=64,a=4473924,o=8947848){a=new mn(a),o=new mn(o);const s=[],l=[];for(let e=0;e<=n;e++){var c=e/n*(2*Math.PI),u=Math.sin(c)*t,c=Math.cos(c)*t;s.push(0,0,0),s.push(u,0,c);c=1&e?a:o;l.push(c.r,c.g,c.b),l.push(c.r,c.g,c.b)}for(let e=0;e<=r;e++){var d=1&e?a:o,h=t-t/r*e;for(let e=0;e<i;e++){var p=e/i*(2*Math.PI),f=Math.sin(p)*h,m=Math.cos(p)*h;s.push(f,0,m),l.push(d.r,d.g,d.b),p=(e+1)/i*(2*Math.PI),f=Math.sin(p)*h,m=Math.cos(p)*h,s.push(f,0,m),l.push(d.r,d.g,d.b)}}const e=new ci;e.setAttribute("position",new ei(s,3)),e.setAttribute("color",new ei(l,3));var g=new Xl({vertexColors:!0,toneMapped:!1});super(e,g),this.type="PolarGridHelper"}},e.PolyhedronBufferGeometry=Ac,e.PolyhedronGeometry=Ac,e.PositionalAudio=class extends wh{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Eh,Th,Ih),Rh.set(0,0,1).applyQuaternion(Th);const t=this.panner;t.positionX?(e=this.context.currentTime+this.listener.timeDelta,t.positionX.linearRampToValueAtTime(Eh.x,e),t.positionY.linearRampToValueAtTime(Eh.y,e),t.positionZ.linearRampToValueAtTime(Eh.z,e),t.orientationX.linearRampToValueAtTime(Rh.x,e),t.orientationY.linearRampToValueAtTime(Rh.y,e),t.orientationZ.linearRampToValueAtTime(Rh.z,e)):(t.setPosition(Eh.x,Eh.y,Eh.z),t.setOrientation(Rh.x,Rh.y,Rh.z))}}},e.Preloader=Q1,e.PropertyBinding=Oh,e.PropertyMixer=Bh,e.PuzzlesLoader=H1,e.QuadraticBezierCurve=Gc,e.QuadraticBezierCurve3=kc,e.Quaternion=Sn,e.QuaternionKeyframeTrack=bd,e.QuaternionLinearInterpolant=yd,e.REVISION=De,e.RGBADepthPacking=i,e.RGBADistancePacking=mt,e.RGBAFormat=Ke,e.RGBAIntegerFormat=x,e.RGBA_ASTC_10x10_Format=it,e.RGBA_ASTC_10x5_Format=tt,e.RGBA_ASTC_10x6_Format=nt,e.RGBA_ASTC_10x8_Format=rt,e.RGBA_ASTC_12x10_Format=at,e.RGBA_ASTC_12x12_Format=ot,e.RGBA_ASTC_4x4_Format=F,e.RGBA_ASTC_5x4_Format=O,e.RGBA_ASTC_5x5_Format=U,e.RGBA_ASTC_6x5_Format=z,e.RGBA_ASTC_6x6_Format=V,e.RGBA_ASTC_8x5_Format=G,e.RGBA_ASTC_8x6_Format=$e,e.RGBA_ASTC_8x8_Format=et,e.RGBA_BPTC_Format=st,e.RGBA_ETC2_EAC_Format=P,e.RGBA_PVRTC_2BPPV1_Format=R,e.RGBA_PVRTC_4BPPV1_Format=E,e.RGBA_S3TC_DXT1_Format=b,e.RGBA_S3TC_DXT3_Format=M,e.RGBA_S3TC_DXT5_Format=C,e.RGBELoader=Kg,e.RGBFormat=f,e.RGB_ETC1_Format=L,e.RGB_ETC2_Format=B,e.RGB_PVRTC_2BPPV1_Format=w,e.RGB_PVRTC_4BPPV1_Format=S,e.RGB_S3TC_DXT1_Format=y,e.RGFormat=A,e.RGIntegerFormat=_,e.RawShaderMaterial=aa,e.Ray=nr,e.Raycaster=Js,e.RectAreaLight=$d,e.RectAreaLightUniformsLib=nv,e.RedFormat=Je,e.RedIntegerFormat=v,e.ReflectionProbeTypeBox=2,e.ReflectionProbeTypeInfinite=0,e.ReflectionProbeTypeSphere=1,e.ReinhardToneMapping=2,e.RenderPass=Ig,e.RenderUtils=Fg,e.RepeatWrapping=k,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=he,e.RingBufferGeometry=_u,e.RingGeometry=_u,e.SAH=2,e.SSAARenderPass=Rg,e.SSAOPass=function(){console.error("v3d.SSAOPass has been removed, use v3d.GTAOMapGenerator instead")},e.Scene=oa,e.SceneBackground=E1,e.SceneUtils=T1,e.ShaderChunk=Ki,e.ShaderLib=Zi,e.ShaderMaterial=Pi,e.ShaderPass=mg,e.ShadowMaterial=Bu,e.Shape=Xc,e.ShapeBufferGeometry=xu,e.ShapeGeometry=xu,e.ShapePath=bp,e.ShapeUtils=du,e.ShortType=s,e.SimplePreloader=W1,e.Skeleton=Vl,e.SkeletonHelper=ep,e.SkinnedMesh=Nl,e.SmoothShading=2,e.Sphere=jn,e.SphereBufferGeometry=yu,e.SphereGeometry=yu,e.Spherical=sd,e.SphericalHarmonics3=eh,e.SplineCurve=Qc,e.SpotLight=Gd,e.SpotLightHelper=qh,e.Sprite=Sl,e.SpriteMaterial=dl,e.SrcAlphaFactor=_e,e.SrcAlphaSaturateFactor=Se,e.SrcColorFactor=ve,e.StaticCopyUsage=35046,e.StaticDrawUsage=r,e.StaticReadUsage=35045,e.Stats=I1,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ni,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ni,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;var n,r,i,a;t.focus===e.focus&&t.fov===e.fov&&t.aspect===e.aspect*this.aspect&&t.near===e.near&&t.far===e.far&&t.zoom===e.zoom&&t.eyeSep===this.eyeSep||(t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ah.copy(e.projectionMatrix),n=(a=t.eyeSep/2)*t.near/t.focus,r=t.near*Math.tan(Et*t.fov*.5)/t.zoom,vh.elements[12]=-a,gh.elements[12]=a,i=-r*t.aspect+n,a=r*t.aspect+n,Ah.elements[0]=2*t.near/(a-i),Ah.elements[8]=(a+i)/(a-i),this.cameraL.projectionMatrix.copy(Ah),i=-r*t.aspect-n,a=r*t.aspect-n,Ah.elements[0]=2*t.near/(a-i),Ah.elements[8]=(a+i)/(a-i),this.cameraR.projectionMatrix.copy(Ah)),this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(vh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(gh)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=Md,e.SubtractEquation=de,e.SubtractiveBlending=se,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TTFLoader=jg,e.TangentSpaceNormalMap=vt,e.TargetConstraint=hm,e.TeapotBufferGeometry=Ru,e.TeapotGeometry=Ru,e.TetrahedronBufferGeometry=bu,e.TetrahedronGeometry=bu,e.TextBufferGeometry=Tu,e.TextGeometry=Tu,e.Texture=_n,e.TextureLoader=Od,e.ToneMapPass=Bg,e.TorusBufferGeometry=Mu,e.TorusGeometry=Mu,e.TorusKnotBufferGeometry=Cu,e.TorusKnotGeometry=Cu,e.TrackToConstraint=I0,e.Triangle=zr,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Su,e.TubeGeometry=Su,e.TweenCameraController=Q0,e.TweenLinear=0,e.TweenSpherical=1,e.UVMapping=o,e.Uint16Attribute=function(e,t){return console.warn("v3d.Uint16Attribute has been removed. Use new v3d.Uint16BufferAttribute() instead."),new qr(e,t)},e.Uint16BufferAttribute=qr,e.Uint32Attribute=function(e,t){return console.warn("v3d.Uint32Attribute has been removed. Use new v3d.Uint32BufferAttribute() instead."),new Jr(e,t)},e.Uint32BufferAttribute=Jr,e.Uint8Attribute=function(e,t){return console.warn("v3d.Uint8Attribute has been removed. Use new v3d.Uint8BufferAttribute() instead."),new Xr(e,t)},e.Uint8BufferAttribute=Xr,e.Uint8ClampedAttribute=function(e,t){return console.warn("v3d.Uint8ClampedAttribute has been removed. Use new v3d.Uint8ClampedBufferAttribute() instead."),new jr(e,t)},e.Uint8ClampedBufferAttribute=jr,e.Uniform=Gh,e.UniformsLib=qi,e.UniformsUtils=Bi,e.UnsignedByteType=Qe,e.UnsignedInt248Type=je,e.UnsignedIntType=He,e.UnsignedShort4444Type=d,e.UnsignedShort5551Type=h,e.UnsignedShortType=We,e.V3DL=Ct,e.VSMShadowMap=ee,e.Vector2=Yt,e.Vector3=wn,e.Vector4=yn,e.VectorKeyframeTrack=Cd,e.Vertex=function(e,t,n){return console.warn("v3d.Vertex has been removed. Use v3d.Vector3 instead."),new wn(e,t,n)},e.VertexColors=2,e.VideoTexture=dc,e.ViewportFitAuto=3,e.ViewportFitFill=4,e.ViewportFitHorizontal=2,e.ViewportFitNone=0,e.ViewportFitOverscan=5,e.ViewportFitVertical=1,e.Visualizer=nm,e.WebGL1Renderer=al,e.WebGLCubeRenderTarget=Ui,e.WebGLMultipleRenderTargets=Mn,e.WebGLMultisampleRenderTarget=Cn,e.WebGLRenderTarget=bn,e.WebGLRenderTargetCube=function(e,t,n){return console.warn("v3d.WebGLRenderTargetCube(width, height, options) is now WebGLCubeRenderTarget(size, options)."),new Ui(e,n)},e.WebGLRenderer=il,e.WebGLUtils=Ys,e.WebXRUtils=_a,e.WireframeGeometry=wu,e.WireframeHelper=function(e,t){return console.warn("v3d.WireframeHelper has been removed. Use v3d.WireframeGeometry instead."),new nc(new wu(e.geometry),new Xl({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=ht,e.XHRLoader=function(e){return console.warn("v3d.XHRLoader has been renamed to v3d.FileLoader."),new Ld(e)},e.XZ=Hg,e.XZLoader=Xg,e.ZeroCurvatureEnding=ut,e.ZeroFactor=me,e.ZeroSlopeEnding=dt,e.ZeroStencilOp=0,e._SRGBAFormat=bt,e.acceleratedRaycast=om,e.arrayMax=jt,e.arrayMin=function(n){if(0===n.length)return 1/0;let r=n[0];for(let e=1,t=n.length;e<t;++e)n[e]<r&&(r=n[e]);return r},e.clampArray=en,e.computeBoundsTree=sm,e.disposeBoundsTree=lm,e.getGlobalScope=rn,e.isDef=$t,e.loadModule=sn,e.sRGBEncoding=ft,e.shaderFloatStr=nn,Object.defineProperty(e,"__esModule",{value:!0})});
